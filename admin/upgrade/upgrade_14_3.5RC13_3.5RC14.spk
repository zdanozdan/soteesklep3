diff -ruN ../soteesklep3/000-upgrade_config.php soteesklep3/000-upgrade_config.php
--- ../soteesklep3/000-upgrade_config.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/000-upgrade_config.php	2006-08-20 15:31:41.000000000 +0200
@@ -0,0 +1,3 @@
+<?php
+define("PATCH_VERSION",14);
+?>
diff -ruN ../soteesklep3/admin/go/_configure/html/configure.html.php soteesklep3/admin/go/_configure/html/configure.html.php
--- ../soteesklep3/admin/go/_configure/html/configure.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_configure/html/configure.html.php	2006-08-23 16:58:43.000000000 +0200
@@ -0,0 +1,85 @@
+<?php
+/**
+* Formularz z elementami konfiguracji sklepu.
+*
+* @author  krzys@sote.pl
+* @version $Id: configure.html.php,v 1.45 2006/08/16 10:20:47 lukasz Exp $
+* @package    configure
+*/
+
+global $config; 
+$theme->bar($lang->configure_title,"100%");print "<BR>";
+$theme->desktop_open("100%");
+
+// odczytaj aktualne order_id
+$order_id_current=$mdbd->select("order_id","order_id",1,array(),"LIMIT 1");
+/**
+* Dodaj obsï¿½ugï¿½ formularzy.
+*/
+require_once ("HTML/Form.php");
+
+$break="</td></tr><tr><td><hr></td></tr><tr><td align=right>";
+
+$form =& new HTML_Form("index.php","POST");
+$form->addHidden("update","true");
+
+// Pokaï¿½ mozliwoï¿½c zmiany symbolu waluty tylko dla wersji light. W wersji expert
+// zmiana symbolu waluty jest zintegrowana z moduï¿½ï¿½m walut
+if ($config->nccp!=0x1388) {
+    $form->addText("configure[currency]",$lang->configure_form['currency'],$config->currency,6);
+} else {
+    $form->addHidden("configure[currency]",$config->currency);
+}
+if ($config->ssl==1){
+$form->addCheckbox("configure[ssl]",$lang->configure_form['ssl'],$config->ssl);
+}
+$form->addSelect("configure[price_type]",$break.$lang->configure_form['price_type'],$lang->price_type,$config->price_type);
+
+$form->addSelect("configure[record_row_type_default]",$break.$lang->configure_form['record_row_type_default'],$lang->configure_record_row_type_default,$config->record_row_type_default);
+$form->addSelect("configure[main_order_default]",$lang->configure_form['main_order_default'],$lang->main_order_default,$config->main_order_default);
+$form->addText("configure[products_on_page_short]",$lang->configure_form['products_on_page_short'],$config->products_on_page['short'],4);
+$form->addText("configure[products_on_page_long]",$lang->configure_form['products_on_page_long'],$config->products_on_page['long'],4);
+
+
+$form->addText("configure[google_keywords]",$break.$lang->configure_form['google_keywords'],$config->google['keywords'],70);
+$form->addText("configure[google_title]",$lang->configure_form['google_title'],$config->google['title'],70);
+
+$form->addTextarea("configure[google_description]",$lang->configure_form['google_description'],$config->google['description'],80,7,1024);
+
+
+$form->addText("configure[image_max_size]",$break.$lang->configure_form['image_max_size'].$lang->configure_form['pixels'],$config->image['max_size'],4);
+$form->addText("configure[image_min_size]",$lang->configure_form['image_min_size'].$lang->configure_form['pixels'],$config->image['min_size'],4);
+
+$form->addText("configure[unit]",$break.$lang->configure_form['unit'],$config->unit,30);
+
+$form->addBlank("",$break.$lang->configure_form['random_on_page']);
+$form->AddText("configure[random_on_page_promotion]",$lang->configure_form['random_on_page_promotion'],$config->random_on_page['promotion'],2);
+$form->AddText("configure[random_on_page_newcol]",$lang->configure_form['random_on_page_newcol'],$config->random_on_page['newcol'],2);
+$form->AddText("configure[random_on_page_bestseller]",$lang->configure_form['random_on_page_bestseller'],$config->random_on_page['bestseller'],2);
+
+
+$form->addText("configure[id_start_orders_default]",$break.$lang->configure_form['id_start_orders_default'],$order_id_current,4);
+$form->addSelect("configure[in_category_down]",$lang->configure_form['in_category_down'],$lang->configure_in_category_down,$config->in_category_down);
+$form->addCheckbox("configure[category_multi]",$lang->configure_form['category_multi'],$config->category_multi);
+$form->addCheckbox("configure[newsletter]",$lang->configure_form['newsletter'],$config->newsletter);
+if (in_array("currency",$config->plugins)) {
+	$form->addCheckbox("configure[currency_show_form]",$lang->configure_form['currency_show_form'],$config->currency_show_form);
+}
+$form->addCheckbox("configure[cyfra_photo]",$lang->configure_form['cyfra_photo'],$config->cyfra_photo);
+if (in_array("extbasket",$config->plugins)) {
+    $form->addCheckbox("configure[basket_photo]",$lang->configure_form['basket_photo'],$config->basket_photo);
+}
+$form->addCheckbox("configure[pay_method_active_1]",$lang->configure_form['pay_method_active_1'],$config->pay_method_active['1']);
+$form->addCheckbox("configure[pay_method_active_11]",$lang->configure_form['pay_method_active_11'],$config->pay_method_active['11']);
+$form->addCheckbox("configure[users_online]",$lang->configure_form['users_online'],$config->users_online);
+$form->addCheckbox("configure[display_availability]",$lang->configure_form['display_availability'],$config->depository['display_availability']);
+//$form->addCheckbox("configure[basket_wishlist][prod_ext_info]",$lang->configure_form['basket_ext'],$config->basket_wishlist['prod_ext_info']);
+//$form->addCheckbox("configure[ssl]",$lang->configure_form['ssl'],$config->ssl);
+$form->addCheckbox("configure[show_user_id]",$lang->configure_form['show_user_id'],$config->show_user_id);
+// $form->addCheckbox("configure[debug]",$lang->configure_form['debug'],$config->debug);
+
+$form->addSubmit("submit",$lang->update);
+$form->display();
+
+$theme->desktop_close();
+?>
diff -ruN ../soteesklep3/admin/go/_configure/index.php soteesklep3/admin/go/_configure/index.php
--- ../soteesklep3/admin/go/_configure/index.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_configure/index.php	2006-08-23 16:58:43.000000000 +0200
@@ -0,0 +1,173 @@
+<?php
+/**
+* Konfiguracja sklepu, róne elementy z config.inc.php itp. 
+* Skrypt odczytuje dane z formularza i zapisuje odpowiednie wartoï¿½ci w pliku konfiguracyjnym u¿ytkownika.
+* Plik do którego zapisywane s± dane: config/auto_config/user_config.inc.php
+*
+* @author  krzys@sote.pl
+* @version $Id: index.php,v 1.46 2006/08/16 10:20:46 lukasz Exp $
+* @package    configure
+*/
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+/**
+* Nag³ówek skryptu.
+*/
+require_once ("../../../include/head.inc");
+
+/**
+* Obs³uga generowania pliku konfiguracyjnego u¿ytkownika.
+*/
+require_once("include/gen_user_config.inc.php");
+
+if (! empty($_REQUEST['configure'])) {
+    $configure=$_REQUEST['configure'];
+}
+
+// naglowek
+$theme->head();
+$theme->page_open_head();
+include_once ("./include/menu.inc.php");
+
+// zapisz dane w pliku konfiguracyjnym usera
+if (! empty($_REQUEST['update'])) {
+    $ftp->connect();
+
+    // config
+    if (empty($configure['debug'])) $configure['debug']=0;
+    else $configure['debug']=1;
+    if (empty($configure['cyfra_photo'])) $configure['cyfra_photo']=0;
+    else $configure['cyfra_photo']=1;
+    if (empty($configure['basket_photo'])) $configure['basket_photo']=0;
+    else $configure['basket_photo']=1;
+    if (empty($configure['newsletter'])) $configure['newsletter']=0;
+    else $configure['newsletter']=1;
+    if (empty($configure['currency_show_form'])) $configure['currency_show_form']=0;
+    else $configure['currency_show_form']=1;
+    if (empty($configure['category_multi'])) $configure['category_multi']=0;
+    else $configure['category_multi']=1;
+    if (empty($configure['pay_method_active_1'])) $configure['pay_method_active_1']=0;
+    else $configure['pay_method_active_1']=1;
+    if (empty($configure['pay_method_active_11'])) $configure['pay_method_active_11']=0;
+    else $configure['pay_method_active_11']=1;
+    
+    if (empty($configure['users_online'])) $configure['users_online']=0;
+    else $configure['users_online']=1;
+	if (empty($configure['basket_wishlist']['prod_ext_info'])) $configure['basket_wishlist']['prod_ext_info']=0;
+    else $configure['basket_wishlist']['prod_ext_info']=1;
+	if (empty($configure['ssl'])) $configure['ssl']=0;
+    else $configure['ssl']=1;
+    
+    if (empty($configure['display_availability']))
+        $configure['depository']['display_availability'] = 0;
+    else
+        $configure['depository']['display_availability'] = 1;
+        
+	if (empty($configure['show_user_id'])) $configure['show_user_id']=0;
+    else $configure['show_user_id']=1;
+
+    unset($configure['display_availability']);
+    $configure_tmp = $configure['depository']['display_availability'];
+    $configure['depository'] = $config->depository;
+    $configure['depository']['display_availability'] = $configure_tmp;
+
+    if (! ereg("^[0-9]+$",$configure['products_on_page_short'])) $configure['products_on_page_short']=$config->products_on_page['short'];
+    if (! ereg("^[0-9]+$",$configure['products_on_page_long']))  $configure['products_on_page_long']=$config->products_on_page['long'];
+
+    $products_on_page=array("long"=>$configure['products_on_page_long'],"short"=>$configure['products_on_page_short']);
+
+    $random_on_page=array("promotion"=>$configure['random_on_page_promotion'],
+    "newcol"=>$configure['random_on_page_newcol'],
+    "bestseller"=>$configure['random_on_page_bestseller'],
+    );
+
+    $image=array("max_size"=>$configure['image_max_size'],
+    "min_size"=>$configure['image_min_size'],
+    );
+
+    $google=array("keywords"=>$configure['google_keywords'],
+    "title"=>$configure['google_title'],
+    "description"=>$configure['google_description'],
+    );
+    
+    $pay_method_active=$config->pay_method_active;
+    $pay_method_active['1']=$configure['pay_method_active_1'];
+    $pay_method_active['11']=$configure['pay_method_active_11'];
+
+    // odczytaj aktualne order_id
+    $order_id_current=$mdbd->select("order_id","order_id",1,array(),"LIMIT 1");
+    if ($configure['id_start_orders_default']<$order_id_current) {
+        $ido=$mdbd->select("order_id","order_register",1,array(),"ORDER BY order_id DESC LIMIT 1");
+        if ($configure['id_start_orders_default']<$ido) {
+            $configure['id_start_orders_default']=$order_id_current;
+        }
+    }
+    if (ereg("^[0-9]+$",$configure['id_start_orders_default'])) {
+        $mdbd->update("order_id","order_id=?",1,array($configure['id_start_orders_default']=>"int"));
+    } else $configure['id_start_orders_default']=$order_id_current;
+    // end
+//	$basket_wishlist = $config->basket_wishlist;
+//	$basket_wishlist['prod_ext_info'] = $configure['basket_wishlist']['prod_ext_info'];
+    $gen_config->gen(array("record_row_type_default"=>$configure['record_row_type_default'],
+    "cyfra_photo"=>$configure['cyfra_photo'],
+    "basket_photo"=>$configure['basket_photo'],
+    "price_type"=>$configure['price_type'],
+    "main_order_default"=>$configure['main_order_default'],
+    "products_on_page"=>$products_on_page,
+    "random_on_page"=>$random_on_page,
+    "google"=>$google,
+    "image"=>$image,
+    "newsletter"=>$configure['newsletter'],
+    "category_multi"=>$configure['category_multi'],
+    "currency_show_form"=>$configure['currency_show_form'],
+    "pay_method_active"=>$pay_method_active,
+    "id_start_orders_default"=>$configure['id_start_orders_default'],
+    "in_category_down"=>$configure['in_category_down'],
+    "debug"=>$configure['debug'],
+    "unit"=>$configure['unit'],
+    "users_online"=>$configure['users_online'],
+//    "basket_wishlist" => $basket_wishlist,
+    "ssl" => $configure['ssl'],
+    "depository" => $configure['depository'],
+    "show_user_id" => $configure['show_user_id'],
+    
+
+    )
+    );
+    $ftp->close();
+
+    $config->record_row_type_default=$configure['record_row_type_default'];
+    $config->cyfra_photo=$configure['cyfra_photo'];
+    $config->basket_photo=$configure['basket_photo'];
+    $config->price_type=$configure['price_type'];
+    $config->main_order_default=$configure['main_order_default'];
+    $config->products_on_page=$products_on_page;
+    $config->google=$google;
+    $config->random_on_page=$random_on_page;
+    $config->image=$image;
+    $config->pay_method_active=$pay_method_active;
+    $config->newsletter=$configure['newsletter'];
+    $config->category_multi=$configure['category_multi'];
+    $config->currency_show_form=$configure['currency_show_form'];
+    $config->id_start_orders_default=$configure['id_start_orders_default'];
+    $config->in_category_down=$configure['in_category_down'];
+    $config->debug=$configure['debug'];
+    $config->unit=$configure['unit'];
+    $config->users_online=$configure['users_online'];
+    $config->show_user_id=$configure['show_user_id'];
+//    $config->basket_wishlist=$basket_wishlist;
+    $config->ssl=$configure['ssl'];
+    $config->depository['display_availability'] = $configure['depository']['display_availability'];
+
+    // end config
+}
+
+include_once ("./html/configure.html.php");
+
+$theme->page_open_foot();
+
+// stopka
+$theme->foot();
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/admin/go/_configure/lang/_en/lang.inc.php soteesklep3/admin/go/_configure/lang/_en/lang.inc.php
--- ../soteesklep3/admin/go/_configure/lang/_en/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_configure/lang/_en/lang.inc.php	2006-08-23 16:58:43.000000000 +0200
@@ -0,0 +1,83 @@
+<?php
+$lang->configure_title="Configuration";
+$lang->button_help="Help";
+$lang->main_order_default=array(
+                'name_L0'=>"names",
+                'price'=>"prices",
+                'producer'=>"producer",
+                );
+$lang->price_type=array(
+                'netto/brutto'=>"net/gross",
+                'netto'=>"net",
+                'brutto'=>"gross",
+                );
+$lang->configure_record_row_type_default=array(
+                'long'=>"full list",
+                'short'=>"short list",
+                );
+$lang->configure_titles=array(
+                'price'=>"Prices",
+                'product_list'=>"Product list",
+                'google'=>"Indexing",
+                'other'=>"Other",
+                );
+$lang->newsedit_columns_default=array(
+                '1'=>"1",
+                '2'=>"2",
+                );
+$lang->configure_form=array(
+                'record_row_type_default'=>"Product list type",
+                'cyfra_photo'=>"Switching on the service of photos taken by means of a digital camera",
+                'basket_photo'=>"Enable the possibility of adding photos and description to products being ordered",
+                'currency'=>"Enter in currency",
+                'price_type'=>"Select price display type",
+                'main_order_default'=>"Product sorting according to",
+                'products_on_page_short'=>"Number of products in a short list",
+                'products_on_page_long'=>"Number of products in a full list",
+                'google_keywords'=>"Key words",
+                'google_title'=>"Page title",
+                'google_description'=>"<BR><BR><BR>Page description <BR><I>max. 150 characters</l> ",
+                'image_max_size'=>"Big photo size",
+                'image_min_size'=>"Small photo size",
+                'random_on_page'=>"Number of products in the window:<BR>",
+                'random_on_page_promotion'=>"promotions",
+                'random_on_page_newcol'=>"news",
+                'random_on_page_bestseller'=>"bestseller",
+                'pixels'=>" in <l>pixels</l>",
+                'newsletter'=>"Place newsletter window on the page",
+                'category_multi'=>"Alow one product to be available in several categories at the same time",
+                'newsedit'=>"Place news window on the page",
+                'currency_show_form'=>"Place the list of currencies for selection on the page",
+                'newsedit_columns_default'=>"How many columns should the news window be divided into",
+                'id_start_orders_default'=>"Last transaction id",
+                'pay_method_active_1'=>"Switch on the option of cash-on-delivery payment",
+                'pay_method_active_11'=>"Switch on the option of payment by transfer",
+                'in_category_down'=>"The number of nests for other products from the same category",
+                'debug'=>"DEBUG ",
+                'users_online'=>"Place the number of users online on the page",
+                'ssl'=>"<font color='red'>Turn off SSL</font>",
+                'unit'=>"Give the unit of measurement according to which delivery costs are calculated.",
+                'basket_ext'=>"Display detailed information about the product in the basket",
+                'display_availability'=>"Display in the shop the information about product availability",
+                'show_user_id'=>"Show product ID in the shop",
+                );
+$lang->button_catalog_conf="Directory mode configuration";
+$lang->button_configuration="General configuration";
+$lang->catalog_conf_title="Directory mode configuration";
+$lang->catalog_conf_text="The shop will be changed into a directory after clicking <B>Directory mode</B>. In the directory mode all functions of the basket are disabled. The customer can only browse the goods available.";
+$lang->catalog_mode_options=array(
+                'catalog_mode'=>"Directory mode",
+                'currency'=>"Switch on the currency list in the directory",
+                'users'=>"Switch on customer service in the directory",
+                'newsletter'=>"Switch on the newsletter window in the directory",
+                'newsedit'=>"Switch on the latest news window in the directory",
+                );
+$lang->configure_lang_changed="Default language was changed";
+$lang->configure_in_category_down=array(
+                '1'=>"1",
+                '2'=>"2",
+                '3'=>"3",
+                '4'=>"4",
+                '5'=>"5",
+                );
+?>
diff -ruN ../soteesklep3/admin/go/_configure/lang/_pl/lang.inc.php soteesklep3/admin/go/_configure/lang/_pl/lang.inc.php
--- ../soteesklep3/admin/go/_configure/lang/_pl/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_configure/lang/_pl/lang.inc.php	2006-08-23 16:58:43.000000000 +0200
@@ -0,0 +1,80 @@
+<?php
+$lang->configure_title="Konfiguracja";
+$lang->configure_titles=array(
+                'price'=>"Ceny",
+                'product_list'=>"Lista produktów",
+                'google'=>"Meta/indeksowanie",
+                'other'=>"Inne",
+                );
+$lang->configure_form=array(
+                'record_row_type_default'=>"Rodzaj listy produktów",
+                'cyfra_photo'=>"W³±czenie obs³ugi zdjêæ wykonanych aparatem cyfrowym",
+                'basket_photo'=>"W³±cz w koszyku mo¿liwo¶æ dodania zdjêæ i opisu do zamawianych produktów",
+                'currency'=>"Wpisz walutê",
+                'price_type'=>"Wybierz typ pokazywania ceny",
+                'main_order_default'=>"Sortowanie produktów wed³ug",
+                'products_on_page_short'=>"Ilo¶æ produktów na li¶cie skróconej",
+                'products_on_page_long'=>"Ilo¶æ produktów na li¶cie pe³nej",
+                'google_keywords'=>"S³owa kluczowe",
+                'google_title'=>"Tytu³ strony",
+                'google_description'=>"<BR><BR><BR>Opis strony <BR><I>max.150 znaków</I>",
+                'image_max_size'=>"Rozmiar du¿ego zdjêcia",
+                'image_min_size'=>"Rozmiar ma³ego zdjêcia",
+                'random_on_page'=>"Ilo¶æ produktów znajduj±cych siê w oknie:<BR>",
+                'random_on_page_promotion'=>"promocje",
+                'random_on_page_newcol'=>" nowo¶ci",
+                'random_on_page_bestseller'=>"bestseller",
+                'pixels'=>"  w <I>pikselach</I>",
+                'newsletter'=>"Umie¶æ okienko newslettera na stronie",
+                'category_multi'=>"Dostêpno¶æ jednego produktu w kilku kategoriach jednocze¶nie",
+                'newsedit'=>"Umie¶æ okienko najnowsze wiadomo¶ci na stronie",
+                'currency_show_form'=>"Umie¶æ liste z walutami do wyboru na stronie",
+                'newsedit_columns_default'=>"Na ile kolumn ma byæ podzielone okienko najnowsze wiadomo¶ci",
+                'id_start_orders_default'=>"Ostatnie id transakcji",
+                'pay_method_active_1'=>"W³±cz mo¿liwo¶æ p³acenia za zaliczeniem",
+                'pay_method_active_11'=>"W³±cz mo¿liwo¶æ p³acenia przelewem",
+                'in_category_down'=>"Ilo¶æ zagnie¿dzeñ przy innych produktach z tej samej kategorii",
+                'debug'=>"Tryb dla programistow (DEBUG)",
+                'ssl'=>"<font color='red'>Wy³±cz SSL w formularzach zamówienia</font>",
+                'unit'=>"Podaj jednostkê miary, wg której obliczane s± koszty dostawy",
+                'users_online'=>"Umie¶æ u¿ytkowników on-line na stronie",
+                'basket_ext'=>"Poka¿ poszerzone informacje o produkcie w koszyku",
+                'display_availability'=>"Pokazuj w sklepie informacjê o dostêpno¶ci produktów",
+                'show_user_id'=>"Poka¿ id produktu w sklepie",
+                );
+$lang->configure_record_row_type_default=array(
+                'long'=>"pe³na lista",
+                'short'=>"skrócona lista",
+                );
+$lang->configure_in_category_down=array(
+                '1'=>"1",
+                '2'=>"2",
+                '3'=>"3",
+                '4'=>"4",
+                '5'=>"5",
+                );
+$lang->price_type=array(
+                'netto/brutto'=>"netto/brutto",
+                'netto'=>"netto",
+                'brutto'=>"brutto",
+                );
+$lang->main_order_default=array(
+                'name_L0'=>"nazwy",
+                'price'=>"ceny",
+                'producer'=>"producenta",
+                );
+$lang->button_catalog_conf="Konfiguracja trybu katalog";
+$lang->button_configuration="Konfiguracja ogólna";
+$lang->button_help="Pomoc";
+$lang->configure_lang_changed="Domy¶lny jêzyk zosta³ zmieniony.";
+$lang->catalog_conf_title="Konfiguracja trybu katalog";
+$lang->catalog_conf_text="Sklep zostanie zmieniony w katalog po zaznaczeniu <B>Tryb katalog</B>. W trybie katalogowym znikaj± wszystkie funkcje koszyka i klient mo¿e jedynie przegl±daæ asortyment.";
+$lang->catalog_mode_options=array(
+                'catalog_mode'=>"Tryb katalog",
+                'currency'=>"W³±cz liste z walutami w katalogu",
+                'users'=>"W³±cz obs³ugê klientów w katalogu",
+                'newsletter'=>"W³±cz okienko newsletter w katalogu",
+                'newsedit'=>"W³±cz okienko z najnowszymi wiadomo¶ciami w katalogu",
+                'price'=>"W³±cz ceny w katalogu",
+                );
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/go/_edit/edit_ceneo.php soteesklep3/admin/go/_edit/edit_ceneo.php
--- ../soteesklep3/admin/go/_edit/edit_ceneo.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_edit/edit_ceneo.php	2006-08-23 16:58:44.000000000 +0200
@@ -0,0 +1,46 @@
+<?php
+/**
+* Edycja parametrów produktu wymaganych do exportu do pasaz.ceneo.pl
+*
+* @author  krzys@sote.pl
+* @version $Id: edit_ceneo.php,v 2.2 2006/08/16 10:20:55 lukasz Exp $
+*
+* \@verified 2004-03-15 m@sote.pl
+* @package    edit
+*/
+
+$global_database=true;
+$global_secure_test=true;
+
+if (empty($DOCUMENT_ROOT)) {
+	$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+}
+/**
+* Nag³ówek skryptu.
+*/
+require_once ("../../../include/head.inc");
+
+if (! empty($_REQUEST['id'])) {
+	$id=$_REQUEST['id'];
+}
+
+require_once ("include/metabase.inc");
+include_once ("config/auto_config/ceneo_config.inc.php");
+
+
+if (! empty($_REQUEST['update'])) {
+		require_once ("./include/edit_update_ceneo.inc.php");
+	}
+include ("include/query_rec_ceneo.inc.php");
+
+$theme->head_window();
+// menu
+include_once ("./include/menu.inc.php");
+require_once("./html/edit_ceneo.html.php");
+			
+
+
+
+$theme->foot_window();
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/admin/go/_edit/html/edit_allegro.html.php soteesklep3/admin/go/_edit/html/edit_allegro.html.php
--- ../soteesklep3/admin/go/_edit/html/edit_allegro.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_edit/html/edit_allegro.html.php	2006-08-23 16:58:44.000000000 +0200
@@ -0,0 +1,286 @@
+<?php
+/**
+* Edycja opcji zwi±zanych z allegro.pl
+*
+* @author  krzys@sote.pl
+* @version $Id: edit_allegro.html.php,v 2.6 2006/06/28 08:57:06 lukasz Exp $
+*
+* @package    edit
+*/
+?>
+
+<?php 
+global $action;
+global $DOCUMENT_ROOT;
+
+include_once("include/allegro.inc.php");
+$allegro=new Allegro;
+$id=@$_REQUEST['id'];
+print "<br><center>";        
+
+$theme->desktop_open();
+
+if (@$rec->data['allegro_auction_type']=="2") {
+    $allegro_auction_type2="checked";
+} else  {
+    $allegro_auction_type1="checked";
+}
+
+if (@$rec->data['allegro_delivery_shipment']=="1") $check_allegro_delivery_shipment="checked"; else $check_allegro_delivery_shipment="";
+if (@$rec->data['allegro_delivery_priority_shipment']=="2") $check_allegro_delivery_priority_shipment="checked"; else $check_allegro_delivery_priority_shipment="";
+if (@$rec->data['allegro_delivery_courier']=="4") $check_allegro_delivery_courier="checked"; else $check_allegro_delivery_courier="";
+if (@$rec->data['allegro_delivery_personal_acceptance']=="8") $check_allegro_delivery_personal_acceptance="checked"; else $check_allegro_delivery_personal_acceptance="";
+if (@$rec->data['allegro_delivery_other']=="16") $check_allegro_delivery_other="checked"; else $check_allegro_delivery_other="";
+if (@$rec->data['allegro_delivery_abroad']=="32") $check_allegro_delivery_abroad="checked"; else $check_allegro_delivery_abroad="";
+
+if (@$rec->data['allegro_pay_wire_transfer']=="1") $check_allegro_pay_wire_transfer="checked"; else $check_allegro_pay_wire_transfer="";
+if (@$rec->data['allegro_pay_collect_on_delivery']=="2") $check_allegro_pay_collect_on_delivery="checked"; else $check_allegro_pay_collect_on_delivery="";
+//if (@$rec->data['allegro_pay_on_line_pay']=="4") $check_allegro_pay_on_line_pay="checked"; else $check_allegro_pay_on_line_pay="";
+if (@$rec->data['allegro_pay_payu_accept_escrow']=="8") $check_allegro_pay_payu_accept_escrow="checked"; else $check_allegro_pay_payu_accept_escrow="";
+if (@$rec->data['allegro_pay']=="1") $check_allegro_pay="checked"; else $check_allegro_pay="";
+
+if (@$rec->data['allegro_miniature']=="2") $check_allegro_miniature="checked"; else $check_allegro_miniature="";
+if (@$rec->data['allegro_bold']=="1") $check_allegro_bold="checked"; else $check_allegro_bold="";
+if (@$rec->data['allegro_light']=="4") $check_allegro_light="checked"; else $check_allegro_light="";
+if (@$rec->data['allegro_favouritism']=="8") $check_allegro_favouritism="checked"; else $check_allegro_favouritism="";
+if (@$rec->data['allegro_category_site']=="16") $check_allegro_category_site="checked"; else $check_allegro_category_site="";
+if (@$rec->data['allegro_home_page']=="32") $check_allegro_home_page="checked"; else $check_allegro_home_page="";
+
+
+
+?>
+<form action=<?php print @$action;?> method=post name=editForm  enctype=multipart/form-data>
+<input type=hidden name=user_id value='<?php print @$_REQUEST['user_id'];?>'>
+<input type=hidden name=update value=true>
+<table border="0" cellpadding="0" cellspacing="0" width="100%">
+<tr>
+<td width="60" valign="top">
+
+<table border=0 align="center" cellpadding="3" cellspacing="9">
+<tr>
+  <td align="left" bgcolor="#d0f9f9" colspan="2"><b><nobr><?php print $lang->edit_allegro['allegro_auction_type']; ?>:</nobr></b></td>
+</tr>
+<tr>  
+<td colspan="2">
+  <input type=radio name=item[allegro_auction_type] value="1" <?php print @$allegro_auction_type1; ?>><?php print $lang->edit_allegro['allegro_auction_type_auction'];?><Br>
+  <input type=radio name=item[allegro_auction_type] value="2" <?php print @$allegro_auction_type2; ?>><?php print $lang->edit_allegro['allegro_auction_type_buy_now'];?>
+  </td>
+</tr>
+<tr>
+  <td width="30%" align="right"><b><?php print $lang->edit_allegro['allegro_product_name']; ?>:</b></td>
+  <?php
+  //odczytaj nazwe produktu
+  if(empty($rec->data['allegro_product_name'])) {
+      $name=$database->sql_select("name_L0","main","user_id=".$user_id);
+  } else {
+    $name=$rec->data['allegro_product_name'];
+  }
+  ?>
+  <td><input type="text" name="item[allegro_product_name]" size="30" value="<?php print $name; ?>"></td>
+</tr>
+<tr>
+  <td width="20%" align="left" colspan="2" bgcolor="#dcddf9"><b><?php print $lang->edit_allegro['allegro_product_description']; ?>:</b></td>
+</tr>
+<tr>
+  <?php
+  //odczytaj nazwe produktu
+  if(empty($rec->data['allegro_product_description'])) {
+      $desc=$database->sql_select("xml_description_L0","main","user_id=".$user_id);
+  } else {
+      $desc=$rec->data['allegro_product_description'];
+  }
+  ?>
+<td colspan="2"><textarea cols="50" rows="20" name="item[allegro_product_description]"><?php print $desc; ?></textarea></td>
+</tr>
+<tr>
+  <?php
+  //odczytaj nazwe produktu
+  if(empty($rec->data['allegro_photo'])) {
+      $photo=$database->sql_select("photo","main","user_id=".$user_id);
+  } else {
+      $photo=@$rec->data['allegro_photo'];
+  }
+ ?>
+    <td width="20%" align="right"><b><?php print $lang->edit_allegro['allegro_photo']; ?>:</b></td>
+  <td>
+  <input type="text" name="item[allegro_photo]" size="30" value="<?php print $photo; ?>">
+  </td>
+</tr>
+<tr>
+  <td width="20%" align="right"><b><?php print $lang->edit_allegro['allegro_miniature']; ?>:</b></td>
+  <td><input type="checkbox" name=item[allegro_miniature] value="2" <?php print $check_allegro_miniature; ?>></td>
+</tr>
+</table>
+
+
+</td>
+<td align="left" valign="top">
+
+
+<table border=0 align="left" cellpadding="4">
+<tr>
+<td>
+<table border=0 align="left" cellpadding="4">
+<tr>
+<td colspan="4" bgcolor="#e2f9a7"><b><?php print $lang->edit_allegro['allegro_prices_duration']; ?>:</b></td>
+</tr>
+<?php
+//ustawianie cen
+//$price_brutto=$database->sql_select("price_brutto","main","user_id=".$user_id);
+/*if(empty($rec->data['allegro_price_start'])) {
+    $allegro_price_start=$price_brutto;
+} else {
+    $allegro_price_start=$rec->data['allegro_price_start'];
+}*/
+$allegro_price_start=@$rec->data['allegro_price_start'];
+$allegro_price_buy_now=@$rec->data['allegro_price_buy_now'];
+$allegro_price_min=@$rec->data['allegro_price_min'];
+$allegro_stock=@$rec->data['allegro_stock'];
+
+?>
+
+
+<tr>
+<td width="20%" align="right"><b><?php print $lang->edit_allegro['allegro_price_start']; ?>:</b></td>
+  <td><input type="text" name="item[allegro_price_start]" size="10" value="<?php print $allegro_price_start;?>"> 
+  <?php print $lang->edit_allegro['allegro_currency']; ?></td>
+  <td width="20%" align="right"><b><?php print $lang->edit_allegro['allegro_price_buy_now']; ?>:</b></td>
+  <td><input type="text" name="item[allegro_price_buy_now]" size="10" value="<?php print $allegro_price_buy_now;?>"> <?php print $lang->edit_allegro['allegro_currency']; ?></td>
+</tr>
+<tr>
+  <td width="20%" align="right"><b><?php print $lang->edit_allegro['allegro_price_min']; ?>:</b></td>
+  <td><input type="text" name="item[allegro_price_min]" size="10" value="<?php print $allegro_price_min;?>"> <?php print $lang->edit_allegro['allegro_currency']; ?></td></td>
+  <td width="20%" align="right"><b><?php print $lang->edit_allegro['allegro_stock']; ?>:</b></td>
+  <td><input type="text" name="item[allegro_stock]" size="3" value="<?php print $allegro_stock;?>"></td>
+</tr>
+<tr>
+  <td width="20%" align="right"><b><nobr><?php print $lang->edit_allegro['allegro_how_long']; ?></nobr>:</b></td>
+  <td>
+  <select name="item[allegro_how_long]">
+  <?php
+    foreach($allegro_config->allegro_time as $key=>$value) {
+        if($rec->data['allegro_how_long'] == $key) {
+            print "<option value=\"".$key."\" selected>".$value."</option>";
+        } else {
+            print "<option value=\"".$key."\">".$value."</option>";
+        }    
+    }
+  ?>
+  </select> 
+  <?php print $lang->edit_allegro['allegro_days']; ?></td>
+</tr>
+</table>
+</td>
+</tr>
+  
+<tr>
+  <td colspan="2"><table border="0" cellpadding="3" cellspacing="3" width="100%">
+  		<tr>
+  			<td colspan="2" bgcolor="#fdffc9"><b><?php print $lang->edit_allegro['allegro_delivery']; ?>:</b></td>
+  		</tr>
+  		<tr>
+  			<td width="100"><nobr><?php print $lang->edit_allegro['allegro_delivery_who_pay']; ?></nobr></td>
+  			<td>
+            <select name="item[allegro_delivery_who_pay]">
+ 			<?PHP
+  			foreach($allegro_config->allegro_trans as $key=>$value) {
+                if($rec->data['allegro_delivery_who_pay'] == $key) {
+                    print "<option value=\"".$key."\" selected>".$value."</option>";
+                } else {
+                    print "<option value=\"".$key."\">".$value."</option>";
+                }    
+  			}
+  			?>
+            </select> 
+            </td>
+            </tr>
+  		<tr>
+  		<td colspan="2">
+  		<input type="checkbox" name=item[allegro_delivery_shipment]  value="1" <?php print $check_allegro_delivery_shipment; ?>><?php print $lang->edit_allegro['allegro_delivery_shipment'];?><br>
+  		<input type="checkbox" name=item[allegro_delivery_priority_shipment]  value="2" <?php print $check_allegro_delivery_priority_shipment; ?>><?php print $lang->edit_allegro['allegro_delivery_priority_shipment'];?><br>
+  		<input type="checkbox" name=item[allegro_delivery_courier]  value="4" <?php print $check_allegro_delivery_courier; ?>><?php print $lang->edit_allegro['allegro_delivery_courier'];?><br>
+  		<input type="checkbox" name=item[allegro_delivery_personal_acceptance]  value="8" <?php print $check_allegro_delivery_personal_acceptance; ?>><?php print $lang->edit_allegro['allegro_delivery_personal_acceptance'];?><br>
+  		<input type="checkbox" name=item[allegro_delivery_other]  value="16" <?php print $check_allegro_delivery_other; ?>><?php print $lang->edit_allegro['allegro_delivery_other'];?>
+  		<input type="text" name=item[allegro_delivery_other_text] size="50" value="<?php print @$rec->data['allegro_delivery_other_text']?>"><br>
+  		<input type="checkbox" name=item[allegro_delivery_abroad]  value="32" <?php print $check_allegro_delivery_abroad; ?>><?php print $lang->edit_allegro['allegro_delivery_abroad'];?><br>
+  		</td>
+  		</tr>
+  		</table>
+    </td>
+</tr>
+<tr>
+  <td colspan="2"><table border="0" cellpadding="3" cellspacing="3" width="100%">
+  		<tr>
+  			<td colspan="2" bgcolor="#f9eabe"><b><?php print $lang->edit_allegro['allegro_pay']; ?>:</b></td>
+  		</tr>
+  		<tr>
+  		<td colspan="2">
+  		
+  		<input type="checkbox" name=item[allegro_pay_wire_transfer] value="1" <?php print $check_allegro_pay_wire_transfer; ?>>
+  		<?php print $lang->edit_allegro['allegro_pay_wire_transfer'];print "&nbsp;&nbsp;&nbsp;&nbsp;".$lang->edit_allegro['allegro_pay_price'];?>: 
+  		<input type="text" name=item[allegro_pay_wire_transfer_price] size="10" value="<?php print @$rec->data['allegro_pay_wire_transfer_price']?>">
+  		 <?php print $lang->edit_allegro['allegro_currency']; ?><br>
+  		
+  		<input type="checkbox" name=item[allegro_pay_collect_on_delivery]  value="2" <?php print $check_allegro_pay_collect_on_delivery; ?>><?php print $lang->edit_allegro['allegro_pay_collect_on_delivery'];
+  		print "&nbsp;&nbsp;&nbsp;&nbsp;".$lang->edit_allegro['allegro_pay_price'];?>: 
+  		<input type="text" name=item[allegro_pay_collect_on_delivery_price] size="10" value="<?php print @$rec->data['allegro_pay_collect_on_delivery_price']?>">
+  		 <?php print $lang->edit_allegro['allegro_currency']; ?><br>
+  		
+  		<!--<input type="checkbox" name=item[allegro_pay_on_line_pay]  value="4" <?php // print $check_allegro_pay_on_line_pay; ?>><?php // print $lang->edit_allegro['allegro_pay_on_line_pay'];?><br>-->
+  		<input type="checkbox" name=item[allegro_pay_payu_accept_escrow] value="8" <?php print $check_allegro_pay_payu_accept_escrow; ?> ><?php print $lang->edit_allegro['allegro_pay_payu_accept_escrow'];?><br>
+  		</td>
+  		</tr>
+  		</table>
+    </td>
+</tr>
+
+<tr>
+<td><table border=0 cellpadding="3" cellspacing="3" width="100%">
+<tr>
+<td colspan="6" bgcolor="#f9dcdc"><b><?php print $lang->edit_allegro['allegro_additional_options']; ?>:</b></td>
+</tr>
+<tr>
+ <td width="20%" align="right"><b><nobr><?php print $lang->edit_allegro['allegro_bold']; ?>:</nobr></b></td>
+  <td><input type="checkbox" name=item[allegro_bold]  value="1" <?php print $check_allegro_bold; ?>></td>
+  <td width="20%" align="right"><b><?php print $lang->edit_allegro['allegro_light']; ?>:</b></td>
+  <td><input type="checkbox" name=item[allegro_light]  value="4" <?php print $check_allegro_light; ?>></td>
+  <td width="20%" align="right"><b><?php print $lang->edit_allegro['allegro_favouritism']; ?>:</b></td>
+  <td><input type="checkbox" name=item[allegro_favouritism] value="8" <?php print $check_allegro_favouritism; ?>></td>
+</tr>
+<tr>
+  <td align="right"><b><?php print $lang->edit_allegro['allegro_category_site']; ?>:</b></td>
+  <td><input type="checkbox" name=item[allegro_category_site] value="16" <?php print $check_allegro_category_site; ?>></td>
+  <td align="right"><b><?php print $lang->edit_allegro['allegro_home_page']; ?>:</b></td>
+  <td><input type="checkbox" name=item[allegro_home_page] value="32" <?php print $check_allegro_home_page; ?>></td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+
+<tr>
+<td colspan="2" align="left">
+<table><tr>
+<td width="10%" align="left"><b><?php print $lang->edit_allegro['allegro_category']; ?>:</b></td>
+  <td><?php 
+  print $allegro->buildTree(@$rec->data['allegro_category']); ?></td>
+</tr>
+</table>
+</td>
+</tr>
+
+<tr>
+<td colspan="2" align="center">&nbsp;</td>
+</tr>
+
+<tr>
+<td colspan="2" align="center"><?php $buttons->button($lang->edit_edit_submit,"javascript:document.editForm.submit();");?></td>
+</tr>
+
+</table>
+<?php
+$theme->desktop_close();
+?>
+<!-- pasaz.ceneo.pl -->
diff -ruN ../soteesklep3/admin/go/_edit/html/edit_ceneo.html.php soteesklep3/admin/go/_edit/html/edit_ceneo.html.php
--- ../soteesklep3/admin/go/_edit/html/edit_ceneo.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_edit/html/edit_ceneo.html.php	2006-08-23 16:58:44.000000000 +0200
@@ -0,0 +1,46 @@
+<?php
+/**
+* Edycja opcji zwi±zanych z pasaz.ceneo.pl
+*
+* @author  rdiak@sote.pl
+* @version $Id: edit_ceneo.html.php,v 2.3 2006/08/16 10:20:55 lukasz Exp $
+*
+* \@verified 2004-03-15 m@sote.pl
+* @package    edit
+*/
+?>
+<!-- pasaz.ceneo.pl -->
+<?php 
+global $action;
+global $DOCUMENT_ROOT;
+
+if (in_array("ceneo.pl",$config->plugins)) {
+    // ceneo_export
+    if ($rec->data['ceneo_export']=="1") $checked_ceneo_export="checked"; else $checked_ceneo_export="";
+    $theme->desktop_open();
+?>
+<form action="edit_ceneo.php?id=<?php print $_REQUEST['id']; ?>" method=post name=editForm  enctype=multipart/form-data>
+<input type=hidden name=update value=true>
+
+<table cellpadding="3" cellspacing="3" border=0 align="center">
+<tr>
+  
+  <td><img src="<?php $theme->img('_img/ceneo.png');?>"></td>
+</tr>
+
+<tr>
+  <td>
+    <input type=checkbox name=item[ceneo_export] <?php print $checked_ceneo_export;?> value=1><?php print $lang->edit_ceneo['ceneo_export'];?>
+  </td>
+</tr>
+
+<tr>	
+  <td align="center"><?php $buttons->button($lang->edit_edit_submit,"javascript:document.editForm.submit();");?></td>
+</tr>	
+</table>
+
+<?php
+$theme->desktop_close();
+}
+?>
+<!-- pasaz.ceneo.pl -->
diff -ruN ../soteesklep3/admin/go/_edit/include/edit_insert.inc.php soteesklep3/admin/go/_edit/include/edit_insert.inc.php
--- ../soteesklep3/admin/go/_edit/include/edit_insert.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_edit/include/edit_insert.inc.php	2006-08-23 16:58:44.000000000 +0200
@@ -0,0 +1,242 @@
+<?php
+/**
+* Dodanie produktu do bazy
+*
+* @author  m@sote.pl
+* @version $Id: edit_insert.inc.php,v 2.32 2006/08/16 14:30:37 lukasz Exp $
+*
+* \@verified 2004-03-16 m@sote.pl
+* @package    edit
+* \@lang
+*/
+
+if (@$global_secure_test!=true) {
+    die ("Forbidden");
+}
+
+require_once ("include/price.inc");
+$my_price = new MyPrice;
+
+// odczytaj dane z formularza
+if ((! empty($_REQUEST['item'])) && (! empty($_REQUEST['item']['user_id']))) {
+    $item=&$_REQUEST['item'];
+    // zaraz po odebraniu cen, zmieñ , na .
+    $item['price_brutto']=ereg_replace(",",".",$item['price_brutto']);
+    $item['price_brutto_detal']=ereg_replace(",",".",$item['price_brutto_detal']);
+    $item['price_2']=ereg_replace(",",".",$item['price_2']);
+    $item['price_currency']=ereg_replace(",",".",$item['price_currency']);
+} else {
+    die ("Forbidden: Unknown item");
+}
+
+if (! empty($_REQUEST['item2'])) {
+    $item2=&$_REQUEST['item2'];
+}
+
+// sprawdz czy wybrano jakas wartosc z elementow select
+if ((empty($item['producer'])) && (! empty($item2['producer']))) {
+    $item['producer']=$item2['producer'];
+}
+if ((empty($item['category1'])) && (! empty($item2['category1']))) {
+    $item['category1']=$item2['category1'];
+}
+if ((empty($item['category2'])) && (! empty($item2['category2']))) {
+    $item['category2']=$item2['category2'];
+}
+if ((empty($item['category3'])) && (! empty($item2['category3']))) {
+    $item['category3']=$item2['category3'];
+}
+if ((empty($item['category4'])) && (! empty($item2['category4']))) {
+    $item['category4']=$item2['category4'];
+}
+if ((empty($item['category5'])) && (! empty($item2['category5']))) {
+    $item['category5']=$item2['category5'];
+}
+
+$item['category1'] = str_replace("\"", "''", $item['category1']);
+$item['category2'] = str_replace("\"", "''", $item['category2']);
+$item['category3'] = str_replace("\"", "''", $item['category3']);
+$item['category4'] = str_replace("\"", "''", $item['category4']);
+$item['category5'] = str_replace("\"", "''", $item['category5']);
+
+// aktualizuj tabele kategorii i producentow, odczytaj id kategorii i producenta
+require_once ("./include/edit.inc.php");
+$edit_p = new EditProduct;
+$edit_p->updateCategory($item);
+$edit_p->updateProducer($item);
+
+// sprawdz czy zmieniono cene, jesli nie to odczytaj dane pelne ze wszsytkimi miejscami po przecinku
+require_once ("include/check_price_netto_brutto.inc.php");
+
+// Sprawdz czy wprowadzono walute. Waluta jest przekazywana takze jako price_currency, ale dodatkwoo jest
+// przekazywana zmienna id_currency, ktora sluzy do rozpoznania waluty i przelicznienia ceny
+// do pola $item['price_brutto'] wprowadzamy obliczona na podstawie kursu waluty kwote brutto zakupu
+// if (in_array("currency",$config->plugins)) {
+if (! empty($item['id_currency'])) {
+
+    // start oblicz: cene brutto wg. kursu waluty
+    $id_currency=&$item['id_currency'];
+    $currency_val=$config->currency_data[$id_currency];
+
+    // sprawdz jaka cene przekazano, netto, czy brutto
+    if ($item['price_nb']=="netto") {
+        $price_netto=$currency_val*$item['price_currency'];
+        $item['price_currency']=$item['price_currency'];
+        $price_brutto=$my_price->netto2brutto($price_netto,$item['vat'],false);
+    } else {
+        $price_brutto_currency=$item['price_currency'];
+        $price_netto_currency=$my_price->brutto2netto($item['price_currency'],$item['vat'],false);
+        $price_netto=$currency_val*$price_netto_currency;
+        $price_brutto=$price_brutto_currency*$currency_val;
+        $item['price_currency']=$price_netto_currency;
+    }
+    // end oblicz:
+
+    if ($price_brutto>0) {
+        $item['price_brutto']=$price_brutto;
+    }
+} // end if (! empty($item['id_currency']))
+// }  // end if (in_array("currency",$config->plugins))
+// end
+
+// start obsluga: ceny hurtowej (netto/brutto)
+if ($item['price_2_nb']=="netto") {
+    $item['price_brutto_2']=$my_price->netto2brutto($item['price_2'],$item['vat'],false);
+} else  $item['price_brutto_2']=@$item['price_2'];
+// end oblsuga:
+
+
+// magazyn
+if(is_numeric($item['depository_num'])) {
+    global $mdbd, $config;
+    $res_depository = $mdbd->select("id", "depository", "user_id_main=?", array($item['user_id'] => 'text'), '', 'array');
+    $min_num = $config->depository['general_min_num'];
+    $num = (int)$item['depository_num'];
+    $user_id_main = addslashes($item['user_id']);
+    $id_deliverer = addslashes($item['deliverer_id']);
+    if($mdbd->num_rows == 0) {
+        $mdbd->insert("depository", "user_id_main, num, min_num, id_deliverer", "'$user_id_main', $num, $min_num, $id_deliverer");
+    }
+    else {
+        $mdbd->update("depository", "num=$num, id_deliverer=$id_deliverer", "user_id_main=?", array($user_id_main => 'text'));
+    }
+    $res2 = $mdbd->select("user_id,num_from,num_to", "available", "1=1", array(), '', 'array');
+    if(!empty($res2)) {
+        $av_id = 0;
+        reset($res2);
+        while (($av_id == 0) && (list($key, $val) = each($res2))) {
+            $a = $val['user_id'];
+            $from = $val['num_from'];
+            $to = $val['num_to'];
+            if($to != '*') {
+                if (($from <= $num) && ($num <= $to)) {
+                    $av_id = $a;
+                }
+            }
+            else {
+                $last_id = $a;
+            }
+        }
+        if($av_id == 0) {
+            $av_id = $last_id;
+        }
+        $item['id_available'] = $av_id;
+    }
+}
+// end magazyn
+
+
+$query="INSERT INTO main  (user_id,name_L0,price_brutto,id_currency,
+                           vat,price_brutto_detal,photo,
+                           producer,id_producer,
+                           category1,category2,category3,category4,category5,
+                           id_category1,id_category2,id_category3,id_category4,id_category5,
+                           main_page,newcol,promotion,bestseller,price_brutto_2,id_available,
+                           accessories,hidden_price,
+                           price_currency,discount,max_discount,
+						   main_keys_online,active,ask4price, status_vat, weight, link_url, link_name,
+						   sms,points_value)
+        VALUES (?,?,?,?,
+                ?,?,?,
+                ?,?,
+                ?,?,?,?,?,
+                ?,?,?,?,?,
+                ?,?,?,?,?,?,
+                ?,?,
+                ?,?,?,
+                ?,?,?,?,?,?,?,
+                ?,?) 
+       ";
+
+$prepared_query=$db->PrepareQuery($query);
+if ($prepared_query) {
+    $db->QuerySetText($prepared_query,1,$item['user_id']);
+    $db->QuerySetText($prepared_query,2,$item['name']);
+    $db->QuerySetText($prepared_query,3,$item['price_brutto']);
+    $db->QuerySetText($prepared_query,4,my(@$item['id_currency']));
+    $db->QuerySetText($prepared_query,5,$item['vat']);
+    $db->QuerySetText($prepared_query,6,$item['price_brutto_detal']);
+    $db->QuerySetText($prepared_query,7,$item['photo']);
+    $db->QuerySetText($prepared_query,8,$item['producer']);
+    $db->QuerySetText($prepared_query,9,$item['id_producer']);
+    $db->QuerySetText($prepared_query,10,$item['category1']);
+    $db->QuerySetText($prepared_query,11,$item['category2']);
+    $db->QuerySetText($prepared_query,12,$item['category3']);
+    $db->QuerySetText($prepared_query,13,$item['category4']);
+    $db->QuerySetText($prepared_query,14,$item['category5']);
+    $db->QuerySetText($prepared_query,15,$item['id_category1']);
+    $db->QuerySetText($prepared_query,16,$item['id_category2']);
+    $db->QuerySetText($prepared_query,17,$item['id_category3']);
+    $db->QuerySetText($prepared_query,18,$item['id_category4']);
+    $db->QuerySetText($prepared_query,19,$item['id_category5']);
+    $db->QuerySetText($prepared_query,20,@$item['main_page']);
+    $db->QuerySetText($prepared_query,21,@$item['newcol']);
+    $db->QuerySetText($prepared_query,22,@$item['promotion']);
+    $db->QuerySetText($prepared_query,23,@$item['bestseller']);
+    $db->QuerySetText($prepared_query,24,@$item['price_brutto_2']);
+    $db->QuerySetText($prepared_query,25,@$item['id_available']);
+    $db->QuerySetText($prepared_query,26,@$item['accessories']);
+    $db->QuerySetText($prepared_query,27,@$item['hidden_price']);
+    $db->QuerySetText($prepared_query,28,@$item['price_currency']);
+    $db->QuerySetText($prepared_query,29,@$item['discount']);
+    $db->QuerySetText($prepared_query,30,@$item['max_discount']);
+    $db->QuerySetText($prepared_query,31,@$item['main_keys_online']);
+    $db->QuerySetText($prepared_query,32,@$item['active']);
+    $db->QuerySetText($prepared_query,33,@$item['ask4price']);
+    $db->QuerySetText($prepared_query,34,@$item['status_vat']);
+    $db->QuerySetText($prepared_query,35,@$item['weight']);
+    $db->QuerySetText($prepared_query,36,@$item['link_url']);
+    $db->QuerySetText($prepared_query,37,@$item['link_name']);
+    $db->QuerySetText($prepared_query,38,@$item['sms']);
+    $db->QuerySetText($prepared_query,39,@$item['points_value']);
+    
+
+    $result=$db->ExecuteQuery($prepared_query);
+    if ($result==0) {
+        die ($db->Error());
+    }
+} else {
+    die ($db->Error());
+}
+
+/**
+* Odczytaj numer ID rekordu
+*
+* @return $id
+*/
+$query="SELECT id FROM main WHERE user_id=?";
+$prepared_query=$db->PrepareQuery($query);
+if ($prepared_query) {
+    $db->QuerySetText($prepared_query,1,$item['user_id']);
+    $result=$db->ExecuteQuery($prepared_query);
+    if ($result!=0) {
+        $num_rows=$db->NumberOfRows($result);
+        if ($num_rows>0) {
+            $id=$db->FetchResult($result,0,"id");
+        } else {
+            die ($lang->edit_errors['insert_error']);
+        }
+    } else die ($db->Error());
+} else die ($db->Error());
+
+?>
diff -ruN ../soteesklep3/admin/go/_edit/include/edit_update_allegro.inc.php soteesklep3/admin/go/_edit/include/edit_update_allegro.inc.php
--- ../soteesklep3/admin/go/_edit/include/edit_update_allegro.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_edit/include/edit_update_allegro.inc.php	2006-08-23 16:58:44.000000000 +0200
@@ -0,0 +1,126 @@
+<?php
+/**
+* Aktualizuj w baze wartosc pola zwi±zane z ceneoPasa¿
+*
+* @author  rdiak@sote.pl
+* @version $Id: edit_update_allegro.inc.php,v 2.4 2006/06/28 08:57:02 lukasz Exp $
+*
+* \@verified 2004-03-16 m@sote.pl
+* @package    edit
+*/
+
+if ($global_secure_test!=true) {
+    die ("Forbidden");
+}
+
+require_once("include/metabase.inc");
+global $database;
+global $mdbd;
+global $allegro_config;
+
+//print_r($datat);
+
+// pobieramy z tablicy main user_id produktu
+$user_id=$mdbd->select("user_id","main","id=?",array($id=>"int"));
+
+// sprawdzamy czy rekord juz istnieje w bazie
+$count=$mdbd->select("count(*)","allegro_auctions","user_id=?",array($user_id=>"string"));
+
+// odczytaj dane z formularza
+if (! empty($_REQUEST['item'])) {
+    $item=&$_REQUEST['item'];
+} else {
+    die ("Forbidden: Unknown item");
+}
+
+
+$item['allegro_price_start']=preg_replace("/\,/",".",$item['allegro_price_start']);
+$item['allegro_price_buy_now']=preg_replace("/\,/",".",$item['allegro_price_buy_now']);
+$item['allegro_price_min']=preg_replace("/\,/",".",$item['allegro_price_min']);
+$item['allegro_pay_wire_transfer_price']=preg_replace("/\,/",".",$item['allegro_pay_wire_transfer_price']);
+$item['allegro_pay_collect_on_delivery_price']=preg_replace("/\,/",".",$item['allegro_pay_collect_on_delivery_price']);
+
+if($allegro_config->allegro_mode == 'true') {
+    $send='product';
+} else {
+    $send='test';
+}    
+
+if($count == 0) {
+    $database->sql_insert("allegro_auctions",array(
+                            'user_id'=> $user_id,
+                            'allegro_auction_type'=>@$item['allegro_auction_type'],
+                            'allegro_product_name'=>@$item['allegro_product_name'],
+                            'allegro_product_description'=>@$item['allegro_product_description'],
+                            'allegro_photo'=>@$item['allegro_photo'],
+                            'allegro_miniature'=>@$item['allegro_miniature'],
+                            'allegro_price_start'=>@$item['allegro_price_start'],
+                            'allegro_price_buy_now'=>@$item['allegro_price_buy_now'],
+                            'allegro_price_min'=>@$item['allegro_price_min'],
+                            'allegro_stock'=>@$item['allegro_stock'],
+                            'allegro_how_long'=>@$item['allegro_how_long'],
+                            'allegro_delivery_who_pay'=>@$item['allegro_delivery_who_pay'],
+                            'allegro_delivery_shipment'=>@$item['allegro_delivery_shipment'],
+                            'allegro_delivery_priority_shipment'=>@$item['allegro_delivery_priority_shipment'],
+                            'allegro_delivery_courier'=>@$item['allegro_delivery_courier'],
+                            'allegro_delivery_personal_acceptance'=>@$item['allegro_delivery_personal_acceptance'],
+                            'allegro_delivery_other'=>@$item['allegro_delivery_other'],
+                            'allegro_delivery_other_text'=>@$item['allegro_delivery_other_text'],
+                            'allegro_delivery_abroad'=>@$item['allegro_delivery_abroad'],
+                            'allegro_pay_wire_transfer'=>@$item['allegro_pay_wire_transfer'],
+                            'allegro_pay_wire_transfer_price'=>@$item['allegro_pay_wire_transfer_price'],
+                            'allegro_pay_collect_on_delivery'=>@$item['allegro_pay_collect_on_delivery'],
+                            'allegro_pay_collect_on_delivery_price'=>@$item['allegro_pay_collect_on_delivery_price'],
+                            'allegro_pay_on_line_pay'=>@$item['allegro_pay_on_line_pay'],
+                            'allegro_pay_payu_accept_escrow'=>@$item['allegro_pay_payu_accept_escrow'],
+                            'allegro_pay' =>@$item['allegro_pay'],
+                            'allegro_pay_wire_transfer_price'=>@$item['allegro_pay_wire_transfer_price'],
+                            'allegro_pay_price'=>@$item['allegro_pay_price'],
+                            'allegro_bold'=>@$item['allegro_bold'],
+                            'allegro_light' =>@$item['allegro_light'],
+                            'allegro_favouritism'=>@$item['allegro_favouritism'],
+                            'allegro_category_site'=>@$item['allegro_category_site'],
+                            'allegro_home_page'=>@$item['allegro_home_page'],
+                            'allegro_category'=>@$item['allegro_category'],
+                            'allegro_send'=>$send,
+                        ));
+} else {
+    $database->sql_update("allegro_auctions","user_id=$user_id",
+                    array(
+                            'allegro_auction_type'=>@$item['allegro_auction_type'],
+                            'allegro_product_name'=>@$item['allegro_product_name'],
+                            'allegro_product_description'=>@$item['allegro_product_description'],
+                            'allegro_photo'=>@$item['allegro_photo'],
+                            'allegro_miniature'=>@$item['allegro_miniature'],
+                            'allegro_price_start'=>@$item['allegro_price_start'],
+                            'allegro_price_buy_now'=>@$item['allegro_price_buy_now'],
+                            'allegro_price_min'=>@$item['allegro_price_min'],
+                            'allegro_stock'=>@$item['allegro_stock'],
+                            'allegro_how_long'=>@$item['allegro_how_long'],
+                            'allegro_delivery_who_pay'=>@$item['allegro_delivery_who_pay'],
+                            'allegro_delivery_shipment'=>@$item['allegro_delivery_shipment'],
+                            'allegro_delivery_priority_shipment'=>@$item['allegro_delivery_priority_shipment'],
+                            'allegro_delivery_courier'=>@$item['allegro_delivery_courier'],
+                            'allegro_delivery_personal_acceptance'=>@$item['allegro_delivery_personal_acceptance'],
+                            'allegro_delivery_other'=>@$item['allegro_delivery_other'],
+                            'allegro_delivery_other_text'=>@$item['allegro_delivery_other_text'],
+                            'allegro_delivery_abroad'=>@$item['allegro_delivery_abroad'],
+                            'allegro_pay_wire_transfer'=>@$item['allegro_pay_wire_transfer'],
+                            'allegro_pay_wire_transfer_price'=>@$item['allegro_pay_wire_transfer_price'],
+                            'allegro_pay_collect_on_delivery'=>@$item['allegro_pay_collect_on_delivery'],
+                            'allegro_pay_collect_on_delivery_price'=>@$item['allegro_pay_collect_on_delivery_price'],
+                            'allegro_pay_on_line_pay'=>@$item['allegro_pay_on_line_pay'],
+                            'allegro_pay_payu_accept_escrow'=>@$item['allegro_pay_payu_accept_escrow'],
+                            'allegro_pay' =>@$item['allegro_pay'],
+                            'allegro_pay_wire_transfer_price'=>@$item['allegro_pay_wire_transfer_price'],
+                            'allegro_pay_price'=>@$item['allegro_pay_price'],
+                            'allegro_bold'=>@$item['allegro_bold'],
+                            'allegro_light' =>@$item['allegro_light'],
+                            'allegro_favouritism'=>@$item['allegro_favouritism'],
+                            'allegro_category_site'=>@$item['allegro_category_site'],
+                            'allegro_home_page'=>@$item['allegro_home_page'],
+                            'allegro_category'=>@$item['allegro_category'],
+                            'allegro_send'=>$send,
+    ));
+}
+?>
diff -ruN ../soteesklep3/admin/go/_edit/include/edit_update_ceneo.inc.php soteesklep3/admin/go/_edit/include/edit_update_ceneo.inc.php
--- ../soteesklep3/admin/go/_edit/include/edit_update_ceneo.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_edit/include/edit_update_ceneo.inc.php	2006-08-23 16:58:44.000000000 +0200
@@ -0,0 +1,30 @@
+<?php
+/**
+* Aktualizuj w baze wartosc pola zwi±zane z ceneoPasa¿
+*
+* @author  rdiak@sote.pl
+* @version $Id: edit_update_ceneo.inc.php,v 2.2 2006/08/16 10:20:55 lukasz Exp $
+*
+* \@verified 2004-03-16 m@sote.pl
+* @package    edit
+*/
+
+if ($global_secure_test!=true) {
+	die ("Forbidden");
+}
+
+require_once("include/metabase.inc");
+global $database;
+global $id;
+
+// odczytaj dane z formularza
+if (! empty($_REQUEST['item'])) {
+	$item=&$_REQUEST['item'];
+} else {
+	//die ("Forbidden: Unknown item");
+	$item = array("ceneo_export" => 0);
+}
+
+// zaakutalizuj informacje o tym czy produkt jest eksportowany w glownej tablicy produktow
+$database->sql_update("main","id=$id",array("ceneo_export"=>@$item['ceneo_export']));
+?>
diff -ruN ../soteesklep3/admin/go/_edit/include/query_rec_allegro.inc.php soteesklep3/admin/go/_edit/include/query_rec_allegro.inc.php
--- ../soteesklep3/admin/go/_edit/include/query_rec_allegro.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_edit/include/query_rec_allegro.inc.php	2006-08-23 16:58:44.000000000 +0200
@@ -0,0 +1,61 @@
+<?php
+/**
+* Odczytaj dane z zapyatnia SQL i udostepnij je w obiekcie $rec
+*
+* @author  m@sote.pl
+* @version $Id: query_rec_allegro.inc.php,v 2.3 2006/06/28 08:57:16 lukasz Exp $
+*
+* @global object $result           wynik zapytania SQL o wlasciwosci produktu
+
+* @package    edit
+*/
+
+// nie zezwalaj na bezposrednie wywolanie tego pliku
+if ($global_secure_test!=true) {
+    die ("Forbidden");
+}
+
+class RecordData {
+    var $data=array();
+}
+
+global $rec;
+$rec =& new RecordData;
+
+$i=0;
+
+$rec->data['user_id']=$db->FetchResult($result,$i,"user_id");
+$rec->data['allegro_auction_type']=$db->FetchResult($result,$i,"allegro_auction_type");
+$rec->data['allegro_product_name']=$db->FetchResult($result,$i,"allegro_product_name");
+$rec->data['allegro_product_description']=$db->FetchResult($result,$i,"allegro_product_description");
+$rec->data['allegro_photo']=$db->FetchResult($result,$i,"allegro_photo");
+$rec->data['allegro_miniature']=$db->FetchResult($result,$i,"allegro_miniature");
+$rec->data['allegro_price_start']=$db->FetchResult($result,$i,"allegro_price_start");
+$rec->data['allegro_price_buy_now']=$db->FetchResult($result,$i,"allegro_price_buy_now");
+$rec->data['allegro_price_min']=$db->FetchResult($result,$i,"allegro_price_min");
+$rec->data['allegro_stock']=$db->FetchResult($result,$i,"allegro_stock");
+$rec->data['allegro_how_long']=$db->FetchResult($result,$i,"allegro_how_long");
+$rec->data['allegro_delivery_who_pay']=$db->FetchResult($result,$i,"allegro_delivery_who_pay");
+$rec->data['allegro_delivery_shipment']=$db->FetchResult($result,$i,"allegro_delivery_shipment");
+$rec->data['allegro_delivery_priority_shipment']=$db->FetchResult($result,$i,"allegro_delivery_priority_shipment");
+$rec->data['allegro_delivery_courier']=$db->FetchResult($result,$i,"allegro_delivery_courier");
+$rec->data['allegro_delivery_personal_acceptance']=$db->FetchResult($result,$i,"allegro_delivery_personal_acceptance");
+$rec->data['allegro_delivery_other']=$db->FetchResult($result,$i,"allegro_delivery_other");
+$rec->data['allegro_delivery_other_text']=$db->FetchResult($result,$i,"allegro_delivery_other_text");
+$rec->data['allegro_delivery_abroad']=$db->FetchResult($result,$i,"allegro_delivery_abroad");
+$rec->data['allegro_pay_wire_transfer']=$db->FetchResult($result,$i,"allegro_pay_wire_transfer");
+$rec->data['allegro_pay_wire_transfer_price']=$db->FetchResult($result,$i,"allegro_pay_wire_transfer_price");
+$rec->data['allegro_pay_collect_on_delivery']=$db->FetchResult($result,$i,"allegro_pay_collect_on_delivery");
+$rec->data['allegro_pay_collect_on_delivery_price']=$db->FetchResult($result,$i,"allegro_pay_collect_on_delivery_price");
+$rec->data['allegro_pay_on_line_pay']=$db->FetchResult($result,$i,"allegro_pay_on_line_pay");
+$rec->data['allegro_pay_payu_accept_escrow']=$db->FetchResult($result,$i,"allegro_pay_payu_accept_escrow");
+$rec->data['allegro_pay']=$db->FetchResult($result,$i,"allegro_pay");
+$rec->data['allegro_pay_wire_transfer_price']=$db->FetchResult($result,$i,"allegro_pay_wire_transfer_price");
+$rec->data['allegro_pay_price']=$db->FetchResult($result,$i,"allegro_pay_price");
+$rec->data['allegro_bold']=$db->FetchResult($result,$i,"allegro_bold");
+$rec->data['allegro_light']=$db->FetchResult($result,$i,"allegro_light");
+$rec->data['allegro_favouritism']=$db->FetchResult($result,$i,"allegro_favouritism");
+$rec->data['allegro_category_site']=$db->FetchResult($result,$i,"allegro_category_site");
+$rec->data['allegro_home_page']=$db->FetchResult($result,$i,"allegro_home_page");
+$rec->data['allegro_category']=$db->FetchResult($result,$i,"allegro_category");
+?>
diff -ruN ../soteesklep3/admin/go/_edit/include/query_rec_ceneo.inc.php soteesklep3/admin/go/_edit/include/query_rec_ceneo.inc.php
--- ../soteesklep3/admin/go/_edit/include/query_rec_ceneo.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_edit/include/query_rec_ceneo.inc.php	2006-08-23 16:58:44.000000000 +0200
@@ -0,0 +1,30 @@
+<?php
+/**
+* Odczytaj dane z zapyatnia SQL i udostepnij je w obiekcie $rec
+*
+* @author  m@sote.pl
+* @version $Id: query_rec_ceneo.inc.php,v 2.2 2006/08/16 10:20:55 lukasz Exp $
+*
+* \@global object $result           wynik zapytania SQL o wlasciwosci produktu
+* \@global string $_REQUEST['lang'] jêzyk, dla którego jest definiowany opis itp.
+*
+* \@verified 2004-03-16 m@sote.pl
+* @package    edit
+*/
+
+// nie zezwalaj na bezposrednie wywolanie tego pliku
+if ($global_secure_test!=true) {
+    die ("Forbidden");
+}
+
+class RecordData {
+    var $data=array();
+}
+
+global $rec;
+global $id;
+
+$rec =& new RecordData;
+$result = $db->Query("Select * From main Where id=$id");
+$rec->data['ceneo_export']=$db->FetchResult($result,0,"ceneo_export");
+?>
diff -ruN ../soteesklep3/admin/go/_edit/lang/_pl/lang.inc.php soteesklep3/admin/go/_edit/lang/_pl/lang.inc.php
--- ../soteesklep3/admin/go/_edit/lang/_pl/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_edit/lang/_pl/lang.inc.php	2006-08-23 16:58:44.000000000 +0200
@@ -0,0 +1,265 @@
+<?php
+$lang->edit_menu=array(
+                'similar'=>"+ Kopia (kategorii)",
+                'similar_id'=>"+ Kopia (ID)",
+                'delete'=>"Usuñ",
+                'preview'=>"Podgl±d",
+                'help'=>"Pomoc",
+                'pasaz.onet.pl'=>"Onet Pasa¿",
+                'pasaz.wp.pl'=>"WP Pasa¿",
+                'pasaz.interia.pl'=>"Interia Pasa¿",
+                'ceneo.pl'=>"Ceneo",
+                'robot'=>"Indeksowanie",
+                'accessories'=>"Akcesoria",
+                'setup'=>"Ustawienia",
+                'add'=>"Dodaj",
+                'edit'=>"Edycja",
+                'google'=>"Google",
+                'category'=>"Kategorie",
+                'copy'=>"",
+                'allegro'=>"Allegro",
+                );
+$lang->edit_lang_versions="Wersje jêzykowe";
+$lang->edit_edit=array(
+                'options_adv'=>"Opcje zaawansowane",
+                'options_adv_edit'=>"Edycja zaawansowanych opcji produktu",
+                'description'=>"Edycja opisu produktu",
+                );
+$lang->edit_add_description_info="Opisy produktu mozna edytowac po dodaniu produktu do bazy";
+$lang->edit_add_submit="Dodaj produkt";
+$lang->edit_edit_submit="Aktualizuj zmiany";
+$lang->edit_edit_title="Edycja danych produktu";
+$lang->edit_add_copy_user_id="Dodaj produkt w innej kategorii";
+$lang->edit_add_review="Dodaj recenzjê";
+$lang->edit_photo_upload="za³±cz zdjêcie";
+$lang->edit_m_photo_upload="za³±cz ma³e zdjêcie";
+$lang->edit_photo_scale="pomniejsz zdjêcie";
+$lang->edit_submit="Aktualizuj zmiany";
+$lang->edit_update_ok="Dane zosta³y zaktualizowane :)";
+$lang->edit_link="Edytuj opis";
+$lang->edit_xml_options="<u>(<b>opcje</b> zaawansowane) pe³na edycja >></u>";
+$lang->edit_add_similar="Dodaj produkt w tej samej kategorii";
+$lang->edit_file="Edytuj plik";
+$lang->edit_photo_delete="usuñ zdjêcie";
+$lang->edit_bar="Edycja tre¶ci stron tekstowych";
+$lang->edit_add_form_errors=array(
+                'user_id'=>array(
+                                '10'=>"brak identyfikatora lub bledna wartosc",
+                                '11'=>"produkt o podanym identyfikatorze juz istnieje w bazie",
+                                ),
+                                
+                'name'=>"brak nazwy produktu",
+                'price_brutto'=>"brak ceny lub b³êdna warto¶æ",
+                'price_currency'=>"brak ceny lub b³êdna warto¶æ",
+                'category1'=>"brak kategorii",
+                'category2'=>"brak kategorii",
+                'category3'=>"brak kategorii",
+                'category4'=>"brak kategorii",
+                'category5'=>"brak kategorii",
+                );
+$lang->onet_form_errors=array(
+                );
+$lang->wp_form_errors=array(
+                );
+$lang->interia_form_errors=array(
+                );
+$lang->ceneo_form_errors=array(
+                );
+$lang->edit_record_add_title="Dodanie nowego produktu";
+$lang->edit_accessories_title="Akcesoria do produktu";
+$lang->edit_setup_title="Ustawienia ogólne edycji produktów";
+$lang->edit_setup_form=array(
+                'netto'=>"Domy¶lnie w edycji produktu wy¶wietlaj ceny netto",
+                );
+$lang->edit_onet=array(
+                'onet_export'=>"Eksportuj produkt",
+                'onet_status_delete'=>"Kasuj produkt",
+                'onet_status_update'=>"Dodaj/Aktualizuj produkt",
+                'onet_image_export'=>"Eksportuj zdjêcie",
+                'onet_image_title'=>"Tytu³ zdjêcia",
+                'onet_image_desc'=>"Opis zdjêcia",
+                'onet_attrib'=>"Dodatkowy atrybut Onet",
+                'onet_not_file'=>"Brak pliku z kategoriami onetowymi.<br><a href=",
+                'onet_same_cat'=>"Nadaj produktom z tej samej kategorii, kategoriê onetow±",
+                'onet_category'=>"Nadaj kategoriê",
+                'onet_op'=>"Oferta OP",
+                'onet_author'=>"Nazwa autora (re¿yser, wykonawca)",
+                'onet_edition'=>"Rok wydania",
+               );
+$lang->edit_onet_head="Onet.Pasa¿.pl";
+$lang->edit_onet_select="Wybierz";
+$lang->edit_interia_select="Wybierz";
+$lang->edit_wp=array(
+                'wp_export'=>"Eksportuj produkt",
+                'wp_status_delete'=>"Kasuj produkt",
+                'wp_status_update'=>"Aktualizuj produkt",
+                'wp_status_add'=>"Dodaj produkt",
+                'wp_image_export'=>"Eksportuj zdjêcie",
+                'wp_image_title'=>"Tytu³ zdjêcia",
+                'wp_image_desc'=>"Opis zdjêcia",
+                'wp_attrib'=>"Dodatkowy atrybut wp",
+                'wp_not_file'=>"Brak pliku z kategoriami WP Pasa¿.<br><a href=",
+                'wp_same_cat'=>"Nadaj produktom z tej samej kategorii, <b>kategoriê</b> WP Pasa¿",
+                'wp_same_prod'=>"Nadaj produktom z tej samej kategorii, <b>producenta</b> WP Pasa¿",
+                'wp_category'=>"Nadaj kategoriê",
+                'wp_producer'=>"Wybierz producenta",
+                'wp_fields'=>"Wybierz dodatkowe kategorie",
+                'wp_advantages'=>"Wybierz korzy¶ci",
+                'wp_filters'=>"Wybierz dodatkowe filtry",
+                'wp_dest'=>"Przeznaczenie",
+                'wp_valid'=>"Data wa¿no¶ci",
+                'wp_dictid'=>"Identyfikator s³ownikowy",
+                'wp_ptg'=>"Promocja tekstowa",
+                'wp_ptg_desc'=>"Opis promocji",
+                'wp_ptg_days'=>"Czas trwania promocji",
+                'wp_ptg_picurl'=>"Url do obrazka",
+                );
+
+$lang->edit_interia=array(
+                'interia_export'=>"Eksportuj produkt",
+                'interia_status_delete'=>"Kasuj produkt",
+                'interia_status_update'=>"Aktualizuj produkt",
+                'interia_status_add'=>"Dodaj produkt",
+                'interia_image_export'=>"Eksportuj zdjêcie",
+                'interia_image_title'=>"Tytu³ zdjêcia",
+                'interia_image_desc'=>"Opis zdjêcia",
+                'interia_attrib'=>"Dodatkowy atrybut interia",
+                'interia_not_file'=>"Brak pliku z kategoriami interia Pasa¿.<br><a href=",
+                'interia_same_cat'=>"Nadaj produktom z tej samej kategorii, kategoriê interia Pasa¿",
+                'interia_category'=>"Nadaj kategoriê",
+                'interia_producer'=>"Wybierz producenta",
+                'interia_fields'=>"Wybierz dodatkowe kategorie",
+                'interia_advantages'=>"Wybierz korzy¶ci",
+                'interia_filters'=>"Wybierz dodatkowe filtry",
+                'interia_dest'=>"Przeznaczenie",
+                'interia_valid'=>"Data wa¿no¶ci",
+                'interia_dictid'=>"Identyfikator s³ownikowy",
+                'interia_ptg'=>"Promocja tekstowa",
+                'interia_ptg_desc'=>"Opis promocji",
+                'interia_ptg_days'=>"Czas trwania promocji",
+                'interia_ptg_picurl'=>"Url do obrazka",
+                );
+
+$lang->edit_ceneo=array(
+                'ceneo_export'=>"Produkt do eksportu",
+                'ceneo_attrib'=>"Do³±czyæ atrybuty Ceneo ?",
+                'ceneo_autor'=>"Autor",
+                'ceneo_isbn'=>"Numer ISBN",
+                'ceneo_page'=>"Ilo¶æ stron",
+                'ceneo_publisher'=>"Wydawca",
+                'ceneo_producer'=>"Nazwa producenta",
+                'ceneo_size'=>"Rozmiar felgi",
+                'ceneo_rozstaw'=>"Rozstaw ¶rub",
+                'ceneo_odsadzenie'=>"Warto¶æ odsadzenia",
+                'ceneo_rezyser'=>"Re¿yser",
+                'ceneo_obsada'=>"Obsada",
+                'ceneo_nosnik'=>"No¶nik",
+                'ceneo_tytul_org'=>"Tytu³ oryginalny",
+                'ceneo_opony_producent'=>"Nazwa producenta",
+                'ceneo_opony_model'=>"Model",
+                'ceneo_opony_szerokosc'=>"Szeroko¶æ",
+                'ceneo_opony_profil'=>"Profil",
+                'ceneo_opony_srednica'=>"¦rednica",
+                'ceneo_opony_predkosc'=>"Indeks prêdko¶ci",
+                'ceneo_opony_nosnosc'=>"No¶no¶æ",
+                'ceneo_opony_sezon'=>"Sezon",
+                'ceneo_opony_typ'=>"Typ pojazdu",
+                'ceneo_perfumy_producent'=>"Producent",
+                'ceneo_perfumy_model'=>"Model",
+                'ceneo_perfumy_rodzaj'=>"Rodzaj",
+                'ceneo_perfumy_pojemnosc'=>"Pojemno¶æ"
+                );
+
+$lang->edit_allegro=array(
+				'allegro_auction_type'=>"Format sprzeda¿y",
+				'allegro_auction_type_auction'=>"Aukcja (z licytacj±)",
+				'allegro_auction_type_buy_now'=>"Tylko Kup Teraz! (bez licytacji)",
+				
+				'allegro_category'=>"Kategoria",
+				'allegro_product_name'=>"Tytu³ aukcji",
+				'allegro_product_description'=>"Opis produktu",
+				'allegro_photo'=>"Zdjêcie",
+				'allegro_miniature'=>"Miniaturka",
+				'allegro_price_start'=>"Cena wywo³awcza",
+				'allegro_price_buy_now'=>"Cena Kup Teraz!",
+				'allegro_price_min'=>"Cena minimalna",
+				'allegro_stock'=>"Liczba sztuk",
+				'allegro_how_long'=>"Czas trwania aukcji",
+				'allegro_prices_duration'=>"Cena i czas trwania",
+				
+				
+				'allegro_delivery'=>"Opcje transportu",
+				'allegro_delivery_who_pay'=>"Koszt przesy³ki pokrywa:",
+				'allegro_delivery_buyer'=>"Kupuj±cy",
+				'allegro_delivery_sell'=>"Sprzedaj±cy",
+				'allegro_delivery_shipment'=>"Przesy³ka pocztowa (list polecony/paczka)",
+				'allegro_delivery_priority_shipment'=>"Przesy³ka pocztowa priorytetowa (list polecony/paczka)",
+				'allegro_delivery_courier'=>"Przesy³ka kurierska",
+				'allegro_delivery_personal_acceptance'=>"Odbiór osobisty",
+				'allegro_delivery_abroad'=>"Zgadzam siê na wys³anie przedmiotu za granicê",
+				'allegro_delivery_other'=>"Inne (np. list zwyk³y)",
+				'allegro_pay'=>"Formy p³atno¶ci",
+				'allegro_pay_wire_transfer'=>"Wp³ata na konto bankowe (p³atno¶æ z góry)",
+				'allegro_pay_collect_on_delivery'=>"Pobranie pocztowe (p³atne przy odbiorze)",
+				'allegro_pay_on_line_pay'=>"P³atno¶ci Allegro - szybkie p³atno¶ci online",
+				'allegro_pay_payu_accept_escrow'=>"Escrow w ramach P³atno¶ci Allegro",
+				'allegro_pay_price'=>"Koszt wysy³ki",
+				
+				
+				'allegro_bold'=>"Pogrubienie",
+				'allegro_light'=>"Pod¶wietlenie",
+				'allegro_favouritism'=>"Wyró¿nienie",
+				'allegro_category_site'=>"Strona kategorii",
+				'allegro_home_page'=>"Strona g³ówna Allegro",
+				'allegro_currency'=>"PLN",
+				'allegro_days'=>"dni",
+				'allegro_additional_options'=>"Opcje dodatkowe",
+				
+				
+				
+);            
+$lang->edit_wp_dest=array(
+                '0'=>"----wybierz----",
+                '1'=>"dla niego",
+                '2'=>"dla niej",
+                '3'=>"dla dziecka",
+                '4'=>"dla firmy",
+                );
+$lang->edit_wp_head="Pasa¿ WP";
+$lang->edit_interia_head="Pasa¿ Interia";
+$lang->edit_ceneo_head="Ceneo";
+$lang->edit_allegro_head="Allegro";
+
+$lang->edit_wp_select="Wybierz";
+$lang->info_attrib_order="Zamów";
+$lang->edit_category_info="Uwaga! Po zmianie/dodaniu kategorii, nale¿y wywo³aæ <a href=/go/_opt/index.php target=top>Optymalizacje</a>";
+$lang->edit_desc="Edycja opisu produktu";
+$lang->edit_noframes="Twoja przegl±darka nie obs³uguje ramek. Skorzystaj np. z programu <b>Netscape 7</b> lub <b>Internet Explorer 5 lub 6</b>.";
+$lang->edit_google_title="Dane zwi±zane z indeksowaniem";
+$lang->edit_google_cols=array(
+                'keywords'=>"S³owa kluczowe",
+                'description'=>"Opis strony",
+                'title'=>"Tytu³ strony",
+                );
+$lang->edit_category_title="Edycja dodatkowych kategorii produktu";
+$lang->edit_category_cols=array(
+                'category_multi_1'=>"Dodatkowe kategorie 1 (Kat1/kat2/.../Kat5)",
+                'category_multi_2'=>"Dodatkowe kategorie 2",
+                );
+$lang->edit_errors=array(
+                'unknown_product'=>"Wybranego produktu nie ma w bazie.",
+                'insert_error'=>"Produkt o podanym identyfikatorze nie zostal dodany do bazy",
+                'file_to_big'=>"Zbyt du¿y plik",
+                'file_max'=>"maksymalna wielko¶c pliku to (Kb)",
+                );
+$lang->flash_description="Opis pliku flash";
+$lang->add_link="Dodaj dodatkowy link do produtku w innej lokalizacji:";
+$lang->link=array(
+				'url'=>'url',
+				'name'=>'nazwa linku',
+);
+$lang->depository_num="Stan magazynowy";
+$lang->deliverer="Dostawca magazynowy";
+$lang->points_warning="<b>Uwaga!</b><br>Cena zostanie wyzerowana<br>";
+$lang->allegro_form_errors=array();
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/go/_google/include/google.inc.php soteesklep3/admin/go/_google/include/google.inc.php
--- ../soteesklep3/admin/go/_google/include/google.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_google/include/google.inc.php	2006-08-23 16:58:45.000000000 +0200
@@ -0,0 +1,668 @@
+<?php
+/**
+* Google - klasy i funkcje
+*
+* @author  m@sote.pl
+* @version $Id: google.inc.php,v 1.14 2006/08/16 10:21:02 lukasz Exp $
+* @package google
+*/
+
+/**
+* Google main
+*/
+require_once ("include/google_main.inc");
+
+/**
+* Google Sitemap
+*/
+require_once ("./include/google_sitemap.inc.php");
+
+/**
+* Klasa Google.
+* @package google
+*/
+class Google extends GoogleMain {
+
+    var $action="stat_pages_products.php";
+    var $max_file_size="47104";      // 46k
+    var $max_tmpl_file_size="4096";  // 4k
+	var $per_run=10000; // w jednym przebiegu przerabiamy 10k produktów max
+    /**
+    * @var array Pliki statyczne, ktore bêd± generowane jako strony HTML
+    */
+    var $_statFiles=array(
+    "terms.html"=>"1",
+    "about_company.html"=>"1",
+    "contact.html"=>"1",
+    "about_shop.html"=>"1",
+    "help.html"=>"1"
+    );
+
+    /**
+    * @var object obiekt GoogleSitemap - dotyczy mapy stron statycznych
+    */
+    var $sitemap;
+
+    /*
+    * @var object obiekt GoogleSitemap - dotyczy mapy dynamicznych stron
+    */
+    var $sitemap2;
+
+    /**
+    * @var array Okre¶lenie priorytetow ró¿nych rodzajów stron
+    */
+    var $_priority=array("html"=>'0.5',"cat"=>"0.9","product"=>"0.8","main_html"=>'0.9');
+
+    /**
+    * @var array okre¶lenie czêstotliwo¶ci aktualizacji ró¿nych typów stron
+    */
+    var $_freq=array("html"=>"monthly","cat"=>"weekly","product"=>"monthly","main_html"=>"weekly");
+
+    
+    /**
+    * @var int W którym przebiegu teraz jeste¶my
+    */
+    var $run;
+    /**
+    * Konstruktor.
+    */
+    function Google($run=1,$per_one=10000) {
+        global $DOCUMENT_ROOT,$config;
+
+        $this->sitemap  =& new GoogleSitemap();  // mapa statyczna  (stron statycznych)
+        $this->sitemap2 =& new GoogleSitemap();  // mapa dynamiczna (stron dynamicznych)
+		$this->per_run=$per_one;
+        // odczytaj date modyfikacji pliki html/index.html -> to jest data generowania stron statycznych html
+        $filename=$DOCUMENT_ROOT."/../htdocs/html/index.html";
+        if (file_exists($filename)) {
+            $this->_lastmod=date("Y-m-d", filectime($filename));
+        } else {
+            $this->_lastmod=date("Y-m-d");
+        }
+
+        $this->sitemap->add("http://".$config->www."/google.php",$this->_lastmod,$this->_priority['main_html'],$this->_freq['main_html']);
+        $this->sitemap2->add("http://".$config->www."/",date("Y-m-d"),1,"daily");
+		$this->run=$run;
+        return;
+    } // end Google()
+
+
+    /**
+    * Formularz wywo³ania startu generowania stron statycznych dla produktow
+    */
+    function formStatProductPages() {
+        global $lang;
+        print "<p />\n";
+        print "<form action=\"$this->action\" method=POST target=\"import\">\n";
+        print "<input type=\"submit\" value=\"$lang->google_submit\" onclick=\"window.open('', 'import', 'width=525,height=380,scrollbars=1,menubar=0,status=0,location=0,directories=0,toolbar=0,resizable=0')\">\n";
+        print "</form>\n";
+    } // end formStatProductPages()
+
+    /**
+    * Generuj strony statyczne dla Google
+    */ 
+    function genStatProductPages() {
+        global $db,$stream;
+        global $ftp,$config;
+
+        $ftp->connect();
+        $this->_readProductTemplate();
+
+//        $query="SELECT * FROM main ORDER BY id";
+		$run_last=$this->run*$this->per_run;
+        $query="SELECT * FROM main ORDER BY id LIMIT $run_last,$this->per_run";
+        $result=$db->query($query);
+        if ($result!=0) {
+            $num_rows=$db->numberOfRows($result);
+            if ($num_rows>0) {
+                $_prev=array();
+
+                for ($i=0;$i<$num_rows+1;$i++) {
+                    $user_id=$db->fetchResult($result,$i,"user_id");
+                    $name=$db->fetchResult($result,$i,"name_L0");                                        
+                    $page=$this->_genStatPage($result,$i);
+                    $filename=$this->_filenameProduct($result,$i);                    
+                    $description=$db->fetchResult($result,$i,"xml_description_L0");
+                    $date_update=$db->fetchResult($result,$i,"date_update");
+                    if ((! empty($date_update)) && (ereg("^[0-9]{14}$",$date_update))){
+                        $date_update=substr($date_update,0,4)."-".substr($date_update,4,2)."-".substr($date_update,6,2); // YYYY-MM-DD
+                    } elseif (ereg("^[0-9]{4}\-[0-9]{2}\-[0-9]{2}",$date_update)) {
+                        // 2004-05-10 12:34
+                        $date_update=substr($date_update,0,10);
+                    } else {
+                        // w date_update nie rozpoznano formatu timestamp np.: 20050530161521                        
+                        $date_update='';
+                    }                    
+
+                    if ($i>1) {
+                        $next="/html/$filename";
+                        if (! empty($_prev_2['filename'])) {
+                            $prev="/html/".$_prev_2['filename'];
+                        } else $prev="#";                        
+                        if ($i==$num_rows) $next="#";
+                                  
+                        $this->_installPage("html/".$_prev['filename'],$_prev['page'],array("prev"=>$prev,"next"=>$next,"map"=>""),$_prev['date_update']);
+                        $this->_add2Sitemap2("product",$_prev['user_id'],$_prev['date_update']);
+
+                        if ($i==1) {
+                            // instaluj 1 stronê tak± jak 1 produkt
+                            $map=$this->genProductMap(); // mapa - lista produktów
+                            $this->_installPage("html/index.html",$_prev['page'],array("prev"=>$prev,"next"=>$next,"map"=>$map),
+                            $date_update);
+                            $stream->line_blue();
+                        }
+                    }
+
+                    // zapamiêtaj stronê, która bêdzie instalowana w kolejnym przej¶ciu pêtli
+                    $_prev_2=$_prev;                   // zapamiêtanie 2 kroków wstecz
+                    $_prev['filename']=$filename;
+                    $_prev['user_id']=$user_id;
+                    $_prev['date_update']=$date_update;
+                    $_prev['page']=$page;
+
+                    $stream->line_blue();
+                }
+            }
+        } else die ($db->error());
+
+        return;
+    } // end genStatProductsPages()
+
+    /**
+    * Generuj nazwe pliku dla storny statycznej produktu
+    *
+    * @param mixed &$result wynik zapytania z bazy danych
+    * @param int   $i      wiersz wyniku zapytania SQL
+    */
+    function _filenameProduct(&$result,$i) {
+        global $db;
+
+        $id=$db->fetchResult($result,$i,"id");
+        $filename=$id.".html";
+
+        return $filename;
+    } // end _filenameProduct()
+
+    /**
+    * Odczytaj szablon produktu i zapamiêtaj
+    *
+    * @access private
+    * @return void
+    */
+    function _readProductTemplate() {
+        $file="./html/template_product.html.php";
+        $fd=fopen($file,"r");
+        $this->_templateProduct=fread($fd,filesize($file));
+        fclose($fd);
+        return;
+    } // end _readProductTemplate()
+
+    /**
+    * Generuj stronê statyczn± dla 1 produktu.
+    *
+    * @param mixed &$result wynik zapytania z bazy danych
+    * @param int   $i      wiersz wyniku zapytania SQL
+    *
+    * @access private
+    * @return string zawarto¶æ strony
+    */
+    function _genStatPage(&$result,$i) {
+        global $db;
+
+        $d=array();
+        $d['title']=$db->fetchResult($result,$i,"name_L0");
+        $d['producer']=$db->fetchResult($result,$i,"producer");
+        $d['short_description']=$db->fetchResult($result,$i,"xml_short_description_L0");
+        $d['description']=$db->fetchResult($result,$i,"xml_description_L0");
+
+        $google_title=$db->fetchResult($result,$i,"google_title");
+        $google_keywords=$db->fetchResult($result,$i,"google_keywords");
+        $google_description=$db->fetchResult($result,$i,"google_description");
+
+        if (! empty($google_title)) {
+            $d['title']=$google_title;
+        }
+
+        if (empty($google_keywords)) {
+            $d['keywords']=$this->keywords().", ".$d['title'].", ".$d['producer'];
+        } else {
+            $d['keywords']=$google_keywords;
+        }
+
+        if (empty($google_description)) {
+            $description=$d['description'];
+            // ogranicz tekst do 128 znaków, obetnij HTMLe
+            require_once ("SDConvertText/class.SDConvertText.php");
+            $sdc =& new SDConvertText();
+            $description=$sdc->dropHTML($description,'');
+            $description=$sdc->shortText($description,128);
+            $description=preg_replace("/[\s]+/"," ",$description);
+            $d['meta_description']=$description;
+        } else {
+            $d['meta_description']=$google_description;
+        }
+
+        $o=$this->_templateProduct;
+
+        reset($d);
+        foreach ($d as $key=>$d1) {
+            $o=ereg_replace("\{$key\}",$d[$key],$o);
+        }
+
+        return $o;
+    } // end _genStatPage()
+
+    /**
+    * Generuj mapê listy produktów
+    *
+    * @param int $limit ilo¶c produktów losowych wygenerowanych w mapie
+    * @return string lista w formacie HTML
+    */
+    function genProductMap($limit=1000) {
+        global $db,$stream;
+
+        $o='';$d=array();
+        $query="SELECT id,user_id,name_L0,producer FROM main ORDER BY rand() LIMIT $limit";
+        $result=$db->query($query);
+        if ($result!=0) {
+            $num_rows=$db->numberOfRows($result);
+            if ($num_rows>0) {
+                $o="<ul>\n";
+                for ($i=0;$i<$num_rows;$i++) {
+                    $d['id']=$db->fetchResult($result,$i,"id");
+                    $d['user_id']=$db->fetchResult($result,$i,"user_id");
+                    $d['name']=$db->fetchResult($result,$i,"name_L0");
+                    $d['producer']=$db->fetchResult($result,$i,"producer");
+                    $o.="<li><a href=\"/html/".$d['id'].".html\">".$d['name']." ".$d['producer']."</a></li>";
+                    $stream->line_green();
+                }
+                $o.="</ul>\n";
+            }
+        } else die ($db->error());
+
+        return $o;
+    } // end genProductMap()
+
+    /**
+    * Instaluj strone HTML w katalogu
+    *
+    * @param string $path        ¶cie¿ka wzglêdem htdocs + nazwa pliku
+    * @param string $source      zawarto¶æ strony
+    * @param array  $data        tablica z podstawieniami do szablonów np. array("next"=>"test.html"), odpowiada szablonowi {next}
+    * @param string $date_update data aktualizacji strony YYYY-MM-DD
+    *
+    * @access private
+    * @return bool
+    */
+    function _installPage($path,$source,$data=array(),$date_update='') {
+        global $ftp,$DOCUMENT_ROOT,$config,$google_config,$lang;
+
+        $filename=basename($path);
+        $dir=dirname($path);
+        $tmp_file=$DOCUMENT_ROOT."/tmp/$filename";
+
+        // podstaw dane pod {logo} {ww} {style}
+        if (empty($data['css'])) {
+            $css_file="/themes/base/google/_style/".$google_config->keyword_plain.".css";
+            $data['css']=$css_file;
+        }
+        if (empty($data['www'])) {
+            $data['www']="<a href=\"/\">$lang->google_www_text $config->www</a>";
+        }
+        if (empty($data['logo'])) {
+            $data['logo']="<a href=\"http://$config->www\"><img src=\"/themes/base/google/_img/$google_config->logo\" title=\"".$google_config->keywords[0]."\" alt=\"".$google_config->keywords[0]."\" border=\"0\"></a>\n";
+        }
+
+        // wstaw odpowiednie warto¶ci do szablonów; podstawienia pod {next} itp.
+        reset($data);
+        foreach ($data as $key=>$val) {
+            $source=ereg_replace("\{$key\}",$val,$source);
+        }
+
+        // print "<pre>";print_r($source);print "</pre>";
+
+        if ($fd=fopen($tmp_file,"w+")) {
+            fwrite($fd,$source,strlen($source));
+            fclose($fd);
+
+            $ftp->put($tmp_file,$config->ftp['ftp_dir']."/htdocs/".$dir,$filename);
+
+            // dodaj adres do sitemap
+            $this->_add2Sitemap($path,$date_update);
+
+            return true;
+        } else {
+            return false;
+        }
+    } // end _installPage()
+
+    /**
+    * Dodaj adres do sitemap
+    *
+    * @param string $path        adres wzglêdem /
+    * @param string $date_update data aktualizacji strony
+    *
+    * @access private
+    * @return void
+    */
+    function _add2Sitemap($path,$date_update) {
+        global $config;
+        if (ereg("^\.",$path)) $path=substr($path,1,strlen($path));
+        if (ereg("html_",$path)) {
+            $priority=$this->_priority['html'];
+            $freq=$this->_freq['html'];
+        } elseif (ereg("cat_",$path)) {
+            $priority=$this->_priority['cat'];
+            $freq=$this->_freq['cat'];
+        } else {
+            $priority=$this->_priority['product'];
+            $freq=$this->_freq['product'];
+        }
+
+
+        if (! ereg("^\/",$path)) $path="/$path";
+        $this->sitemap->add("http://".$config->www.$path,$date_update,$priority,$freq);
+        return;
+    } // end _add2Sitemap()
+
+    /**
+    * Dodaj stronê do sitemap2
+    *
+    * @param string $type typ strony
+    * @param string $data parametr np. id produktu, nazwa pliku, id produktu
+    * @param string $date_update data aktualizacji
+    *
+    * @access private
+    * @return void
+    */
+    function _add2Sitemap2($type,$data,$date_update='') {
+        global $config;
+        if (! empty($data)) {
+            switch ($type) {
+                case "html":                
+                $this->sitemap2->add("http://".$config->www."/go/_files/?file=$data",$date_update,$this->_priority['html'],$this->_freq['html']);
+                break;
+                case "product":
+                $this->sitemap2->add("http://".$config->www."/go/_info/?user_id=$data",$date_update,$this->_priority['product'],$this->_freq['product']);
+                break;
+                case "cat":
+                $this->sitemap2->add("http://".$config->www."/go/_category/?idc=$data",$date_update,$this->_priority['cat'],$this->_freq['cat']);
+                break;
+            }
+        }
+        return;
+    } // end _add2Sitemap()
+
+    /**
+    * Generuj stronê tekstow± w w wersji HTML
+    *
+    * @return void
+    */
+    function genHTMLPages() {
+        global $lang,$config,$DOCUMENT_ROOT,$stream,$ftp;
+
+        $ftp->connect();
+
+        require_once ("go/_wysiwyg/config/config.inc.php");
+
+        // nadpisz listeplikow z configa lista plikow lokalnie zdefiniowanych
+        $config->wysiwyg_files[$config->htdocs_lang]=$this->_statFiles;
+
+        /*
+        * Generuj strone i-1 z linkiem do strony i. W ostatnim kroku generuj strony i-1 i i.
+        */
+        reset($config->wysiwyg_files[$config->htdocs_lang]); $file_data=array(); $i=0; $n=sizeof($config->wysiwyg_files[$config->htdocs_lang]);
+        foreach ($config->wysiwyg_files[$config->htdocs_lang] as $filename=>$data) {
+
+            // generuj naglowek strony html
+            $file="./html/head.html";
+            $fd=fopen($file,"r");
+            $head=fread($fd,filesize($file));
+            fclose($fd);
+
+            // generuj stopke strony html
+            $file="./html/foot.html";
+            $fd=fopen($file,"r");
+            $foot=fread($fd,filesize($file));
+            fclose($fd);
+
+            $file_html="$DOCUMENT_ROOT/../htdocs/themes/_$config->htdocs_lang/_html_files/$filename";
+            $fd=fopen($file_html,"r");
+            $page=$head.fread($fd,filesize($file_html)).$foot;
+            fclose($fd);
+
+            // zapamiêtaj dane pliku: nazwe, zawarto¶æ
+            $file_data[$i]=array("filename"=>$filename,"page"=>$page);
+
+            // pomiñ 1 przej¶cie, po to, ¿eby poznaæ link do kolejnej strony i pó¼niej wstawiæ go do 1 strony
+            if ($i>0) {
+                $data=array();
+                $data['next']="/html/html_".$file_data[$i]['filename'];
+                if (empty($file_data[$i-2]['filename'])) {
+                    $data['prev']="/";
+                } else {
+                    $data['prev']="/html/html_".$file_data[$i-2]['filename'];
+                }
+
+                $data['title']=$this->title();
+                $data['keywords']=$this->keywords();
+                $data['description']=$this->description();
+
+                $filename=$file_data[$i-1]['filename'];
+                $page=$file_data[$i-1]['page'];
+                
+                $date_update=$this->_filectime($filename);
+                $this->_installPage("html/html_$filename",$page,$data,$date_update);
+                $this->_add2Sitemap2("html",$filename,$date_update);
+                
+                $stream->line_blue();
+
+                // poniewa¿ na pocz±tku pominêli¶my 1 przej¶cie, to w ostatnim kroku musimy wygenerowaæ dodatkwo
+                // stronê dla ostatniego elementu - ostatniej strony HTML
+                if ($i==$n-1) {
+                    $data=array();
+                    $data['next']="/html/index.html"; // przej¶cie do listy produktów
+                    $data['prev']="/html/html_".$file_data[$i-1]['filename'];
+                    $data['title']=$this->title();
+                    $data['keywords']=$this->keywords();
+                    $data['description']=$this->description();
+
+                    $filename=$file_data[$i]['filename'];
+                    $page=$file_data[$i]['page'];
+                    
+                    $date_update=$this->_filectime($filename);
+                    $this->_installPage("html/html_$filename",$page,$data,$date_update);                    
+                    $this->_add2Sitemap2("html",$filename,$date_update);
+                    
+                    $stream->line_blue();
+                }
+            }
+
+            $i++;
+        }
+        // end
+
+        return;
+    } // end genHTMLPages()
+
+    /**
+    * Generuj strony kategorii    
+    */
+    function genCat() {
+        global $__category;
+        require_once ("config/tmp/category.php");
+
+        $this->_idc=array();
+        foreach ($__category as $id=>$tab) {
+            $this->_idc[]=substr($id,3,strlen($id)-3);
+            $this->_parseCat($tab);
+        }
+
+        $this->_genPagesIDC();
+
+        return;
+    } // end genCat()
+
+    /**
+    * Odczytaj date aktualizacji pliku HTML
+    *
+    * @param string $filename nazwa pliku html z _html_files
+    *
+    * @access private
+    * @return string data aktualizacji pliku YYY-MM-DD
+    */
+    function _filectime($filename) {
+        global $DOCUMENT_ROOT,$config;
+        // odczytaj date modyfikacji pliku; date("F d Y H:i:s.", filectime($filename)
+        $file=$DOCUMENT_ROOT."/../htdocs/themes/_$config->htdocs_lang/_html_files/$filename";
+        if (file_exists($file)) {
+            return date("Y-m-d",filectime($file));
+        } else return "0000-00-00";
+    } // end _filectime()
+
+    /**
+    * Odczytaj i zapamiêtaj warto¶æi IDC z listy katregorii
+    * 
+    * @param array $tab tablica kategorii
+    *
+    * @access private
+    * @return void
+    */
+    function _parseCat($tab) {
+        foreach ($tab as $key=>$val) {
+            if (is_array($val)) {
+                $this->_parseCat($val);
+            } else {
+                if (ereg("^[0-9_]+$",$val)) {
+                    $this->_idc[]=$val;
+                    // sprawdz czy wyzsze poziomy danej kategorii sa zapisane
+                    // np. jesli mamy 44_213_41 to sprawdzamy czy sa zapisane 44_213
+                    $tab2=split("_",$val,5); $idct2=$tab2[0]."_";
+                    for ($i=1;$i<sizeof($tab2);$i++) {
+                        $idct2.=$tab2[$i];
+                        if (! in_array($idct2,$this->_idc)) {
+                            $this->_idc[]=$idct2;
+                        }
+                        $idct2.="_";
+                    } // end for
+                }
+            }
+        }
+        return;
+    } // end _parseCat()
+
+    /**
+    * Generuj strony dla kategorii, analiza listy $this->idc
+    */
+    function _genPagesIDC() {
+        global $db,$db2;
+
+        reset($this->_idc);$db2=$db;$k=0;
+        foreach ($this->_idc as $id=>$idc) {
+
+            $this->_add2Sitemap2("cat",$idc,date("Y-m-d")); // dodaj adres do mapy
+
+            $db=$db2;
+            $tab=split("_",$idc);
+            $l=sizeof($tab);
+            $where='';
+            for ($i=1;$i<=$l;$i++) {
+                $where.="id_category$i='".$tab[$i-1]."' AND ";
+            }
+            $where=substr($where,0,strlen($where)-5);
+            $query="SELECT * FROM main WHERE $where ORDER BY rand() LIMIT 10";
+            //  "query=$query ";
+            $result=$db->query($query);
+            if ($result!=0) {
+                // generuj strone dla kategorii
+                if ($k==0) $prev_k=0; else $prev_k=$k-1;
+                if ($k==sizeof($this->_idc)-1) $next_k=$k; else $next_k=$k+1;
+                $this->_genOnePageIDC($result,$idc,$this->_idc[$prev_k],$this->_idc[$next_k]);
+            } else die ($db->error());
+            $k++;
+        }
+        return;
+    } // end _genPagesIDC()
+
+    /**
+    * Generuj 1 stronê HTML dla wskazanej kategorii
+    *
+    * @param mixed  $result   wynik zapytania z bazy danych
+    * @param string $idc      IDC kategorii
+    * @param string $idc_prev poprzedniej kategorii
+    * @param string $idc_next nastêpnej kategorii
+    *
+    * @access private
+    * @return void
+    */
+    function _genOnePageIDC(&$result,$idc,$prev_idc,$next_idc) {
+        global $db;
+        global $stream;
+        global $lang;
+
+        // print "IDC: &lt; $prev_idc |<b>$idc</b>| $next_idc &gt;<br />\n";
+
+        // head
+        $file="./html/head.html";
+        $fd=fopen($file,"r");
+        $head=fread($fd,filesize($file));
+        fclose($fd);
+
+        // foot
+        $file="./html/foot.html";
+        $fd=fopen($file,"r");
+        $foot=fread($fd,filesize($file));
+        fclose($fd);
+
+        $num_rows=$db->numberOfRows($result);$body='';
+        for ($i=0;$i<$num_rows;$i++) {
+            $d=array();
+            $d['id']=$db->fetchResult($result,$i,"id");
+            $d['name']=$db->fetchResult($result,$i,"name_L0");
+            $d['category1']=$db->fetchResult($result,$i,"category1");
+            $d['category2']=$db->fetchResult($result,$i,"category2");
+            $d['category3']=$db->fetchResult($result,$i,"category3");
+            $d['category4']=$db->fetchResult($result,$i,"category4");
+            $d['category5']=$db->fetchResult($result,$i,"category5");
+            $d['producer']=$db->fetchResult($result,$i,"producer");
+            $d['description']=$db->fetchResult($result,$i,"xml_description_L0");
+
+            $body.="
+            <table width=\"50%\"><tr><td>
+            <a href=\"/html/".$d['id'].".html\">".$d['name']."</a><p />
+            ".$d['producer']."
+            <p />\n<b>".$lang->google_categories."</b><h3>".$d['category1']."</h3> ".$d['category2']." ".$d['category3']." ".$d['category4']." ".$d['category5']."<p />
+            ".$d['description']."
+            </table> <hr />";
+
+        } // end for
+
+        $page=$head.$body.$foot;
+
+        if (ereg("^[0-9]+$",$idc)) $idc="id_$idc";
+        if (ereg("^[0-9]+$",$prev_idc)) $prev_idc="id_$prev_idc";
+        if (ereg("^[0-9]+$",$next_idc)) $next_idc="id_$next_idc";
+
+        $prev="/html/cat_$prev_idc".".html";
+        $next="/html/cat_$next_idc".".html";
+
+        $this->_installPage("./html/cat_$idc".".html",$page,
+        array("prev"=>$prev,"next"=>$next,"keywords"=>$this->keywords(),"description"=>$this->description(),
+        "title"=>$this->title()),date("Y-m-d"));
+        $stream->line_green();
+
+        return;
+    } // end _genOnePageIDC()
+
+    /**
+    * Destruktor
+    */
+    function close() {
+        global $ftp;
+        $ftp->close();
+        return true;
+    } // end close()
+
+} // end class Google()
+
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/go/_google/include/google_sitemap.inc.php soteesklep3/admin/go/_google/include/google_sitemap.inc.php
--- ../soteesklep3/admin/go/_google/include/google_sitemap.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_google/include/google_sitemap.inc.php	2006-08-23 16:58:45.000000000 +0200
@@ -0,0 +1,182 @@
+<?php
+/**
+* Generuj Google SiteMap
+*
+* @see https://www.google.com/webmasters/sitemaps/stats
+*
+* @author  m@sote.pl
+* @version $Id: google_sitemap.inc.php,v 1.8 2006/08/16 10:21:02 lukasz Exp $
+* @package google
+*
+*
+* example of sitemap protocol:
+
+<urlset xsi:schemaLocation="http://www.google.com/schemas/sitemap/0.84 http://www.google.com/schemas/sitemap/0.84/sitemap.xsd">  
+  <url>
+    <loc>www.1440.demo.sote.pl:9686/</loc>
+    <changefreq>daily</changefreq>
+    <priority>0.5</priority>
+  </url>
+</urlset>
+
+*/
+
+define ("SITEMAP_LIST",1);
+define ("SITEMAP_ONE",2);
+
+
+include_once("Date/Calc.php");
+
+/**
+* Generowanie Google SiteMap XML
+*/
+class GoogleSitemap {
+
+    /**
+    * @var string $_www adres URL sklepu 
+    * @access private
+    */
+    var $_www;
+
+    /**
+    * @var string $_xml_head_list
+    * @access private
+    */
+    var $_xml_head_list="<?xml version='1.0' encoding='UTF-8'?>\n<sitemapindex xmlns=\"http://www.google.com/schemas/sitemap/0.84\">\n";
+    
+    /**
+    * @var string $_xml_head
+    * @access private
+    */
+    var $_xml_head="<?xml version='1.0' encoding='UTF-8'?>\n<urlset xmlns=\"http://www.google.com/schemas/sitemap/0.84\">\n";
+
+    /**
+    * @var string $_xml_foot
+    * @access private
+    */
+    var $_xml_foot="</urlset>\n";
+
+    /**
+    * @var string $_priority domy¶lna warto¶æ wa¿no¶ci strony 0.1 -> 1
+    * @access private
+    */
+    var $_priority="0.5";
+
+    /**
+    * @var string $_freq czêstotliwo¶æ modyfikacji strony
+    * @access private
+    */
+    var $_freq="weekly";
+
+    /**
+    * @var string $_xml generowany xml sitemap
+    * @access private
+    */
+    var $_xml;
+
+    /**
+    * Konstruktor
+    * 
+    * @param int $type typ mapy SITEMAP_LIST,SITEMAP_ONE
+    * @return void
+    */
+    function GoogleSitemap($type=SITEMAP_ONE) {
+        global $config;
+        $this->_www=$config->www;
+        if ($type==SITEMAP_LIST) {
+            $this->_xml=$this->_xml_head_list;
+        } else {
+            $this->_xml=$this->_xml_head;
+        }
+        $this->Date_mod =& New Date_Calc();
+        return;
+    } // end GoogleSiteMap()
+
+    /**
+     * Obni¿anie daty przekazanej jako parametr o 1 dzieñ
+     *
+     * @param date $date YYYY-MM-DD
+     */
+    function lowerdate(&$date) {
+    	ereg("([0-9]{4})-([0-9]{2})-([0-9]{2})",$date,$matches);
+    	$yyyy=$matches[1];
+    	$mm=$matches[2];
+    	$dd=$matches[3];
+    	$date=$this->Date_mod->prevDay($dd,$mm,$yyyy,"%Y-%m-%d");
+    }    
+    
+    /**
+    * Dodaj adres
+    * Dodaj wpis do XML
+    *
+        <url>
+         <loc>www.1440.demo.sote.pl:9686/</loc>
+         <changefreq>daily</changefreq>
+         <priority>0.5</priority>
+        </url>
+    *
+    * @see https://www.google.com/webmasters/sitemaps/docs/en/protocol.html
+    *
+    * @param string $url
+    * @param string $priority 0.1-1
+    * @param string $freq always, hourly, daily, weekly, monthly, yearly, never
+    * @param string $lastmod ostatnia modyfikacja YYYY-MM-DD
+    *    
+    * @return void
+    */
+    function add($url,$lastmod='',$priority='',$freq='') {
+        if (empty($priority)) $priority=$this->_priority;
+        if (empty($freq)) $freq=$this->_freq;
+
+        $url=trim($url);
+        $lastmod=$this->lowerdate($lastmod);
+        $o='';
+        $o.="  <url>\n";
+        $o.="    <loc>".$url."</loc>\n";
+        $o.="    <changefreq>$freq</changefreq>\n";
+        $o.="    <priority>$priority</priority>\n";
+        if (! empty($lastmod)) {
+            $o.="    <lastmod>$lastmod</lastmod>\n";
+        }
+        $o.="  </url>\n";
+        $this->_xml.=$o;
+        return;
+    } // end add()
+
+    /**
+    * Generuj pelny XML Sitemap
+    */
+    function readSitemap() {
+        $this->_xml.=$this->_xml_foot;
+        return $this->_xml;
+    } // end readSitemap()
+
+    /**
+    * Generuj zbiorcz± mapê - lista map
+    */
+    function readSitemapAll($ile) {
+        global $config;
+        
+        // 2004-10-01T18:23:17+00:00
+        $last_mod=date("Y-m-d");
+        $this->lowerdate($last_mod);
+        $o="<?xml version=\"1.0\" encoding=\"UTF-8\"?>
+   <sitemapindex xmlns=\"http://www.google.com/schemas/sitemap/0.84\">";
+   
+   for($i=1;$i<=$ile;$i++){     
+   $o.="
+   <sitemap>
+      <loc>http://$config->www/google/sitemap".$i.".xml.gz</loc>
+      <lastmod>$last_mod</lastmod>
+   </sitemap>
+   <sitemap>
+      <loc>http://$config->www/google/sitemap".$i."d.xml.gz</loc>
+      <lastmod>$last_mod</lastmod>
+   </sitemap>";
+   }
+   $o.="</sitemapindex>";
+        return $o;
+    } // end readSiteMapAll
+
+} // end class GoogleSitemap
+?>
diff -ruN ../soteesklep3/admin/go/_google/stat_pages_products.php soteesklep3/admin/go/_google/stat_pages_products.php
--- ../soteesklep3/admin/go/_google/stat_pages_products.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_google/stat_pages_products.php	2006-08-23 16:58:45.000000000 +0200
@@ -0,0 +1,127 @@
+<?php
+/**
+ * Generowanie stron statycznych dla produktów, stron HTML, kategorii itp.
+ *
+ * @author  m@sote.pl
+ * @version $Id: stat_pages_products.php,v 1.4 2006/08/16 10:21:02 lukasz Exp $
+ * @version $Id: stat_pages_products.php,v 1.4 2006/08/16 10:21:02 lukasz Exp $
+ * @package google
+ */
+
+$DOCUMENT_ROOT=$_SERVER['DOCUMENT_ROOT'];
+require_once ("../../include/head_stream.inc.php");
+
+/**
+* Obs³uga Google.
+*/
+require_once ("./include/google.inc.php");
+
+/**
+* Obs³uga FTP.
+*/
+require_once ("include/ftp.inc.php");
+
+// naglowek
+$theme->head_window();
+$theme->bar($lang->google_products_title);
+// obsluga streamingu -> status bar
+require_once ("themes/stream.inc.php");
+$stream = new StreamTheme;
+$stream->title_500(); // wyswietl pasek z numerami 100,200,300,400,500
+
+$per_one = 250;//to nam daje 100.000 podstron do zindeksowania
+global $db;
+$query="SELECT COUNT(*) FROM main";
+$result=$db->query($query);
+$ile=$db->fetchResult($result,0,"COUNT(*)");
+//$ile-=40000;//do testow
+$number=@$_REQUEST['number'];
+$number=mysql_escape_string($number);
+if (empty($number)) $number=1;
+
+$tmp2 = $ile/$per_one;
+print '<p /><center>Postêp '.$number.'/'.ceil($tmp2).'</center>';
+flush();
+
+$google =& new Google($number,$per_one);
+$google->genStatProductPages();
+$google->genHTMLPages();
+$google->genCat();
+$google->close();
+
+// zainstaluj sitemap
+$ftp->connect();
+$sitemap1=$google->sitemap->readSitemap();
+$sitemap2=$google->sitemap2->readSitemap();
+
+$sitemap_all =& new GoogleSitemap(SITEMAP_LIST);
+//$sitemap_all_xml = $sitemap_all->readSitemapAll(array("sitemap".$number.".xml","sitemap".$number."d.xml"));
+$sitemap_all_xml = $sitemap_all->readSitemapAll($number);
+	require_once ("Packer/packer.php");
+	
+	//to odpowiada za glowny plik
+	$sitemaps=array("sitemap.xml"=>$sitemap_all_xml);
+	foreach ($sitemaps as $file_sitemap=>$sitemap) {
+	    
+	    $file=$DOCUMENT_ROOT."/tmp/$file_sitemap";
+	    $fd=fopen($file,"w+");
+	    fwrite($fd,$sitemap,strlen($sitemap));
+	    fclose($fd);
+	
+	    // gzipuj mapê
+	    $archive =& new packer($file);
+	    $archive->toVar($out);
+	    
+	    $fd=fopen($file.".gz","w+");
+	    fwrite($fd,$out,strlen($out));
+	    fclose($fd);
+	
+	    $ftp->put($file.".gz",$config->ftp['ftp_dir']."/htdocs",$file_sitemap.".gz");
+	    
+	    @unlink($file);
+	}
+	//to odpowiada za male sitemapy -> wrzucane do katalogu google
+	$sitemaps=array("sitemap".$number.".xml"=>$sitemap1,"sitemap".$number."d.xml"=>$sitemap2);
+	foreach ($sitemaps as $file_sitemap=>$sitemap) {
+	    
+	    $file=$DOCUMENT_ROOT."/tmp/$file_sitemap";
+	    $fd=fopen($file,"w+");
+	    fwrite($fd,$sitemap,strlen($sitemap));
+	    fclose($fd);
+	
+	    // gzipuj mapê
+	    $archive =& new packer($file);
+	    $archive->toVar($out);
+	    
+	    $fd=fopen($file.".gz","w+");
+	    fwrite($fd,$out,strlen($out));
+	    fclose($fd);
+	
+	    $ftp->put($file.".gz",$config->ftp['ftp_dir']."/htdocs/google",$file_sitemap.".gz");
+	    
+	    @unlink($file);
+	}
+	$ftp->close();
+	
+
+
+// stopka
+$theme->foot_window();
+if($number<$ile/$per_one){
+	$number++;
+?>
+<script>
+window.location="stat_pages_products.php?number=<?php print $number;?>"
+</script>
+<?php
+	
+	
+}else{
+	
+	print "<p />\n<center>";
+	$theme->close();
+	print "</center>";
+}
+include_once ("include/foot.inc");
+
+?>
diff -ruN ../soteesklep3/admin/go/_lang_editor/index.php soteesklep3/admin/go/_lang_editor/index.php
--- ../soteesklep3/admin/go/_lang_editor/index.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_lang_editor/index.php	2006-08-23 16:58:46.000000000 +0200
@@ -0,0 +1,94 @@
+<?php
+/**
+* Edycja wersji jêzykowych
+*
+* Domy¶lny skrypt obs³uguj±cy edycjê wersji jêzykowych. Inicjuje obiekt klasy LangEditor,
+* za³±cza odpowiednie pliki modu³u i wykonuje jego metody w zale¿no¶ci od obecno¶ci i
+* warto¶ci zmiennych przesy³anych z formularza (tablica $_REQUEST).
+* @author  lech@sote.pl
+* @version $Id: index.php,v 1.21 2005/12/13 12:51:16 lechu Exp $
+* @package    lang_editor
+* \@lang
+* \@encodings
+*/
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+/**
+* Nag³ówek skryptu.
+*/
+require_once ("../../../include/head.inc");
+
+include("./include/lang_editor.inc.php"); // Klasa LangEditor
+include("lib/ConvertCharset/ConvertCharset.class.php");
+$NewEncoding = new ConvertCharset;
+global $sess;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+
+$__part = 'htdocs';
+
+if(!empty($_REQUEST['__part'])) {
+    $sess->register('__part', $_REQUEST['__part']);
+}
+
+if(!empty($_SESSION['__part']))
+    $__part = $_SESSION['__part'];
+
+$report_lang = @$_REQUEST['report_lang'];
+if($config->nccp == '0x1388') {
+    $lang_str = '';
+    $coma = '';
+    for($i = 0; $i < count($config->langs_symbols); $i++) {
+        if($config->langs_active[$i] == 1) {
+            $lang_str .= $coma . $config->langs_symbols[$i];
+            $coma = ', ';
+        }
+    }
+    $editor =& new LangEditor($lang_str, $__part);
+}
+else
+    $editor =& new LangEditor($config->base_lang, $__part);
+
+require_once("include/gen_config.inc.php"); // klasa s³u¿±ca do generowania zawarto¶ci pliku lang
+$generator =& new GenConfig;
+
+
+if(@$_REQUEST['lang_editor_post'] == 'update'){ // przes³ano formularz edycji zmiennej
+    $editor->updateAll($_REQUEST);
+    $theme->head_window();    
+    include_once("./html/lang_editor_dlg_confirm.html.php");
+    $theme->foot_window();
+}
+else{
+    // naglowek
+    $theme->head();
+    $theme->page_open_head();
+    
+    include_once ("plugins/_dictionary/include/menu_top.inc.php");    
+    $theme->bar($lang->_lang_editor_title_bar);            // bar
+
+    include_once("./html/lang_editor_searchform.html.php"); // wy¶wietl formularz wyszukiwania zmiennych
+    if(@$_REQUEST['lang_editor_action'] == 'search'){ // przes³ano formularz wyszukiwania zmiennych
+        $serialized = urlencode(serialize($_REQUEST));
+        ?>
+        <iframe width="100%" height="300" src="/go/_lang_editor/iframe.php?sess_id=<? echo $sess->id; ?>&serialized=<?php echo $serialized; ?>"></iframe>
+        <?php
+//        include_once("./include/lang_editor_mainform.php"); // wy¶wietl formularze edycji zmiennych
+        $editor->emptyTrash();
+    }
+    $theme->page_open_foot();
+    // stopka
+    $theme->foot();
+    include_once ("include/foot.inc");
+}
+
+global $shop;
+if($shop->home == 1){
+	// usun zapamietane pliki tymczasowe
+	foreach ($__del_files as $id=>$file) {
+	    if (file_exists($file))   unlink ($file);
+	}
+}
+
+?>
diff -ruN ../soteesklep3/admin/go/_main_configure/html/configure.html.php soteesklep3/admin/go/_main_configure/html/configure.html.php
--- ../soteesklep3/admin/go/_main_configure/html/configure.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_main_configure/html/configure.html.php	2006-08-23 16:58:46.000000000 +0200
@@ -0,0 +1,85 @@
+<?php
+/**
+* Centrum konfiguracyjne - zbior wszystkich konfiuracji ze sklepu
+*
+* @author  krzys@sote.pl
+* @version $Id: configure.html.php,v 1.25 2006/08/16 10:21:08 lukasz Exp $
+* @package configure
+*/
+
+global $config; 
+$theme->bar($lang->configure_title,"100%");
+print "<br>";
+$theme->desktop_open("100%");
+?>
+<table border="0" cellpadding="2" cellspacing="2">
+    <tr>
+        <td width="100%">
+            <?php print $lang->welcome_text;?><br /><br />
+        <td>
+    </tr>
+</table>
+<table border="0" cellpadding="0" cellspacing="0" width="100%" align="center">
+    
+    <tr align="left">    
+        <td width=30%>
+            <a href="/go/_configure/index.php"><u><?php print $lang->configuration; ?></u></a><br>
+            <!-- <a href="/go/_configure/domains.php"><u><?php print $lang->configuration_domains;?></u></a></br /> -->
+            <a href="/go/_configure/catalog_conf.php"><u><?php print $lang->catalog_conf; ?></u></a><br>
+            <a href="/go/_points/configure.php"><u><?php print $lang->configuration_points; ?></u></a>
+        </td>
+       
+        <td width=30%  valign="top"> 
+            <b><?php print $lang->conf_title_modules;?></b><br><br>
+            <?php if ($config->nccp=="0x1388"){ ?><a href="/plugins/_dictionary/configure.php"><u><?php print $lang->configuration_language; ?></u></a><br><?php }; ?>
+            <a href="/plugins/_newsletter/_users/config.php"><u><?php print $lang->configuration_newsletter; ?></u></a><br>
+            <a href="/plugins/_newsedit/configure.php"><u><?php print $lang->configuration_newsedit; ?></u></a><br>
+            <a href="/go/_options/_delivery/config.php"><u><?php print $lang->configuration_country; ?></u></a><br>
+            <a href="/go/_search/configure.php"><u><?php print $lang->configuration_search; ?></u></a><br>
+        </td>
+   
+        <td width=30%  valign="top">
+        <?php if ($config->nccp=="0x1388" && $config->admin_lang=='pl'){ ?>
+            <b><?php print $lang->conf_title_partners;?></b><br><br>
+            <a href="/plugins/_pasaz.onet.pl/config.php"><u><?php print $lang->configuration_onet; ?></u></a><br>
+            <a href="/plugins/_pasaz.wp.pl/config.php"><u><?php print $lang->configuration_wp; ?></u></a><br>
+            <a href="/plugins/_pasaz.interia.pl/config.php"><u><?php print $lang->configuration_interia; ?></u></a><br>
+            <a href="/plugins/_allegro/config.php"><u><?php print $lang->configuration_allegro; ?></u></a>
+        <?php }; ?>
+        </td>
+   </tr>
+   <tr>
+        <td colspan="3"><br></td>
+   </tr>
+   <tr>
+        <td width="30%" valign="top">
+        <?php if ($config->nccp=="0x1388"){ ?>
+            <b><?php print $lang->conf_title_pay;?></b><br><br>
+            <?php print $lang->conf_title_pay_on;?><br>
+            <?php if ($config->admin_lang=='pl'){ ?>
+            <u><a href="/plugins/_pay/_polcard/index.php"><?php print $lang->configuration_polcard;?></a></u><br>
+            <u><a href="/plugins/_pay/_przelewy24/index.php"><?php print $lang->configuration_przelewy24;?></a></u><br>
+            <?php } if ($config->admin_lang=='en'){ ?>
+            <u><a href="/plugins/_pay/_paypal/index.php"><?php print $lang->configuration_paypal;?></a></u><br>
+            <?php }; ?>
+           
+            <u><a href="/plugins/_pay/_platnoscipl/index.php"><?php print $lang->configuration_platnosciPL;?></a></u><br>
+            <u><a href="/plugins/_pay/_ecard/index.php"><?php print $lang->configuration_ecard;?></a></u><br>
+            <u><a href="/plugins/_pay/_allpay/index.php"><?php print $lang->configuration_allpay;?></a><u><br><br>
+            P³atno¶ci off-line:<br>
+             <u><a href="/plugins/_pay/_cardpay/info.php"><?php print $lang->configuration_cardpay;?></a></u><br>
+        <?php }; ?>
+            </td>
+        <td valign="top" width=30%>
+            <b><?php print $lang->conf_title_aspect;?></b><br><br>
+            <u><a href="/plugins/_themes/index.php"><?php print $lang->configuration_themes;?></u><br>
+            <u><a href="/plugins/_themes/category.php"><?php print $lang->configuration_category;?></a></u>
+        </td>
+   </tr>
+       
+</table>
+<br />
+<br />
+<?php
+$theme->desktop_close();
+?>
diff -ruN ../soteesklep3/admin/go/_offline/_main/include/category.inc.php soteesklep3/admin/go/_offline/_main/include/category.inc.php
--- ../soteesklep3/admin/go/_offline/_main/include/category.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_offline/_main/include/category.inc.php	2006-08-23 16:58:47.000000000 +0200
@@ -0,0 +1,122 @@
+<?php
+/**
+ * Zarzadzanie kategoriami i producentami
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: category.inc.php,v 2.14 2006/06/28 08:57:33 lukasz Exp $
+* @package    offline
+* @subpackage main
+ */
+
+ 
+/**
+ * Includowanie liba do oblsugi zapytan do bazy danych
+ */
+require_once("include/metabase.inc");
+
+
+/**
+* Klasa OfflineCategory
+*
+* @package offline
+* @subpackage admin
+*/
+class OfflineCategory {
+    var $category1=array();
+    var $category2=array();
+    var $category3=array();
+    var $category4=array();
+    var $category5=array();
+    var $producer=array();
+    
+    /**
+     * Konstruktor obiektu myCategory wczytuje do tablic wartosci z bazy danyc
+     *
+     * @return bool  
+     *
+     * @author rdiak@sote.pl
+     */
+    function OfflineCategory() {
+        global $database;
+        
+        $this->category1=$database->sql_select_data_array("id","category1","category1");
+        $this->category1_ord=$database->sql_select_data_array("id","ord_num","category1");
+
+        $this->category2=$database->sql_select_data_array("id","category2","category2");
+        $this->category2_ord=$database->sql_select_data_array("id","ord_num","category2");
+        
+        $this->category3=$database->sql_select_data_array("id","category3","category3");
+        $this->category3_ord=$database->sql_select_data_array("id","ord_num","category3");
+        
+        $this->category4=$database->sql_select_data_array("id","category4","category4");
+        $this->category4_ord=$database->sql_select_data_array("id","ord_num","category4");
+        
+        $this->category5=$database->sql_select_data_array("id","category5","category5");
+        $this->category5_ord=$database->sql_select_data_array("id","ord_num","category5");
+        
+        $this->producer=$database->sql_select_data_array("id","producer","producer");
+        return true;
+    }
+    
+    /**
+     * Funkcja check_category sprawdza czy dana kategoria znajduje sie juz w tablicy
+     *
+     * @param  string $category  nazwa tablicy ktorï¿½ sprawdzamy,
+     * @param  string $name      nazwa kategorii do sprawdzenia
+     * @return int    $max       id kategorii  
+     * 
+	 * @access public
+	 *
+     * @author rdiak@sote.pl
+     */
+   function check_category($category,$name) {
+        // sprawdzamy czy w tablicy znajduje sie juz taka kategoria
+        // jesli nie to dodajemy ja na koniec tablicy
+        $category_var=&$this->$category;
+        if(in_array("$name",$category_var)){
+            $max=array_search("$name",$category_var);
+            return $max;
+        } else {
+            $table=array_keys($category_var);
+            @$max=max($table);
+            //print "maxx - $max<br>";
+            $max+=1;
+            $category_var = $category_var+array($max=>$name);
+            return $max;
+        }
+    }
+    
+    /**
+     * Funkcja load_category laduje kategorie z tablicy do bazy danych. Wczesniej kasowane
+     * sa kategorie z bazy gdyz kategorie wszystkie znajduja sie w tablicach PHP, na ktorych
+     * wczesniej operowalismy. 
+     *
+     * @param  string $category  nazwa tablicy ktora uzupelniamy
+     * @return bool     
+     *
+     * @author rdiak@sote.pl
+     */
+    function load_category(){
+        global $database;
+
+        $table=array("category1","category2","category3","category4","category5","producer");
+        foreach($table as $cat) {
+            $cat1=$cat."_ord";
+        	
+            $database->sql_delete($cat);
+            while ( list( $key, $value ) = each( $this->$cat ) ) {
+            	$tab=@$this->$cat1;
+            	if ($cat != "producer")
+            	{
+	                $result=$database->sql_insert($cat,array("id"=>"$key",$cat=>"$value","ord_num"=>$tab[$key]));
+            	} 
+            	elseif ($cat == "producer")
+            	{
+            		$result=$database->sql_insert($cat,array("id"=>"$key",$cat=>"$value"));
+            	}
+            }
+        }
+        return true;
+    }
+} // end class OfflineCategory
+?>
diff -ruN ../soteesklep3/admin/go/_opt/include/producer.inc.php soteesklep3/admin/go/_opt/include/producer.inc.php
--- ../soteesklep3/admin/go/_opt/include/producer.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_opt/include/producer.inc.php	2006-08-23 16:58:48.000000000 +0200
@@ -0,0 +1,270 @@
+<?php
+/**
+* Stworz liste produkcentow dla kazdej kategorii
+*
+* @global  array $__category lista kategorii z config/tmp/category.php
+* @global object $stream obiekt klasy Stream -> obsluga status bar'a
+*
+* @author  m@sote.pl
+* @version $Id: producer.inc.php,v 2.23 2006/08/16 10:21:14 lukasz Exp $
+* @package soteesklep
+*/
+
+if (@$__secure_test!=true) die ("Bledne wywolanie");
+
+require_once ("include/ftp.inc.php");
+require_once ("config/tmp/category.php");
+
+global $stream;
+
+class ProducerCategory {
+    var $cidcs=array();             // lista id kategorii; dostepnwe wartosci parametrow idc i cidc
+    // przekazywanych do /htdocs/go/_category/index.php
+    var $producers=array();         // lista producentow dla poszczegolnych ID
+    // np. array("id_1"=>array(array("HP"=>"1"),array("Canon"=>"2")),"1_2"=>array(aray("HP"=>"3")),...)
+    
+    /**
+    * Wyszukaj id kategorii/podkategorii z tablicy danych
+    *
+    * @param  array $data_tab tablica danych kategorii/podkategorii
+    * @global array $this->cidcs array("1","1_2","1_3","3","3_4","3_4_6","3_4_7") itp.
+    */
+    function parse($data_tab=array()) {
+        reset($data_tab);
+        //        foreach ($data_tab as $data) {
+        while (list($key,$data) = each($data_tab)) {
+            if ((ereg("^[0-9_]+",$key)) || (ereg("^id_[0-9]+",$key))) {
+                if (! empty($key)) array_push($this->cidcs,$key);
+            }
+            if (is_array($data)) {
+                $this->parse($data);
+            } else {
+                if ((ereg("^[0-9_]+",$data)) || (ereg("^id_[0-9]+",$data))) {
+                    array_push($this->cidcs,$data);
+                }
+            }
+        } // end foreach
+    } // end parse
+    
+    /**
+    * Generuj dane $category_tab do fukcji $this->query()
+    */
+    function gen_category_tabs() {
+        global $stream;
+        
+        reset($this->cidcs);
+        foreach ($this->cidcs as $idc) {
+            
+            // wyswietl pasek status bar
+            $stream->line_green();
+            flush();
+            
+            $category_tab=array();
+            if (ereg("^id_",$idc)) {
+                $id=ereg_replace("id_","",$idc);   // dla np. $idc=id_15
+                // jest 1 kategoria
+                if (ereg("^[0-9]+$",$id)) {
+                    $category_tab[0]=$id;
+                }
+            } else {
+                if  (ereg("_",$idc)) {
+                    // jest wiecej niz 1 kategoria
+                    $category_tab=split("_",$idc,20);
+                } else {
+                    // jest 1 kategoria
+                    if (ereg("^[0-9]+$",$idc)) {
+                        $category_tab[0]=$idc;
+                    }
+                }
+            } // end if
+            
+            // generuj SQL - zapytaj sie o liste producentow w danej kategorii
+            if (sizeof($category_tab)>0) {
+                
+                $query=$this->query($category_tab);
+                
+                // generuj liste producentow
+                $category_producers=$this->producer_list($query);
+//                echo "<pre>";
+//                print_r($query);
+//                echo "</pre>";
+                // zapamietaj liste producentow dla danej kategorii (dla danej wartosci $idc)
+                $this->producers[$idc]=$category_producers;
+            }
+        } // end foreach
+    } // end gen_category_tabs()
+    
+    /**
+    * Generuj zapytanie SQL o producentow w danej kategorii
+    *
+    * @param array $category_tab array("1","3","5") oznacza category1=1 category2=3 category3=5
+    * @return string SQL
+    */
+    function query($category_tab) {
+        global $theme;
+        
+        $sql="SELECT producer,id_producer FROM main WHERE active=1 AND ";
+        
+        $size=sizeof($category_tab);
+        reset($category_tab);
+        for ($i=0;$i<$size;$i++) {
+            if (! ereg("^[0-9]+$",$category_tab[$i])) {
+                die  ("<center>Bledne wywolanie</center>");
+            }
+            $k=$i+1; // 0->1, 1->2 itd.
+            $sql.="id_category$k = '$category_tab[$i]' AND ";
+        }
+        //        $sql=substr($sql,0,strlen($sql)-4);
+        $sql.="producer!='' AND id_producer>0 GROUP BY producer,id_producer ORDER BY producer";
+        
+        // print $sql."<BR>";
+        
+        return $sql;
+    } // end query()
+    
+    /**
+    * Generuj liste proucentow dla okreslonych kategorii
+    *
+    * @param string $query zapytanie sql o producentow w danej kategorii
+    * @return array tablica z producentami i id producentow
+    *               np. array(array("HP"=>"1"),array("Canon"=>"2"))
+    */
+    function producer_list($query) {
+        global $db;
+        
+        $tab=array();
+        $prepared_query=$db->PrepareQuery($query);
+        if ($prepared_query) {
+            $result=$db->Query($query);
+            if ($result!=0) {
+                $num_rows=$db->NumberOfRows($result);
+                if ($num_rows>0) {
+                    for ($i=0;$i<$num_rows;$i++) {
+                        $producer=$db->FetchResult($result,$i,"producer");
+                        $id_producer=$db->FetchResult($result,$i,"id_producer");
+                        $producer=addslashes($producer);
+                        $tab2=array();
+                        $tab2[$producer]=$id_producer;
+                        array_push($tab,$tab2);
+                    } // end for
+                } // end if
+            } else die ($db->Error());
+        } else die ($db->Error());
+        
+        return $tab;
+    } // end producer_list()
+    
+    /**
+    * Genruj kod PHP z listami producentow
+    */
+    function gen_php() {
+        reset($this->producers);
+        if ((empty($this->producers)) || (key($this->producers)=="id_0"))  {
+            $php="<?php\n\n";
+            $php.="global \$__producers;\n\n";
+            $php.="\$__producers=array();\n?>";
+            return $php;
+        }
+        $php="<?php\n\n";
+        $php.="global \$__producers;\n\n";
+        $producers_serialized = serialize($this->producers);
+        $php .= "\$__producers=unserialize('$producers_serialized');";
+        /*
+        $php.="\$__producers=array(";
+        reset($this->producers);
+        
+        while (list($id,$data) = each ($this->producers)) {
+            if (sizeof($data)>0) {
+                $php.="\"$id\"=>array(";
+                while (list($idc,$cat_tab) = each($data)) {
+                    $producer_name=key($cat_tab);
+                    $producer_id=$cat_tab[$producer_name];
+                    $php.="array(\"$producer_name\"=>\"$producer_id\"),";
+                } // end while
+                $php=substr($php,0,strlen($php)-1);
+                $php.="),\n\t           ";
+            }
+        }  // end while
+        $php=substr($php,0,strlen($php)-(3+11));
+        
+        $php.=");\n";
+        */
+        $php.="\n";
+        $php.="?>\n";
+        /*
+        echo "<pre>";
+        print_r($this->producers);
+        echo "</pre>";
+        */
+        return $php;
+    } // end gen_php()
+    
+    
+    /**
+    * Zapisz wygenerowane listy producentow w pliku
+    *
+    * @param  string $body tresc zapisywanego pliku
+    */
+    function save($body) {
+        global $DOCUMENT_ROOT;
+        global $config,$ftp;
+        
+        // jezeli nie ma zadnych producentow - nic nie rob
+        if (empty($body)) 
+        {
+        	$body="<?php\n\n";
+            $body.="global \$__producers;\n\n";
+            $body.="\$__producers=array();\n?>";
+        }
+        // zapisz kod w tymczasowym pliku
+        if  ($fd=@fopen("$DOCUMENT_ROOT/tmp/producer.php","w+")) {
+            fwrite($fd,$body,strlen($body));
+            fclose($fd);
+        } else {
+            global $theme;
+            $theme->head_window();
+            die ("Forbidden tmp/producer.php");
+        }
+        
+        // wstaw dane w odpowiednie miejsce (przez ftp)
+        $ftp->put("$DOCUMENT_ROOT/tmp/producer.php",$config->ftp_dir."/config/tmp","producer.php");
+        
+        return;
+    } // end save()
+    
+} // end class ProducerCategory
+
+$pcat = new ProducerCategory;
+$pcat->parse($__category);
+$pcat->gen_category_tabs();
+
+// start sprawdz czy jest jakis producent: w bazie, jesli jest top generuj kod PHP, jesli nie ma to nic nie generuj
+$is_producer=false;
+$query="SELECT id_producer,producer FROM main WHERE producer!='' AND id_producer>0 AND active=1 LIMIT 1";
+$result=$db->Query($query);
+if ($result!=0) {
+    $num_rows=$db->NumberOfRows($result);
+    if ($num_rows>0) $is_producer=true;
+} else die ($db->Error());
+
+if ($is_producer==true) {
+    $body=$pcat->gen_php();
+}
+// end sprawdz czy jest jakis producent
+
+// generuj liste wszystkich producentow
+$all_p=$pcat->producer_list("SELECT id_producer,producer FROM main WHERE producer!='' AND id_producer>0 AND active=1 GROUP BY id_producer,producer ORDER BY producer");
+if (! empty($all_p)) {
+    $body.="\n\n<?php\n\n";
+    $body.="\$__all_producers=array(\n";
+    foreach ($all_p as $p) {
+        $producer=key($p);
+        $id_producer=$p[$producer];
+        $producer=addslashes($producer);
+        $body.="\t\t      \"$producer\"=>\"$id_producer\",\n";
+    }
+    $body=substr($body,0,strlen($body)-2);
+    $body.="\n\t\t      );\n?>";
+}
+$pcat->save(@$body);
+?>
diff -ruN ../soteesklep3/admin/go/_order/include/order_products.inc.php soteesklep3/admin/go/_order/include/order_products.inc.php
--- ../soteesklep3/admin/go/_order/include/order_products.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_order/include/order_products.inc.php	2006-08-23 16:58:49.000000000 +0200
@@ -0,0 +1,329 @@
+<?php
+/**
+* Odczytaj dane produktów w danym zamówieniu.
+*
+* @author  m@sote.pl
+* @version $Id: order_products.inc.php,v 2.13 2006/08/16 14:30:47 lukasz Exp $
+* @package    order
+*/
+
+/**
+* Odczytaj dane produktów w danym zamówieniu
+* @package order
+* @subpackage order
+*/
+class OrderProducts {
+    
+    /**
+    * @var array dane produktów.
+    * Tablica zwiera wyni zapytania $mdbd->select() w postaci tablicy, array(0=>array(), 1=>array(), ...).
+    */
+    var $data=array();
+    
+    /**
+    * @var float $total_amount_brutto warto¶æ zamówienia przypisanego dla danej transakcji.
+    * Warto¶æ mo¿e byæ ró¿na od kwoty zamówienia z³o¿onego przez klienta, gdy¿ sprzedawca mo¿e
+    * modyfikowaæ za³o¿one zamówienie.
+    */
+    var $total_amount_brutto=0;
+    
+    /**
+    * @var float $total_amount_netto warto¶æ zamówienia netto
+    */
+    var $total_amount_netto=0;
+    
+    /**
+    * @var int order_id zamówienia
+    */
+    var $order_id;
+    
+    /**
+    * Konstruktor
+    */
+    function OrderProducts($order_id) {
+        global $mdbd;
+        if (! empty($order_id)) {
+            $dat=$mdbd->select("id_promotions,promotions_name,promotions_discount","order_register","order_id=?",array($order_id=>"int"),"LIMIT 1");
+            $this->discount=$dat['promotions_discount'];
+            $this->order_id=$order_id;
+        }
+        return;
+    } // end OrderProducts()
+    
+    /**
+    * Odczytaj dane produktów dla danej trsnsakcji.
+    *
+    * @param int $order_id id transakcji
+    * @return none
+    
+    Array
+    (
+    [0] => Array
+    (
+    [id] => 1
+    [order_id] => 443
+    [user_id_main] => 12
+    [price_brutto] => 3900
+    [vat] => 0
+    [name] => Future 1724 Future Design
+    [num] => 1
+    [currency] => PLN
+    [measure] =>
+    [producer] =>
+    )
+    )
+    */
+    function getData() {
+        global $mdbd;
+        $order_id=$this->order_id;
+        $this->data=$mdbd->select("id,order_id,user_id_main,price_brutto,vat,name,num,currency,measure,producer,options",
+        "order_products","order_id=?",array($order_id=>"int"),'ORDER BY id',"ARRAY");
+        return;
+    } // end getData()
+    
+    /**
+    * Wy¶wietl produkty z danej transakcji.
+    *
+    * @param int $order_id order_id zamówienia
+    * @return string HTML
+    * @link tutorials/extended/order.pkg
+    */
+    function getProductsInfo() {
+        global $theme;
+        
+        $order_id=$this->order_id;
+        
+        if (empty($this->data)) $this->getData();
+        if (empty($this->data)) return;
+        
+        reset($this->data);
+        $o=$this->_showHead();
+        foreach ($this->data as $pos=>$product) {
+            $this->_calcProduct($product);
+            $o.=$this->_showRecord($product);
+        } // end foreach
+        $this->total_amount_netto=$theme->price($this->total_amount_netto);
+        $this->total_amount_brutto=$theme->price($this->total_amount_brutto);
+        $o.=$this->_showFoot();
+        return $o;
+    } // end getProductsInfo()
+    
+    /**
+    * Wy¶wietl formularz dodania produktu do zamówienia + przycisk aktualizacji ca³ego zamówienia.
+    * @return none
+    */
+    function addForm() {
+        global $lang;
+        include_once ("./html/product_add_form.html.php");
+        return;
+    } // end addForm()
+    
+    /**
+    * Dodaj dodatkowe pola do danych produktu (netto,sume)
+    *
+    * @param array &$product dane produktu
+    * @access private
+    * @return none
+    */
+    function _calcProduct(&$product) {
+        global $theme;
+        
+        $product['price_netto']=$theme->price($product['price_brutto']/( (100+$product['vat'])/100 ));
+        $product['sum_brutto']=$product['price_brutto']*$product['num'];
+        $product['sum_netto']=$theme->price($product['price_netto']*$product['num']);
+        $product['vat_value']=$theme->price($product['price_netto']*($product['vat']/100));
+        $this->total_amount_brutto=$this->total_amount_brutto+$product['sum_brutto'];
+        $this->total_amount_netto=$this->total_amount_netto+$product['sum_netto'];
+        return;
+    } // end _calcProduct()
+    
+    /**
+    * Nag³ówek listy produktów.
+    * Funkcja zwraca HTML <table><tr><th>...</th></tr>
+    *
+    * @return string HTML
+    * @access private
+    */
+    function _showHead() {
+        global $lang, $order_print;
+        if($order_print != true) { // zwyk³a prezentacja listy
+	        $o="<table border=\"1\" width=\"100%\">\n<tr>\n";
+        }
+	    else { // prezentacja listy do druku
+        	$o="<table border=\"1\" width=\"100%\" cellspacing=0 cellpadding=2>\n<tr>\n";
+	    }
+        $o.="<th>".$lang->order_products['user_id']."</th>";
+        $o.="<th>".$lang->order_products['name']."</th>";
+        // $o.="<th>".$lang->order_products['producer']."</th>";
+        $o.="<th>".$lang->order_products['options']."</th>";
+        $o.="<th>".$lang->order_products['price_netto']."</th>";
+        $o.="<th>".$lang->order_products['price_brutto']."</th>";
+        $o.="<th>".$lang->order_products['vat']."%</th>";
+        $o.="<th>".$lang->order_products['vat_value']."</th>";
+        $o.="<th>".$lang->order_products['num']."</th>";
+        $o.="<th>".$lang->order_products['sum_brutto']."</th>";
+        if($order_print != true) {
+        	$o.="<th><input type=\"submit\" value=\"$lang->delete\"></th>";
+        }
+        $o.="</tr>\n";
+        
+        return $o;
+    } // _showHead()
+    
+    
+    /**
+    * Rekord z informacjami o produkcie.
+    * Funkcja zwraca kod HTML <tr>...</tr>.
+    *
+    * @param array $product dane produktu
+    *
+    * @access private
+    * @return string HTML
+    */
+    function _showRecord($product) {
+    	global $order_print;
+        $o="<tr>\n";
+        $o.="  <td align=\"right\">".$product['user_id_main']."</td>\n";
+        $o.="  <td align=\"center\">".$product['name']."</td>\n";
+        // $o.="  <td align=\"right\">".$product['producer']."</td>\n";
+        $o.="  <td align=\"right\">".$product['options']."</td>\n";
+        $o.="  <td align=\"right\">".$product['price_netto']."</td>\n";
+        $o.="  <td align=\"right\">".$product['price_brutto']."</td>\n";
+        $o.="  <td align=\"center\">".$product['vat']."</td>\n";
+        $o.="  <td align=\"right\">".$product['vat_value']."</td>\n";
+        $o.="  <td align=\"center\">".$product['num']."</td>\n";
+        $o.="  <td align=\"right\">".$product['sum_brutto']."</td>\n";
+        if($order_print != true) {
+	        $o.="  <td align=\"center\"><input type=\"checkbox\" name=products_del[".$product['id']."] value=1></td>\n";
+        }
+        $o."</tr>\n";
+        
+        return $o;
+    } // end _showRecord()
+    
+    /**
+    * Stopka listy produktów.
+    * Funkcja zamyka tabele HTML listy produktów oraz zawiera podsumowanie kwoty netto i brutto zamówienia.
+    *
+    * @access private
+    * @return string HTML
+    */
+    function _showFoot() {
+        global $lang,$config;
+        
+        $o="</table>\n";
+        $o.="<div align=\"right\">";
+        $o.="$lang->order_total_amount_netto ".$this->total_amount_netto." $config->currency<BR>";
+        $o.="$lang->order_total_amount_brutto <b>".$this->total_amount_brutto."</b> $config->currency<BR>";
+        $this->totalAmount();
+        $o.="</div>\n";
+        return $o;
+    } // _showFoot()
+    
+    /**
+    * Dodaj produkt do zamówienia
+    *
+    * @param array $product  dane dodawanego produktu
+    * @return none
+    */
+    function add($product) {
+        global $mdbd;
+        
+        $order_id=$this->order_id;
+        
+        // jesli wybrano produkt z listy rozwijanej, to przekaz user_id przypisane do wybranego produktu
+        if (! empty($product['user_id_auto'])) {
+            $product['user_id']=$product['user_id_auto'];
+        }
+        
+        // jesli nie podano nazwy, odczytaj dane produktu z bazy danych
+        if ((empty($product['name'])) && (! empty($product['user_id']))) {
+             
+            $db_product=$mdbd->select("user_id,name_L0,price_brutto,vat,xml_options","main","user_id=?",
+            array($product['user_id']=>"text"),"LIMIT 1");
+            
+            if (empty($db_product)) return;
+            // elementy, ktore sa przekazywane z formularza nie z bazy
+            if (! empty($product['num'])) $db_product['num']=$product['num'];
+            if (! empty($product['options'])) $db_product['options']=$product['options'];
+            
+            // oblicz cene produktu wg rodzaju
+            $db_product['price_brutto']=$db_product['price_brutto'];
+            $product=$db_product;
+
+        }
+        else 
+        {
+        	$product['name_L0'] = $product['name'];
+        }
+        
+        if (empty($product['num'])) $product['num']=1;
+        if (empty($product['options'])) $product['options']='';
+
+        $mdbd->insert("order_products","user_id_main,name,price_brutto,vat,options,num,order_id","?,?,?,?,?,?,?",
+        array(
+        "1,".$product['user_id']=>"text",
+        "2,".$product['name_L0']=>"text",
+        "3,".$product['price_brutto']=>"text",
+        "4,".$product['vat']=>"text",
+        "5,".$product['options']=>"text",
+        "6,".$product['num']=>"text",
+        "7,".$order_id=>"int",
+        ));
+        
+        return;
+    } // end add()
+    
+    /**
+    * Usuñ zaznaczone produkty z zamówienia (o podnym id).
+    * Zaznaczone produkty s± usuwane z tabeli order_products.
+    *
+    * @param array $del tablica z id rekordów do usuniêcia
+    * @return none
+    */
+    function delete($del) {
+        global $mdbd;
+        
+        if (empty($del)) return;
+        reset($del);
+        foreach ($del as $id=>$val) {
+            if ($val==1) {
+                $mdbd->delete("order_products","id=?",array($id=>"int"));
+            }
+        } // end foreach
+        $this->totalAmount();
+        return;
+    } // end delete()
+    
+    /**
+    * Odczytaj warto¶æ zamówienia dla danej transakcji i zapisz warto¶æ w order_register.
+    * Zwracana warto¶c zmówienia uwzglêdnia zmiany wprowadzone do zamówienia. Np. dodanie pozycji do koszyka itp.
+    *
+    * @return float warto¶c zamówienia brutto
+    */
+    function totalAmount() {
+        global $db,$mdbd,$rec;
+        
+        $order_id=$this->order_id;
+        
+        $query="SELECT SUM(price_brutto*num) AS total_amount FROM order_products WHERE order_id=?";
+        $prepared_query=$db->PrepareQuery($query);
+        if ($prepared_query) {
+            $db->QuerySetInteger($prepared_query,1,$order_id);
+            $result=$db->ExecuteQuery($prepared_query);
+            if ($result!=0) {
+                $total_amount=$db->FetchResult($result,0,"total_amount");
+                $total_amount=$total_amount*((100-$this->discount)/100);
+                $rec->data['total_amount']=$total_amount;
+                $mdbd->update("order_register","total_amount=?","order_id=?",
+                array("1,".$total_amount=>"text",
+                "2,".$order_id=>"int"));
+                return $total_amount;
+            }
+        } else die ($db->Error());
+        
+        return 0;
+    } // end totalAmount()
+    
+} // end class OrderProducts
+?>
diff -ruN ../soteesklep3/admin/go/_upgrade/check_new_upgrade.php soteesklep3/admin/go/_upgrade/check_new_upgrade.php
--- ../soteesklep3/admin/go/_upgrade/check_new_upgrade.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_upgrade/check_new_upgrade.php	2006-08-23 16:58:50.000000000 +0200
@@ -0,0 +1,109 @@
+<?php
+/**
+* Sprawd¼, czy s± nowe aktualizacje do programu.
+*
+* @author  m@sote.pl
+* @version $Id: check_new_upgrade.php,v 1.13 2006/08/16 10:21:21 lukasz Exp $
+* @package    upgrade
+*/
+
+// naglowek php
+$global_database=true;$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+require_once ("../../../include/head.inc");
+// end naglowek php
+
+// naglowek
+$theme->head();
+$theme->page_open_head();
+
+include_once ("./include/menu2.inc.php");
+$theme->bar($lang->upgrade_check_new_version_title);
+
+$file_version="$DOCUMENT_ROOT/../VERSION";
+$fd=fopen($file_version,"r");
+$my_version=trim(fread($fd,filesize($file_version)));
+fclose($fd);
+
+$my_upgrades=$mdbd->select("version","`upgrade`",1,array(),"ORDER BY id DESC","ARRAY");
+$upgrades_installed=array();   // lista zainstalowanych  w sklepie upgradeow (liczby calkowite)
+if (! empty($my_upgrades)) {
+    foreach ($my_upgrades as $myu) {
+        if (! empty($myu['version'])) $upgrades_installed[]=$myu['version'];
+    }
+}
+
+// pobierz dostêpne aktualizacje dla wskazanej wersji
+require_once ("HTTP/Client.php");
+$http =& new HTTP_Client();
+$http->get("http://www.sote.pl/plugins/_bugs/check_new_upgrade_35.php?version=$my_version&lang=$config->lang");
+$data_serial=$http->_responses[0]['body'];
+$data=@unserialize(trim(@$data_serial));
+
+// poka¿ jakie komunikaty zwraca skrypt po stronie repozytorium ttp://www.sote.pl/plugins/_bugs/check_new_upgrade_31.php
+// print "<pre>";print_r($data_serial);print "</pre>";
+
+if (! empty($data)) {
+
+    // odczytaj maksylmalne numery pakietow aktualizacyujnych dla poszczegolnych grup gid
+    $gidb=array();          // baza maksymalnych numerow pakietow dla danej grupy gid=>nr
+    $id_gidb=array();       // przypisanie gid do id pakietu id=>gid
+    $id_name=array();       // przypisanie gid do id pakietu id=>name
+    $id_short_desc=array(); // przypisanie gid do id pakietu id=>short_desc
+    $upgrades2install=array();
+    foreach ($data as $upgr) {
+        if ((empty($gidb[$upgr['gid']])) || ($upgr['id']>$gidb[$upgr['gid']]))  {
+            $gidb[$upgr['gid']]=$upgr['id'];
+        }
+        $id_gidb[$upgr['id']]=$upgr['gid'];
+        $id_name[$upgr['id']]=$upgr['name'];
+        $id_short_desc[$upgr['id']]=$upgr['short_desc'];
+        if (@$upgr['id']>@$upgrades2install[$upgr['gid']]) {
+            // znaleziono nowsz± aktualizacjê
+            $upgrades2install[$upgr['gid']]=$upgr['id'];
+        }
+    }
+
+    print "<p />\n";
+
+    // odczytaj gid dla kazdego zainstalowanego pakietu i zapamietaj w relacji gid=>id
+    // oznaczajacej zainstalowane pakiety dla danego gid
+    reset($upgrades_installed);$installed_gid=array();
+    foreach ($upgrades_installed as $id_installed) {
+        if (! empty($id_gidb[$id_installed])) {
+            // jesli w systemie jest zainstalowanych kilka aktualizacji dla tego samego gid
+            // zapamietaj najwyzszy numer
+            if ($id_installed>@$installed_gid[$id_gidb[$id_installed]]) {
+                $installed_gid[$id_gidb[$id_installed]]=$id_installed;
+            }
+        }
+    }
+
+    // sprawdz czy numery pakietow aktualizacyjnych dla danej grupy sa > od zainstalowanych
+    // jesli tak, to wyswietl info o pakiecie do zainstalowania; pokaz pakiety nie zainstalowane
+    reset($upgrades2install);$_info=false;
+    foreach ($upgrades2install as $gid=>$id) {
+        if ($id>@$installed_gid[$gid]) {
+            // znaleziono nowsz± aktualizacje dla danej grupy pakietów aktualizacyjnych (maj±cych ten sam numer gid)
+            if (! $_info) {
+                print $lang->upgrade_to_install.":<p />\n";
+                $_info=true;
+            }
+            print "<li>";
+            print "<b>".$id_name[$id]."</b> ".$id_short_desc[$id];
+            print "</li>\n";
+        }
+    } // end foreach
+}
+
+if (! @$_info) {
+    print ereg_replace("{VERSION}",$my_version,$lang->upgrade_new_not_found);
+}
+
+print "<p />\n";
+
+$theme->page_open_foot();
+// stopka
+$theme->foot();
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/admin/go/_upgrade/include/gid_2.inc.php soteesklep3/admin/go/_upgrade/include/gid_2.inc.php
--- ../soteesklep3/admin/go/_upgrade/include/gid_2.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_upgrade/include/gid_2.inc.php	2006-08-23 16:58:50.000000000 +0200
@@ -0,0 +1,99 @@
+<?php
+/**
+* Skrypt wywolywany po zaladowniu pakietu z gid=2
+* Uaktualnienie sum kontrolnych wg listy aktualnych pakietów.
+*
+* @author  m@sote.pl
+* @version $Id: gid_2.inc.php,v 1.10 2006/08/16 10:21:22 lukasz Exp $
+* @package    upgrade
+*/
+
+if (file_exists("$DOCUMENT_ROOT/upgrade/upgrade_eru1_30006.pkg")) {
+    // zainstalowano poakiet 0006
+    $s9=$mdbd->select("version","`upgrade`","version=6",array(),"LIMIT 1");
+    if ($s9!=6) {
+        $mdbd->insert("`upgrade`","version,date_add,filename","?,?,?",array(
+        "6"=>"int",
+        date("Y-m-d")=>"text",
+        "upgrade_eru1_30006.pkg"=>"text")
+        );
+        
+    } // end if ($s9!=6)
+    
+} // end file_exists ... 0006.pkg
+
+if (file_exists("$DOCUMENT_ROOT/upgrade/upgrade_hue8_30009.pkg")) {
+    // zainstalowano pakiet 0009
+    $s9=$mdbd->select("version","`upgrade`","version=9",array(),"LIMIT 1");
+    if ($s9!=9) {
+        $mdbd->insert("`upgrade`","version,date_add,filename","?,?,?",array(
+        "9"=>"int",
+        date("Y-m-d")=>"text",
+        "upgrade_hue8_30009.pkg"=>"text")
+        );
+    }
+}
+
+/**
+* Start FC 15
+*
+* Uaktualnienie sum kontrolnych ponizszych plików
+* W kolejnych modyfikacjach nalezy usun±c poni¿szy kod, gdy¿ po uaktualnieniu
+* sum kontrolnych plikow z 0006 nie jest ju¿ on potrzebny
+*/
+if ((file_exists("$DOCUMENT_ROOT/upgrade/install_15.inf"))  && (! file_exists(".0015"))) {
+
+    /**
+    * Dodaj obs³ugê FTP
+    */  
+    require_once ("include/ftp.inc.php");
+    
+    // generuj lista plikow z sumami kontrolnymi (do uaktualnienia)
+    $files=array();$sums=array();
+    $fmd5="$DOCUMENT_ROOT/go/_upgrade/config/current.md5";
+    $fd=fopen($fmd5,"r");
+    $data=fread($fd,filesize($fmd5));
+    fclose($fd);
+        
+    
+    $lines=split("\n",$data,100000);
+    reset($lines);
+    foreach ($lines as $line) {        
+        $tab=split(" ",$line);        
+        if (! empty($tab[1])) {
+            $files[$tab[0]]=$tab[1];            
+        }
+    }
+    
+    
+    // oblicz sume kontrolna dla kazdego z w/w plikow
+    require_once ("include/file_checksum.inc.php");
+    reset($files);
+    foreach ($files as $sum2=>$file) {        
+        $file_path=preg_replace("/^./","$DOCUMENT_ROOT/..",$file);        
+        
+        $fc =& new FileChecksum($file_path,FILE_CHECKSUM_FILE);
+        $sum1=$fc->getChecksum();                
+        
+        if ($sum1==$sum2) {
+            $fc->set($file,$sum2);       
+        }        
+        
+    } // end foreach
+    
+    // zapisz nowy plik sum kontrolnych
+    FileChecksum::saveDat();
+    
+    
+    $fd=fopen("$DOCUMENT_ROOT/tmp/.0015","w+");
+    fwrite($fd,"Done",4);
+    fclose($fd);
+    
+    $ftp->connect();
+    $ftp->put("$DOCUMENT_ROOT/tmp/.0015",$config->ftp['ftp_dir']."/admin/go/_upgrade",".0015");
+    $ftp->close();
+}
+/**
+* End FC 15
+*/
+?>
diff -ruN ../soteesklep3/admin/go/_upgrade/include/upgrade.inc.php soteesklep3/admin/go/_upgrade/include/upgrade.inc.php
--- ../soteesklep3/admin/go/_upgrade/include/upgrade.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_upgrade/include/upgrade.inc.php	2006-08-23 16:58:51.000000000 +0200
@@ -0,0 +1,942 @@
+<?php
+/**
+* Obs³uga plików aktualizacji.
+* Odczytanie plików do aktualizacji, weryfikacja, aktualizacja.
+*
+* @author  m@sote.pl
+* @version $Id: upgrade.inc.php,v 1.39 2006/08/16 10:21:22 lukasz Exp $
+* @package    upgrade
+*/
+
+/**
+* Dodaj obs³ugê FTP
+*/
+require_once ("include/ftp.inc.php");
+
+/**
+* Dodaj obs³ugê plików CVS
+*/
+require_once ("include/cvs.inc.php");
+
+/**
+* Dodaj obs³ugê generowania sum kontrolnych plików
+*/
+require_once ("include/file_checksum.inc.php");
+
+/**
+* Odczytaj konfiguracje patch'y
+*/
+require_once ("config/auto_config/patch_config.inc.php");
+
+/**
+* Oczytaj zarz±dzanie licencj±
+*/
+require_once ("include/license.inc.php");
+
+/**
+* Maksymalna ilo¶æ zagnie¿dzeñ katalogów przy zak³adaniu nowych ¶cie¿ek.
+* Ilo¶æ katalogów przegl±danych "w górê" w celu znalezienia odpowiedniej ¶cie¿ki, w której
+* mo¿na zak³adaæ wsakzane katalogi.
+*/
+define ("MKDIR_MAX_COUNT",8);
+
+/**
+* Okre¶lenie do jakiej bazy sum kontrolnych jest zapisywana suma kontrolna. UPGRADE_FILE_SUM -> sum.md5
+*/
+define ("UPGRADE_FILE_SUM",1);
+
+/**
+* Okre¶lenie do jakiej bazy sum kontrolnych jest zapisywana suma kontrolna. UPGRADE_FILE_MOD -> mod.md5
+*/
+define ("UPGRADE_FILE_MOD",2);
+
+/**
+* Okre¶lenie czy dokonujemy symulacji instalacji pakietu.
+*/
+define ("UPGRADE_SIMULATION",true);
+
+/**
+* Okre¶lenie poprawnej aktualizacji pliku.
+*/
+define ("UPGRADE_RESULT_OK",0);
+
+/**
+* Okre¶lenie pliku z modyfikacj± klienta.
+*/
+define ("UPGRADE_RESULT_MOD",-1);
+
+/**
+* B³±d podczas instalacji pliku.
+*/
+define ("UPGRADE_RESULT_ERROR",-2);
+
+/**
+* Tryb autonmatycznej instalacji plików.
+*/
+define ("UPGRADE_INSTALL_AUTO_MODE",1);
+
+/**
+* Zapamiêtaj aktualizowany plik w bazie, nie instaluj go.
+*/
+define ("UPGRADE_SAVE_MOD",1);
+
+/**
+* Obs³uga plików "Diff"
+* @package upgrade
+*/
+class Diff {
+
+    /**
+    * @var array wiersze z aktualizacji
+    * @access private
+    */
+    var $_file_lines=array();
+
+    /**
+    * @var array lista plików do aktualizacji
+    */
+    var $_files=array();
+
+    /**
+    * @var int licznik za³o¿onych katalogów, przy tworznieu odpowiedniej ¶cie¿ki do pliku (zobacz MKDIR_MAX_COUNT)
+    */
+    var $_mkdirCount=0;
+
+    /**
+    * @var bool true - symulacja instalacji    
+    * @access private
+    */
+    var $_simulation=false;
+
+    /**
+    * @var int status aktualizacji 0 - ok, 1 - modyfikacja
+    */
+    var $upgrade_status=0;
+
+    /**
+    * @var string zawarto¶c ostatnio aktualizowanego pliku
+    */
+    var $_source='';
+
+    /**
+    * @var string opcjonalny kod aktywacyjny do pakietu zdefiniowany w pliku 000-upgrade_config.php w sta³ej PATCH_CODE
+    * @access private
+    */
+    var $_patch_code='';
+
+    /**
+    * Konstruktor
+    *
+    * @param string $file plik z aktualizacj±
+    * @return bool true plik poprawnie za³±czony, false w p.w.
+    */
+    function Diff($file) {
+        if (file_exists($file)) {
+            $fd=fopen($file,"r");
+            $data=fread($fd,filesize($file));
+            fclose($fd);
+            $this->_file_lines=split("\n",$data);
+            return true;
+        }
+        return false;
+    } // end Diff()
+
+    /**
+    * Odczytaj listê plików do aktualizacji
+    * @return array
+    */
+    function _getFiles() {
+        $files=array();
+        reset($this->_file_lines);
+        foreach ($this->_file_lines as $_line) {
+            if (ereg("^diff -ruN",$_line)) {
+                $tab=split(" ",$_line,4);
+                if (! empty($tab[3])) $files[]=$tab[3];
+            }
+        } // end foreach
+        $this->_files=$files;
+        return $files;
+    } // end _getFiles()
+
+    /**
+    * Odczytaj zawarto¶c wskazanego pliku z pakietu aktualizcyjnego.
+    *
+    * @param string nazwa pliku + ¶cie¿ka w wzglêdem $DOCUMENT_ROOT/../
+    * @return string zawarto¶c pliku
+    */
+    function getFile($file) {
+        if (empty($this->_file_lines)) return;
+        reset($this->_file_lines);$file_source='';$_read=false;$_start=false;
+        foreach ($this->_file_lines as $_line) {
+            if (ereg(" ".$file."$",$_line)) $_read=true;
+            if ((! (ereg(" ".$file."$",$_line))) && ((ereg("^diff "."-ruN ",$_line)))) { $_read=false; $_start=false; }
+            if (ereg("\ No newline "."at end of file",$_line)) { $_read=false; $_start=false; }
+            if (($_read) && ($_start)) {
+                $line=preg_replace("/^\+/","",$_line); // usuñ znak +, kótry dodaje diff na pocz±tku ka¿dej linii
+                $file_source.=$line."\n";
+            }
+            if (($_read) && (! $_start)) {
+                if (ereg("^@@ ",$_line)) $_start=true;
+            }
+        } // end foreach()
+        return $file_source;
+    } // getFile()
+
+} // end class Diff
+
+/**
+* Klasa aktualizacja sklepu na bazie plików "diff".
+* @package upgrade
+*/
+class DiffUpgrade extends Diff {
+
+    /**
+    * @var int numer wersji upgrade'u, dla ka¿dego upgradu numer powinien byæ nowy numer CVS
+    */
+    var $_version=-1;
+
+    /**
+    * @var string zmienna zawieraj±ca plik zawieraj±cy pakiet upgrade'u (nazwa pliku z uaktualneiniem)
+    * @access public
+    */
+    var $upgradeFile='';
+
+    /**
+    * Lista podkatalogów z g³ównego katalogu sklepu, dla których zmieniana jest lokalizacja docelowa
+    * Dot. instalacji na home.pl
+    */
+    var $_base_dirs=array("config","include","lib","bin");
+
+    /**
+    * Kondtruktor
+    * @see Diff::Diff()
+    */
+    function DiffUpgrade($file) {
+        $this->upgradeFile=$file;
+        preg_match("/([0-9][0-9][0-9])\./",basename($file),$matches);
+        if (! empty($matches[1])) $this->_version=intval($matches[1]);
+        else $this->version=date("YmdHi");
+        return $this->Diff($file);
+    } // end DiffUpgrade()
+
+    /**
+    * Wy¶wietl liste plików do aktualizacji
+    * @return none
+    */
+    function showListFiles() {
+        if  (empty($this->_files)) $this->_getFiles();
+        reset($this->_files);
+        print "<ul>\n";
+        foreach ($this->_files as $_file) {
+            $file_url=urlencode($_file);
+            print "<li>$_file</li>\n";
+        } // end foreach
+        print "</ul>\n";
+        return;
+    } // end showListFiles()
+
+    /**
+    * Wykonaj upgrade
+    *
+    * @param bool $simulation true - emulacja trybu instalacji pakietu, bez jego instalacji, false - instalacja pakietu
+    *
+    * @return int  1 upgrade wykonany poprawnie,  (-1) - bledny pakiet  
+    */
+    function doUpgrade($simulation=false) {
+        global $ftp,$DOCUMENT_ROOT;
+        global $lang,$shop,$config;
+
+        $this->_simulation=$simulation;
+
+        $this->_getFiles();
+        if  (empty($this->_files)) $this->_getFiles();
+        $ftp->connect();
+        //print "<table cellspacing=1 cellpadding=0 border=0>\n";
+        $result=array();
+        foreach ($this->_files as $_file) {
+            // print "<tr>\n";
+            // spawdz, czy plik mozna zaktualizowac
+            $result_upgrade_test=$this->_upgradeTestFile($_file);
+
+            if (! ereg("000-upgrade_config.php",$_file)) {
+                // pomiñ plik konfiguracji aktualnie instalowanego pakietu
+                $result[$_file]['result']=$result_upgrade_test;
+            }
+
+            if (($result_upgrade_test>0) && ($result_upgrade_test!=2)) {
+                $this->upgrade_status=1;
+            }
+            if ($result_upgrade_test==0) {
+                // instaluj plik je¶li nie zosta³ wywo³any tryb symulacji lub je¶li jest odczytywany plik konfiguracyjny
+                if ((! $this->_simulation) || (ereg("000-upgrade_config.php",$_file))) {
+                    if (! $this->upgradeFile($_file)) {
+                        $result['files'][$_file]=UPGRADE_RESULT_ERROR;
+                    } else {
+                        // start home.pl 2005-08-17 m@sote.pl
+                        // instaluj plik konfiguracyjny do g³ównego katalogu i do admin (dla home.pl)
+                        // gdy¿ na home.pl plik z g³ównego katalogu nie jest dostêpny i jego
+                        // kopia musi znajdowaæ siê w podkatalogu "admin"
+                        if ((ereg("000-upgrade_config.php",$_file)) && ($shop->home)) {
+                            if ($fd=fopen("/tmp/000-upgrade_config.php","w+")) {
+                                fwrite($fd,$this->_source,strlen($this->_source));
+                                fclose($fd);
+                                $ftp->put("/tmp/000-upgrade_config.php",$config->ftp['ftp_dir']."/admin","000-upgrade_config.php");
+                            } else {
+                                die ("Error: Unable to install file /tmp/000-upgrade_config.php");
+                            }
+                        }
+                        // end home.pl
+
+                    }
+
+                    if (ereg("000-upgrade_config.php",$_file)) {
+                        // odczytaj numer wersji aktualnie instalowanego pakietu
+                        include_once ("000-upgrade_config.php");
+                        if (! defined("PATCH_VERSION")) {
+                            $this->upgrade_status=1;
+                        } else {
+                            $this->_version=PATCH_VERSION;
+                        }
+
+                        // kod aktywacyjny zwi±zany z pakietem aktualizacyjnym
+                        if (defined("PATCH_CODE")) {
+                            $this->_patch_code=PATCH_CODE;
+                        }
+
+                    }
+                }
+
+                // sprawd¼ wersjê instalowanego pakietu,
+                if (! $this->checkVersion()) {
+                    return (-1);
+                }
+
+                // } elseif ($result_upgrade_test==-1) {
+                //  if (! $this->upgradeFile($_file,'',UPGRADE_FILE_MOD)) {
+                //      $result['files'][$_file]=UPGRADE_RESULT_ERROR;
+                //  }
+            } else {
+                //print "</td>\n";
+                //print "<td>\n";
+                //print " <font color=\"$color\">".$lang->upgrade_file_status_simulation[$result_upgrade_test]."</font>";
+                //print "</td>\n";
+                global $shop;
+                if (($result_upgrade_test!=2) && ($this->_simulation) && !@$shop->home) {
+                    //print "<td>\n";
+                    // poka¿ formularze do wykrycia modyfikacji pliku i "wyleczenia/pogodzenia" zmian
+                    //print "      <form action=repair.php method=POST target=window>\n";
+                    //print "      <input type=hidden name=file[name] value='".$_file."'>\n";
+                    $result[$_file]['form']['name']=$_file;
+                    $result[$_file]['form']['upgrade_file']=$this->upgradeFile;
+                    //print "      <input type=hidden name=file[upgrade_file] value='".$this->upgradeFile."'>\n";
+                    //print "      <input type=hidden name=file[path] value='".$this->_files['path']."'>\n";
+                    $result[$_file]['form']['path']=$this->_files['path'];
+                    //print "      <input type=hidden name=file[upgrade] value='".$this->_files['upgrade']."'>\n";
+                    $result[$_file]['form']['upgrade']=$this->_files['upgrade'];
+                    //print "      <input type=submit value='$lang->upgrade_file_repair' onclick='window.open(\"\", \"window\", \"width=800, height=600, status=no, toolbar=no, scrollbars=yes, resize=1\")'>\n";
+                    //print "      </form>\n";
+                    //print "</td>\n";
+                } else {
+                    // instalacja plików z bufora, lub nadpisanie plików z dysku plikami z pakietu
+                    // sprawd¼, czy aktualizowany plik jest w buforze, je¶li tak to odczytaj jego zawarto¶æ i zainstaluj
+                    // je¶li nie, instaluj pliki z pakietu
+                    $upgrade_file_source=$this->getFileFromDB($_file);
+                    if ($upgrade_file_source) {
+                        // plik jest w buforze
+                        $this->upgradeFile($_file,$upgrade_file_source,UPGRADE_FILE_MOD);
+                        $result[$_file]['result']=4;
+                    } else {
+                        // nie ma plku w buforze, we¼ plik z pakietu akualizacyjnego
+                        $this->upgradeFile($_file);
+                        $result[$_file]['result']=0;
+                    }
+                }
+                //print "</tr>\n";
+            }
+        } // end foreach()
+        //print "</table>\n";
+
+        // zapamiêtaj wynik testu/aktualizacji
+        $this->_result=$result;
+        //print "<pre>";print_r($result);print "</pre>";
+
+
+        if (empty($result)) {
+            print "<font color=\"red\">$lang->upgrade_error_ext</font>\n";
+            $this->upgrade_status=2;
+        }
+
+        global $__database_md5;
+
+        // zapisz now± bazê sum kontrolnych
+        if (! $this->_simulation) {
+            if (FileChecksum::saveDat()) {
+                print "<p>$lang->upgrade_checksums_upgraded <p>";
+            } else {
+                print "<p><font color=\"red\">$lang->upgrade_checksums_upgrade_error</font><p>\n";
+            }
+        }
+        $ftp->close();
+
+        return (1);
+    } // end doUpgrade()
+
+    // {{{ showUpgradeInfo()
+
+    /**
+    * Wyswietl raport dot. aktualizacji.
+    *
+    * @param int $upgrade_mode 0 - defualt, UPGRADE_INSTALL_AUTO_MODE - nie pokazuj linku do naprawy plików
+    *
+    * @return  bool
+    */
+    function showUpgradeInfo($upgrade_mode=0) {
+        global $theme;
+        if (empty($this->_result)) return false;
+        if ((empty($this->_version)) && ($this->_version!=0)) return false;
+
+        $ret=true;
+        print "<table cellspacing=\"0\" cellpadding=\"1\">\n";
+        foreach ($this->_result as $file=>$val) {
+            print "<tr>";
+            print "<td>";
+            $status=$val['result'];
+            switch ($status) {
+                case 0: $theme->point("g");break; // 0 - mo¿na aktualizowaæ plik
+                case 1: $theme->point("r");break; // 1 - plik zmieniony, wykryto modyfikacjê
+                case 2: $theme->point("b");break; // 2 - nowsza wersja pliku
+                case 3: $theme->point("o");break; // 3 - indywidualna modyfikacja
+                case 4: $theme->point("rg");break; // 4 - indywidualna modyfikacja, zatwierdzona w poprzedniej aktualizacji
+                default: $theme->point("black");break;
+            }
+            print "</td>";
+            print "<td>$file</td>";
+            if (($status==1) || ($status==3) | ($status==4)) {
+                if (empty($upgrade_mode)) {
+                    $ret=false;
+                    print "<td>";$this->_repairForm($file);print "</td>\n";
+                }
+            }
+            print "</tr>\n";
+        } // end foreach;
+        print "</table>\n";
+
+        return $ret;
+    } // end showUpgradeInfo()
+
+    // {{{ repairForm()
+
+    /**
+    * Wy¶wietl formularz przekierowuj±cy u¿ytkownika na stronê ³±czenia modyfikacji plików z pakietu i z dysku
+    *
+    * @param string $file nazwa pliku np. soteesklep3/admin/index.php
+    * @return void
+    */
+    function _repairForm($_file) {
+        $result=$this->_result;
+
+        print "<form action=repair.php method=POST target=window>\n";
+        print "      <input type=hidden name=file[name] value='".$_file."'>\n";
+        print "      <input type=hidden name=file[patch_version] value='".$this->_version."'>\n";
+        print "      <input type=hidden name=file[upgrade_file] value='".$result[$_file]['form']['upgrade_file']."'>\n";
+        print "      <input type=hidden name=file[path] value='".$result[$_file]['form']['path']."'>\n";
+        print "      <input type=hidden name=file[upgrade] value='".$result[$_file]['form']['upgrade']."'>\n";
+        print "<input type=image  src=/themes/base/base_theme/_img/repair.png border=0 width=10 height=10 onclick='window.open(\"\", \"window\", \"width=800, height=600, status=no, toolbar=no, scrollbars=yes, resize=1\")'>";
+        print "      </form>\n";
+
+
+        return;
+    } // end _repairForm()
+
+    // }}}
+
+    // }}}
+
+    // {{{ legend()
+
+    /**
+    * Wy¶wietl legendê statusów aktualizacji.
+    */
+    function legend() {
+        global $theme,$lang;
+
+        print "<br />$lang->upgrade_legend_title:<br \>";
+        print "<table cellspacing=\"1\" cellpadding=\"1\">\n";
+        print "<tr><td>";$theme->point("g");print "</td><td>".$lang->upgrade_legend[0]."</td></tr>\n";
+        print "<tr><td>";$theme->point("b");print "</td><td>".$lang->upgrade_legend[2]."</td></tr>\n";
+        print "<tr><td>";$theme->point("r");print "</td><td>".$lang->upgrade_legend[1]."</td></tr>\n";
+        print "<tr><td>";$theme->point("o");print "</td><td>".$lang->upgrade_legend[3]."</td></tr>\n";
+        print "<tr><td>";$theme->point("rg");print "</td><td>".$lang->upgrade_legend[4]."</td></tr>\n";
+        print "<tr><td><img src=/themes/base/base_theme/_img/repair.png width=10 height=10></td><td>".$lang->upgrade_legend['repair']."</td></tr>\n";
+        print "</table>\n";
+        return;
+    } // end legend()
+
+    // }}} legend()
+
+    // {{{ checkVersion()
+
+    /**
+    * Sprawd¼ wersjê instalowanego pakietu.
+    * Sprawd¼ czy wersja istnieje oraz czy mo¿na dany pakiet zainstalowaæ. Pakiety, które mo¿na zainstalowaæ
+    * musz± byæ kolejnymi numerami PATCH_LAST lub powinny mieæ warto¶æ 0 - dla indywidualnych pakietów.
+    * 
+    * @return bool true - mo¿na instalowaæ dan± wersjê, false w p.w.
+    */
+    function checkVersion() {
+        global $mdbd,$lang,$__devel;
+        global $config,$_REQUEST;
+
+        // dla wersji o numerze 0 zwracja true, po weryfikacji kodu
+        if ($this->_version==0) {
+            // sprawd¼ czy kod aktualizacji jest poprawny
+            if ($this->_simulation) {
+                $lic =& new License();
+                $code=$lic->checkCode($this->_patch_code);
+                if ($_REQUEST['upgrade_code']==$code) {
+                    return true;
+                } else {
+                    print "<font color=\"red\">".$lang->upgrade_code_error."</font>";
+                    return false;
+                }
+            }
+            return true;
+        }
+
+        // sprawd¼ czy dany pakiet jest ju¿ zainstalowany
+        $exists=$mdbd->select("id","`upgrade`","version=?",array($this->_version=>"text"),"LIMIT 1");
+        // nie zezwalaj na powtórne ³adowanie pakietu, chyba ¿e sklep dzia³a w trybie devel
+        if (($exists>0) && (! $__devel)) {
+            $this->upgrade_status=1;
+            print  "<font color=\"red\">$lang->upgrade_already_installed</font>\n";
+            return false;
+        } elseif (($__devel) && ($exists>0)) {
+            // je¶li pakiet ju¿ by³ zainstalowany i panel dzia³a w trybie "devel" to zezwalaj na jego ponown± instalacjê
+            return true;
+        }
+
+        // odczytaj ostatnio zainstalowany pakiet
+        
+        // 
+        // $max_current_version=$mdbd->select("version","upgrade","1",array(),"ORDER BY version DESC LIMIT 1");        
+        $max_current_version=$mdbd->select("version","`upgrade`","1",array(),"ORDER BY id DESC LIMIT 1");
+
+        if (empty($max_current_version)) $max_current_version=$config->pkg_first_number-1;
+        if ($this->_version!=$max_current_version+1) {
+            // sprawd¼ sytuacjê: czy czasem nie ma ¿adnych wpisów w bazie, je¶li tak jest
+            // to sprawd¼ w config'u jaki pakiet powinien byæ instalowany jako pierwszy
+            // @todo
+            $any=$mdbd->select("id","`upgrade`",1,array(),"LIMIT 1");
+            if (! $any) {
+                // nie ma ¿adnych rekordów w upgrade
+                if ($this->_version==$config->pkg_first_number) {
+                    return true;
+                } else {
+                    $this->upgrade_status=1;
+                    print  "<font color=\"red\">$lang->upgrade_wrong_pkg_number</font>\n";
+                    return false;
+                }
+            }
+
+            $this->upgrade_status=1;
+            print  "<font color=\"red\">$lang->upgrade_wrong_pkg_number</font>\n";
+            return false;
+        }
+        // sprawd¼ czy instalowany pakiet mo¿e byæ instalowany tj. jest o 1 wiêkszy od max_current_version
+
+        if ($this->_version==-1) {
+            print ("<font color=\"red\">$lang->upgrade_wrong_format</font>\n");
+            return false;
+        }
+        return true;
+    } // end checkVersion()
+
+    // }}}
+
+    /**
+    * Sprawd¼ czy mo¿na zaktualizowaæ plik
+    * Weryfikacja czy plik nie zosta³ zmieniony przez klienta i czy wersja pliku w sklepie nie jest
+    * nowsza od wersji instalowanej. Dodatkowo system sprawdza, czy plik na dysku nie jest zgodny z plikiem
+    * w upgrade. Je¶li tak to mimo róznych sum kontrolnych zwraca wynik pozytywny.
+    *
+    * @param string $file plik
+    *
+    * @access private
+    * @return int     0 - mo¿na aktualizowaæ plik,
+    *                 1 - plik zmieniony przez usera,
+    *                 2 - nowsza wersja pliku
+    *                 3 - wykryta indywidualna modyfikacja,
+    *                 4 - plik zaktualizowany w poprzedniej aktualizacji (wykryto wczesniej indywidualna modyfikacje /3/)
+    */
+    function _upgradeTestFile($file) {
+        global $DOCUMENT_ROOT;
+        global $shop;
+
+        if ($shop->home!=1) {
+            $_file_root_path="$DOCUMENT_ROOT/../../$file";
+        } else {
+            $_file_root_path=preg_replace("/^soteesklep3/","",$file);
+        }
+
+        if (! file_exists($_file_root_path)) {
+            return (0);
+        }
+        $_file_base_path=ereg_replace("soteesklep3",".",$file);  // ¶cie¿ka typu ./admin/go/_edit.index.php
+
+        // plik z systemu plikow
+        $cvs =& new CVS($_file_root_path,CVS_FILE);
+        $file_version_cvs=$cvs->getVersion();                    // numer wersji CVS np. 2.9
+        $file_version=$cvs->idCVS2Int($file_version_cvs);        // numer wersji CVS INT np. 29
+
+        // odczytaj sume kontrolna z systemu plikow
+        $fc =& new FileChecksum($_file_root_path,FILE_CHECKSUM_FILE);
+        $file_checksum=$fc->getChecksum();
+        if ($fd=@fopen($_file_root_path,"r")) {
+            $_file_source=fread($fd,filesize($_file_root_path));
+            $file_source_from_path=trim($_file_source);
+        } else $file_source_from_path='';
+
+        // plik z upgrade
+        $file_source_from_upgrade=trim($this->getFile($file));
+        $cvs =& new CVS($file_source_from_upgrade,CVS_SOURCE);
+        $file_version_upgr_cvs = $cvs->getVersion();
+        $file_version_upgr = $cvs->idCVS2Int($file_version_upgr_cvs);
+
+        $file_checksum_dat=$fc->getChecksumFromDAT($_file_base_path);
+
+        // @since 3.1beta1.5
+        // testujemy plik z pakietu aktualizacyjnego (nie plik le¿±cy na dysku)
+        if (ereg("\\\@"."x",$file_source_from_upgrade)) {
+            return (-1); // modyfikacja, któr± mo¿na nadpisaæ patchem bez komunikatu o sumie kontrolnej, suma w mod.md5
+        }
+
+        // sprawd¼ czy plik w pakiecie upgrade jest taki sam jak plik na dysku, je¶li tak to zezwalaj na aktualizacjê
+        if ($file_source_from_path==$file_source_from_upgrade) {
+            return (0);
+        }
+
+        // zapamiêtaj  w przestrzeni globalnej obiektu warto¶ci plików, z którymi wyst±pi³ problem
+        $this->_files=array();
+        $this->_files['path']=urlencode($file_source_from_path);
+        $this->_files['upgrade']=urlencode($file_source_from_upgrade);
+
+
+        if (empty($file_checksum_dat)) {
+            return (0);               // brak sumy w pliku bazy sum
+        }
+        if ($file_checksum_dat!=$file_checksum) {
+            // sprawdzamy czy klient nie zaktualizowal wczesniej zmodyfikowanego pliku
+            // tj. czy jest odpowiedni wpis w mod.md5 i czy suma kontrolna tam zawarta
+            // jest zgodna z sum± kontroln± pliku na dysku
+            // (jest tak return (4) else return (1))
+            if ($this->_testModFile($_file_base_path,$file_checksum)) return (4);
+            else return (1);  // wykryto modyfikacjê pliku
+        } else {
+            // suma kontrolna siê zgadza
+            return (0);
+        }
+        if ($file_version>$file_version_upgr) return (2);        // ma dysku jest nowsza wersja pliku
+
+        // @since 3.1beta1.5
+        // testujemy plik z dysku (np. po instalacji indywidualnej modyfikacji)
+        if (ereg("\\\@"."x",$file_source_from_path)) {
+            return (3); // zainstalowano indywidualna modyfikacjê wykonan± przez SOTE
+        }
+
+        return (0);
+    } // end _upgradeTestFile()
+
+    /**
+    * Sprawd¼ czy wskazany plik by³ wcze¶niej zmodyfikowany i zmiany zosta³y zatwierdzone przez admina/developera
+    *
+    * @param string $file          ¶cie¿ka do pliku np. ./admin/go/_order/html/edit.html.php
+    * @param string $file_checksum suma kontrolna aktualnego pliku na dysku
+    * @access private
+    * @return bool true - plik zosta³ wcze¶niej zmodyfikowany i zatwierdzony, false w p.w.
+    */
+    function _testModFile($file,$file_checksum) {
+        global $DOCUMENT_ROOT;
+
+        $file_md5="$DOCUMENT_ROOT/../mod.md5";
+        if (file_exists($file_md5)) {
+            $fd=fopen($file_md5,"r");
+            $data=fread($fd,filesize($file_md5));
+            fclose($fd);
+
+            $lines=split("\n",$data);
+            foreach ($lines as $line) {
+                $tab=split("  ",$line,2);
+                if (! empty($tab[1])) {
+                    if ((trim($tab[1])==$file) && (trim($tab[0])==$file_checksum)) return true;
+                }
+            }
+
+        } else $data='';
+
+        return false;
+    } // end _testModFile()
+
+    /**
+    * Aktualizuj wskazany plik
+    *
+    * @param string $file        plik wzglêdem $DOCUMENT_ROOT/../ np. soteesklep3/htdocs/index.php
+    * @param string $file_source zawarto¶æ pliku, jesli warto¶c nie jest domy¶lnie pobierana z pakietu upgrade
+    * @param int    $type        UPGRADE_FILE_SUM - zapisz dane w sum.md5, UPGRADE_FILE_MOD - nie zpisuj w sum.md5
+    * @param int    $mode        0 - defult, UPGRADE_SAVE_MOD - zapisz zawarto¶c pliku w bazie, nie instaluj go
+    *
+    * @access public
+    * @return bool true upgrade OK, false w p.w.
+    */
+    function upgradeFile($file,$file_source='',$type=UPGRADE_FILE_SUM,$mode=0) {
+        global $ftp,$DOCUMENT_ROOT,$config;
+        global $shop;
+
+        if ($this->_version<0) {
+            global $_REQUEST;
+            if (! empty($_REQUEST['file']['patch_version'])) {
+                $this->_version=intval($_REQUEST['file']['patch_version']);
+                if (! $this->_version>0) {
+                    die ("Error: Wrong version number");
+                }
+            }
+        }
+
+        $db_data=array();
+        $db_data['file']=ereg_replace("soteesklep3",".",$file);
+        $db_data['date_add']=date("Y-m-d");
+        $db_data['version_name']=$this->_version;
+        $db_data['upgrade_file']=basename($this->upgradeFile);
+
+        if (empty($file_source)) {
+            $file_source=$this->getFile($file);             // pobierz zawarto¶æ wskazanego pliku z pakietu upgrade
+            $this->_source=$file_source;
+        }
+
+        $file_name=basename($file);                         // odczytaj nazwê pliku
+        $file_name_copy=$this->_version."-".$file_name;     // nazwa kopii pliku
+        $file_dir=dirname($file);                           // katalog wzglêdem $DOCUMENT_ROOT/../ np. soteesklep3/htdocs
+
+        if (@$shop->home!=1) {
+            $file_current=$DOCUMENT_ROOT."/../../$file_dir/$file_name";
+        } else {
+            // home.pl
+            // rozró¿nij katalogi soteesklep3/admin/include i soteesklep3/include
+            // na home.pl /include wskazuje na soteesklep3/admin.include a nie na g³ówny katalog
+            // odwo³ania do g³ównego katalogu, przekieruj na soteesklep3/admin/htdocs/base/include
+            foreach ($this->_base_dirs as $dir) {
+                if (ereg("^soteesklep3/".$dir,$file_dir)) {
+                    $file_dir=preg_replace("/^soteesklep3\/".$dir."/",'soteesklep3/admin/htdocs/base/'.$dir,$file_dir);
+                }
+            }
+            $file_current=preg_replace("/^\/soteesklep3/","","/$file_dir/$file_name");
+            $file_current=preg_replace("/^\/admin/","",$file_current);
+        }
+
+        $file_new="$DOCUMENT_ROOT/tmp/upgrade_$file_name";
+        if (@$shop->home!=1) {
+            $file_copy=$DOCUMENT_ROOT."/../../$file_dir/$file_name_copy";
+        } else {
+            // home.pl
+            $file_copy=preg_replace("/^\/soteesklep3/","","/$file_dir/$file_name_copy");
+            $file_copy=preg_replace("/^\/admin/","",$file_copy);
+        }
+        $this->_file_copy=$file_copy;
+
+        // dla trybu UPGRADE_SAVE_MOD nie instaluj pliku tylko zapamietaj go w bazie
+        if (! $mode) {
+            // zapisz zrodla do tymczasowego pliku
+            if ($fd=fopen($file_new,"w+")) {
+                fwrite($fd,$file_source,strlen($file_source));
+                fclose($fd);
+                if ((file_exists($file_current)) && (! file_exists($file_copy))) {
+                    // zrob kopie starej wersji pliku
+                    $ftp->put($file_current,$config->ftp['ftp_dir']."/../$file_dir",$file_name_copy);
+                }
+                // aktualizuj katalogi, za³ó¿ odpowiednie katalogi, je¶li nie ma ich w obecnym drzewie programu
+                $this->_mkDir($file_dir);
+                // aktualizuj plik
+                $ftp->put($file_new,$config->ftp['ftp_dir']."/../$file_dir",$file_name);
+                unlink($file_new);
+
+                if ($type==UPGRADE_FILE_SUM) {
+                    // oblicz sumê kontroln± zainstalowanego pliku  i zapamiêtaj j± w bazie sum kontrolnych
+                    $file_dir2=preg_replace("/^soteesklep3/","",$file_dir);
+                    $file_fc=".".$file_dir2."/$file_name";                  // np. ./admin/index.php
+                    $file_fc_path=$DOCUMENT_ROOT."/..".$file_dir2."/$file_name";  // np. /home/sklep/soteesklep3/admin/index.php
+                    $fc =& new FileChecksum($file_fc_path,FILE_CHECKSUM_FILE);
+                    $file_checksum=$fc->getChecksum();
+                    $fc->set($file_fc,$file_checksum);
+                }
+            } else return false;
+        } else {
+            // @todo dodac zapapietanie w bazie danych zawartosci pliku dla danej sesji.
+            // ...
+        }
+
+        return true;
+    } // end upgradeFile()
+
+    /**
+    * Odczytaj pe³n± scie¿kê (z katalogiem sklepu) do kopii pliku (np. soteesklep3/htdocs/8-index.php)
+    *
+    * \@global string $this->_file_copy np. /usr/home/maroslaw/MYCVS2/soteesklep2/admin/../../soteesklep3/htdocs/8-index.php
+    * @return string np. soteesklep3/htdocs/8-index.php
+    */
+    function getLastFileCopyName() {
+        if (! empty($this->_file_copy)) {
+            preg_match("/soteesklep[0-9]{1}(.*)$/",$this->_file_copy,$matches);
+            if (! empty($matches[1])) {
+                return ereg_replace('/admin/../../','',$matches[1]);
+            }
+        }
+        return '';
+    } // end getlastFileCopyName()
+
+    /**
+    * Za³ó¿ wskazany katalog, jesli nie ma go w systemie plików
+    *
+    * @param string $dir ¶cie¿ka do katalogu wzglêdem soteesklep3
+    * @return bool
+    */
+    function _mkDir($dir) {
+        global $DOCUMENT_ROOT,$ftp,$config;
+
+
+        $dir=preg_replace("/^soteesklep[0-9]\//","",$dir);
+
+        if (! is_dir("$DOCUMENT_ROOT/../".$dir)) {
+            $this->_mkRecSubDir($dir);
+            $ftp->mkdir($config->ftp['ftp_dir']."/".$dir);
+        }
+        return true;
+    } // end _mkDir()
+
+    /**
+    * Za³ó¿ rekurencyjnie wskazany katalog (poza ostatnim)
+    * Funkcja rekurencyjna.
+    *
+    * @param string $dir katalog wzglêdem g³ównego katalogu soteesklep3
+    *
+    * @access private
+    * @return bool true - katalog za³ozony, false - w p.w.
+    */
+    function _mkRecSubDir($dir) {
+        global $ftp,$config,$DOCUMENT_ROOT;
+
+        // obetnij ostatni katalog i sprawd¼, czy poziom wy¿ej mo¿ña za³o¿yæ podkatalog
+        $last_dir=basename($dir);
+
+        $dir2=$dir;
+
+        $dir=substr($dir,0,strlen($dir)-strlen($last_dir)-1);
+        $test_dir="$DOCUMENT_ROOT/../$dir";
+
+        if (is_dir($test_dir)) {
+            $ftp->mkdir($config->ftp['ftp_dir']."/".$dir2);
+            return true;
+        } else {
+            if ($this->_mkdirCount<MKDIR_MAX_COUNT) {
+                $this->_mkdirCount++;
+                $this->_mkRecSubDir($dir);
+                return;
+            }
+        }
+    } // end _mkRecSubDir()
+
+    /**
+    * Odczytaj numer upgrade'u
+    * @return int numer wersji aktualizacji
+    */
+    function getVersion() {
+        return $this->_version;
+    } // end getVersion();
+
+    // {{{ saveModFile()
+
+    /**
+    * Zapisz w bazie danych zawarto¶æ po³±czonego pliku.
+    *
+    * @param string $file_name     ¶cie¿ka do pliku wzglêdem soteesklepX + nazwa pliku
+    * @param string $new_file      zawarto¶c pliku, warto¶æ zapisywana w bazie
+    * @param int    $patch_version numer wersji pakietu aktualizacyjnego
+    *
+    * @return bool
+    */
+    function saveModFile($file_name,$new_file,$patch_version) {
+        global $sess,$db;
+        global $mdbd;
+
+        // sprawd¼ czy wpis ju¼ istnieje
+        $query="SELECT id FROM upgrade_files WHERE path=? AND source=? AND session_id=? AND pkg_number=?";
+        $prepared_query=$db->prepareQuery($query);
+        if ($prepared_query) {
+            $db->QuerySetText($prepared_query,1,$file_name);
+            $db->QuerySetText($prepared_query,2,$new_file);
+            $db->QuerySetText($prepared_query,3,$sess->id);
+            $db->QuerySetInteger($prepared_query,4,$patch_version);
+            $result=$db->executeQuery($prepared_query);
+            if ($result!=0) {
+                $num_rows=$db->numberOfRows($result);
+                if ($num_rows>0) {
+                    return true;
+                }
+            } else die ($db->error());
+        } else die ($db->error());
+
+        $query2="INSERT INTO upgrade_files (path,source,session_id,pkg_number) VALUES (?,?,?,?)";
+        $prepared_query2=$db->prepareQuery($query2);
+        if ($prepared_query2) {
+            $db->QuerySetText($prepared_query2,1,$file_name);
+            $db->QuerySetText($prepared_query2,2,$new_file);
+            $db->QuerySetText($prepared_query2,3,$sess->id);
+            $db->QuerySetInteger($prepared_query2,4,$patch_version);
+            $result2=$db->executeQuery($prepared_query2);
+            if ($result2!=0) {
+                return true;
+            }
+        } else die ($db->error());
+
+        return false;
+    } // end saveModFile()
+
+    // }}}
+
+    // {{{ showReportUpgradeDB
+
+    /**
+    * Poka¿ raport o plikach zainstalowanych w buforze dla danej sesji
+    * Funckja dla debugowania.
+    *
+    * @return void
+    */
+    function showReportUpgradeDB() {
+        global $sess,$mdbd;
+        $data=$mdbd->select("id,path,pkg_number","upgrade_files","session_id=?",array($sess->id=>"text"));
+        print "pliki w buforze:<br />\n";
+        print "<pre>";print_r($data);print "</pre>";
+        return;
+    } // end showReportUpgradeDB()
+
+    // }}}
+
+    // {{ getFileFromDB()
+
+    /**
+    * Sprawd¼ czy plik jest w buforze, je¶li jest to odczytaj jego zawarto¶æ
+    *
+    * @param string $file 
+    * @return string zawarto¶c pliku w buforze lub ci±g pusty (void)
+    */
+    function getFileFromDB($file) {
+        global $mdbd,$sess;
+        $source=$mdbd->select("source","upgrade_files","session_id=? AND path=?",array($sess->id=>"text",$file=>"text"),"LIMIT 1");
+        if (! empty($source)) return $source;
+        return;
+    } // end getFileFromDB()
+
+    // }}}
+
+
+} // end class DiffUpgrade
+
+?>
diff -ruN ../soteesklep3/admin/go/_upgrade/include/.#upgrade.inc.php.1.38 soteesklep3/admin/go/_upgrade/include/.#upgrade.inc.php.1.38
--- ../soteesklep3/admin/go/_upgrade/include/.#upgrade.inc.php.1.38	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_upgrade/include/.#upgrade.inc.php.1.38	2006-08-23 16:58:51.000000000 +0200
@@ -0,0 +1,942 @@
+<?php
+/**
+* Obs³uga plików aktualizacji.
+* Odczytanie plików do aktualizacji, weryfikacja, aktualizacja.
+*
+* @author  m@sote.pl
+* @version $Id: upgrade.inc.php,v 1.38 2006/03/09 11:41:07 lukasz Exp $
+* @package    upgrade
+*/
+
+/**
+* Dodaj obs³ugê FTP
+*/
+require_once ("include/ftp.inc.php");
+
+/**
+* Dodaj obs³ugê plików CVS
+*/
+require_once ("include/cvs.inc.php");
+
+/**
+* Dodaj obs³ugê generowania sum kontrolnych plików
+*/
+require_once ("include/file_checksum.inc.php");
+
+/**
+* Odczytaj konfiguracje patch'y
+*/
+require_once ("config/auto_config/patch_config.inc.php");
+
+/**
+* Oczytaj zarz±dzanie licencj±
+*/
+require_once ("include/license.inc.php");
+
+/**
+* Maksymalna ilo¶æ zagnie¿dzeñ katalogów przy zak³adaniu nowych ¶cie¿ek.
+* Ilo¶æ katalogów przegl±danych "w górê" w celu znalezienia odpowiedniej ¶cie¿ki, w której
+* mo¿na zak³adaæ wsakzane katalogi.
+*/
+define ("MKDIR_MAX_COUNT",8);
+
+/**
+* Okre¶lenie do jakiej bazy sum kontrolnych jest zapisywana suma kontrolna. UPGRADE_FILE_SUM -> sum.md5
+*/
+define ("UPGRADE_FILE_SUM",1);
+
+/**
+* Okre¶lenie do jakiej bazy sum kontrolnych jest zapisywana suma kontrolna. UPGRADE_FILE_MOD -> mod.md5
+*/
+define ("UPGRADE_FILE_MOD",2);
+
+/**
+* Okre¶lenie czy dokonujemy symulacji instalacji pakietu.
+*/
+define ("UPGRADE_SIMULATION",true);
+
+/**
+* Okre¶lenie poprawnej aktualizacji pliku.
+*/
+define ("UPGRADE_RESULT_OK",0);
+
+/**
+* Okre¶lenie pliku z modyfikacj± klienta.
+*/
+define ("UPGRADE_RESULT_MOD",-1);
+
+/**
+* B³±d podczas instalacji pliku.
+*/
+define ("UPGRADE_RESULT_ERROR",-2);
+
+/**
+* Tryb autonmatycznej instalacji plików.
+*/
+define ("UPGRADE_INSTALL_AUTO_MODE",1);
+
+/**
+* Zapamiêtaj aktualizowany plik w bazie, nie instaluj go.
+*/
+define ("UPGRADE_SAVE_MOD",1);
+
+/**
+* Obs³uga plików "Diff"
+* @package upgrade
+*/
+class Diff {
+
+    /**
+    * @var array wiersze z aktualizacji
+    * @access private
+    */
+    var $_file_lines=array();
+
+    /**
+    * @var array lista plików do aktualizacji
+    */
+    var $_files=array();
+
+    /**
+    * @var int licznik za³o¿onych katalogów, przy tworznieu odpowiedniej ¶cie¿ki do pliku (zobacz MKDIR_MAX_COUNT)
+    */
+    var $_mkdirCount=0;
+
+    /**
+    * @var bool true - symulacja instalacji    
+    * @access private
+    */
+    var $_simulation=false;
+
+    /**
+    * @var int status aktualizacji 0 - ok, 1 - modyfikacja
+    */
+    var $upgrade_status=0;
+
+    /**
+    * @var string zawarto¶c ostatnio aktualizowanego pliku
+    */
+    var $_source='';
+
+    /**
+    * @var string opcjonalny kod aktywacyjny do pakietu zdefiniowany w pliku 000-upgrade_config.php w sta³ej PATCH_CODE
+    * @access private
+    */
+    var $_patch_code='';
+
+    /**
+    * Konstruktor
+    *
+    * @param string $file plik z aktualizacj±
+    * @return bool true plik poprawnie za³±czony, false w p.w.
+    */
+    function Diff($file) {
+        if (file_exists($file)) {
+            $fd=fopen($file,"r");
+            $data=fread($fd,filesize($file));
+            fclose($fd);
+            $this->_file_lines=split("\n",$data);
+            return true;
+        }
+        return false;
+    } // end Diff()
+
+    /**
+    * Odczytaj listê plików do aktualizacji
+    * @return array
+    */
+    function _getFiles() {
+        $files=array();
+        reset($this->_file_lines);
+        foreach ($this->_file_lines as $_line) {
+            if (ereg("^diff -ruN",$_line)) {
+                $tab=split(" ",$_line,4);
+                if (! empty($tab[3])) $files[]=$tab[3];
+            }
+        } // end foreach
+        $this->_files=$files;
+        return $files;
+    } // end _getFiles()
+
+    /**
+    * Odczytaj zawarto¶c wskazanego pliku z pakietu aktualizcyjnego.
+    *
+    * @param string nazwa pliku + ¶cie¿ka w wzglêdem $DOCUMENT_ROOT/../
+    * @return string zawarto¶c pliku
+    */
+    function getFile($file) {
+        if (empty($this->_file_lines)) return;
+        reset($this->_file_lines);$file_source='';$_read=false;$_start=false;
+        foreach ($this->_file_lines as $_line) {
+            if (ereg(" ".$file."$",$_line)) $_read=true;
+            if ((! (ereg(" ".$file."$",$_line))) && ((ereg("^diff "."-ruN ",$_line)))) { $_read=false; $_start=false; }
+            if (ereg("\ No newline "."at end of file",$_line)) { $_read=false; $_start=false; }
+            if (($_read) && ($_start)) {
+                $line=preg_replace("/^\+/","",$_line); // usuñ znak +, kótry dodaje diff na pocz±tku ka¿dej linii
+                $file_source.=$line."\n";
+            }
+            if (($_read) && (! $_start)) {
+                if (ereg("^@@ ",$_line)) $_start=true;
+            }
+        } // end foreach()
+        return $file_source;
+    } // getFile()
+
+} // end class Diff
+
+/**
+* Klasa aktualizacja sklepu na bazie plików "diff".
+* @package upgrade
+*/
+class DiffUpgrade extends Diff {
+
+    /**
+    * @var int numer wersji upgrade'u, dla ka¿dego upgradu numer powinien byæ nowy numer CVS
+    */
+    var $_version=-1;
+
+    /**
+    * @var string zmienna zawieraj±ca plik zawieraj±cy pakiet upgrade'u (nazwa pliku z uaktualneiniem)
+    * @access public
+    */
+    var $upgradeFile='';
+
+    /**
+    * Lista podkatalogów z g³ównego katalogu sklepu, dla których zmieniana jest lokalizacja docelowa
+    * Dot. instalacji na home.pl
+    */
+    var $_base_dirs=array("config","include","lib","bin");
+
+    /**
+    * Kondtruktor
+    * @see Diff::Diff()
+    */
+    function DiffUpgrade($file) {
+        $this->upgradeFile=$file;
+        preg_match("/([0-9][0-9][0-9])\./",basename($file),$matches);
+        if (! empty($matches[1])) $this->_version=intval($matches[1]);
+        else $this->version=date("YmdHi");
+        return $this->Diff($file);
+    } // end DiffUpgrade()
+
+    /**
+    * Wy¶wietl liste plików do aktualizacji
+    * @return none
+    */
+    function showListFiles() {
+        if  (empty($this->_files)) $this->_getFiles();
+        reset($this->_files);
+        print "<ul>\n";
+        foreach ($this->_files as $_file) {
+            $file_url=urlencode($_file);
+            print "<li>$_file</li>\n";
+        } // end foreach
+        print "</ul>\n";
+        return;
+    } // end showListFiles()
+
+    /**
+    * Wykonaj upgrade
+    *
+    * @param bool $simulation true - emulacja trybu instalacji pakietu, bez jego instalacji, false - instalacja pakietu
+    *
+    * @return int  1 upgrade wykonany poprawnie,  (-1) - bledny pakiet  
+    */
+    function doUpgrade($simulation=false) {
+        global $ftp,$DOCUMENT_ROOT;
+        global $lang,$shop,$config;
+
+        $this->_simulation=$simulation;
+
+        $this->_getFiles();
+        if  (empty($this->_files)) $this->_getFiles();
+        $ftp->connect();
+        //print "<table cellspacing=1 cellpadding=0 border=0>\n";
+        $result=array();
+        foreach ($this->_files as $_file) {
+            // print "<tr>\n";
+            // spawdz, czy plik mozna zaktualizowac
+            $result_upgrade_test=$this->_upgradeTestFile($_file);
+
+            if (! ereg("000-upgrade_config.php",$_file)) {
+                // pomiñ plik konfiguracji aktualnie instalowanego pakietu
+                $result[$_file]['result']=$result_upgrade_test;
+            }
+
+            if (($result_upgrade_test>0) && ($result_upgrade_test!=2)) {
+                $this->upgrade_status=1;
+            }
+            if ($result_upgrade_test==0) {
+                // instaluj plik je¶li nie zosta³ wywo³any tryb symulacji lub je¶li jest odczytywany plik konfiguracyjny
+                if ((! $this->_simulation) || (ereg("000-upgrade_config.php",$_file))) {
+                    if (! $this->upgradeFile($_file)) {
+                        $result['files'][$_file]=UPGRADE_RESULT_ERROR;
+                    } else {
+                        // start home.pl 2005-08-17 m@sote.pl
+                        // instaluj plik konfiguracyjny do g³ównego katalogu i do admin (dla home.pl)
+                        // gdy¿ na home.pl plik z g³ównego katalogu nie jest dostêpny i jego
+                        // kopia musi znajdowaæ siê w podkatalogu "admin"
+                        if ((ereg("000-upgrade_config.php",$_file)) && ($shop->home)) {
+                            if ($fd=fopen("/tmp/000-upgrade_config.php","w+")) {
+                                fwrite($fd,$this->_source,strlen($this->_source));
+                                fclose($fd);
+                                $ftp->put("/tmp/000-upgrade_config.php",$config->ftp['ftp_dir']."/admin","000-upgrade_config.php");
+                            } else {
+                                die ("Error: Unable to install file /tmp/000-upgrade_config.php");
+                            }
+                        }
+                        // end home.pl
+
+                    }
+
+                    if (ereg("000-upgrade_config.php",$_file)) {
+                        // odczytaj numer wersji aktualnie instalowanego pakietu
+                        include_once ("000-upgrade_config.php");
+                        if (! defined("PATCH_VERSION")) {
+                            $this->upgrade_status=1;
+                        } else {
+                            $this->_version=PATCH_VERSION;
+                        }
+
+                        // kod aktywacyjny zwi±zany z pakietem aktualizacyjnym
+                        if (defined("PATCH_CODE")) {
+                            $this->_patch_code=PATCH_CODE;
+                        }
+
+                    }
+                }
+
+                // sprawd¼ wersjê instalowanego pakietu,
+                if (! $this->checkVersion()) {
+                    return (-1);
+                }
+
+                // } elseif ($result_upgrade_test==-1) {
+                //  if (! $this->upgradeFile($_file,'',UPGRADE_FILE_MOD)) {
+                //      $result['files'][$_file]=UPGRADE_RESULT_ERROR;
+                //  }
+            } else {
+                //print "</td>\n";
+                //print "<td>\n";
+                //print " <font color=\"$color\">".$lang->upgrade_file_status_simulation[$result_upgrade_test]."</font>";
+                //print "</td>\n";
+                global $shop;
+                if (($result_upgrade_test!=2) && ($this->_simulation) && !@$shop->home) {
+                    //print "<td>\n";
+                    // poka¿ formularze do wykrycia modyfikacji pliku i "wyleczenia/pogodzenia" zmian
+                    //print "      <form action=repair.php method=POST target=window>\n";
+                    //print "      <input type=hidden name=file[name] value='".$_file."'>\n";
+                    $result[$_file]['form']['name']=$_file;
+                    $result[$_file]['form']['upgrade_file']=$this->upgradeFile;
+                    //print "      <input type=hidden name=file[upgrade_file] value='".$this->upgradeFile."'>\n";
+                    //print "      <input type=hidden name=file[path] value='".$this->_files['path']."'>\n";
+                    $result[$_file]['form']['path']=$this->_files['path'];
+                    //print "      <input type=hidden name=file[upgrade] value='".$this->_files['upgrade']."'>\n";
+                    $result[$_file]['form']['upgrade']=$this->_files['upgrade'];
+                    //print "      <input type=submit value='$lang->upgrade_file_repair' onclick='window.open(\"\", \"window\", \"width=800, height=600, status=no, toolbar=no, scrollbars=yes, resize=1\")'>\n";
+                    //print "      </form>\n";
+                    //print "</td>\n";
+                } else {
+                    // instalacja plików z bufora, lub nadpisanie plików z dysku plikami z pakietu
+                    // sprawd¼, czy aktualizowany plik jest w buforze, je¶li tak to odczytaj jego zawarto¶æ i zainstaluj
+                    // je¶li nie, instaluj pliki z pakietu
+                    $upgrade_file_source=$this->getFileFromDB($_file);
+                    if ($upgrade_file_source) {
+                        // plik jest w buforze
+                        $this->upgradeFile($_file,$upgrade_file_source,UPGRADE_FILE_MOD);
+                        $result[$_file]['result']=4;
+                    } else {
+                        // nie ma plku w buforze, we¼ plik z pakietu akualizacyjnego
+                        $this->upgradeFile($_file);
+                        $result[$_file]['result']=0;
+                    }
+                }
+                //print "</tr>\n";
+            }
+        } // end foreach()
+        //print "</table>\n";
+
+        // zapamiêtaj wynik testu/aktualizacji
+        $this->_result=$result;
+        //print "<pre>";print_r($result);print "</pre>";
+
+
+        if (empty($result)) {
+            print "<font color=\"red\">$lang->upgrade_error_ext</font>\n";
+            $this->upgrade_status=2;
+        }
+
+        global $__database_md5;
+
+        // zapisz now± bazê sum kontrolnych
+        if (! $this->_simulation) {
+            if (FileChecksum::saveDat()) {
+                print "<p>$lang->upgrade_checksums_upgraded <p>";
+            } else {
+                print "<p><font color=\"red\">$lang->upgrade_checksums_upgrade_error</font><p>\n";
+            }
+        }
+        $ftp->close();
+
+        return (1);
+    } // end doUpgrade()
+
+    // {{{ showUpgradeInfo()
+
+    /**
+    * Wyswietl raport dot. aktualizacji.
+    *
+    * @param int $upgrade_mode 0 - defualt, UPGRADE_INSTALL_AUTO_MODE - nie pokazuj linku do naprawy plików
+    *
+    * @return  bool
+    */
+    function showUpgradeInfo($upgrade_mode=0) {
+        global $theme;
+        if (empty($this->_result)) return false;
+        if ((empty($this->_version)) && ($this->_version!=0)) return false;
+
+        $ret=true;
+        print "<table cellspacing=\"0\" cellpadding=\"1\">\n";
+        foreach ($this->_result as $file=>$val) {
+            print "<tr>";
+            print "<td>";
+            $status=$val['result'];
+            switch ($status) {
+                case 0: $theme->point("g");break; // 0 - mo¿na aktualizowaæ plik
+                case 1: $theme->point("r");break; // 1 - plik zmieniony, wykryto modyfikacjê
+                case 2: $theme->point("b");break; // 2 - nowsza wersja pliku
+                case 3: $theme->point("o");break; // 3 - indywidualna modyfikacja
+                case 4: $theme->point("rg");break; // 4 - indywidualna modyfikacja, zatwierdzona w poprzedniej aktualizacji
+                default: $theme->point("black");break;
+            }
+            print "</td>";
+            print "<td>$file</td>";
+            if (($status==1) || ($status==3) | ($status==4)) {
+                if (empty($upgrade_mode)) {
+                    $ret=false;
+                    print "<td>";$this->_repairForm($file);print "</td>\n";
+                }
+            }
+            print "</tr>\n";
+        } // end foreach;
+        print "</table>\n";
+
+        return $ret;
+    } // end showUpgradeInfo()
+
+    // {{{ repairForm()
+
+    /**
+    * Wy¶wietl formularz przekierowuj±cy u¿ytkownika na stronê ³±czenia modyfikacji plików z pakietu i z dysku
+    *
+    * @param string $file nazwa pliku np. soteesklep3/admin/index.php
+    * @return void
+    */
+    function _repairForm($_file) {
+        $result=$this->_result;
+
+        print "<form action=repair.php method=POST target=window>\n";
+        print "      <input type=hidden name=file[name] value='".$_file."'>\n";
+        print "      <input type=hidden name=file[patch_version] value='".$this->_version."'>\n";
+        print "      <input type=hidden name=file[upgrade_file] value='".$result[$_file]['form']['upgrade_file']."'>\n";
+        print "      <input type=hidden name=file[path] value='".$result[$_file]['form']['path']."'>\n";
+        print "      <input type=hidden name=file[upgrade] value='".$result[$_file]['form']['upgrade']."'>\n";
+        print "<input type=image  src=/themes/base/base_theme/_img/repair.png border=0 width=10 height=10 onclick='window.open(\"\", \"window\", \"width=800, height=600, status=no, toolbar=no, scrollbars=yes, resize=1\")'>";
+        print "      </form>\n";
+
+
+        return;
+    } // end _repairForm()
+
+    // }}}
+
+    // }}}
+
+    // {{{ legend()
+
+    /**
+    * Wy¶wietl legendê statusów aktualizacji.
+    */
+    function legend() {
+        global $theme,$lang;
+
+        print "<br />$lang->upgrade_legend_title:<br \>";
+        print "<table cellspacing=\"1\" cellpadding=\"1\">\n";
+        print "<tr><td>";$theme->point("g");print "</td><td>".$lang->upgrade_legend[0]."</td></tr>\n";
+        print "<tr><td>";$theme->point("b");print "</td><td>".$lang->upgrade_legend[2]."</td></tr>\n";
+        print "<tr><td>";$theme->point("r");print "</td><td>".$lang->upgrade_legend[1]."</td></tr>\n";
+        print "<tr><td>";$theme->point("o");print "</td><td>".$lang->upgrade_legend[3]."</td></tr>\n";
+        print "<tr><td>";$theme->point("rg");print "</td><td>".$lang->upgrade_legend[4]."</td></tr>\n";
+        print "<tr><td><img src=/themes/base/base_theme/_img/repair.png width=10 height=10></td><td>".$lang->upgrade_legend['repair']."</td></tr>\n";
+        print "</table>\n";
+        return;
+    } // end legend()
+
+    // }}} legend()
+
+    // {{{ checkVersion()
+
+    /**
+    * Sprawd¼ wersjê instalowanego pakietu.
+    * Sprawd¼ czy wersja istnieje oraz czy mo¿na dany pakiet zainstalowaæ. Pakiety, które mo¿na zainstalowaæ
+    * musz± byæ kolejnymi numerami PATCH_LAST lub powinny mieæ warto¶æ 0 - dla indywidualnych pakietów.
+    * 
+    * @return bool true - mo¿na instalowaæ dan± wersjê, false w p.w.
+    */
+    function checkVersion() {
+        global $mdbd,$lang,$__devel;
+        global $config,$_REQUEST;
+
+        // dla wersji o numerze 0 zwracja true, po weryfikacji kodu
+        if ($this->_version==0) {
+            // sprawd¼ czy kod aktualizacji jest poprawny
+            if ($this->_simulation) {
+                $lic =& new License();
+                $code=$lic->checkCode($this->_patch_code);
+                if ($_REQUEST['upgrade_code']==$code) {
+                    return true;
+                } else {
+                    print "<font color=\"red\">".$lang->upgrade_code_error."</font>";
+                    return false;
+                }
+            }
+            return true;
+        }
+
+        // sprawd¼ czy dany pakiet jest ju¿ zainstalowany
+        $exists=$mdbd->select("id","upgrade","version=?",array($this->_version=>"text"),"LIMIT 1");
+        // nie zezwalaj na powtórne ³adowanie pakietu, chyba ¿e sklep dzia³a w trybie devel
+        if (($exists>0) && (! $__devel)) {
+            $this->upgrade_status=1;
+            print  "<font color=\"red\">$lang->upgrade_already_installed</font>\n";
+            return false;
+        } elseif (($__devel) && ($exists>0)) {
+            // je¶li pakiet ju¿ by³ zainstalowany i panel dzia³a w trybie "devel" to zezwalaj na jego ponown± instalacjê
+            return true;
+        }
+
+        // odczytaj ostatnio zainstalowany pakiet
+        
+        // 
+        // $max_current_version=$mdbd->select("version","upgrade","1",array(),"ORDER BY version DESC LIMIT 1");        
+        $max_current_version=$mdbd->select("version","upgrade","1",array(),"ORDER BY id DESC LIMIT 1");
+
+        if (empty($max_current_version)) $max_current_version=$config->pkg_first_number-1;
+        if ($this->_version!=$max_current_version+1) {
+            // sprawd¼ sytuacjê: czy czasem nie ma ¿adnych wpisów w bazie, je¶li tak jest
+            // to sprawd¼ w config'u jaki pakiet powinien byæ instalowany jako pierwszy
+            // @todo
+            $any=$mdbd->select("id","upgrade",1,array(),"LIMIT 1");
+            if (! $any) {
+                // nie ma ¿adnych rekordów w upgrade
+                if ($this->_version==$config->pkg_first_number) {
+                    return true;
+                } else {
+                    $this->upgrade_status=1;
+                    print  "<font color=\"red\">$lang->upgrade_wrong_pkg_number</font>\n";
+                    return false;
+                }
+            }
+
+            $this->upgrade_status=1;
+            print  "<font color=\"red\">$lang->upgrade_wrong_pkg_number</font>\n";
+            return false;
+        }
+        // sprawd¼ czy instalowany pakiet mo¿e byæ instalowany tj. jest o 1 wiêkszy od max_current_version
+
+        if ($this->_version==-1) {
+            print ("<font color=\"red\">$lang->upgrade_wrong_format</font>\n");
+            return false;
+        }
+        return true;
+    } // end checkVersion()
+
+    // }}}
+
+    /**
+    * Sprawd¼ czy mo¿na zaktualizowaæ plik
+    * Weryfikacja czy plik nie zosta³ zmieniony przez klienta i czy wersja pliku w sklepie nie jest
+    * nowsza od wersji instalowanej. Dodatkowo system sprawdza, czy plik na dysku nie jest zgodny z plikiem
+    * w upgrade. Je¶li tak to mimo róznych sum kontrolnych zwraca wynik pozytywny.
+    *
+    * @param string $file plik
+    *
+    * @access private
+    * @return int     0 - mo¿na aktualizowaæ plik,
+    *                 1 - plik zmieniony przez usera,
+    *                 2 - nowsza wersja pliku
+    *                 3 - wykryta indywidualna modyfikacja,
+    *                 4 - plik zaktualizowany w poprzedniej aktualizacji (wykryto wczesniej indywidualna modyfikacje /3/)
+    */
+    function _upgradeTestFile($file) {
+        global $DOCUMENT_ROOT;
+        global $shop;
+
+        if ($shop->home!=1) {
+            $_file_root_path="$DOCUMENT_ROOT/../../$file";
+        } else {
+            $_file_root_path=preg_replace("/^soteesklep3/","",$file);
+        }
+
+        if (! file_exists($_file_root_path)) {
+            return (0);
+        }
+        $_file_base_path=ereg_replace("soteesklep3",".",$file);  // ¶cie¿ka typu ./admin/go/_edit.index.php
+
+        // plik z systemu plikow
+        $cvs =& new CVS($_file_root_path,CVS_FILE);
+        $file_version_cvs=$cvs->getVersion();                    // numer wersji CVS np. 2.9
+        $file_version=$cvs->idCVS2Int($file_version_cvs);        // numer wersji CVS INT np. 29
+
+        // odczytaj sume kontrolna z systemu plikow
+        $fc =& new FileChecksum($_file_root_path,FILE_CHECKSUM_FILE);
+        $file_checksum=$fc->getChecksum();
+        if ($fd=@fopen($_file_root_path,"r")) {
+            $_file_source=fread($fd,filesize($_file_root_path));
+            $file_source_from_path=trim($_file_source);
+        } else $file_source_from_path='';
+
+        // plik z upgrade
+        $file_source_from_upgrade=trim($this->getFile($file));
+        $cvs =& new CVS($file_source_from_upgrade,CVS_SOURCE);
+        $file_version_upgr_cvs = $cvs->getVersion();
+        $file_version_upgr = $cvs->idCVS2Int($file_version_upgr_cvs);
+
+        $file_checksum_dat=$fc->getChecksumFromDAT($_file_base_path);
+
+        // @since 3.1beta1.5
+        // testujemy plik z pakietu aktualizacyjnego (nie plik le¿±cy na dysku)
+        if (ereg("\\\@"."x",$file_source_from_upgrade)) {
+            return (-1); // modyfikacja, któr± mo¿na nadpisaæ patchem bez komunikatu o sumie kontrolnej, suma w mod.md5
+        }
+
+        // sprawd¼ czy plik w pakiecie upgrade jest taki sam jak plik na dysku, je¶li tak to zezwalaj na aktualizacjê
+        if ($file_source_from_path==$file_source_from_upgrade) {
+            return (0);
+        }
+
+        // zapamiêtaj  w przestrzeni globalnej obiektu warto¶ci plików, z którymi wyst±pi³ problem
+        $this->_files=array();
+        $this->_files['path']=urlencode($file_source_from_path);
+        $this->_files['upgrade']=urlencode($file_source_from_upgrade);
+
+
+        if (empty($file_checksum_dat)) {
+            return (0);               // brak sumy w pliku bazy sum
+        }
+        if ($file_checksum_dat!=$file_checksum) {
+            // sprawdzamy czy klient nie zaktualizowal wczesniej zmodyfikowanego pliku
+            // tj. czy jest odpowiedni wpis w mod.md5 i czy suma kontrolna tam zawarta
+            // jest zgodna z sum± kontroln± pliku na dysku
+            // (jest tak return (4) else return (1))
+            if ($this->_testModFile($_file_base_path,$file_checksum)) return (4);
+            else return (1);  // wykryto modyfikacjê pliku
+        } else {
+            // suma kontrolna siê zgadza
+            return (0);
+        }
+        if ($file_version>$file_version_upgr) return (2);        // ma dysku jest nowsza wersja pliku
+
+        // @since 3.1beta1.5
+        // testujemy plik z dysku (np. po instalacji indywidualnej modyfikacji)
+        if (ereg("\\\@"."x",$file_source_from_path)) {
+            return (3); // zainstalowano indywidualna modyfikacjê wykonan± przez SOTE
+        }
+
+        return (0);
+    } // end _upgradeTestFile()
+
+    /**
+    * Sprawd¼ czy wskazany plik by³ wcze¶niej zmodyfikowany i zmiany zosta³y zatwierdzone przez admina/developera
+    *
+    * @param string $file          ¶cie¿ka do pliku np. ./admin/go/_order/html/edit.html.php
+    * @param string $file_checksum suma kontrolna aktualnego pliku na dysku
+    * @access private
+    * @return bool true - plik zosta³ wcze¶niej zmodyfikowany i zatwierdzony, false w p.w.
+    */
+    function _testModFile($file,$file_checksum) {
+        global $DOCUMENT_ROOT;
+
+        $file_md5="$DOCUMENT_ROOT/../mod.md5";
+        if (file_exists($file_md5)) {
+            $fd=fopen($file_md5,"r");
+            $data=fread($fd,filesize($file_md5));
+            fclose($fd);
+
+            $lines=split("\n",$data);
+            foreach ($lines as $line) {
+                $tab=split("  ",$line,2);
+                if (! empty($tab[1])) {
+                    if ((trim($tab[1])==$file) && (trim($tab[0])==$file_checksum)) return true;
+                }
+            }
+
+        } else $data='';
+
+        return false;
+    } // end _testModFile()
+
+    /**
+    * Aktualizuj wskazany plik
+    *
+    * @param string $file        plik wzglêdem $DOCUMENT_ROOT/../ np. soteesklep3/htdocs/index.php
+    * @param string $file_source zawarto¶æ pliku, jesli warto¶c nie jest domy¶lnie pobierana z pakietu upgrade
+    * @param int    $type        UPGRADE_FILE_SUM - zapisz dane w sum.md5, UPGRADE_FILE_MOD - nie zpisuj w sum.md5
+    * @param int    $mode        0 - defult, UPGRADE_SAVE_MOD - zapisz zawarto¶c pliku w bazie, nie instaluj go
+    *
+    * @access public
+    * @return bool true upgrade OK, false w p.w.
+    */
+    function upgradeFile($file,$file_source='',$type=UPGRADE_FILE_SUM,$mode=0) {
+        global $ftp,$DOCUMENT_ROOT,$config;
+        global $shop;
+
+        if ($this->_version<0) {
+            global $_REQUEST;
+            if (! empty($_REQUEST['file']['patch_version'])) {
+                $this->_version=intval($_REQUEST['file']['patch_version']);
+                if (! $this->_version>0) {
+                    die ("Error: Wrong version number");
+                }
+            }
+        }
+
+        $db_data=array();
+        $db_data['file']=ereg_replace("soteesklep3",".",$file);
+        $db_data['date_add']=date("Y-m-d");
+        $db_data['version_name']=$this->_version;
+        $db_data['upgrade_file']=basename($this->upgradeFile);
+
+        if (empty($file_source)) {
+            $file_source=$this->getFile($file);             // pobierz zawarto¶æ wskazanego pliku z pakietu upgrade
+            $this->_source=$file_source;
+        }
+
+        $file_name=basename($file);                         // odczytaj nazwê pliku
+        $file_name_copy=$this->_version."-".$file_name;     // nazwa kopii pliku
+        $file_dir=dirname($file);                           // katalog wzglêdem $DOCUMENT_ROOT/../ np. soteesklep3/htdocs
+
+        if (@$shop->home!=1) {
+            $file_current=$DOCUMENT_ROOT."/../../$file_dir/$file_name";
+        } else {
+            // home.pl
+            // rozró¿nij katalogi soteesklep3/admin/include i soteesklep3/include
+            // na home.pl /include wskazuje na soteesklep3/admin.include a nie na g³ówny katalog
+            // odwo³ania do g³ównego katalogu, przekieruj na soteesklep3/admin/htdocs/base/include
+            foreach ($this->_base_dirs as $dir) {
+                if (ereg("^soteesklep3/".$dir,$file_dir)) {
+                    $file_dir=preg_replace("/^soteesklep3\/".$dir."/",'soteesklep3/admin/htdocs/base/'.$dir,$file_dir);
+                }
+            }
+            $file_current=preg_replace("/^\/soteesklep3/","","/$file_dir/$file_name");
+            $file_current=preg_replace("/^\/admin/","",$file_current);
+        }
+
+        $file_new="$DOCUMENT_ROOT/tmp/upgrade_$file_name";
+        if (@$shop->home!=1) {
+            $file_copy=$DOCUMENT_ROOT."/../../$file_dir/$file_name_copy";
+        } else {
+            // home.pl
+            $file_copy=preg_replace("/^\/soteesklep3/","","/$file_dir/$file_name_copy");
+            $file_copy=preg_replace("/^\/admin/","",$file_copy);
+        }
+        $this->_file_copy=$file_copy;
+
+        // dla trybu UPGRADE_SAVE_MOD nie instaluj pliku tylko zapamietaj go w bazie
+        if (! $mode) {
+            // zapisz zrodla do tymczasowego pliku
+            if ($fd=fopen($file_new,"w+")) {
+                fwrite($fd,$file_source,strlen($file_source));
+                fclose($fd);
+                if ((file_exists($file_current)) && (! file_exists($file_copy))) {
+                    // zrob kopie starej wersji pliku
+                    $ftp->put($file_current,$config->ftp['ftp_dir']."/../$file_dir",$file_name_copy);
+                }
+                // aktualizuj katalogi, za³ó¿ odpowiednie katalogi, je¶li nie ma ich w obecnym drzewie programu
+                $this->_mkDir($file_dir);
+                // aktualizuj plik
+                $ftp->put($file_new,$config->ftp['ftp_dir']."/../$file_dir",$file_name);
+                unlink($file_new);
+
+                if ($type==UPGRADE_FILE_SUM) {
+                    // oblicz sumê kontroln± zainstalowanego pliku  i zapamiêtaj j± w bazie sum kontrolnych
+                    $file_dir2=preg_replace("/^soteesklep3/","",$file_dir);
+                    $file_fc=".".$file_dir2."/$file_name";                  // np. ./admin/index.php
+                    $file_fc_path=$DOCUMENT_ROOT."/..".$file_dir2."/$file_name";  // np. /home/sklep/soteesklep3/admin/index.php
+                    $fc =& new FileChecksum($file_fc_path,FILE_CHECKSUM_FILE);
+                    $file_checksum=$fc->getChecksum();
+                    $fc->set($file_fc,$file_checksum);
+                }
+            } else return false;
+        } else {
+            // @todo dodac zapapietanie w bazie danych zawartosci pliku dla danej sesji.
+            // ...
+        }
+
+        return true;
+    } // end upgradeFile()
+
+    /**
+    * Odczytaj pe³n± scie¿kê (z katalogiem sklepu) do kopii pliku (np. soteesklep3/htdocs/8-index.php)
+    *
+    * \@global string $this->_file_copy np. /usr/home/maroslaw/MYCVS2/soteesklep2/admin/../../soteesklep3/htdocs/8-index.php
+    * @return string np. soteesklep3/htdocs/8-index.php
+    */
+    function getLastFileCopyName() {
+        if (! empty($this->_file_copy)) {
+            preg_match("/soteesklep[0-9]{1}(.*)$/",$this->_file_copy,$matches);
+            if (! empty($matches[1])) {
+                return ereg_replace('/admin/../../','',$matches[1]);
+            }
+        }
+        return '';
+    } // end getlastFileCopyName()
+
+    /**
+    * Za³ó¿ wskazany katalog, jesli nie ma go w systemie plików
+    *
+    * @param string $dir ¶cie¿ka do katalogu wzglêdem soteesklep3
+    * @return bool
+    */
+    function _mkDir($dir) {
+        global $DOCUMENT_ROOT,$ftp,$config;
+
+
+        $dir=preg_replace("/^soteesklep[0-9]\//","",$dir);
+
+        if (! is_dir("$DOCUMENT_ROOT/../".$dir)) {
+            $this->_mkRecSubDir($dir);
+            $ftp->mkdir($config->ftp['ftp_dir']."/".$dir);
+        }
+        return true;
+    } // end _mkDir()
+
+    /**
+    * Za³ó¿ rekurencyjnie wskazany katalog (poza ostatnim)
+    * Funkcja rekurencyjna.
+    *
+    * @param string $dir katalog wzglêdem g³ównego katalogu soteesklep3
+    *
+    * @access private
+    * @return bool true - katalog za³ozony, false - w p.w.
+    */
+    function _mkRecSubDir($dir) {
+        global $ftp,$config,$DOCUMENT_ROOT;
+
+        // obetnij ostatni katalog i sprawd¼, czy poziom wy¿ej mo¿ña za³o¿yæ podkatalog
+        $last_dir=basename($dir);
+
+        $dir2=$dir;
+
+        $dir=substr($dir,0,strlen($dir)-strlen($last_dir)-1);
+        $test_dir="$DOCUMENT_ROOT/../$dir";
+
+        if (is_dir($test_dir)) {
+            $ftp->mkdir($config->ftp['ftp_dir']."/".$dir2);
+            return true;
+        } else {
+            if ($this->_mkdirCount<MKDIR_MAX_COUNT) {
+                $this->_mkdirCount++;
+                $this->_mkRecSubDir($dir);
+                return;
+            }
+        }
+    } // end _mkRecSubDir()
+
+    /**
+    * Odczytaj numer upgrade'u
+    * @return int numer wersji aktualizacji
+    */
+    function getVersion() {
+        return $this->_version;
+    } // end getVersion();
+
+    // {{{ saveModFile()
+
+    /**
+    * Zapisz w bazie danych zawarto¶æ po³±czonego pliku.
+    *
+    * @param string $file_name     ¶cie¿ka do pliku wzglêdem soteesklepX + nazwa pliku
+    * @param string $new_file      zawarto¶c pliku, warto¶æ zapisywana w bazie
+    * @param int    $patch_version numer wersji pakietu aktualizacyjnego
+    *
+    * @return bool
+    */
+    function saveModFile($file_name,$new_file,$patch_version) {
+        global $sess,$db;
+        global $mdbd;
+
+        // sprawd¼ czy wpis ju¼ istnieje
+        $query="SELECT id FROM upgrade_files WHERE path=? AND source=? AND session_id=? AND pkg_number=?";
+        $prepared_query=$db->prepareQuery($query);
+        if ($prepared_query) {
+            $db->QuerySetText($prepared_query,1,$file_name);
+            $db->QuerySetText($prepared_query,2,$new_file);
+            $db->QuerySetText($prepared_query,3,$sess->id);
+            $db->QuerySetInteger($prepared_query,4,$patch_version);
+            $result=$db->executeQuery($prepared_query);
+            if ($result!=0) {
+                $num_rows=$db->numberOfRows($result);
+                if ($num_rows>0) {
+                    return true;
+                }
+            } else die ($db->error());
+        } else die ($db->error());
+
+        $query2="INSERT INTO upgrade_files (path,source,session_id,pkg_number) VALUES (?,?,?,?)";
+        $prepared_query2=$db->prepareQuery($query2);
+        if ($prepared_query2) {
+            $db->QuerySetText($prepared_query2,1,$file_name);
+            $db->QuerySetText($prepared_query2,2,$new_file);
+            $db->QuerySetText($prepared_query2,3,$sess->id);
+            $db->QuerySetInteger($prepared_query2,4,$patch_version);
+            $result2=$db->executeQuery($prepared_query2);
+            if ($result2!=0) {
+                return true;
+            }
+        } else die ($db->error());
+
+        return false;
+    } // end saveModFile()
+
+    // }}}
+
+    // {{{ showReportUpgradeDB
+
+    /**
+    * Poka¿ raport o plikach zainstalowanych w buforze dla danej sesji
+    * Funckja dla debugowania.
+    *
+    * @return void
+    */
+    function showReportUpgradeDB() {
+        global $sess,$mdbd;
+        $data=$mdbd->select("id,path,pkg_number","upgrade_files","session_id=?",array($sess->id=>"text"));
+        print "pliki w buforze:<br />\n";
+        print "<pre>";print_r($data);print "</pre>";
+        return;
+    } // end showReportUpgradeDB()
+
+    // }}}
+
+    // {{ getFileFromDB()
+
+    /**
+    * Sprawd¼ czy plik jest w buforze, je¶li jest to odczytaj jego zawarto¶æ
+    *
+    * @param string $file 
+    * @return string zawarto¶c pliku w buforze lub ci±g pusty (void)
+    */
+    function getFileFromDB($file) {
+        global $mdbd,$sess;
+        $source=$mdbd->select("source","upgrade_files","session_id=? AND path=?",array($sess->id=>"text",$file=>"text"),"LIMIT 1");
+        if (! empty($source)) return $source;
+        return;
+    } // end getFileFromDB()
+
+    // }}}
+
+
+} // end class DiffUpgrade
+
+?>
diff -ruN ../soteesklep3/admin/go/_upgrade/include/upgrade_menu_25.inc.php soteesklep3/admin/go/_upgrade/include/upgrade_menu_25.inc.php
--- ../soteesklep3/admin/go/_upgrade/include/upgrade_menu_25.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_upgrade/include/upgrade_menu_25.inc.php	2006-08-23 16:58:51.000000000 +0200
@@ -0,0 +1,39 @@
+<?php
+/**
+* Menu z dodatkowymi opcjami dot. aktualziacji wersji
+*
+* @author  m@sote.pl
+* @version $id$
+* @package    upgrade
+*/
+
+require_once ("include/ver2.5/upgrade_order.inc.php");
+$upgrade_order =& new UpgradeOrder();
+
+$_upgrade25=$mdbd->select("id","`upgrade`","name='2530'",array(),"LIMIT 1");
+
+if (($upgrade_order->checkDB25()) && (! $_upgrade25)) {
+    $buttons =& new Buttons;
+    $_order=0;$_user=0;
+    if ($mdbd->select("id","order_register","record_version!='30'",array(),"LIMIT 1")>0) {
+        $buttons->button($lang->upgrade_25_menu['order'],"upgrade_25_order.php");   
+        $_order=1;
+    }
+    if ($mdbd->select("id","users","record_version!='30'",array(),"LIMIT 1")>0) {
+        $buttons->button($lang->upgrade_25_menu['users'],"upgrade_25_user.php");   
+        $_user=1;
+    }
+    if (($_user==0) && ($_order==0)) {
+        $mdbd->insert("`upgrade`","name,date_add,description","?,?,?",
+        array(
+        "1,".'2530'=>"text",
+        "2,".date("Y-m-d")=>"text",
+        "3,".$lang->upgrade_25_description=>"text"       
+        )
+        );
+    }
+ 
+} 
+
+print "<br />\n";
+?>
diff -ruN ../soteesklep3/admin/go/_upgrade/index.php soteesklep3/admin/go/_upgrade/index.php
--- ../soteesklep3/admin/go/_upgrade/index.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_upgrade/index.php	2006-08-23 16:58:50.000000000 +0200
@@ -0,0 +1,209 @@
+<?php
+/**
+* Upgrade pakietu. Automatyczna aktualizacja programu.
+* Strona z formularzem za³±czenia pakietu upgrade oraz odczytanie za³±czonego pliku.
+*
+* @author m@sote.pl
+* @version $Id: index.php,v 1.23 2006/08/16 10:21:22 lukasz Exp $
+* @package    upgrade
+*/
+
+// naglowek php
+$global_database=true;$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+require_once ("../../../include/head.inc");
+// end naglowek php
+
+/**
+* Dodaj obs³ugê sprawdzania wersji bazy danych i sklepu
+*/
+require_once ("./include/check_version.inc.php");
+
+// naglowek
+$theme->head();
+$theme->page_open_head();
+print "<script>";
+include_once ("./html/script.js");
+print "</script>";
+
+include_once ("./include/menu.inc.php");
+$theme->bar($lang->upgrade_title);
+
+print "<p />\n";
+
+$file_md5="$DOCUMENT_ROOT/../sum.md5";
+if (! file_exists($file_md5)) {
+
+    print "<p />$lang->upgrade_nomd5_info <p /> <a href=download_md5.php><u>$lang->upgrade_md5_install</u></a>\n";
+
+    $theme->page_open_foot();
+    $theme->foot();
+    include_once ("include/foot.inc");
+    exit;
+}
+
+if (empty($_FILES['upgrade_pkg']['name'])) {
+
+    
+    // formularsz html do zaladowania pakietow
+    include_once ("./html/upgrade.html.php");
+
+    $upgrade_data=$mdbd->select("id,date_add,name,description,version,filename,status","`upgrade`",1,array(),"ORDER BY id DESC LIMIT 10","ARRAY");
+
+    if (! empty($upgrade_data)) {
+        print $lang->upgrade_prev."<p />\n";
+        print "<ul>\n";
+        foreach ($upgrade_data as $num=>$dat) {
+            // print "<pre>";print_r($dat);print "</pre>";
+            print "<li>".$dat['date_add']." ".sprintf("%05d",$dat['version'])." ".$dat['name']." ".$dat['description']." ";
+            if (! empty($dat['filename'])) {
+                print " (".$dat['filename'].") ";
+            }
+
+            if ($dat['status']=="Modified") {
+                print "<font color=\"red\">$lang->upgrade_modified</font>\n";
+            }
+            print "</li>\n";
+        }
+        print "</ul>\n";
+    }
+
+} else {
+
+    $file_name=$_FILES['upgrade_pkg']['name'];
+    if (! ereg("\.spk\.tar\.gz$",$file_name)) {
+        print "<font color=\"red\">$lang->upgrade_error_ext</font>\n";
+
+        // formularsz html do zaladowania pakietow
+        include_once ("./html/upgrade.html.php");
+    } else {
+        require_once ("include/ftp.inc.php");
+        $ftp->connect();
+        $file_tmp=$_FILES['upgrade_pkg']['tmp_name'];
+
+        print "<p />\n".$lang->upgrade_files_simulation."<p .>\n";
+        
+        /**
+         * Zapamietaj w admin/upgrade pakiet. Rozpakuj upgrade_XXX.spk.gz         
+         */
+        // zapisz pakiet tar.gz w ./admin/upgrade
+        if ($ftp->put($file_tmp,$config->ftp['ftp_dir']."/admin/upgrade/",$file_name)) {
+            require_once("Packer/packer.php");
+            $packer =& new packer($file_tmp);
+            $packer->unpack();
+
+            // print "<pre>";
+            // print_r ($packer->filestruct);
+            // print "</pre>";
+
+            print "<table cellspacing=\"0\" cellpadding=\"0\">\n";
+            foreach ($packer->filestruct as $file_tmp_pk=>$file_path_pk) {
+                // analiza poszczególnych plików
+                // mo¿na wy¶wietliæ tu jaki¶ komubnikat itp.   
+                print "<tr>\n";             
+                print "<td>";$theme->point("g");print "</td>";
+                
+                if (ereg("^./",$file_path_pk)) {
+                    $file_path_pk_view=substr($file_path_pk,2,strlen($file_path_pk)-2);
+                } else $file_path_pk_view=$file_path_pk;
+                
+                print "<td>";print "&nbsp;".$file_path_pk_view;print "</td>\n";
+                // skasuj pliki z testu instalacji
+                if (! ereg(".spk$",$file_tmp_pk)) {         
+                    unlink("$DOCUMENT_ROOT/tmp/$file_tmp_pk");
+                }
+                print "</tr>\n";
+            }
+            print "</table>\n";
+            
+            // na koñcu listy jest plik upgrade_XXX.spk i zmienna $file_tmp zawiera ¶eciêzke do tego pliku
+            $file_tmp=$DOCUMENT_ROOT."/tmp/".$file_tmp_pk;
+            // obetnij .tar.gz
+            $file_name=substr($file_name,0,strlen($file_name)-7);
+            
+            print "<p />\n";
+        } else {
+            die ($lang->upgrade_error_save_pkg);
+        }
+        // end
+
+        if ($ftp->put($file_tmp,$config->ftp['ftp_dir']."/admin/upgrade/",$file_name)) {
+
+            print $lang->upgrade_file_uploaded." <b>$file_name</b><p />\n";
+
+            $upgrade_file=$DOCUMENT_ROOT."/upgrade/$file_name";
+            require_once ("./include/upgrade.inc.php");
+            $upgrade =& new DiffUpgrade($upgrade_file);
+            //print "<p />\n".$lang->upgrade_files_list."<p />\n";
+            //$upgrade->showListFiles();            
+            $result_test=$upgrade->doUpgrade(UPGRADE_SIMULATION);
+            $upgrade->showUpgradeInfo();
+
+            // print "<pre>";print_r($upgrade);print "</pre>";
+
+            if ($result_test!=-1) {
+
+                print "<form action=upgrade.php>\n";
+                print "<input type=hidden name=upgrade_pkg value=\"$file_name\">\n";
+                if ($upgrade->upgrade_status==0) {
+                    print "<p />\n";
+                    print "<input type=submit value=\"$lang->upgrade_update\">\n";
+                } else {
+                    if ($result_test>-1) {
+                        print "<p /><font color=\"red\">$lang->upgrade_update_not_allowed</font><p />\n";
+                        print "<input type=checkbox name=upgrade_hard_install value=1 onclick='ToggleTextarea(this);'><i>$lang->upgrade_hard_install</i>\n";
+
+                        print "
+            <div id='d_textarea' name='d_textarea' style='display: none;'>
+                <textarea cols=80 rows=8>$lang->upgrade_terms</textarea><br>
+                <input type=checkbox name=drugi_checkbox value=1 onclick='ToggleSubmit(this);'>$lang->upgrade_accept
+                <br>
+            </div>
+            <div id='d_submit' name='d_submit' style='display: none;'>
+                <input type=submit value='$lang->upgrade_update'>
+            </div>
+            ";
+                    } else {
+                        // nie mo¿na aktualizowaæ pakietu, wyst±pi³y konflikty
+                    }
+
+                }
+                print "</form>";
+                print "<p />\n";
+                $upgrade->legend();
+
+            } // end if ($result_test!=-1)
+        } // end if (ftp_put(...)
+        else {
+            // nie uda³o siê za³±czyæ aktualizacji
+        }
+
+        $ftp->close();
+    }
+
+    // tmp: debug info
+    // $upgrade->showReportUpgradeDB();
+}
+
+
+// usuñ pliki konfiguracyjne pakietu instalacyjnego
+require_once ("include/ftp.inc.php");
+$ftp->connect();
+
+if (file_exists($DOCUMENT_ROOT."/../000-upgrade_config.php")) {
+    $ftp->delete($config->ftp['ftp_dir'],"000-upgrade_config.php");
+}
+if (file_exists($DOCUMENT_ROOT."/../-1-000-upgrade_config.php")) {
+    $ftp->delete($config->ftp['ftp_dir'],"-1-000-upgrade_config.php");
+}
+$ftp->close();
+
+// dodaj menu upgrade'ow z wersji 2.5->3.0
+include_once ("./include/upgrade_menu_25.inc.php");
+
+$theme->page_open_foot();
+
+// stopka
+$theme->foot();
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/admin/go/_upgrade/upgrade.php soteesklep3/admin/go/_upgrade/upgrade.php
--- ../soteesklep3/admin/go/_upgrade/upgrade.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_upgrade/upgrade.php	2006-08-23 16:58:50.000000000 +0200
@@ -0,0 +1,175 @@
+<?php
+/**
+* Wykonanie aktualizacji wg za³±czonego pakietu.
+*
+* @author  m@sote.pl
+* @version $Id: upgrade.php,v 1.15 2006/08/16 10:21:22 lukasz Exp $
+* @package    upgrade
+*/
+
+// naglowek php
+$global_database=true;$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+require_once ("../../../include/head.inc");
+// end naglowek php
+
+// naglowek
+$theme->head();
+$theme->page_open_head();
+
+include_once ("./include/menu.inc.php");
+$theme->bar($lang->upgrade_title);
+
+print "<p />\n";
+require_once ("include/upgrade.inc.php");
+
+if (! empty($_REQUEST['upgrade_pkg'])) {
+    $file=$_REQUEST['upgrade_pkg'];
+    $file=ereg_replace("\.\.","",$file);
+    $file=$DOCUMENT_ROOT."/upgrade/".$file;
+
+    // odczytaj pakiet tar.gz
+    $file_tgz=$file.".tar.gz";
+    require_once("Packer/packer.php");
+    $packer =& new packer($file_tgz);
+    $packer->unpack();
+
+    // print "<pre>";
+    // print_r($packer->filestruct);
+    // print "</pre>";
+
+
+    print $lang->upgrade_files." (<b>".basename($file)."</b>):<p />";
+
+    $ftp->connect();
+
+    print "<table cellspacing=\"0\" cellpadding=\"0\">\n";
+    foreach ($packer->filestruct as $file_tmp_pk=>$file_path_pk) {
+        if (! ereg(".spk$",$file_tmp_pk)) {
+
+            // zainstaluj plik
+            $file_path_1=$DOCUMENT_ROOT."/tmp/$file_tmp_pk";
+            $file_name_1=basename($file_path_pk);$l_file_name=strlen($file_name_1);
+            $file_dir=substr($file_path_pk,0,strlen($file_path_pk)-$l_file_name-1);
+            $file_dir_1=substr($file_dir,strlen("./soteesklep3/"),strlen($file_dir)-strlen("./soteesklep3/"));
+
+            if (ereg("^./",$file_path_pk)) {
+                $file_path_pk_view=substr($file_path_pk,2,strlen($file_path_pk)-2);
+            } else $file_path_pk_view=$file_path_pk;
+
+
+            if ($ftp->put($file_path_1,$config->ftp['ftp_dir']."/".$file_dir_1,$file_name_1)) {
+
+                // print "FTP:local=$file_path_1 ".$config->ftp['ftp_dir']."/".$file_dir_1." $file_name_1 <br />\n";
+                // analiza poszczególnych plików
+                // mo¿na wy¶wietliæ tu jaki¶ komubnikat itp.
+                print "<tr>\n";
+                print "<td>";$theme->point("g");print "</td>";
+
+
+                print "<td>";print "&nbsp;".$file_path_pk_view;print "</td>\n";
+                print "</tr>\n";
+            } else {
+                // nie uda³o siê zainstalowac pliku graficznego
+                print "<tr>\n";
+                print "<td>";$theme->point("black");print "</td>";
+
+                print "<td>";print "&nbsp;".$file_path_pk_view;print "</td>\n";
+                print "</tr>\n";
+            }
+
+            unlink("$DOCUMENT_ROOT/tmp/$file_tmp_pk");
+        } else {
+            $spk_file=$DOCUMENT_ROOT."/tmp/$file_tmp_pk";
+        }
+    }
+    print "</table>\n";
+}
+// end
+
+
+if (file_exists($file)) {
+    $upgrade =& new DiffUpgrade($file);
+
+    if ($upgrade->doUpgrade()) {
+        $upgrade_status=$upgrade->showUpgradeInfo(UPGRADE_INSTALL_AUTO_MODE);
+
+        $ver=$mdbd->select("version","`upgrade`","version=?",array($upgrade->getVersion()=>"text"),"LIMIT 1");
+        if (empty($ver)) {
+
+
+            // sprawd¼, czy dla danej sesji i dla danego pakietu s± jakie¶ po³±czone zmiany
+            $mod=$mdbd->select("id","upgrade_files","session_id=? AND pkg_number=?",
+            array($sess->id=>"text",$upgrade->getVersion()=>"int"),"LIMIT 1");
+
+            if ($mod>0) {
+                // wykryto modyfikacje, zapisz pakiet jako zmieniony
+                $modifications='Modified';
+            } else {
+                $modifications='OK';
+            }
+
+            // print "<pre>";print_r($mod);print "</pre>";
+
+            $mdbd->insert("`upgrade`","date_add,version,filename,status","?,?,?,?",
+            array
+            (
+            "1,".date("Y-m-d")=>"text",
+            "2,".$upgrade->getVersion()=>"text",
+            "3,".basename($file)=>"text",
+            "4,".$modifications=>"text",
+            ));
+
+
+
+            /**
+            * Za³aduj modyfikacje bazy SQL (lub nowe tabele itp.)
+            */
+            $version_upgrade=$upgrade->getVersion();
+            $version_pkg=$version_upgrade;
+            require_once ("./include/upgrade_database.inc.php");
+
+            /**
+            * Za³aduj plik konfiguracyjny pakietu i wykonaj procedury jego obs³ugi. 
+            */
+            require_once ("./include/upgrade_conf.inc.php");
+
+            /**
+            * Dodaj wykoanie skryptu po za³adowaniu patcha ./soteesklep3/exe/$ver.php
+            */
+            @include_once ("exe/$ver.php");
+        
+            // usuñ pliki SQL i PHP (exe) oraz pakiet
+            $file_sql=$DOCUMENT_ROOT."/../sql/upgrade_".$version_upgrade.".mysql";            
+            $file_php=$DOCUMENT_ROOT."/../exe/$version_upgrade.php";
+           
+            $ftp->connect();             
+            
+            if (file_exists($file_sql)) {
+                // print "<br>file_sql=$file_sql";
+                $ftp->delete($config->ftp['ftp_dir']."/sql/","upgrade_".$version_upgrade.".mysql");
+            }
+            if (file_exists($file_php)) {                                
+                //print "<br>file_php=$file_php";                
+                $ftp->delete($config->ftp['ftp_dir']."/exe/",$version_upgrade.".php");
+            }
+            // usuñ plik pakietu spk
+            unlink($spk_file);
+            // end
+            
+        } // end if (empty($ver))
+
+        print "<p /><b>$lang->upgrade_done</b><p />\n";
+
+    } // end if ($upgrade->doUpgrade())
+
+} // if file_exists($file))
+
+$ftp->close();
+
+$theme->page_open_foot();
+
+// stopka
+$theme->foot();
+include_once ("include/foot.inc");
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/include/allegro.inc.php soteesklep3/admin/include/allegro.inc.php
--- ../soteesklep3/admin/include/allegro.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/include/allegro.inc.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,657 @@
+<?php
+/**
+ * Klasa do komunkacji z Allegro.
+ * Podstawowe funkcje
+ *
+ */
+include_once("config/auto_config/allegro_config.inc.php");
+include_once("NuSOAP/nusoap.php");
+include_once("include/metabase.inc");
+include_once('lib/ConvertCharset/ConvertCharset.class.php');
+
+class Allegro {
+
+    var $_debug=0;              // czy tryb debugowania
+
+    /**
+	 * Enter description here...
+	 *
+	 * @return Allegro
+	 */
+    function Allegro() {
+
+    } // end func Allegro
+
+    /**
+	 * Pobranie drzewa kategorii z Allegro.pl
+	 *
+	 */
+    function getCategory()
+    {
+        global $_SESSION;
+        global $allegro_config;
+        global $lang;
+        global $database;
+        // ustawienie parametów wywo³ania SOAP
+
+        // jesli allegro jest w trybie produkcyjnym to
+        if($allegro_config->allegro_mode == 'true') {
+            $parameters = array(
+            $allegro_config->allegro_country_code,          // kod kraju
+            $allegro_config->allegro_version,               // numer wersji WEBAPI
+            $allegro_config->allegro_web_api_key,           // klucz WEBAPI allegro
+            );
+        } else {
+            $parameters = array(
+            $allegro_config->allegro_country_code_test,     // kod kraju
+            $allegro_config->allegro_version_test,          // numer wersji WEBAPI
+            $allegro_config->allegro_web_api_key,           // klucz WEBAPI allegro
+            );
+        }
+        // stworzenie obiektu SOAP
+        $client = new soapclient($allegro_config->allegro_server,true);
+        $client->decode_utf8=false;
+        // pobranie b³êdów je¶li trakie by³y
+        $errors = $client->getError();
+        if ($errors) {
+            // Wyswietlenie bledow wywoalania - niepowodzenie
+            echo '<h2>Blad </h2><pre>' . $errors . '</pre>';
+        }
+        // wywo³anie metody
+        $response = $client->call('doGetCatsData',$parameters);
+        if(!empty($response['faultcode'])) {
+            $convertChar = new ConvertCharset();
+            $afterChange = $convertChar->Convert($response['faultstring'],'utf-8','iso-8859-2');
+         	print $afterChange;
+        } else {
+            if($this->_debug) {
+                print "<pre>";
+                print_r($response);
+                print "</pre>";
+            }
+            $this->saveCategory($response);
+            // sprawdzamy czy do bazy zostaly zapisane kategorie
+            $count=$database->sql_select("count(*)","allegro_cat");
+            if($count) {
+                if($allegro_config->allegro_mode == 'true') {
+                    if($response['ver-key']=$allegro_config->allegro_version) {
+                        print "<center>".$lang->get_category_ok."<center>";
+                    }
+                } else {
+                    if($response['ver-key']=$allegro_config->allegro_version_test) {
+                        print "<center>".$lang->get_category_ok."<center>";
+                    }
+                }
+            } else {
+                print $lang->allegro_error_auction['category'];
+            }
+        }
+    } // end func getCategory
+
+    /**
+     * Enter description here...
+     *
+     */
+    function getOther()
+    {
+        global $_SESSION;
+        global $allegro_config;
+        global $lang;
+        // ustawienie parametów wywo³ania SOAP
+		
+        // jesli allegro jest w trybie produkcyjnym to
+        if($allegro_config->allegro_mode == 'true') {
+            $parameters = array(
+            $allegro_config->allegro_country_code,      // kod kraju
+            $allegro_config->allegro_version,            // numer wersji WEBAPI
+            $allegro_config->allegro_web_api_key,       // klucz WEBAPI allegro
+            );
+        } else {
+            $parameters = array(
+            $allegro_config->allegro_country_code_test,      // kod kraju
+            $allegro_config->allegro_version_test,            // numer wersji WEBAPI
+            $allegro_config->allegro_web_api_key,       // klucz WEBAPI allegro
+            );
+        }
+        // stworzenie obiektu SOAP
+        $client = new soapclient($allegro_config->allegro_server, true);
+        
+        $client->decode_utf8=false;
+        // pobranie b³êdów je¶li trakie by³y
+        $errors = $client->getError();
+        if ($errors) {
+            // Wyswietlenie bledow wywoalania - niepowodzenie
+            echo '<h2>Blad </h2><pre>' . $errors . '</pre>';
+        }
+        // wywo³anie metody
+        $response = $client->call('doGetSellFormFieldsExt',$parameters);
+        if(!empty($response['faultcode'])) {
+            // jest jakis b³±d
+            $convertChar = new ConvertCharset();
+            print $convertChar->Convert($response['faultstring'],'utf-8','iso-8859-2');
+        } else {
+            if($this->_debug) {
+                print "<pre>";
+                print_r($response);
+                print "</pre>";
+            }
+            $this->prepareOther($response['sell-form-fields']);
+            if($allegro_config->allegro_mode == 'true') {
+                if($response['ver-key']=$allegro_config->allegro_version) {
+                    print "<center>".$lang->get_other_ok."<center>";
+                }
+            } else {
+                if($response['ver-key']=$allegro_config->allegro_version_test) {
+                    print "<center>".$lang->get_other_ok."<center>";
+                }
+            }
+        }
+        
+        
+        
+    } // end func getOther
+
+    /**
+     * Funkcja parsuje dane z prametrow allegro i zwraca tablice asocjacyjna
+     *
+     * @param array  data  dane z allegro
+     * @param string index index tablicy 
+     *
+     * @return array $tab
+     */
+    function prepareArray(& $data, $index)
+    {
+        $tab=array();
+        $sell_form_desc=preg_split("/\|/",$data[$index]['sell-form-desc'],-1,PREG_SPLIT_NO_EMPTY);
+        $sell_form_opts_values=preg_split("/\|/",$data[$index]['sell-form-opts-values'],-1,PREG_SPLIT_NO_EMPTY);
+        foreach($sell_form_desc as $key=>$value) {
+            $tab= $tab+array($sell_form_opts_values[$key]=>$this->utf8_to_8859($value));
+        }
+        return $tab;
+    } // end func prepareArray
+
+    /**
+     * Pobranie innych danych z allegro
+     *
+     * @param array  data  dane z allegro
+     *
+     * @return boolean true/false
+     */
+    function prepareOther(& $data)
+    {
+        //pobierz czas trwania aukcji
+        $this->allegro_time=array();
+        if($data[3]['sell-form-id'] == 4) {
+            $this->allegro_time = $this->prepareArray(& $data, 3);
+        }
+        // pobierz województwa
+        if($data[9]['sell-form-id'] == 10) {
+            $this->allegro_states = $this->prepareArray(& $data, 9);
+        }
+        // transport
+        if($data[11]['sell-form-id'] == 12) {
+            $this->allegro_trans = $this->prepareArray(& $data, 11);
+        }
+        return true;
+    } // end func prepareOther
+
+    /**
+	 * Zapisanie katergorii do bazy danych
+	 *
+     * @param array category
+     *
+     * @return boolean true/false
+	 */
+    function saveCategory(& $category)
+    {
+        global $database;
+        // skasuj zawartosc tablicy
+        $database->sql_delete("allegro_cat");
+        // przejdz po tablicy i zapisz kategrii do bazy danych
+        foreach($category['cats-list'] as $key=>$value) {
+            $database->sql_insert("allegro_cat",array(
+            "id"=>"",
+            "cat_id"=>$value['cat-id'],
+            "cat_name"=>$this->utf8_to_8859($value['cat-name']),
+            "cat_parent"=>$value['cat-parent'],
+            "cat_position"=>$value['cat-position'],
+            ));
+        }
+        return true;
+    } // end func saveCategory
+
+    /**
+     * Logowanie do systemu allegro.pl. Po zalogowaniu otrzymujemy numer sesji
+     *
+     * @return boolean true/false
+     */
+    function Login()
+    {
+        global $allegro_config;
+        global $allegro;
+        global $sess;
+        // ustawienie parametów wywo³ania SOAP
+
+        // jesli allegro jest w trybie produkcyjnym to
+        if($allegro_config->allegro_mode == 'true') {
+            $parameters = array(
+            $allegro_config->allegro_login,             // login w allegro
+            $allegro_config->allegro_password,          // has³o w allegro
+            $allegro_config->allegro_country_code,      // kod kraju
+            $allegro_config->allegro_web_api_key,       // klucz WEBAPI allegro
+            $allegro_config->allegro_version            // numer wersji WEBAPI
+            );
+        } else {
+            // tryb testowy
+            $parameters = array(
+            $allegro_config->allegro_login_test,             // login w allegro
+            $allegro_config->allegro_password_test,          // has³o w allegro
+            $allegro_config->allegro_country_code_test,      // kod kraju
+            $allegro_config->allegro_web_api_key,       // klucz WEBAPI allegro
+            $allegro_config->allegro_version_test            // numer wersji WEBAPI
+            );
+        }
+        // stworzenie obiektu SOPA
+        $client = new soapclient($allegro_config->allegro_server, true);
+        // pobranie b³êdów je¶li trakie by³y
+        $errors = $client->getError();
+        if ($errors) {
+            // Wyswietlenie bledow wywoalania - niepowodzenie
+            echo '<h2>Blad </h2><pre>' . $errors . '</pre>';
+        }
+        // wywo³anie metody
+        $response = $client->call('doLogin',$parameters);
+
+        // sprawdz
+        if(!empty($response['session-handle-part'])) {
+            $allegro=$response;
+            $sess->register("allegro",$allegro);
+            return true;
+        } else {
+            print "<font color=red>";
+           	print "<b>Problem z zalogowaniem siê do systemu Allegro. Upewnij siê, ¿e masz za³o¿one konto w systmie Allegro.</b>";
+            print "</font>";
+        	return false;
+        }
+    } // end func Login
+
+    /**
+     * Wylogowanie z allegro ( skasowanie z sesji sklepu danych zwiazanych z allegro )
+     *
+     * @return boolean true/false
+     */
+    function Logout()
+    {
+        global $sess;
+        $sess->unregister("allegro");
+        return true;
+    } // end func Logout
+
+    /**
+     * Funkcja konwertujaca string z standardu utf-8 na iso-8859-2
+     *
+     * @param  string $string  ciag znakow,
+     *
+     * @return string $string  ciag znakow po konwersji
+     */
+    function & utf8_to_8859(&$string) {
+        $decode=array(
+        "\xC4\x84"=>"\xA1",
+        "\xC4\x85"=>"\xB1",
+        "\xC4\x86"=>"\xC6",
+        "\xC4\x87"=>"\xE6",
+        "\xC4\x98"=>"\xCA",
+        "\xC4\x99"=>"\xEA",
+        "\xC5\x81"=>"\xA3",
+        "\xC5\x82"=>"\xB3",
+        "\xC5\x83"=>"\xD1",
+        "\xC5\x84"=>"\xF1",
+        "\xC3\x93"=>"\xD3",
+        "\xC3\xB3"=>"\xF3",
+        "\xC5\x9A"=>"\xA6",
+        "\xC5\x9B"=>"\xB6",
+        "\xC5\xB9"=>"\xAC",
+        "\xC5\xBA"=>"\xBC",
+        "\xC5\xBB"=>"\xAF",
+        "\xC5\xBC"=>"\xBF"
+        );
+
+        $string = strtr("$string",$decode);
+        return $string;
+    } // end func utf8_to_8859
+
+    /**
+     * Funkcja konwertujaca string z standardu iso-8859-2 na utf-8
+     *
+     * @param  string $string  ciag znakow,
+     *
+     * @return string $string  ciag znakow po konwersji
+     */
+    function & iso8859_to_utf8(&$string) {
+        $decode=array(
+        "\xA1" => "\xC4\x84",
+        "\xB1" => "\xC4\x85",
+        "\xC6" => "\xC4\x86",
+        "\xE6" => "\xC4\x87",
+        "\xCA" => "\xC4\x98",
+        "\xEA" => "\xC4\x99",
+        "\xA3" => "\xC5\x81",
+        "\xB3" => "\xC5\x82",
+        "\xD1" => "\xC5\x83",
+        "\xF1" => "\xC5\x84",
+        "\xD3" => "\xC3\x93",
+        "\xF3" => "\xC3\xB3",
+        "\xA6" => "\xC5\x9A",
+        "\xB6" => "\xC5\x9B",
+        "\xAC" => "\xC5\xB9",
+        "\xBC" => "\xC5\xBA",
+        "\xAF" => "\xC5\xBB",
+        "\xBF" => "\xC5\xBC",
+        );
+        $string = strtr("$string",$decode);
+        return $string;
+    } // end func encoding_iso8859_2_to_utf8
+
+    /**
+     * Funkcja preparuje liste podkategorii dla kategorii g³ównej
+     *
+     * @param unknown $cat
+     */
+    function & prepareSubCat($cat,$default='')
+    {
+        global $database;
+        $str='';
+        $data1=$database->sql_select_data_array("cat_id","cat_name","allegro_cat","cat_parent=$cat");
+        foreach($data1 as $key1=>$value1) {
+            $count1=$database->sql_select("count(*)","allegro_cat","cat_parent=".$key1);
+            if($count1) {
+                $data2=$database->sql_select_data_array("cat_id","cat_name","allegro_cat","cat_parent=$key1");
+                foreach($data2 as $key2=>$value2) {
+                    $count2=$database->sql_select("count(*)","allegro_cat","cat_parent=".$key2);
+                    if($count2) {
+                        $data3=$database->sql_select_data_array("cat_id","cat_name","allegro_cat","cat_parent=$key2");
+                        foreach($data3 as $key3=>$value3) {
+                            $count3=$database->sql_select("count(*)","allegro_cat","cat_parent=".$key3);
+                            if($count3) {
+                                $data4=$database->sql_select_data_array("cat_id","cat_name","allegro_cat","cat_parent=$key3");
+                                foreach($data4 as $key4=>$value4) {
+                                    $count4=$database->sql_select("count(*)","allegro_cat","cat_parent=".$key4);
+                                    if($count4) {
+                                        $data5=$database->sql_select_data_array("cat_id","cat_name","allegro_cat","cat_parent=$key4");
+                                        foreach($data5 as $key5=>$value5) {
+                                            $count5=$database->sql_select("count(*)","allegro_cat","cat_parent=".$key5);
+                                            if($count5) {
+                                            } else {
+                                                if($default == $key5) $checked=" selected"; else $checked="";
+                                                $str.="<option  value=\"".$key5."\"".@$checked.">".$value1." >> ".$value2." >> ".$value3." >> ".$value4." >> ".$value5."</option>\n";
+                                            }
+                                        }
+                                    } else {
+                                        if($default == $key4) $checked=" selected"; else $checked="";
+                                        $str.="<option  value=\"".$key4."\"".@$checked.">".$value1." >> ".$value2." >> ".$value3." >> ".$value4."</option>\n";
+                                    }
+                                }
+                            } else {
+                                if($default == $key3) $checked=" selected"; else $checked="";
+                                $str.="<option  value=\"".@$key3."\"".@$checked.">".@$value1." >> ".@$value2." >> ".@$value3."</option>\n";
+                            }
+                        }
+                    } else {
+                        if($default == $key2) $checked=" selected"; else $checked="";
+                        $str.="<option  value=\"".@$key2."\"".@$checked.">".@$value1." >> ".@$value2."</option>\n";
+                    }
+                }
+            } else {
+                if($default == $key1) $checked=" selected"; else $checked="";
+                $str.="<option  value=\"".$key1."\"".@$checked.">".$value1."</option>\n";
+            }
+        }
+        return $str;
+    } // end func prepareSubCat
+
+    /**
+     * Funkcja buduje liste kategorii 
+     *
+     * @return string $str lista rozwiajana z aktywnymi kategoriami
+     */
+    function buildTree($default='')
+    {
+        global $allegro_config;
+        $str='<select class=form name="item[allegro_category]" size="1"><option value="default">----wybierz----</option>'."\n";
+        foreach($allegro_config->allegro_category as $key=>$value) {
+            $str.=$this->prepareSubCat($value,$default);
+        }
+        $str.="</select>\n";
+        return $str;
+    } // end func buildTree
+
+    /**
+     * Preparujemy aukcje dla okreslonego user_id
+     *
+     * @param string user_id
+     *
+     * @return array $param  tablica zawierajace wszytkie potrzebne paramtry do wystawienia aukcji
+     */
+    function & prepareAuction($user_id)
+    {
+        global $database;
+        global $allegro_config;
+        $data=$database->sql_select_multi_array4("*","allegro_auctions","user_id=".$user_id);
+/*		
+        if ($data[0]['allegro_auction_type'] == "2")
+        {
+        	$data[0]['allegro_price_start'] = "0";
+        	$data[0]['allegro_price_min'] = "0";
+        }
+        
+        if ($data[0]['allegro_auction_type'] == "1" and $data[0]['allegro_stock'] > "1")
+        {
+        	$data[0]['allegro_price_buy_now'] = "0";
+        }
+*/        
+        $param=array();
+        // tytul aukcji
+        $param[0]=array('fid'=>1,
+        'fvalue-string'=>$this->iso8859_to_utf8($data[0]['allegro_product_name']),
+        'fvalue-int'=>'','fvalue-float'=>'','fvalue-image'=>'','fvalue-text'=>'','fvalue-datetime'=>'','fvalue-boolean'=>'');
+
+        $param[1]=array('fid'=>2,'fvalue-string'=>'',
+        'fvalue-int'=>$data[0]['allegro_category'],
+        'fvalue-float'=>'','fvalue-image'=>'','fvalue-text'=>'','fvalue-datetime'=>'','fvalue-boolean'=>'');
+
+        $param[2]=array('fid'=>3,'fvalue-string'=>'','fvalue-int'=>'','fvalue-float'=>'','fvalue-image'=>'','fvalue-text'=>'',
+        'fvalue-datetime'=>time(),
+        'fvalue-boolean'=>'');
+
+        $param[3]=array('fid'=>4,'fvalue-string'=>'',
+        'fvalue-int'=>$data[0]['allegro_how_long'],
+        'fvalue-float'=>'','fvalue-image'=>'','fvalue-text'=>'','fvalue-datetime'=>'','fvalue-boolean'=>'');
+
+        $param[4]=array('fid'=>5,'fvalue-string'=>'',
+        'fvalue-int'=>$data[0]['allegro_stock'],
+        'fvalue-float'=>'','fvalue-image'=>'','fvalue-text'=>'','fvalue-datetime'=>'','fvalue-boolean'=>'');
+
+        $param[5]=array('fid'=>6,'fvalue-string'=>'','fvalue-int'=>'',
+        'fvalue-float'=>$data[0]['allegro_price_start'],
+        'fvalue-image'=>'','fvalue-text'=>'','fvalue-datetime'=>'','fvalue-boolean'=>'');
+
+        $param[6]=array('fid'=>7,'fvalue-string'=>'','fvalue-int'=>'',
+        'fvalue-float'=>$data[0]['allegro_price_min'],
+        'fvalue-image'=>'','fvalue-text'=>'','fvalue-datetime'=>'','fvalue-boolean'=>'');
+
+        $param[7]=array('fid'=>8,'fvalue-string'=>'','fvalue-int'=>'',
+        'fvalue-float'=>$data[0]['allegro_price_buy_now'],
+        'fvalue-image'=>'','fvalue-text'=>'','fvalue-datetime'=>'','fvalue-boolean'=>'');
+
+        if($allegro_config->allegro_mode == 'true') {
+            $param[8]=array('fid'=>9, 'fvalue-string'=>'',
+            'fvalue-int'=>$allegro_config->allegro_country_code,
+            'fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        } else {
+            $param[8]=array('fid'=>9, 'fvalue-string'=>'',
+            'fvalue-int'=>$allegro_config->allegro_country_code_test,
+            'fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        }
+
+        $param[9]=array('fid'=>10, 'fvalue-string'=>'',
+        'fvalue-int'=>$allegro_config->allegro_state_select,
+        'fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+
+        $param[10]=array('fid'=>11,
+        'fvalue-string'=>$this->iso8859_to_utf8($allegro_config->allegro_city),
+        'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+
+        $param[11]=array('fid'=>12, 'fvalue-string'=>'',
+        'fvalue-int'=>$data[0]['allegro_delivery_who_pay'],
+        'fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        
+        $delivery_options = $data[0]['allegro_delivery_shipment']+
+        				 	$data[0]['allegro_delivery_priority_shipment']+
+        				 	$data[0]['allegro_delivery_courier']+
+        				 	$data[0]['allegro_delivery_personal_acceptance']+
+        				 	$data[0]['allegro_delivery_other']+
+        				 	$data[0]['allegro_delivery_abroad'];
+
+        $param[12]=array('fid'=>13, 'fvalue-string'=>'',
+        'fvalue-int'=>$delivery_options,
+        'fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        
+        $pay_options = $data[0]['allegro_pay_wire_transfer']+
+        				 $data[0]['allegro_pay_collect_on_delivery']+
+        				 $data[0]['allegro_pay_on_line_pay']+
+        				 $data[0]['allegro_pay_payu_accept_escrow'];
+
+        $param[13]=array('fid'=>14, 'fvalue-string'=>'',
+        'fvalue-int'=>$pay_options,
+        'fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        
+        $other_options = $data[0]['allegro_bold']+
+        				 $data[0]['allegro_miniature']+
+        				 $data[0]['allegro_light']+
+        				 $data[0]['allegro_favouritism']+
+        				 $data[0]['allegro_category_site']+
+        				 $data[0]['allegro_home_page'];
+
+        $param[14]=array('fid'=>15, 'fvalue-string'=>'',
+        'fvalue-int'=>$other_options,
+        'fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+
+        $param[15]=array('fid'=>16, 'fvalue-string'=>'', 'fvalue-int'=>'','fvalue-float'=>'',
+        'fvalue-image'=>$this->preparePhoto($data[0]['allegro_photo']),
+        'fvalue-text'=>'', 'fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        $param[16]=array('fid'=>17, 'fvalue-string'=>'', 'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        $param[17]=array('fid'=>18, 'fvalue-string'=>'', 'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        $param[18]=array('fid'=>19, 'fvalue-string'=>'', 'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        $param[19]=array('fid'=>20, 'fvalue-string'=>'', 'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        $param[20]=array('fid'=>21, 'fvalue-string'=>'', 'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        $param[21]=array('fid'=>22, 'fvalue-string'=>'', 'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        $param[22]=array('fid'=>23, 'fvalue-string'=>'', 'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+
+        $param[23]=array('fid'=>24,
+        'fvalue-string'=>$this->iso8859_to_utf8($data[0]['allegro_product_description']),
+        'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        
+        $param[24]=array('fid'=>25, 'fvalue-string'=>'', 
+        'fvalue-int'=>$data[0]['allegro_pay_wire_transfer_price'],
+        'fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        
+        $param[25]=array('fid'=>26, 'fvalue-string'=>'',
+        'fvalue-int'=>$data[0]['allegro_pay_collect_on_delivery_price'],
+        'fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        
+        $param[26]=array('fid'=>27,
+        'fvalue-string'=>$data[0]['allegro_delivery_other_text'],
+        'fvalue-int'=>'','fvalue-float'=>'', 'fvalue-image'=>'', 'fvalue-text'=>'','fvalue-datetime'=>'', 'fvalue-boolean'=>'');
+        if($this->debug) {
+            print "<pre>";
+            print_r($param);
+            print "</pre>";
+        }    
+        return $param;
+    } // end func prepareAuction
+
+    /**
+     * Wyslij aukcje na allegro
+     *
+     * @return array $tab
+     */
+    function sendAuctions($id)
+    {
+        global $database;
+        global $allegro_config;
+        global $_SESSION;
+        global $lang;
+        $user_id=$database->sql_select_array("user_id","allegro_auctions","user_id=".$id);
+
+        $client = new soapclient($allegro_config->allegro_server, true);
+        //$client->setDebugLevel(1);
+        $client->decode_utf8=false;
+
+        foreach($user_id as $key=>$value) {
+            $data=$this->prepareAuction($value);
+            $parameters = array(
+            $_SESSION['allegro']['session-handle-part'],    // sesja z allegro
+            $data,                                          // dane w postaci tablicy
+            0,
+            0
+            );
+            // wywo³anie metody
+            $response = $client->call('doNewAuctionExt',$parameters);
+            //echo '<pre>' . htmlspecialchars($client->request, ENT_QUOTES) . '</pre>';
+            if(!empty($response['faultcode'])) {
+                print "<font color=red>";
+                print $lang->allegro_error_auction['problem'].$value."<br>";
+                print $lang->allegro_error_auction['type_error'].$this->utf8_to_8859($response['faultstring'])."<br><br>";
+                print "</font>";
+            } else {
+                if(!empty($response['item-id'])) {
+                	print $lang->set_auction['ok'].$value."<br>";
+                    print $lang->set_auction['number'].$response['item-id']."<br>";
+                    if($allegro_config->allegro_mode == 'true') {
+                        print $lang->set_auction['url']."<a href=\"http://www.allegro.pl/show_item.php?item=".$response['item-id']."\" target=\"window\"><u>http://www.allegro.pl/show_item.php?item=".$response['item-id']."</u></a><br><br>";
+                    } else {
+                        print $lang->set_auction['url']."<a href=\"http://www.testwebapi.pl/show_item.php?item=".$response['item-id']."\" target=\"window\"><u>http://www.testwebapi.pl/show_item.php?item=".$response['item-id']."</u></a><br><br>";
+                    }
+                    $database->sql_update("allegro_auctions","user_id=".$value,array(
+                    "allegro_number"=>$response['item-id'],
+                    ));
+                }
+            }
+        }
+        print "<pre>";
+        print_r ($client->getDebug());
+        print "</pre>";
+        return true;
+    } // end func sendAuctions
+
+    /**
+     * Zakodowanie pliku fotografii
+     *
+     * @param string $name nazwa fotografii
+     *
+     * @return string $encoded zakodowany obrazek
+     */
+    function & preparePhoto($name)
+    {
+        global $DOCUMENT_ROOT;
+        global $config;
+
+        $path="http://".$config->www."/photo/".$name;
+        if(preg_match("/soteesklep3/",$path)) {
+        	print "<font color=red>Ustaw prawid³owy adres sklepu w zak³adce \"Dane sprzedawcy. Adres sklepu\"</font><br>";
+        }
+        $file='';
+        if($fd = fopen($path, "rb")) {
+            while (!feof($fd)) {
+                $file .= fread($fd, 8192);
+            }
+            $encoded = base64_encode($file);
+            fclose($fd);
+            return $encoded;
+        } else {
+            print "<font color=red>Problem z do³±czeniem zdjeciem</font><br>";
+            return false;
+        }
+    } // end func preparePhoto
+} // end class Allegro
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/include/gen_config.inc.php soteesklep3/admin/include/gen_config.inc.php
--- ../soteesklep3/admin/include/gen_config.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/include/gen_config.inc.php	2006-08-23 16:58:51.000000000 +0200
@@ -0,0 +1,286 @@
+<?php
+/**
+* Generuj plik konfiguracyjny na podstawie danych z tablicy. Metoda ta sluzy do generowanie danych
+* z tabel SQL, ktore sa dostepne w postaci tablic PHP. Pozwala to na zaoszczedzenie czasu zwiazanego
+* z wykonywaniem zapytan SQL i dobieraniem danych. Metoda jest zalecana dla generowania danych, ktore sa
+* zcesto wykorzystyweane w sklepie, np. do cen, walut, rabatow, kodowania hasla dostepu do bazy itp.
+*
+* @author  m@sote.pl
+* @version $Id: gen_config.inc.php,v 2.25 2005/04/01 08:35:33 maroslaw Exp $
+* @package    admin_include
+*/
+
+/**
+* @ignore
+* @package admin
+* @subpackage config
+*/
+class NullClass {}
+
+/**
+* Dodaj obs³ugê generowania kodu PHP.
+*/
+require_once ("include/php.inc.php");
+
+/**
+* Dodaj obs³ugê FTP.
+*/
+require_once ("include/ftp.inc.php");
+
+/**
+* Generowanie, pobranie i wrzucenie w odpowiednie wskazane miejsce plików konfiguracyjnych PHP.
+* @package admin
+* @subpackage config
+*/
+class GenConfig {
+    
+    /**
+    * @var string Katalog zawierajacy generowany plik konfiguracyjny
+    */
+    var $config_dir="";
+    
+    /**
+    * @var string Generowany plik konfiguracjny
+    */
+    var $config_file="";
+    /*
+    * @var string Nazwa klasy zawierajace definicje konfiguracyjne
+    */
+    var $classname;
+    
+    /**
+    * @var string Jesli $classname jest rozszezeniem jakiejs klasy to $ext_classname wskazuje na ta klase
+    */
+    var $ext_classname="";
+    
+    /**
+    * @var object obiekt $classname
+    */
+    var $obj_config;
+    
+    /**
+    * @var string Automatycznie polacz sie z serwerem FTP wg danych z configu
+    */
+    var $auth_from_db="yes";
+    
+    /**
+    * @var string User  ftp, jesli nie laczymy sie automatycznie
+    */
+    var $ftp_user;
+    
+    /**
+    * @var string Has³o ftp
+    */
+    var $ftp_password;
+    
+    /**
+    * @var string Serwer ftp
+    */
+    var $ftp_host;
+    
+    /**
+    * @var bool Czy automatycznie ³±czyæ siê przez FTP.
+    */
+    var $auto_ftp=true;
+    
+    /**
+    * Generuj plik konfiguracyjny PHP. Odczytaj dane do zmian przekazane jako parametr, pozostale dane
+    * odczytaj z biezacej konfiguracji.
+    *
+    * @param array $vars zmienna=>wartosc parametry zapisywane w pliku konfiguracyjnym
+    * \@depend $config->user_vars
+    * @access private
+    */
+    function _gen($vars) {
+        global $config;
+        global $DOCUMENT_ROOT;
+        
+        // odczytaj aktualne wartosci zdefiniowane w obiekcie, w ktorym przechowywane sa wartosci wszystkich zmiennych
+        // generowanych przez wywolanie tej. klasy (dla danej grupy zmiennych)
+        if (empty($this->config)) {
+            $this->config =& new NullClass; // wymagane kiedy tworzymy plik i potrzebujemy obiekt klasy z pliku,
+            // ktory jeszcze nie zostal wygenerowany
+        }
+        $obj_config=&$this->config;
+        
+        $php =& new PHPFile;
+        $php->start_class($this->classname,$this->ext_classname,$this->class_object);
+        
+        reset($this->vars);
+        foreach ($this->vars as $var) {
+            // sprawdz czy dana wartosc jest podana w parametrze $vars jako klucz
+            reset($vars);$in_param=false;
+            while (list($key,) = each($vars)) {
+                if ($key==$var) {
+                    $in_param=true;
+                }
+            }
+            
+            if ($in_param==true) {
+                // zmienna przekazana jako parametr
+                $val=$vars[$var];
+                $php->add($var,$val);
+            } else {
+                // odczytaj wartosc z biezacej konfiguracji
+                if (isset($obj_config->$var)) {
+                    $val=$obj_config->$var;
+                    $php->add($var,$val);
+                } else $val='';
+            }
+        } // end foreach
+        
+        $src_php=$php->gen_php_file();
+        
+        // zapisz dane w pliku konfiguracyjnym
+        $file="$DOCUMENT_ROOT/tmp/$this->config_file";
+        if ($fd=fopen($file,"w+")) {
+            fwrite($fd,$src_php,strlen($src_php));
+            fclose($fd);
+        } else die ("Forbidden $file");
+        
+        // przerzuc plik poprzez FTP do wlasciwego miejsca
+        global $ftp;
+        if ($this->auth_from_db=="no") {
+            $ftp->ftp_user=$this->ftp_user;
+            $ftp->ftp_password=$this->ftp_password;
+            $ftp->ftp_host=$this->ftp_host;
+        }
+        if ($this->auto_ftp==true) $ftp->connect($this->auth_from_db);
+        $ftp->put($file,$config->ftp['ftp_dir'].$this->config_dir,$this->config_file);
+        if ($this->auto_ftp==true) $ftp->close();
+        
+        return(0);
+    } // end gen()
+    
+    /**
+    * @see gen
+    */
+    function genPHPFileClass($vars) {
+        return $this->_gen($vars);
+    } // end genPHPFileClass
+    
+    /**
+    * Alias do genPHPFileClass
+    * @deprecate since 3.0
+    */
+    function gen($vars) {
+        return $this->genPHPFileClass($vars);
+    } // end gen()
+    
+    /**
+    * Generuj plik PHP z konfiguracj±.
+    * Plik zawiera przypisania waerto¶ci do obiektu postaci np. $lang->zmienna="1123";
+    *
+    * @param string $object nazwa zmiennej reprezentuj±cej obiekt
+    * @param string $file   nazwa pliku (wzglêdem DOCUMENT_ROOT), który bêdzie generowany
+    * @param array  $values tablica z warto¶ciami, które zostan± podmienione w w/w pliku
+    * @return bool true - dane zosta³y zaktualizowane, false w p.w.
+    */
+    function genPHPFileValues($object,$file,$values) {
+        global $DOCUMENT_ROOT;
+        global $ftp,$config;
+        global $shop;
+        $php =& new PHPFile;
+        
+        $file_name=basename($file);
+        $file_dir=substr($file,0,strlen($file)-strlen($file_name));
+        
+        // Kopiujemy plik po to,¿eby moc go odczytaæ, bez wzglêdu na to czy wcze¶niej
+        // by³ ³adowany czy nie. Bez kopiwania, je¶li plik by³ wcze¶niej wywo³ywany przez
+        // np. include_once, nie bedziemy mogli go ponownie odczytaæ.
+        if($shop->home == 1){
+        	global $__del_files;
+	        $salt=md5(time().rand(1,1000000));
+	        $from_file=$DOCUMENT_ROOT."/../".$file;
+	        $dest_file=$DOCUMENT_ROOT."/tmp2/gen_php_file_tmp_".$salt.".php.";
+	        $dest_file_2=$DOCUMENT_ROOT."/tmp2/gen_php_file_tmp_2_".$salt.".php";
+	        $__del_files[]=$dest_file;
+	        $__del_files[]=$dest_file_2;
+        }else{
+        	$from_file=$DOCUMENT_ROOT."/../".$file;
+        	$dest_file=$DOCUMENT_ROOT."/tmp/gen_php_file_tmp.php";
+        	$dest_file_2=$DOCUMENT_ROOT."/tmp/gen_php_file_tmp_2.php";	
+        }        
+                        
+        $ftp->connect();
+        
+        if (file_exists($from_file)) {
+            // kopiujemy istniejacy plik
+            if (copy($from_file,$dest_file)) {
+                $$object =& new PHPFileTMP();
+                
+                if($shop->home == 1)
+                	require_once($dest_file);
+                else 
+                	include($dest_file);
+                	
+                // przeksztalcenie elementow obiektu na tablicê
+                $cur_values = array($$object);$cur_values = $cur_values[0];
+                reset($cur_values);$new_values=array();
+                while (list($key,$val) = each($cur_values)) {
+                    if (! is_array($val)) $val=stripslashes($val);
+                    $new_values[$key]=$val;
+                }
+                // end
+                
+                // podstaw przekazane do podmiany zmienne
+                reset($values);
+                while (list($key,$val) = each($values)) {
+                    $new_values[$key]=$val;
+                }
+                // end
+                
+                $php_source=$php->genPHPFIleValues($object,$new_values);
+            } else {
+                return false;
+            }
+        } else {
+            // sprawdzamy czy istnieje wskazany katalog
+            // $file_dir -> /htdocs/1/lang/_pl/
+            $dir_1=$config->ftp['ftp_dir']."/".$file_dir;
+            $ftp->mkdir($dir_1);
+                
+            // tworzymy nowy plik
+            if ($fd=fopen($dest_file_2,"w+")) {
+                $$object =& new PHPFileTMP();
+                $php_source=$php->genPHPFIleValues($object,$values);
+                fclose($fd);
+            } else return false;
+        }
+                
+        // zapisz wygenerowany kod PHP w pliku
+        if ($fd=fopen($dest_file_2,"w+")) {
+            fwrite($fd,$php_source,strlen($php_source));
+            fclose($fd);
+        } else return false;
+        
+        
+        
+        if($shop->home == 1){
+        	$file_dir_2 = $config->ftp['ftp_dir'].substr($file_dir,2);
+	        //print $file_dir_2.$file_name."<br>";
+	
+	        // skopiuj plik do docelowej lokalizacji
+	        $ftp->put($dest_file_2,$file_dir_2,$file_name);
+	        $ftp->close();        	
+        }else{
+	        // skopiuj plik do docelowej lokalizacji
+	        $ftp->put($dest_file_2,$config->ftp['ftp_dir']."/".$file_dir,$file_name);
+	        $ftp->close();
+	        
+	        // skasuj niepotrzebne ju¿ pliki
+	        if (file_exists($dest_file))   unlink ($dest_file);
+	        if (file_exists($dest_file_2)) unlink ($dest_file_2);
+        }
+        return true;
+    } // end genPHPFileValues()
+    
+} // end class GenConfig
+
+/*
+// Przyklad generowania podmiany zmienny w pliku z warto¶ciami przypisanymi do danego obiektu
+require_once ("include/gen_config.inc.php");
+$gen_config =& new GenConfig();
+$gen_config->genPHPFileValues("lang","./htdocs/1/lang/_pl/lang.inc.php",array("zmienna1"=>"Smok","zmienna3"=>"Wawelski"));
+*/
+?>
diff -ruN ../soteesklep3/admin/plugins/_allegro/html/allegro_config.html.php soteesklep3/admin/plugins/_allegro/html/allegro_config.html.php
--- ../soteesklep3/admin/plugins/_allegro/html/allegro_config.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_allegro/html/allegro_config.html.php	2006-08-23 16:59:10.000000000 +0200
@@ -0,0 +1,127 @@
+<?php
+/**
+ * Strona konfiguracyjna modu³u allegro.
+ *
+ * @author  krzysk@sote.pl
+ * @version $Id: allegro_config.html.php,v 1.5 2006/04/12 11:45:27 scalak Exp $
+ *
+* @package    allegro
+ */
+if($allegro_config->allegro_mode == "true") {
+    $checked='checked';
+    $checked1='';
+} else {
+    $checked1='checked';
+    $checked='';
+} 
+
+?>
+
+<form action=config.php method=POST name=allegro_config>
+<input type=hidden name=item[save] value=1>
+
+<table border=0 width="65%" cellpadding="3" cellspacing="3" align="center">
+<tr>
+<td colspan="2" width="60%" align="center"><?php print "<img src=";$theme->img("_img/allegro_logo.gif");print ">\n";?>
+</td>
+</tr>
+<tr>
+<td width="70%" align="center" valign="top"><?php $theme->frame_open($lang->allegro_config['options']);?>
+<table border="0" cellpadding="3" cellspacing="0">
+		<tr>
+		<td width="100"><?php print $lang->allegro_config['login'] ;?>:</td>
+		<td><input type=text size=20 name=item[login] value='<?php print @$allegro_config->allegro_login; ?>'></td>
+		<td width="100"><?php print $lang->allegro_config['login_test'] ;?>:</td>
+		<td><input type=text size=20 name=item[login_test] value='<?php print @$allegro_config->allegro_login_test; ?>'></td>
+		</tr>
+		<tr>
+		<td><?php print $lang->allegro_config['password'] ;?>:</td>
+		<td><input type=password size=20 name=item[password] value='<?php print @$allegro_config->allegro_password; ?>'></td>
+		<td><?php print $lang->allegro_config['password_test'] ;?>:</td>
+		<td><input type=password size=20 name=item[password_test] value='<?php print @$allegro_config->allegro_password_test; ?>'></td>
+		</tr>
+		<tr>
+		<td><nobr><?php print $lang->allegro_config['web_api_key'] ;?></nobr>:</td>
+		<td><input type=text size=20 name=item[web_api_key] value='<?php print @$allegro_config->allegro_web_api_key; ?>'></td>
+		<td>&nbsp;</td>
+		<td>&nbsp;</td>
+		</tr>
+		<tr>
+		<td><?php print $lang->allegro_config['country_code'] ;?></td>
+		<td><input type=text size=20 name=item[country_code] value='<?php print @$allegro_config->allegro_country_code; ?>'></td>
+		<td><?php print $lang->allegro_config['country_code_test'] ;?></td>
+		<td><input type=text size=20 name=item[country_code_test] value='<?php print @$allegro_config->allegro_country_code_test; ?>'></td>
+		</tr>
+		<tr>
+		<td><?php print $lang->allegro_config['version'] ;?></td>
+		<td><input type=text size=20 name=item[version] value='<?php print @$allegro_config->allegro_version; ?>'></td>
+		<td><?php print $lang->allegro_config['version_test'] ;?></td>
+		<td><input type=text size=20 name=item[version_test] value='<?php print @$allegro_config->allegro_version_test; ?>'></td>
+		</tr>
+
+		<tr>
+		<td colspan="2"><?php print $lang->allegro_config['city'] ;?></td>
+		<td colspan="2"><input type=text size=50 name=item[city] value='<?php print @$allegro_config->allegro_city; ?>'></td>
+		</tr>
+
+		<tr>
+		<td colspan="2"><?php print $lang->allegro_config['state_select'] ;?></td>
+		<td colspan="2">
+        <select name=item[state_select]>
+		<?php
+		foreach($allegro_config->allegro_states as $key=>$value) {
+		  if($key == $allegro_config->allegro_state_select) {
+		      print "<option value=".$key." selected>".$value."</option>";
+		  } else {
+		      print "<option value=".$key.">".$value."</option>";
+		  }
+		}
+		
+		?>
+		</select>
+		</td>
+		</tr>
+		<tr>
+		<td colspan="2"><?php print $lang->allegro_config['server'] ;?></td>
+		<td colspan="2"><input type=text size=50 name=item[server] value='<?php print @$allegro_config->allegro_server; ?>'></td>
+		</tr>
+
+		<tr>
+		<td colspan="2"><?php print $lang->allegro_config['mode'] ;?></td>
+		<td colspan="2">
+		<?php print $lang->allegro_config['product']; ?>
+		<input type=radio name=item[mode] value='true' <?php print @$checked; ?>>
+        <?php print $lang->allegro_config['test']; ?>
+        <input type=radio name=item[mode] value='false' <?php print @$checked1; ?>>
+		</td>
+		</tr>
+		
+		</table>
+<?php $theme->frame_close();?>
+</td>
+<td width="20%" colspan=2 valign="top"><?php $theme->frame_open($lang->allegro_config['category']);?><table border="1" cellpadding="3" cellspacing="0">
+		<tr>
+		<td align="center">
+<?php
+
+//wlaczyc gdy bedzie baza - nietestowane
+global $database;
+$select=@$allegro_config->allegro_category;
+$data=$database->sql_select_multiple("allegro_cat","category[]","cat_id","cat_name","","cat_parent=0","","8",$select);
+print $data;
+?>
+<!-- dla testow -->
+		</td>
+		</tr>
+	</table>
+<?php $theme->frame_close();?>
+
+</td>
+</tr>
+</table>
+<center>
+   <?php
+      $buttons->button($lang->allegro_config['save'],"javascript:document.allegro_config.submit();");
+?>
+</center>
+</from>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/config.php soteesklep3/admin/plugins/_ceneo.pl/config.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/config.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/config.php	2006-08-23 17:45:27.000000000 +0200
@@ -0,0 +1,10 @@
+<?php
+/**
+ * Konfiguracja modu³u z ceneo
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: config.php,v 1.2 2006/08/16 10:41:41 lukasz Exp $
+* @package    pasaz.ceneo.pl
+ */
+include("./index.php");
+?>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/export1.php soteesklep3/admin/plugins/_ceneo.pl/export1.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/export1.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/export1.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,34 @@
+<?php
+/**
+ * Export produktów do ceneo pasaz
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: export1.php,v 1.2 2006/08/16 10:41:41 lukasz Exp $
+* @package    pasaz.ceneo.pl
+ */
+
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+global $config;
+/**
+ * Nag³ówek skryptu
+ */
+require_once ("../../include/head_stream.inc.php");
+
+$theme->head_window();
+$theme->bar($lang->ceneo_bar['export']);
+
+print "<br><center>".$lang->ceneo_load_offer['timeout']."<br>";
+print "</center>";
+flush();
+
+require_once("./include/ceneo_load_offer.inc.php");
+$ceneo_offer=new ceneoLoadOffer;
+$ceneo_offer->load_offer();
+
+print "<br><center>".$lang->ceneo_load_offer['file']."<br><a target='_blank' href='http://".$config->www."/ceneo.xml'>http://".$config->www."/ceneo.xml</a></center>";
+include_once ("./html/ceneo_close.html.php");   
+
+// stopka
+$theme->foot_window();
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/export.php soteesklep3/admin/plugins/_ceneo.pl/export.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/export.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/export.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,51 @@
+<?php
+/**
+ * Export produktów do ceneo pasaz
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: export.php,v 1.2 2006/08/16 10:41:41 lukasz Exp $
+* @package    pasaz.ceneo.pl
+ */
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+
+/**
+ * Nag³ówek skryptu
+ */
+require_once ("../../../include/head.inc");
+
+// naglowek
+$theme->head();
+$theme->page_open_head();
+
+include_once ("./include/menu.inc.php");
+$theme->bar($lang->ceneo_bar['export']);
+require_once ("include/save_auth_session.inc.php");
+
+print "<br>";
+print $lang->ceneo_export['info'];
+print "<br><br>";
+
+$__disable_trash='false';
+// zaznacz wszystkie produkty
+$sql = "SELECT * FROM main WHERE ceneo_export=1";
+
+// funkcja prezentujaca wynik zapytania w glownym oknie strony 
+include_once ("include/dbedit_list.inc");
+
+$dbedit = new DBEditList;
+$dbedit->start_list_element=$theme->list_th();
+
+$dbedit->show();
+
+include_once ("./html/ceneo_export.html.php");    
+
+$theme->page_open_foot();
+
+// stopka
+$theme->foot();
+
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_close.html.php soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_close.html.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_close.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_close.html.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,20 @@
+<?php
+/**
+ * Okienko z buttonem zamykaj±cym je onet pasaz
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: ceneo_close.html.php,v 1.4 2006/08/16 10:41:41 lukasz Exp $
+* @package    pasaz.onet.pl
+ */
+?>
+<p>
+<center>
+<?php
+global $buttons,$lang;
+?>
+<table><tr><td>
+<?php $buttons->button($lang->close,"javascript:window.close();"); ?>
+</td>
+</tr>
+</table>
+</center>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_config.html.php soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_config.html.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_config.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_config.html.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,39 @@
+<?php
+/**
+ * Strona konfiguracyjna modu³u ceneo pasa¿.
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: ceneo_config.html.php,v 1.5 2006/08/16 10:41:41 lukasz Exp $
+ *
+* @package    pasaz.ceneo.pl
+ */
+ ?>
+
+<form action=config.php method=POST name=ceneo_config>
+<input type=hidden name=item[save] value=1>
+<p>
+<table cellpadding="0" cellspacing="0" align="center">
+<tr>
+<td>
+<img src="<?php $theme->img('_img/ceneo.png');?>">
+
+<table cellpadding="0" cellspacing="0" align="center">
+<tr><td style="padding-top:20px;">
+<?php print $lang->ceneo_config['id']; ?>
+</td>
+<td style="padding-top:20px;padding-left:5px;">
+<input type=text size=5 name=item[id] value='<?php print $ceneo_config->ceneo_shop_id; ?>'>
+</td>
+</tr>
+</table>
+
+</td>
+</tr>
+</table>
+
+<center>
+   <?php
+      $buttons->button($lang->ceneo_config['save'],"javascript:document.ceneo_config.submit();");
+?>
+</center>
+</from>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_export.html.php soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_export.html.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_export.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_export.html.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,43 @@
+<?php
+/**
+ * Strona exportu produktów do ceneo pasa¿.
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: ceneo_export.html.php,v 1.4 2006/08/16 10:41:41 lukasz Exp $
+ *
+* @package    pasaz.ceneo.pl
+ */
+
+$onclick="onclick=\"window.open('','ceneo_export','width=515,height=350,scrollbars=1,menubar=0,status=0,location=0,directories=0,toolbar=0,resizable=0');\"";
+?>
+<br>
+
+<form action=export1.php method=POST name="ceneo_export" target=ceneo_export>
+<input type=hidden name=export value=1>
+<p>
+<table align=center width=95%><tr><td>
+<center>
+<?php 
+	if(!$dbedit->records) {
+		print $lang->ceneo_export['noproduct'];
+		print "<br><br>";
+	}
+?>
+<?php 
+if($dbedit->records) {
+	print $lang->ceneo_export['export']; 
+}
+?></center>
+<p>
+</td></tr>
+<tr><td>
+<center>
+<?php 
+if($dbedit->records) {
+	$buttons->button($lang->ceneo_export['submit'],"javascript:document.ceneo_export.submit(); $onclick");
+}   
+?>
+</center>
+</td></tr>
+</table>
+</from>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_pasaz.html.php soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_pasaz.html.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_pasaz.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/html/ceneo_pasaz.html.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Strona g³ówna modu³u ceneo pasa¿.
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: ceneo_pasaz.html.php,v 1.4 2006/08/16 10:41:41 lukasz Exp $
+ *
+* @package    pasaz.ceneo.pl
+ */
+?>
+<table align=center width=95%><tr><td>
+
+&nbsp;<?php print $lang->ceneo_pasaz['title']; ?>
+</td>
+</tr>
+<tr>
+<td align="center">
+<img src="<?php $theme->img('_img/ceneo.png');?>">
+<ul>
+
+ <li> <?php print $lang->ceneo_pasaz['export']; ?> <a href=/plugins/_ceneo.pl/export.php><u><?php print $lang->ceneo_options["export"]; ?></u></a>
+
+<p>
+</td></tr></table>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/include/ceneo_load_offer.inc.php soteesklep3/admin/plugins/_ceneo.pl/include/ceneo_load_offer.inc.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/include/ceneo_load_offer.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/include/ceneo_load_offer.inc.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,356 @@
+<?php
+/**
+ * Obsluga tworzenia pliku dla ceneo.pl
+ *
+ *
+ * @author krzys@sote.pl
+ * @version $Id: ceneo_load_offer.inc.php,v 1.8 2006/08/16 10:41:41 lukasz Exp $
+* @package    pasaz.ceneo.pl
+ */
+
+
+/**
+ * Includowanie potrzebnych klas 
+ */
+require_once("include/metabase.inc");
+require_once("include/ftp.inc.php");
+
+
+
+/**
+ * Klasa OnetLoadOffer
+ *
+ * @package onet
+ * @subpackage admin
+ */
+class CeneoLoadOffer{
+
+    var $ceneo_mode='';                  // tryb ladowania produktow do ceneo_pasaz full - pelny update - przyrostowy
+    var $ceneo_shop_id='';               // id sklepu przyznawany przez administratora z ceneo_pasaz
+    var $www='';                        // adres internetowy sklepu
+    var $count=0;
+    var $partner_name='ceneo';               // nazwa partnera
+    var $target='';
+    var $ftp_dir;
+    /**
+	* Konstruktor obiektu ceneoLoadOffer
+	*
+	* @access public
+	*
+	* @author rdiak@sote.pl
+	*
+	* @return boolean true/false
+	*/
+    function ceneoLoadOffer() {
+        global $ceneo_config;
+        global $config;
+
+        $this->ceneo_shop_id=$ceneo_config->ceneo_shop_id;
+        $this->ftp_dir=$config->ftp_dir;
+        $this->target=$this->ftp_dir."/htdocs/";
+        $this->www=$config->www;
+        return true;
+    } // end ceneoLoadOffer()
+
+    /**
+	* Funkcja zwaracajaca nalowek pliku xml
+	*
+	* @access public
+	*
+	* @author rdiak@sote.pl
+	*
+	* @return string naglowek pliku xml
+	*
+	*/
+    function ceneo_get_head() {
+        $str="<?xml version=\"1.0\" encoding=\"ISO-8859-2\"?>\n<!DOCTYPE pasaz:Envelope SYSTEM \"loadOffers.dtd\">\n<pasaz:Envelope xmlns:pasaz=\"http://schemas.xmlsoap.org/soap/envelope/\">\n<pasaz:Body>\n<loadOffers xmlns=\"urn:ExportB2B\">\n";
+        return $str;
+    } //end ceneo_get_head()
+
+    /**
+	* Funkcja zwraca stopke pliku xml .
+	*
+	* @access public
+	*
+	* @author rdiak@sote.pl
+	*
+	* @return string stopka pliku xml
+	*
+	*/
+    function ceneo_get_foot() {
+        $str="</loadOffers>\n</pasaz:Body>\n</pasaz:Envelope>";
+        return $str;
+    } //end ceneo_get_foot()
+
+    /**
+	 * Funkcja zwraca url produktu .
+	 *
+	 * @access public
+	 *
+	 * @return string url
+	 */
+    function ceneo_prepare_url() {
+        global $mdbd;
+        global $config;
+
+        $data=$mdbd->select("partner_id,name","partners","name=?",array($this->partner_name=>"string"));
+        $partner_id=$data['partner_id'];
+        $code=md5("partner_id.$partner_id.$config->salt");                 // wygenerowanie kodu kontrolnego
+        $link="&partner_id=".$partner_id."&code=".$code;    // budowanie linku
+        return $link;
+    }
+
+
+    /**
+	 * Funkcja formuje komunikat xml z oferta sklepu  .
+	 *
+	 * @access public
+	 *
+	 * @author rdiak@sote.pl
+	 *
+	 * @return string stopka pliku xml
+	 *
+	 */
+    function & prepare_offer() {
+        global $database;
+        global $lang;
+        $str='';
+        //$str.=$this->ceneo_get_head();
+        // jest to tablica tablic zawierajaca dane z oferty
+        $dane=$this->get_database();
+        if(empty($dane)) return false;
+
+        // kawalek url odpwiedzialny za prawid³ow± identyfikacjê partnera
+        $code=$this->ceneo_prepare_url();
+        foreach($dane as $data){
+            $price=$this->ceneo_currency($data);
+            $url="http://".$this->www."/go/_info/?id=".$data['id'].$code;
+            $str.="<offer>\n";
+            $str.="\t<id>".$data['user_id']."</id>\n";
+            $str.="\t<name>".$data['name']."</name>\n";
+            $str.="\t<price>".$price."</price>\n";
+            $str.="\t<url>".$url."</url>\n";
+            $str.="\t<categoryId>".$data['category'];
+            if (!empty($data['category2'])){
+            $str.="/".$data['category2'];
+            }
+            if (!empty($data['category3'])){
+            $str.="/".$data['category3'];
+            }
+            if (!empty($data['category4'])){
+            $str.="/".$data['category4'];
+            }
+            if (!empty($data['category5'])){
+            $str.="/".$data['category5'];
+            }
+            $str.="</categoryId>\n";
+            $xml_description=$this->_cut_html($data['xml_description']);
+            $str.="\t<description>".($xml_description)."</description>\n";
+          
+            $str.="\t".$this->ceneo_image($data)."\n";
+
+                $str.="\t<attributes>\n";
+                $str.="<attribute>\n";
+                $str.="<name>Producent</name>\n";
+                $str.="<value>".$data['producer']."</value>\n";
+                $str.="</attribute>\n";
+                $str.="\t</attributes>\n";
+            
+            $str.="</offer>\n\n";
+            $this->count++;
+        }
+        //$str.=$this->onet_get_foot();
+        $offer=&$str;
+        return $offer;
+    } //end prepare_offer()
+
+    /**
+	* Funkcja zapisuje oferte do pliku  .
+	*
+	* @access public
+	*
+	* @author rdiak@sote.pl
+	*
+	* @return string stopka pliku xml
+	*
+	*/
+    function load_offer() {
+        global $DOCUMENT_ROOT;
+        global $lang;
+        global $ceneo_config;
+
+
+        $offer1="<offers>\n".$this->prepare_offer()."</offers>\n";
+        $file_name="xml_offer_ceneo.xml";
+        $offer=$this->ceneo_get_head();
+        $offer.=$offer1;
+        $offer.=$this->ceneo_get_foot();
+        
+        if($offer) {
+            $file=$DOCUMENT_ROOT."/tmp/ceneo.xml";
+            if  ($fd=fopen($file,"w+")) {
+                fwrite($fd,$offer,strlen($offer));
+                fclose($fd);
+            }
+        }
+        $this->load_ftp($file);
+
+    } // end load_offer
+
+    /**
+	* Funkcja ceneo_currency przelicza cene jesli waluta jest inna niz PLN
+	*
+	* @access public
+	*
+	* @author rdiak@sote.pl
+	*
+	* @param  string $price_brutto nazwa zdjecia,
+	*
+	* @return string $price przelicznona cena
+	*
+	*/
+    function ceneo_currency($data) {
+        global $database;
+        $currency=$database->sql_select_data_array("id","currency_val","currency");
+        $id_currency=$data['id_currency'];
+
+        if ( $id_currency > 1 ) {
+            $price_brutto=($data['price_currency']*$currency[$id_currency])*(1+($data['vat']/100));
+            if ($data['discount'] >0 && $data['discount'] <100) {
+                $price_brutto=$price_brutto-(($price_brutto*$data['discount'])/100);
+            }
+        } else {
+            $price_brutto=$data['price_brutto']*1;
+            if ($data['discount'] >0 && $data['discount'] <100) {
+                $price_brutto=$price_brutto-(($price_brutto*$data['discount'])/100);
+            }
+        }
+
+        if(eregi("(^[0-9]{1,}$)",$price_brutto)) {
+            $price_brutto=$price_brutto.".00";
+        }elseif(eregi("(^[0-9]{1,}\.[0-9]{1}$)",$price_brutto)) {
+            $price_brutto=$price_brutto."0";
+        }elseif(eregi("(^[0-9]{1,}\.[0-9]{2}$)",$price_brutto)) {
+            $price_brutto=$price_brutto;
+        }elseif(eregi("^[0-9]{1,}\.[0-9]{0,17}$",$price_brutto)) {
+            preg_match("/^(\d{1,})\.(\d{2})/",$price_brutto,$data_match);
+            $price_brutto=$data_match[1].".".$data_match[2];
+        }
+        return $price_brutto;
+    } // end ceneo_currency
+
+    /**
+	* Funkcja formuje komunikat xml z oferta sklepu  .
+	*
+	* @access public
+	*
+	* @author rdiak@sote.pl
+	*
+	* @return string stopka pliku xml
+	*
+	*/
+    function & get_database() {
+        global $db;
+
+        global $database;
+        
+        //print "<pre>";
+        //print_r($main_param);
+        //print "</pre>";
+        $product=array();
+        $query="SELECT ";
+        $query.="ceneo_export ";
+        $query.="user_id,photo,name_L0,price_brutto,producer,price_currency,xml_description_L0,vat,id_currency,discount,hidden_price,category1,category2,category3,category4,category5,id";
+        $query.=" FROM main WHERE ceneo_export=1";
+
+        $prepared_query=$db->PrepareQuery($query);
+        if ($prepared_query) {
+            $result=$db->ExecuteQuery($prepared_query);
+            if ($result!=0) {
+                $num_rows=$db->NumberOfRows($result);
+                if ($num_rows>0) {
+                    for ($i=0;$i<$num_rows;$i++) {
+                        $data=array();                       
+                     
+                        $data['user_id']=$db->FetchResult($result,$i,"user_id");
+                        $data['photo']=$db->FetchResult($result,$i,"photo");
+                        $data['name']=$db->FetchResult($result,$i,"name_L0");
+                        $data['price_brutto']=$db->FetchResult($result,$i,"price_brutto");
+                        $data['producer']=$db->FetchResult($result,$i,"producer");
+                        $data['price_currency']=$db->FetchResult($result,$i,"price_currency");
+                        $data['xml_description']=$db->FetchResult($result,$i,"xml_description_L0");
+                        $data['vat']=$db->FetchResult($result,$i,"vat");
+                        $data['id_currency']=$db->FetchResult($result,$i,"id_currency");
+                        $data['discount']=$db->FetchResult($result,$i,"discount");
+                        $data['hidden_price']=$db->FetchResult($result,$i,"hidden_price");
+                        $data['category']=$db->FetchResult($result,$i,"category1");
+                        $data['category2']=$db->FetchResult($result,$i,"category2");
+                        $data['category3']=$db->FetchResult($result,$i,"category3");
+                        $data['category4']=$db->FetchResult($result,$i,"category4");
+                        $data['category5']=$db->FetchResult($result,$i,"category5");
+                        $data['id']=$db->FetchResult($result,$i,"id");
+                        
+                        
+                        foreach($main_param[$data['user_id']] as $key=>$value) {
+                            if(preg_match("/ceneo/",$key)) {
+                                $data[$key]=$main_param[$data['user_id']][$key];
+                            }
+                        }
+                        array_push ($product, $data);
+                    } // end for
+                }
+            } else die ($db->Error());
+        } else die ($db->Error());
+        $data=&$product;
+        return $data;
+    } // end get_database
+
+    /**
+	* Funkcja onet_check_image zwraca gotowy tag xml z parametrami zdj-Bêcia -A
+	*
+	* @access public
+	*
+	* @author rdiak@sote.pl
+	*
+	* @param  string $photo  nazwa zdjecia,
+	* @param  string $url    adres url do zdjecia
+	*
+	* @return string tag xml zawierajacy parametry zdjecia
+	*
+	*/
+    function ceneo_image($data) {
+        $url="http://".$this->www."/photo/".$data['photo'];
+        $size = @getimagesize ($url);
+        $str="<image height=\"".@$size[1]."\" width=\"".@$size[0]."\" title=\"".$data['name']."\">".$url."</image>";
+        return $str;
+    } // end ceneo_image
+
+    /**
+	 * Funkcja ftpuje plik do okrelsonej lokalizacji.
+	 *
+	 * @param  string $file nazwa pliku
+	 *
+	 * @return boolean true/false
+	 */
+    function load_ftp($file) {
+        global $ftp;
+        global $DOCUMENT_ROOT;
+        $ftp->connect();
+        $ftp->put("$file","$this->target","ceneo.xml");
+        $ftp->close();
+        return true;
+    } // end load_ftp()
+
+    /**
+	 * Wytnij znaczniki html ze stringu
+ 	 *
+     * @return string ciag znakow bez znacznikow html
+     */
+    
+    function _cut_html($str) {
+        $str=preg_replace("'<[\/\!]*?[^<>]*?>'si","",$str);
+        return $str;
+    } // end _cut_html
+    
+} // end class ceneoLoadOffer
+?>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/include/gen_ceneo_config.inc.php soteesklep3/admin/plugins/_ceneo.pl/include/gen_ceneo_config.inc.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/include/gen_ceneo_config.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/include/gen_ceneo_config.inc.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,27 @@
+<?php
+/**
+ * Konfiguracja modu³u ceneo pasaz
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: gen_ceneo_config.inc.php,v 1.4 2006/08/16 10:41:42 lukasz Exp $
+* @package    pasaz.ceneo.pl
+ */
+
+/**
+ * Includowanie pliku do generowania konfiguracji
+ */
+require_once ("include/gen_config.inc.php");
+
+$gen_config = new GenConfig;
+//$gen_config->config_dir="/admin/plugins/_pasaz.ceneo.pl/config/";     // katalog zawierajacy generowany plik
+$gen_config->config_dir="/config/auto_config/";            // katalog generowanego pliku
+$gen_config->config_file="ceneo_config.inc.php";    // generowany plik konfiguracyjny
+$gen_config->classname="ceneoConfig";                 // 1) klasa tworzona w pliku, zawierajaca definicje zmeinnych
+$gen_config->ext_classname="";           // jesli w/w klasa jest rozszezeniem klasy, to ext_classname okresla nazwa klasy nadrzednej
+$gen_config->class_object="ceneo_config";                // obiekt klasy 1)
+$gen_config->vars=array(
+                        "ceneo_shop_id",
+                     
+                        );              // lista zmiennych generowanych w konfiguracji
+$gen_config->config=&$config;                      // adres aktualnego obiektu klasy 1)
+?>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/include/menu.inc.php soteesklep3/admin/plugins/_ceneo.pl/include/menu.inc.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/include/menu.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/include/menu.inc.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Menu modu³u ceneo pasaz
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: menu.inc.php,v 1.6 2006/08/16 10:41:42 lukasz Exp $
+* @package    pasaz.ceneo.pl
+ */
+
+global $config;
+
+print "<div align=right>";
+$buttons->menu_buttons(array(                            
+                             //$lang->ceneo_options["config"]=>"/plugins/_ceneo.pl/config.php",
+                             $lang->ceneo_options["export"]=>"/plugins/_ceneo.pl/export.php",
+                             //$lang->ceneo_options["category"]=>"/plugins/_ceneo.pl/category.php",
+                             //$lang->ceneo_options["trans"]=>"/plugins/_ceneo.pl/transaction.php",
+
+                             $lang->ceneo_options["help"]=>"/plugins/_help_content/help_show.php?id=57 onClick=\"window.open('','help','width=300,height=500,scrollbars=1');\" target=help",
+
+                             )
+                       );
+print "</div>";
+?>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/index.php soteesklep3/admin/plugins/_ceneo.pl/index.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/index.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/index.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,33 @@
+<?php
+/**
+ * Export produktów do ceneo pasaz
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: index.php,v 1.2 2006/08/16 10:41:41 lukasz Exp $
+* @package    pasaz.ceneo.pl
+ */
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+
+/**
+ * Nag³ówek skryptu
+ */
+require_once ("../../../include/head.inc");
+
+$theme->head();
+$theme->page_open_head();
+
+include_once ("./include/menu.inc.php");
+$theme->bar($lang->ceneo_bar["index"]);
+
+include_once("./html/ceneo_pasaz.html.php");
+
+$theme->page_open_foot();
+
+// stopka
+$theme->foot();
+
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/admin/plugins/_ceneo.pl/lang/_pl/lang.inc.php soteesklep3/admin/plugins/_ceneo.pl/lang/_pl/lang.inc.php
--- ../soteesklep3/admin/plugins/_ceneo.pl/lang/_pl/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_ceneo.pl/lang/_pl/lang.inc.php	2006-08-23 16:58:52.000000000 +0200
@@ -0,0 +1,99 @@
+<?php
+$lang->close="Zamknij okno";
+$lang->ceneo_bar=array(
+                      "index"=>"Ceneo",
+                      "config"=>"Ceneo - konfiguracja",
+                      "export"=>"Export oferty do Ceneo",
+                      "cat"=>"Import kategorii z Ceneo",
+                      "trans"=>"Export transakcji do Ceneo"    	
+                      );
+$lang->ceneo_options=array(
+                          "config"=>"Konfiguracja",
+                          "export"=>"Export produktów",
+                          "category"=>"Import Kategorii",
+                          "trans"=>"Export Transakcji",
+                          "help"=>"Pomoc",
+                          );
+$lang->ceneo_config=array(
+                         "options"=>"Opcje Ceneo",
+                         "network"=>"Opcje sieciowe Ceneo",
+                         "id"=>"ID sklepu:",
+                         "mode"=>"Tryb ³adowania danych", 
+                         "full"=>"Pe³ny eksport",
+                         "update"=>"Przyrostowy eksport",
+                         "login"=>"Login",
+                         "pass"=>"Has³o",
+                         "server"=>"Adres serwera SOAP",
+                         "test_server"=>"Adres testowego serwera SOAP",
+                         "get_category"=>"Pobieranie kategorii",
+                         "biling"=>"Wysy³anie produktów",
+                         "transaction"=>"Potwierdzanie transakcji",
+                         "port"=>"Port Server SOAP",
+                         "save"=>"Zapisz",
+                         "category"=>"Kategorie Ceneo*",
+                         "confirm"=>"Adres potwierdzania transakcji",
+                         "load"=>"Tryb pracy modu³u:",
+                         "test"=>"Tryb testowy",
+                         "product"=>"Tryb produkcyjny",
+                         "back"=>"Ostatnie ustawienia",
+                         "partner_name"=>"Nazwa partnera",
+                         );
+$lang->ceneo_soap=array(
+                       "no_header"=>"Brak naglowka odpowiedzi z Ceneo",
+                       "bad_reply"=>"Brak odpowiedzi z serwera SOAP",
+                       "not_connect"=>"Nie mozna polaczyc sie z serwerem",
+                       );
+
+$lang->ceneo_load_offer=array(
+                             "badxml"=>"Nieprawid³owu plik xml z oferta",
+                             "noprod"=>"Brak produktów do wyeksportwania",    
+                             "timeout"=>"Trwa tworzenie pliku xml z produktami dla Ceneo. Mo¿e to potrwaæ kilka chwil.",
+                             "count"=>"Ilo¶æ produktów w pliku Ceneo",
+                             "file"=>"Plik xml z wyeksportowanymi produktami znajduje siê tutaj:", 
+                             );
+
+
+$lang->ceneo_pasaz=array(
+                        "title"=>"System <b>Ceneo</b>, jest przeznaczony do zarz±dzania produktami ze sklepu z Ceneo.",
+                        "config"=>"Je¶li chcesz przeprowadziæ konfiguracje parametrów Ceneo wybierz zak³adkê",
+                        "export"=>"Je¶li chcesz wyeksportowaæ produkty ze sklepu do Ceneo wybierz zak³adkê",
+                        "category"=>"Je¶li chcesz pobraæ drzewo kategorii z Ceneo wybierz  zak³adkê",
+                        "transaction"=>"Je¶li chcesz wykonæ eksport transakcji do Ceneo wybierz zak³adke",  
+                        );
+$lang->ceneo_export=array(
+                         "info"=>"Z tego miejsca mo¿na wyeksportowaæ produkty ze sklepu do Ceneo. Je¶li produkt znajduje siê na li¶cie poni¿ej, to ma on zaznaczona opcjê do eksportu Ceneo.",
+                         "export"=>"Eksportuj  produkty ze sklepu do <b>Ceneo</b>.",
+                         "submit"=>"Eksport produktów",
+                         "noproduct"=>"<font color=red>Brak produktów do eksportu.</font>",
+                         );
+$lang->ceneo_attrib=array(
+                'ceneo_export'=>"Eksportuj produkt",
+                'ceneo_attrib'=>"Do³±czyæ atrybuty Ceneo ?",
+                'ceneo_autor'=>"Autor",
+                'ceneo_isbn'=>"ISBN",
+                'ceneo_page'=>"Ilosc_stron",
+                'ceneo_publisher'=>"Wydawnictwo",
+                'ceneo_producer'=>"Producent",
+                'ceneo_size'=>"Rozmiar",
+                'ceneo_rozstaw'=>"Rozstaw_srub",
+                'ceneo_odsadzenie'=>"Odsadzenie",
+                'ceneo_rezyser'=>"Rezyser",
+                'ceneo_obsada'=>"Obsada",
+                'ceneo_nosnik'=>"No¶nik",
+                'ceneo_tytul_org'=>"Tytul_oryginalny",
+                'ceneo_opony_producent'=>"Producent",
+                'ceneo_opony_model'=>"Model",
+                'ceneo_opony_szerokosc'=>"Szerokosc",
+                'ceneo_opony_profil'=>"Profil",
+                'ceneo_opony_srednica'=>"Srednica",
+                'ceneo_opony_predkosc'=>"Predkosc",
+                'ceneo_opony_nosnosc'=>"Nosnosc",
+                'ceneo_opony_sezon'=>"Sezon",
+                'ceneo_opony_typ'=>"Typ_pojazdu",
+                'ceneo_perfumy_producent'=>"Producent",
+                'ceneo_perfumy_model'=>"Model",
+                'ceneo_perfumy_rodzaj'=>"Rodzaj",
+                'ceneo_perfumy_pojemnosc'=>"Pojemnosc"
+                );
+                         
+?>
diff -ruN ../soteesklep3/admin/plugins/html/main.html.php soteesklep3/admin/plugins/html/main.html.php
--- ../soteesklep3/admin/plugins/html/main.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/html/main.html.php	2006-08-23 16:59:09.000000000 +0200
@@ -0,0 +1,83 @@
+<?php
+/**
+* @version    $Id: main.html.php,v 1.24 2006/03/14 12:09:31 krzys Exp $
+* @package    admin_plugins
+*/
+?>
+<BR>
+<table border="0" cellpadding="0" cellspacing="0" width="75%" align="center">
+    
+    <tr align="left">    
+        <td width="33%" valign="top">
+<?php
+if (in_array("newsletter",$config->plugins)) {
+	$permf->a("<u>".$lang->icons['newsletter']."</u><BR>","/plugins/_newsletter/_users/index.php");
+}
+if (in_array("discounts",$config->plugins)) {
+    $permf->a("<u>".$lang->icons['discounts']."</u><BR>","/plugins/_discounts/index.php");
+}
+if (in_array("partners",$config->plugins)) {
+    $permf->a("<u>".$lang->icons['partners']."</u><BR>","/plugins/_partners/index.php");
+}
+if (in_array("multi_lang",$config->plugins)) {
+    $permf->a("<u>".$lang->icons['lang']."</u><BR>","/plugins/_dictionary/index.php");
+}
+if (in_array("reviews",$config->plugins)) {
+    $permf->a("<u>".$lang->icons['reviews']."</u><BR>","/plugins/_reviews/index.php");
+}
+if (in_array("promotion",$config->plugins)) {
+    $permf->a("<u>".$lang->icons['promotions']."</u><BR>","/plugins/_promotions/index.php");
+}
+/*
+if ($config->lang=="pl") {
+    $permf->a("<u>".$lang->icons['gg']."</u><BR>","/plugins/_gg/index.php");
+}*/
+
+?>
+        </td>
+        <td width="33%" valign="top">
+<?php
+if ((in_array("pasaz.onet.pl",$config->plugins)) && ($config->lang=="pl")) {
+    $permf->a("<u>".$lang->icons['onet']."</u><BR>","/plugins/_pasaz.onet.pl/index.php");
+} 
+if ((in_array("pasaz.wp.pl",$config->plugins)) && ($config->lang=="pl"))  {
+    $permf->a("<u>".$lang->icons['wp']."</u><BR>","/plugins/_pasaz.wp.pl/index.php");
+}
+if ((in_array("pasaz.interia.pl",$config->plugins)) && ($config->lang=="pl"))  {
+    $permf->a("<u>".$lang->icons['interia']."</u><BR>","/plugins/_pasaz.interia.pl/index.php");
+}
+if ((in_array("ceneo.pl",$config->plugins)) && ($config->lang=="pl"))  {
+    $permf->a("<u>".$lang->icons['ceneo']."</u>","/plugins/_ceneo.pl/index.php");
+}
+
+?>
+        </td>
+        <td width="33%" valign="top">
+<?php
+if (in_array("cd",$config->plugins)) {
+    $permf->a("<u>".$lang->icons['cd']."</u><BR>","/plugins/_cd/index.php");
+}
+$permf->a("<u>".$lang->icons['catalog_mode']."</u>","/go/_configure/catalog_conf.php");
+print "<br>";
+$permf->a("<u>".$lang->icons['google']."</u>","/go/_google/config.php");
+if ($config->nccp=="0x1388"){ 
+print "<br>";
+$permf->a("<u>".$lang->icons['assoc_rules']."</u>","/plugins/_assoc_rules/index.php");
+}
+print "<br>";
+
+$permf->a("<u>".$lang->icons['basket_wishlist']."</u>","/plugins/_basket_wishlist/index.php");
+if (in_array("platnoscipl",$config->plugins)) {
+    print "<br>";   
+    $permf->a("<u>".$lang->icons['platnoscipl']."</u><BR>","/plugins/_pay/_platnoscipl/index.php");
+}
+if ($config->nccp=="0x1388"){ 
+$permf->a("<u>".$lang->icons['allegro']."</u>","/plugins/_allegro/index.php");
+}
+
+?>
+        </td>
+
+    </tr>   
+       
+</table>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/plugins/_newsletter/_users/config.php soteesklep3/admin/plugins/_newsletter/_users/config.php
--- ../soteesklep3/admin/plugins/_newsletter/_users/config.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_newsletter/_users/config.php	2006-08-23 16:58:55.000000000 +0200
@@ -0,0 +1,204 @@
+<?php
+/**
+* Konfiguracja systemu newsletter. Formularz + obs³uga.
+* 
+* Konfiguracja systemu newsletter jest generowana w pliku config/newsletter_config.inc.php
+*
+* @author  rdiak@sote.pl
+* @version $Id: config.php,v 2.9 2006/07/17 12:20:27 lukasz Exp $
+*
+* verified 2004-03-09 m@sote.pl
+* @package    newsletter
+* @subpackage users
+*/
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+/**
+* Naglowek skryptu.
+*/
+require_once ("../../../../include/head.inc");
+$choose_lang=@$_REQUEST['item']['choose_lang'];
+if (empty($choose_lang) && $_REQUEST['item']['choose_lang']!=='0') {
+	if ($config->admin_lang=='pl') $choose_lang=0;
+		else $choose_lang=1;
+}
+	if ($choose_lang==0){
+		require_once("./include/gen_newsletter_config_L0.inc.php");
+	}elseif ($choose_lang==1){
+		require_once("./include/gen_newsletter_config_L1.inc.php");
+	}elseif ($choose_lang==2){
+		require_once("./include/gen_newsletter_config_L2.inc.php");
+	}elseif ($choose_lang==3){
+		require_once("./include/gen_newsletter_config_L3.inc.php");
+	}if ($choose_lang==4){
+		require_once("./include/gen_newsletter_config_L4.inc.php");
+	}
+
+
+
+// najpierw dokonujemy zmian, potem wyswietlamy wyglad, z juz zaktualizowanymi danymi
+// naglowek
+$theme->head();
+$theme->page_open_head();
+
+include_once("../include/menu.inc.php");
+$theme->bar($lang->newsletter_config_bar);
+
+if (! empty($_REQUEST['item'])) {
+    $item=$_REQUEST['item'];
+} else $item=array();
+
+if ($choose_lang==0){
+	require_once("config/auto_config/newsletter/newsletter_config_L0.inc.php");
+	if (! empty($item['save'])) {
+		    $ftp->connect();    
+		    $gen_config->gen(array(
+		                           "newsletter_group"=>$item['group'],
+		                           "newsletter_sender"=>$item['sender'],
+		                           "newsletter_head"=>$item['head'],
+		                           "newsletter_info_add"=>$item['info_add'],
+		                           "newsletter_info_del"=>$item['info_del'],
+		                           "newsletter_foot_add"=>$item['foot_add'],
+		                           "newsletter_foot_del"=>$item['foot_del'],
+		                           "newsletter_foot"=>$item['foot'],
+		                           )
+		                     );
+		    $ftp->close();
+		    $config_newsletter->newsletter_group=$item['group'];
+		    $config_newsletter->newsletter_sender=$item['sender'];
+		    $config_newsletter->newsletter_head=$item['head'];
+		    $config_newsletter->newsletter_info_add=$item['info_add'];
+		    $config_newsletter->newsletter_info_del=$item['info_del'];
+		    $config_newsletter->newsletter_foot_add=$item['foot_add'];
+		    $config_newsletter->newsletter_foot_del=$item['foot_del'];
+		    $config_newsletter->newsletter_foot=$item['foot'];
+		}
+}
+if ($choose_lang==1){
+	require_once("config/auto_config/newsletter/newsletter_config_L1.inc.php");
+	if (! empty($item['save'])) {
+		    $ftp->connect();    
+		    $gen_config->gen(array(
+		                           "newsletter_group"=>$item['group'],
+		                           "newsletter_sender"=>$item['sender'],
+		                           "newsletter_head"=>$item['head'],
+		                           "newsletter_info_add"=>$item['info_add'],
+		                           "newsletter_info_del"=>$item['info_del'],
+		                           "newsletter_foot_add"=>$item['foot_add'],
+		                           "newsletter_foot_del"=>$item['foot_del'],
+		                           "newsletter_foot"=>$item['foot'],
+		                           )
+		                     );
+		    $ftp->close();
+		    $config_newsletter->newsletter_group=$item['group'];
+		    $config_newsletter->newsletter_sender=$item['sender'];
+		    $config_newsletter->newsletter_head=$item['head'];
+		    $config_newsletter->newsletter_info_add=$item['info_add'];
+		    $config_newsletter->newsletter_info_del=$item['info_del'];
+		    $config_newsletter->newsletter_foot_add=$item['foot_add'];
+		    $config_newsletter->newsletter_foot_del=$item['foot_del'];
+		    $config_newsletter->newsletter_foot=$item['foot'];
+		}
+}
+if ($choose_lang==2){
+	require_once("config/auto_config/newsletter/newsletter_config_L2.inc.php");
+	if (! empty($item['save'])) {
+		    $ftp->connect();    
+		    $gen_config->gen(array(
+		                           "newsletter_group"=>$item['group'],
+		                           "newsletter_sender"=>$item['sender'],
+		                           "newsletter_head"=>$item['head'],
+		                           "newsletter_info_add"=>$item['info_add'],
+		                           "newsletter_info_del"=>$item['info_del'],
+		                           "newsletter_foot_add"=>$item['foot_add'],
+		                           "newsletter_foot_del"=>$item['foot_del'],
+		                           "newsletter_foot"=>$item['foot'],
+		                           )
+		                     );
+		    $ftp->close();
+		    $config_newsletter->newsletter_group=$item['group'];
+		    $config_newsletter->newsletter_sender=$item['sender'];
+		    $config_newsletter->newsletter_head=$item['head'];
+		    $config_newsletter->newsletter_info_add=$item['info_add'];
+		    $config_newsletter->newsletter_info_del=$item['info_del'];
+		    $config_newsletter->newsletter_foot_add=$item['foot_add'];
+		    $config_newsletter->newsletter_foot_del=$item['foot_del'];
+		    $config_newsletter->newsletter_foot=$item['foot'];
+		}
+}
+if ($choose_lang==3){
+	require_once("config/auto_config/newsletter/newsletter_config_L3.inc.php");
+	if (! empty($item['save'])) {
+		    $ftp->connect();    
+		    $gen_config->gen(array(
+		                           "newsletter_group"=>$item['group'],
+		                           "newsletter_sender"=>$item['sender'],
+		                           "newsletter_head"=>$item['head'],
+		                           "newsletter_info_add"=>$item['info_add'],
+		                           "newsletter_info_del"=>$item['info_del'],
+		                           "newsletter_foot_add"=>$item['foot_add'],
+		                           "newsletter_foot_del"=>$item['foot_del'],
+		                           "newsletter_foot"=>$item['foot'],
+		                           )
+		                     );
+		    $ftp->close();
+		    $config_newsletter->newsletter_group=$item['group'];
+		    $config_newsletter->newsletter_sender=$item['sender'];
+		    $config_newsletter->newsletter_head=$item['head'];
+		    $config_newsletter->newsletter_info_add=$item['info_add'];
+		    $config_newsletter->newsletter_info_del=$item['info_del'];
+		    $config_newsletter->newsletter_foot_add=$item['foot_add'];
+		    $config_newsletter->newsletter_foot_del=$item['foot_del'];
+		    $config_newsletter->newsletter_foot=$item['foot'];
+		}
+}
+if ($choose_lang==4){
+	require_once("config/auto_config/newsletter/newsletter_config_L4.inc.php");
+	if (! empty($item['save'])) {
+		    $ftp->connect();    
+		    $gen_config->gen(array(
+		                           "newsletter_group"=>$item['group'],
+		                           "newsletter_sender"=>$item['sender'],
+		                           "newsletter_head"=>$item['head'],
+		                           "newsletter_info_add"=>$item['info_add'],
+		                           "newsletter_info_del"=>$item['info_del'],
+		                           "newsletter_foot_add"=>$item['foot_add'],
+		                           "newsletter_foot_del"=>$item['foot_del'],
+		                           "newsletter_foot"=>$item['foot'],
+		                           )
+		                     );
+		    $ftp->close();
+		    $config_newsletter->newsletter_group=$item['group'];
+		    $config_newsletter->newsletter_sender=$item['sender'];
+		    $config_newsletter->newsletter_head=$item['head'];
+		    $config_newsletter->newsletter_info_add=$item['info_add'];
+		    $config_newsletter->newsletter_info_del=$item['info_del'];
+		    $config_newsletter->newsletter_foot_add=$item['foot_add'];
+		    $config_newsletter->newsletter_foot_del=$item['foot_del'];
+		    $config_newsletter->newsletter_foot=$item['foot'];
+		}
+}
+
+
+if ($choose_lang==0){
+require_once ("./html/newsletter_config_L0.html.php");
+} elseif ($choose_lang==1){
+require_once ("./html/newsletter_config_L1.html.php");
+} elseif ($choose_lang==2){
+require_once ("./html/newsletter_config_L2.html.php");
+} elseif ($choose_lang==3){
+require_once ("./html/newsletter_config_L3.html.php");
+} if ($choose_lang==4){
+require_once ("./html/newsletter_config_L4.html.php");
+}
+
+
+$theme->page_open_foot();
+
+// stopka
+$theme->foot();
+
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/admin/plugins/_newsletter/_users/html/newsletter_config_L0.html.php soteesklep3/admin/plugins/_newsletter/_users/html/newsletter_config_L0.html.php
--- ../soteesklep3/admin/plugins/_newsletter/_users/html/newsletter_config_L0.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_newsletter/_users/html/newsletter_config_L0.html.php	2006-08-23 16:58:55.000000000 +0200
@@ -0,0 +1,113 @@
+<?php
+/**
+* Formularz konfiguracji newslettera
+*
+* @author  rdiak@sote.pl
+* @version $Id: newsletter_config_L0.html.php,v 2.4 2006/07/17 12:20:36 lukasz Exp $
+*
+* verified 2004-03-10 m@sote.pl
+* @package    newsletter
+* @subpackage users
+*/
+global $lang,$config;
+
+if ($choose_lang=='4'){
+ $selected4="selected";   
+}elseif ($choose_lang=='3'){
+ $selected3="selected";   
+}elseif ($choose_lang=='2'){
+ $selected2="selected";   
+}elseif ($choose_lang=='1'){
+ $selected1="selected";   
+}
+else{
+ $selected0="selected";
+}
+
+?>
+<form name='MyForm5' method='post' action='config.php'>
+<?php if ($config->nccp=="0x1388"){ ?>
+<select onchange='javascript:document.MyForm5.submit();' name='item[choose_lang]'>
+<option value='0' <?php print @$selected0;?>><?php print $config->langs_names['0'];?></option>
+<option value='1' <?php print @$selected1;?>><?php print $config->langs_names['1'];?></option>
+<option value='2' <?php print @$selected2;?>><?php print $config->langs_names['2'];?></option>
+<option value='3' <?php print @$selected3;?>><?php print $config->langs_names['3'];?></option>
+<option value='4' <?php print @$selected4;?>><?php print $config->langs_names['4'];?></option>
+</select></form>
+<?php } ?>
+<form action=config.php method=POST>
+<p>
+
+<table width=95% align=center border="0">
+<tr>
+  <td valign=top width=50%>
+    <?php $theme->frame_open($lang->newsletter_config['options']);?>
+    <table>
+    <tr>
+      <td>
+        <?php print $lang->newsletter_parametres['sender'];?>
+      </td>
+      <td>
+        <input type=text size=25 name=item[sender] value='<?php print $config_newsletter->newsletter_sender?>'>
+      </td>
+    </tr>
+    <tr>
+      <td>
+        <?php print $lang->newsletter_parametres['default_group'];?>
+      </td>
+      <td>
+        <input type=text size=5 name=item[group] value='<?php print $config_newsletter->newsletter_group?>'> 
+      </td>
+    </tr>
+    <tr>
+      <td>
+        <?php print $lang->newsletter_parametres['head'];?>
+      </td>
+      <td>
+        <textarea name=item[head] row=2 cols=25><?php print $config_newsletter->newsletter_head?></textarea>
+      </td>
+    </tr>
+    </table>  
+    <?php $theme->frame_close();?>
+  
+  </td>
+
+<td width="50%" valign="top">
+<?php $theme->frame_open($lang->newsletter_config['options']);?>
+<table>
+<tr>
+<td><?php print $lang->newsletter_parametres['foot_delete'];?></td>
+</tr>
+<tr>
+<td><textarea name=item[foot] row=3 cols=40><?php print @$config_newsletter->newsletter_foot?></textarea></td>
+</tr>
+</table>
+<?php $theme->frame_close();?>
+</td>
+</tr>
+</table>
+
+<table width=95% align=center>
+<tr>
+  <td valign=top width=50%>
+    <?php $theme->frame_open($lang->newsletter_config['info']);?>
+    <?php print $lang->newsletter_parametres['info_add'];?><br>
+    <textarea name=item[info_add] row=3 cols=40><?php print $config_newsletter->newsletter_info_add?></textarea><br><br>
+    <?php print $lang->newsletter_parametres['info_del'];?><br>
+    <textarea name=item[info_del] row=3 cols=40><?php print $config_newsletter->newsletter_info_del?></textarea><br>
+    <?php $theme->frame_close();?>
+
+  </td>
+  <td valign=top width=50%>
+    <?php $theme->frame_open($lang->newsletter_config['info_link']);?>
+    <?php print $lang->newsletter_parametres['foot_add'];?><br>
+<textarea name=item[foot_add] row=3 cols=40><?php print $config_newsletter->newsletter_foot_add?></textarea><br><br>
+    <?php print $lang->newsletter_parametres['foot_del'];?><br>
+    <textarea name=item[foot_del] row=3 cols=40><?php print $config_newsletter->newsletter_foot_del?></textarea><br>
+    <?php $theme->frame_close();?>
+  </td>
+</tr>
+</table>
+
+<center><input type=submit name=item[save] value="<?php print $lang->save;?>"></center>
+</from>
diff -ruN ../soteesklep3/admin/plugins/_newsletter/_users/html/newsletter_config_L1.html.php soteesklep3/admin/plugins/_newsletter/_users/html/newsletter_config_L1.html.php
--- ../soteesklep3/admin/plugins/_newsletter/_users/html/newsletter_config_L1.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_newsletter/_users/html/newsletter_config_L1.html.php	2006-08-23 16:58:55.000000000 +0200
@@ -0,0 +1,110 @@
+<?php
+/**
+* Formularz konfiguracji newslettera
+*
+* @author  rdiak@sote.pl
+* @version $Id: newsletter_config_L1.html.php,v 2.3 2006/07/17 12:20:36 lukasz Exp $
+*
+* verified 2004-03-10 m@sote.pl
+* @package    newsletter
+* @subpackage users
+*/
+global $lang,$config;
+
+if ($choose_lang=='4'){
+ $selected4="selected";   
+}elseif ($choose_lang=='3'){
+ $selected3="selected";   
+}elseif ($choose_lang=='2'){
+ $selected2="selected";   
+}elseif ($choose_lang=='1'){
+ $selected1="selected";   
+}
+else{
+ $selected0="selected";
+}
+?>
+<form name='MyForm5' method='post' action='config.php'>
+<select onchange='javascript:document.MyForm5.submit();' name='item[choose_lang]'>
+<option value='0' <?php print @$selected0;?>><?php print $config->langs_names['0'];?></option>
+<option value='1' <?php print @$selected1;?>><?php print $config->langs_names['1'];?></option>
+<option value='2' <?php print @$selected2;?>><?php print $config->langs_names['2'];?></option>
+<option value='3' <?php print @$selected3;?>><?php print $config->langs_names['3'];?></option>
+<option value='4' <?php print @$selected4;?>><?php print $config->langs_names['4'];?></option>
+</select></form>
+
+<form action=config.php method=POST>
+<p>
+
+<table width=95% align=center>
+<tr>
+  <td valign=top width=50%>
+    <?php $theme->frame_open($lang->newsletter_config['options']);?>
+    <table>
+    <tr>
+      <td>
+        <?php print $lang->newsletter_parametres['sender'];?>
+      </td>
+      <td>
+        <input type=text size=25 name=item[sender] value='<?php print $config_newsletter->newsletter_sender?>'>
+      </td>
+    </tr>
+    <tr>
+      <td>
+        <?php print $lang->newsletter_parametres['default_group'];?>
+      </td>
+      <td>
+        <input type=text size=5 name=item[group] value='<?php print $config_newsletter->newsletter_group?>'> 
+      </td>
+    </tr>
+    <tr>
+      <td>
+        <?php print $lang->newsletter_parametres['head'];?>
+      </td>
+      <td>
+        <textarea name=item[head] row=2 cols=25><?php print $config_newsletter->newsletter_head?></textarea>
+      </td>
+    </tr>
+    </table>  
+    <?php $theme->frame_close();?>
+  
+  </td>
+  <td width="50%" valign="top">
+<?php $theme->frame_open($lang->newsletter_config['options']);?>
+<table>
+<tr>
+<td><?php print $lang->newsletter_parametres['foot_delete'];?></td>
+</tr>
+<tr>
+<td><textarea name=item[foot] row=3 cols=40><?php print @$config_newsletter->newsletter_foot?></textarea></td>
+</tr>
+</table>
+<?php $theme->frame_close();?>
+</td>
+</tr>
+</table>
+
+<table width=95% align=center>
+<tr>
+  <td valign=top width=50%>
+    <?php $theme->frame_open($lang->newsletter_config['info']);?>
+    <?php print $lang->newsletter_parametres['info_add'];?><br>
+    <textarea name=item[info_add] row=3 cols=40><?php print $config_newsletter->newsletter_info_add?></textarea><br><br>
+    <?php print $lang->newsletter_parametres['info_del'];?><br>
+    <textarea name=item[info_del] row=3 cols=40><?php print $config_newsletter->newsletter_info_del?></textarea><br>
+    <?php $theme->frame_close();?>
+
+  </td>
+  <td valign=top width=50%>
+    <?php $theme->frame_open($lang->newsletter_config['info_link']);?>
+    <?php print $lang->newsletter_parametres['foot_add'];?><br>
+<textarea name=item[foot_add] row=3 cols=40><?php print $config_newsletter->newsletter_foot_add?></textarea><br><br>
+    <?php print $lang->newsletter_parametres['foot_del'];?><br>
+    <textarea name=item[foot_del] row=3 cols=40><?php print $config_newsletter->newsletter_foot_del?></textarea><br>
+    <?php $theme->frame_close();?>
+  </td>
+</tr>
+</table>
+<input type="hidden" name='item[choose_lang]' value="1">
+<center><input type=submit name=item[save] value="<?php print $lang->save;?>"></center>
+</from>
diff -ruN ../soteesklep3/admin/plugins/_pay/_ecard/html/ecard_config.html.php soteesklep3/admin/plugins/_pay/_ecard/html/ecard_config.html.php
--- ../soteesklep3/admin/plugins/_pay/_ecard/html/ecard_config.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_pay/_ecard/html/ecard_config.html.php	2006-08-23 16:58:56.000000000 +0200
@@ -0,0 +1,153 @@
+<?php
+global $config;
+print "<br>";
+$theme->desktop_open("100%"); 
+
+//print "<pre>";
+//print_r($config);
+//print "</pre>";
+if(!empty($ecard_config->ecardActive)) $ecardActive="checked";
+if(!empty($ecard_config->ecardStatus)) {
+	$ecardStatus="checked";
+} else {
+	$ecardStatus="";
+}
+?>
+<form action=index.php method=POST name=ecard_config>
+<input type=hidden name=item[save] value=1>
+<p>
+<img src=/themes/base/base_theme/_icons/ecard.png align="right" style="padding-right: 10px">
+<?php// $theme->frame_open($lang->ecard_config['frames1']);?>
+<table>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardAccount']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[ecardAccount] value='<?php print @$ecard_config->ecardAccount; ?>'>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardPassword']; ?>
+</td>
+<td>
+<input type=password size=70 name=item[ecardPassword] value='<?php print @$ecard_config->ecardPassword; ?>'>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardReturnUrl']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[ecardReturnUrl] value='<?php print "http://".$config->www."/".@$ecard_config->ecardReturnUrl; ?>' readonly>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardCancelReturnUrl']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[ecardCancelReturnUrl] value='<?php print "http://".$config->www."/".@$ecard_config->ecardCancelReturnUrl; ?>' readonly>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardServerHash']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[ecardServerHash] value='<?php print @$ecard_config->ecardServerHash; ?>'>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardServerPay']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[ecardServerPay] value='<?php print @$ecard_config->ecardServerPay; ?>'>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardAddressCheck']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[ecardAddressCheck] value='<?php print "http://".$config->www."/".@$ecard_config->ecardAddressCheck; ?>' readonly>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardLang']; ?>
+</td>
+<td>
+<?php
+if($ecard_config->ecardLang == 'PL') {
+   $selected11="selected";
+} else {
+   $selected22="selected";
+}
+?>
+<select name=item[ecardLang]>
+<OPTION value="PL" <?php print @$selected11; ?>>PL</OPTION>
+<OPTION value="EN" <?php print @$selected22; ?>>EN</OPTION>
+</select>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardPayType']; ?>
+</td>
+<td>
+<?php
+if($ecard_config->ecardPayType == 'ALL') {
+   $selected1="selected";
+} elseif($ecard_config->ecardPayType == 'CARD') {
+   $selected2="selected";
+} else {
+   $selected3="selected";
+}
+?>
+<select name=item[ecardPayType]>
+<OPTION value="ALL" <?php print @$selected1; ?>>ALL</OPTION>
+<OPTION value="CARD" <?php print @$selected2; ?>>CARD</OPTION>
+<OPTION value="TRANSFER" <?php print @$selected3; ?>>TRANSFER</OPTION>
+/select>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardActive']; ?>
+</td>
+<td>
+<input type=checkbox name=item[ecardActive] value='1' <?php print @$ecardActive; ?>>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->ecard_config['ecardStatus']; ?>
+</td>
+<td>
+<input type=checkbox name=item[ecardStatus] value='1' <?php print @$ecardStatus; ?>>
+</td>
+</tr>
+</table>
+<?php// $theme->frame_close();?>
+<center>
+   <?php
+      $buttons->button($lang->ecard_config['save'],"javascript:document.ecard_config.submit();");
+?>
+</center>
+</from>
+
+<?php $theme->desktop_close(); ?>
diff -ruN ../soteesklep3/admin/plugins/_pay/_paypal/html/paypal_config.html.php soteesklep3/admin/plugins/_pay/_paypal/html/paypal_config.html.php
--- ../soteesklep3/admin/plugins/_pay/_paypal/html/paypal_config.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_pay/_paypal/html/paypal_config.html.php	2006-08-23 16:58:57.000000000 +0200
@@ -0,0 +1,104 @@
+<?php
+global $config;
+
+//print "<pre>";
+//print_r($config);
+//print "</pre>";
+if(!empty($paypal_config->payPalActive)) $payPalActive="checked";
+if(!empty($paypal_config->payPalStatus)) $payPalStatus="checked";
+?>
+
+
+<form action=index.php method=POST name=paypal_config>
+<input type=hidden name=item[save] value=1>
+<p>
+<img src=/themes/base/base_theme/_img/paypal_logo.png align="right"><br />
+
+<?php $theme->frame_open($lang->paypal_config['frames1']);?>
+<table>
+
+<tr>
+<td>
+<?php print $lang->paypal_config['payPalAccount']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[payPalAccount] value='<?php print @$paypal_config->payPalAccount; ?>'>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->paypal_config['payPalCompany']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[payPalCompany] value='<?php print @$paypal_config->payPalCompany; ?>'>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->paypal_config['payPalReturnUrl']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[payPalReturnUrl] value='<?php print "http://".$config->www."/".@$paypal_config->payPalReturnUrl; ?>' readonly>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->paypal_config['payPalCancelReturnUrl']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[payPalCancelReturnUrl] value='<?php print "http://".$config->www."/".@$paypal_config->payPalCancelReturnUrl; ?>' readonly>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->paypal_config['payPalServerUrl']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[payPalServerUrl] value='<?php print @$paypal_config->payPalServerUrl; ?>' readonly>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->paypal_config['payPalServerTestUrl']; ?>
+</td>
+<td>
+<input type=text size=70 name=item[payPalServerTestUrl] value='<?php print @$paypal_config->payPalServerTestUrl; ?>' readonly>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->paypal_config['payPalActive']; ?>
+</td>
+<td>
+<input type=checkbox name=item[payPalActive] value='1' <?php print @$payPalActive; ?>>
+</td>
+</tr>
+
+<tr>
+<td>
+<?php print $lang->paypal_config['payPalStatus']; ?>
+</td>
+<td>
+<input type=checkbox name=item[payPalStatus] value='1' <?php print @$payPalStatus; ?>>
+</td>
+</tr>
+
+</table>
+<?php $theme->frame_close();?>
+
+<br>
+
+<center>
+   <?php
+      $buttons->button($lang->paypal_config['save'],"javascript:document.paypal_config.submit();");
+?>
+</center>
+</from>
+
+
diff -ruN ../soteesklep3/admin/plugins/_pay/_paypal/index.php soteesklep3/admin/plugins/_pay/_paypal/index.php
--- ../soteesklep3/admin/plugins/_pay/_paypal/index.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_pay/_paypal/index.php	2006-08-23 16:58:57.000000000 +0200
@@ -0,0 +1,106 @@
+<?php
+/**
+ * Konfiguracja danych mBank (platnosc mTRANSFER), aktywacja/ustawienia uslugi
+ *
+ * @author  p@sote.pl
+ * @version $Id: index.php,v 1.4 2006/07/17 10:14:05 lukasz Exp $
+ * @package soteesklep _pay _mbank
+ */
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+require_once ("../../../../include/head.inc");
+@include_once ("config/auto_config/paypal_config.inc.php");
+
+// naglowek
+$theme->head();
+$theme->page_open_head();
+
+include_once("./include/menu.inc.php");
+$theme->bar($lang->paypal_config['bar']);
+
+if (! empty($_REQUEST['item'])) {
+    $item=$_REQUEST['item'];
+} else $item=array();
+
+$item['payPalReturnUrl']=preg_replace("/http:\/\/[a-z0-9.:]+?\//","",@$item['payPalReturnUrl']);
+$item['payPalCancelReturnUrl']=preg_replace("/http:\/\/[a-z0-9.:]+?\//","",@$item['payPalCancelReturnUrl']);
+
+$active=@$item['payPalActive'];
+
+if (! empty($item['save'])) {
+    require_once("include/gen_user_config.inc.php");
+    $gen_config->auto_ftp=false;
+
+    $ftp->connect();
+    if(array_key_exists("101",$config->pay_method_active)) {
+        if($active == 1) {
+            $config->pay_method_active['101']=1;
+        } else {
+            $config->pay_method_active['101']=0;
+        }
+    } else {
+        if($active == 1) {
+            $config->pay_method_active=$config->pay_method_active+array("101"=>"1");
+        } else {
+            $config->pay_method_active=$config->pay_method_active+array("101"=>"0");
+        }
+    }
+
+    $gen_config->gen(array(
+            "pay_method_active"=>$config->pay_method_active,
+    )
+    );
+
+    $gen_config->config_dir="/config/auto_config/";            // katalog generowanego pliku
+    $gen_config->config_file="paypal_config.inc.php";         // nazwa generowanego pliku
+    $gen_config->classname="paypalConfig";                    // nazwa klasy generowanego pliku
+    $gen_config->class_object="paypal_config";                // 1) nazwa tworzonego obiektu klasy w/w
+    $gen_config->vars=array(
+            "payPalAccount",
+            "payPalCompany",
+            "payPalReturnUrl",
+            "payPalCancelReturnUrl",
+            "payPalServerUrl",
+            "payPalActive",
+            "payPalStatus",
+            "payPalServerTestUrl",
+    );
+    $gen_config->config=&$paypal_config;                      // przekaz aktualne wartosci obiektu 1)
+
+
+
+
+
+    $gen_config->gen(array(
+            "payPalAccount"=>$item['payPalAccount'],
+            "payPalCompany"=>$item['payPalCompany'],
+            "payPalReturnUrl"=>$item['payPalReturnUrl'],
+            "payPalCancelReturnUrl"=>$item['payPalCancelReturnUrl'],
+            "payPalServerUrl"=>$item['payPalServerUrl'],
+            "payPalActive"=>@$item['payPalActive'],
+            "payPalStatus"=>@$item['payPalStatus'],
+            "payPalServerTestUrl"=>@$item['payPalServerTestUrl']
+    )
+    );
+    $ftp->close();
+    $paypal_config->payPalAccount=$item['payPalAccount'];
+    $paypal_config->payPalCompany=$item['payPalCompany'];
+    $paypal_config->payPalReturnUrl=$item['payPalReturnUrl'];
+    $paypal_config->payPalCancelReturnUrl=$item['payPalCancelReturnUrl'];
+    $paypal_config->payPalServerUrl=$item['payPalServerUrl'];
+    $paypal_config->payPalActive=@$item['payPalActive'];
+    $paypal_config->payPalStatus=@$item['payPalStatus'];
+    $paypal_config->payPalServerTestUrl=@$item['payPalServerTestUrl'];
+}
+
+include_once ("./html/paypal_config.html.php");
+
+$theme->page_open_foot();
+
+// stopka
+$theme->foot();
+
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/VERSION soteesklep3/VERSION
--- ../soteesklep3/VERSION	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/VERSION	2006-08-20 15:31:41.000000000 +0200
@@ -0,0 +1 @@
+3.5RC14
