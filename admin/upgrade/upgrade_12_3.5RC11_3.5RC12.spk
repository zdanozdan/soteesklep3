diff -ruN ../soteesklep3/000-upgrade_config.php soteesklep3/000-upgrade_config.php
--- ../soteesklep3/000-upgrade_config.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/000-upgrade_config.php	2006-07-11 13:20:34.000000000 +0200
@@ -0,0 +1,3 @@
+<?php
+define("PATCH_VERSION",12);
+?>
diff -ruN ../soteesklep3/admin/go/_order/lang/_en/lang.inc.php soteesklep3/admin/go/_order/lang/_en/lang.inc.php
--- ../soteesklep3/admin/go/_order/lang/_en/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_order/lang/_en/lang.inc.php	2006-07-11 14:13:59.000000000 +0200
@@ -0,0 +1,188 @@
+<?php
+$lang->tips="You can feel safe while using SOTESHOP as all customer and transaction data are coded";
+$lang->edit_update_ok="Record has been updated";
+$lang->order_user="Customer data";
+$lang->order_more_info="<b>Payment/delivery selected by customer</b>";
+$lang->order_status="Transaction status";
+$lang->order_buttons=array(
+                'add'=>"Add transaction",
+                'list'=>"Transaction list",
+                'not_paid'=>"Unpaid",
+                'paid'=>"Paid",
+                'points'=>"Points",
+                'status'=>"Status",
+                'order'=>"Transactions",
+                );
+$lang->order_title="Order";
+$lang->order_search=array(
+                'amount'=>"Transaction value",
+                'pay_method'=>"Payment method",
+                'confirm'=>"Payment confirmed",
+                'status'=>"Transaction status",
+                'order_id'=>"Transaction ID",
+                'partner'=>"Partners",
+                );
+$lang->order_basket=array(
+                'nr'=>"No.",
+                'name'=>"Product name",
+                'options'=>"Options",
+                'user_id'=>"ID",
+                'price_netto'=>"Net price",
+                'vat'=>"VAT",
+                'num'=>"number",
+                'price_brutto'=>"Gross price",
+                'sum'=>"Sum",
+                );
+$lang->order_status_lock_info="E-mail with status confirmation has not been sent to the customer.";
+$lang->order_status_mail="e-mail";
+$lang->order_status_unlock="send a confirmation";
+$lang->order_status_sent="Information about status has been sent to the customer";
+$lang->order_errors=array(
+                'unknown_order'=>"There is no transaction with this ID",
+                );
+$lang->order_unknown="There is no transaction with this ID";
+$lang->order_last_modified_time="Last modification time";
+$lang->order_last_modified_by="Lately modified by";
+$lang->order_info_title="Additional information connected with the transaction";
+$lang->order_total_amount_brutto="gross:";
+$lang->order_total_amount_netto="Net value of the order";
+$lang->order_cor="Delivery data";
+$lang->order_billing="Billing data";
+$lang->order_form_name=array(
+                'firm'=>"company",
+                'name'=>"name ",
+                'surname'=>"surname",
+                'street'=>"street",
+                'street_n1'=>"house number",
+                'street_n2'=>"flat number",
+                'postcode'=>"area code",
+                'city'=>"city/town",
+                'country'=>"country",
+                'phone'=>"phone",
+                'email'=>"e-mail",
+                'nip'=>"tax identification number",
+                'description'=>"remarks",
+                );
+$lang->order_names=array(
+                'order_id'=>"transaction number",
+                'session_id'=>"session number",
+                'amount'=>"order",
+                'amount_confirm'=>"pay the sum",
+                'delivery_cost'=>"delivery cost",
+                'id_currency'=>"currency",
+                'id_pay_method'=>"payment",
+                'date_add'=>"date",
+                'time_add'=>"time",
+                'remote_ip'=>"IP address",
+                'email'=>"e-mail",
+                'xml_descrription'=>"order",
+                'id_user'=>"user id",
+                'xml_user'=>"customer data",
+                'name'=>"order is made by",
+                'id_delivery'=>"deliverer",
+                'id_status'=>"status",
+                'no_confirm'=>"unpaid",
+                'confirm'=>"paid",
+                'cancel'=>"cancelled",
+                'confirm_online'=>"paid online",
+                'confirm_user'=>"confirmed(e-mail/phone)",
+                'description'=>"additional information/available for the salesperson",
+                'confirmation_status'=>"calculation",
+                'status'=>"status",
+                'checksum'=>"transaction control sum",
+                'send_date'=>"date of package sending",
+                'send_number'=>"package number",
+                'onet_pasaz'=>"Register about Onet Passage",
+                'send_confirm'=>"package sent",
+                'partner_name'=>"partner",
+                'rake_off_amount'=>"commission",
+                'fraud'=>"risk estimation",
+                'confirm_partner'=>"confirm partner's transaction",
+                'recommend_by'=>'transaction with a product recommended by a customer'
+                );
+$lang->order_products=array(
+                'user_id'=>"ID",
+                'name'=>"Name",
+                'producer'=>"Producer",
+                'options'=>"Options",
+                'price'=>"Price",
+                'price_brutto'=>"Gross price",
+                'price_netto'=>"Net price",
+                'vat'=>"VAT",
+                'vat_value'=>"VAT value",
+                'num'=>"number/amount",
+                'sum_brutto'=>"gross sum",
+                'add'=>"Add",
+                );
+$lang->order_status_unknown="undefined";
+$lang->order_add_user="Add a customer to user base";
+$lang->order_menu=array(
+                'invoice'=>"FV",
+                'print'=>"Print",
+                'edit'=>"Edit transaction",
+                'users'=>"Customer data",
+                'users_points'=>"Customer?s points",
+                'users_data'=>"Edit customer data in the order",
+                'users_order'=>"Customer transactions list",
+                'info'=>"Information",
+                );
+$lang->order_fraud_attention="High risk estimation";
+$lang->order_amount_all="sum to pay";
+$lang->order_promotions="Promotion";
+$lang->order_discount="discount";
+$lang->order_set_confirm="pay for the transaction";
+$lang->order_cancel_confirm="cancel/return";
+$lang->order_pay_status="system status";
+$lang->order_legend="Legend";
+$lang->order_main_keys_status=array(
+                '001'=>"Codes displayed to the customer on WWW",
+                '050'=>"Too few codes. Missing codes should be sent to the customer by e-mail.",
+                );
+$lang->order_main_keys_title="Codes sold on-line";
+$lang->order_cancel="cancel";
+$lang->order_date_confirm="Transaction confirmation deadline";
+$lang->order_legend_desc=array(
+                'o'=>"Transacion is waiting to be approved",
+                'r'=>"transaction to be cancelled/returned",
+                'g'=>"transaction has been carried out",
+                'b'=>"transaction to be paid",
+                'black'=>"transaction rejected",
+                'rg'=>"transaction partly paid",
+                'rblack'=>"transaction cancelled",
+                'clock'=>"time (number of days) given to pay the transaction, value <0 - number of days after deadline ",
+                'attention'=>"Attention! Transaction status should be checked.",
+                'attention2'=>"critical error, it should be reported to administrator",
+                );
+$lang->order_partner_confirm=array(
+                '0'=>"Ignore",
+                '1'=>"Confirm",
+                '2'=>"Cancel",
+                );
+$lang->order_przelewy24_check="Check status in 
+transfers24.pl";
+$lang->order_przelewy24_cstatus_check_title="Payment status check
+in transfers24.pl";
+$lang->order_customer_note="Customer's note";
+$lang->order_report=array(
+                'total_amount'=>"Order value - gross",
+                'records'=>"Number of transactions",
+                'average_amount_brutto'=>"The average value of transaction - gross",
+                );
+$lang->order_print="print";
+$lang->order_list_title="Order list";
+$lang->order_user_ok="Order made by a user";
+$lang->card=array(
+				'title'=>"card data",
+				'card'=>"card number",
+				'cvv'=>"CVV / CVC code",
+				'valid_to'=>"card valid to (month-year)",
+				'record_deleted'=>"entry removed",
+				);
+$lang->points=array(
+				'title'=>"Value of order in points",
+				'cancel'=>"order cancelled",
+				'accept'=>"order accepted",
+				'renew'=>"order restored",
+				);
+$lang->info_for_client="nformation about transaction ? <b>available to a customer</b>";
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/go/_order/_status/lang/_en/lang.inc.php soteesklep3/admin/go/_order/_status/lang/_en/lang.inc.php
--- ../soteesklep3/admin/go/_order/_status/lang/_en/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_order/_status/lang/_en/lang.inc.php	2006-07-11 14:13:58.000000000 +0200
@@ -0,0 +1,29 @@
+<?php
+$lang->order_status_bar="Transaction status";
+$lang->order_status_cols=array(
+                'name'=>'Status name',
+                'user_id'=>'ID',
+                'send_mail'=>'Send an e-mail to the client after givinig the transaction this status',
+                'mail_title'=>'E-mail title',
+                'mail_content'=>'E-mail content',
+                );
+$lang->order_status_menu=array(
+                'add'=>'New status',
+                'list'=>'Status list',
+                'help'=>'Help',
+                );
+$lang->order_status_edit="Edit status properties of the transaction";
+$lang->order_status_list=array(
+                'name'=>'Name',
+                'send_mail'=>'Mail',
+                );
+$lang->order_status_add_bar="Add new status";
+$lang->order_status_edit_form_errors=array(
+                'name'=>'incorrect value',
+                'user_id'=>array(
+                                '1'=>'incorrect ID number',
+                                '10'=>'This ID already exists, choose another ID',
+                                ),
+                                
+                );
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/go/_upgrade/lang/_en/lang.inc.php soteesklep3/admin/go/_upgrade/lang/_en/lang.inc.php
--- ../soteesklep3/admin/go/_upgrade/lang/_en/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/go/_upgrade/lang/_en/lang.inc.php	2006-07-11 14:14:02.000000000 +0200
@@ -0,0 +1,103 @@
+<?php
+$lang->upgrade_title="Automatic program upgrading";
+$lang->upgrade_get_info="Attach shop upgrading";
+$lang->upgrade_file_uploaded="Package upgrade file has been attached";
+$lang->upgrade_files="List of updated files";
+$lang->upgrade_done="Upgrading completed";
+$lang->upgrade_pkg=array(
+                '1.01'=>"Enter upgrading marked with number 30003 into the shop. This upgrading is necessary if you want to install next improvements in the shop. ",
+                );
+$lang->upgrade_checksums_upgrade_error="Unsuccessful control sum base updating";
+$lang->upgrade_checksums_upgraded="Control sum base has been updated";
+$lang->upgrade_file_status=array(
+                '2'=>"Ignored. Disk version is newer than update version. ",
+                '1'=>"File has not been updated. Customer modification has been detected.",
+                '3'=>"Ignored. Individual modification file",
+                '4'=>"Approved in previous updating",
+                );
+$lang->upgrade_file_status_simulation=array(
+                '2'=>"Test: Disk version is newer than update version. ",
+                '1'=>"Test: Customer modification has been detected.",
+                '3'=>"Test: Individual modification file",
+                '4'=>"Test: Approved in previous updating",
+                );
+$lang->upgrade_name_theme="Theme name for updating";
+$lang->upgrade_25_description="Version updating 2.5->3.0";
+$lang->upgrade_25_error="Data has not been updated";
+$lang->upgrade_25_done="Data has been updated";
+$lang->upgrade_25_menu=array(
+                'order'=>"Update transaction data from version 2.5->3",
+                'users'=>"Update customer data from version 2.5->3.0",
+                'themes'=>"Update version theme 2.5->3.0",
+                );
+$lang->upgrade_prev="Upgrading installed in the shop";
+$lang->upgrade_updates="Install upgrades";
+$lang->upgrade_check_new="Check available upgrades";
+$lang->upgrade_nomd5_info="No control sum base of the program";
+$lang->upgrade_md5_install="Load base";
+$lang->upgrade_md5_installed="Contrtol sum base installed";
+$lang->upgrade_md5_continue="Move to upgrading system";
+$lang->upgrade_to_install="Upgrade packets available to be installed (packet available on the page <a
+href=http://service.soteshop.com>http://service.soteshop.com</a>)";
+$lang->upgrade_check_new_version_title="Available upgrades check";
+$lang->upgrade_new_not_found="At the moment all upgrades available for the version are installed in the shop.<br />
+There are no new upgrades. ";
+$lang->upgrade_database_updated="Database has been updated";
+$lang->upgrade_diff_title="Automatic connection of changes in file with changes in update packet";
+$lang->upgrade_file_repair="Analyse/Connect changes";
+$lang->upgrade_file_not_found="No file data";
+$lang->upgrade_file=array(
+                'path'=>"File version on a disk",
+                'upgrade'=>"File version in an update packet",
+                'diff'=>"<b>File from a disk with modifications from update packet</b>",
+                );
+$lang->upgrade_diff_patch="Detected differences/preview";
+$lang->upgrade_unknown_gid="No GID number. Graphic files have not been updated";
+$lang->upgrade_individual_mod="individual modification";
+$lang->upgrade_error_ext="Wrong file format";
+$lang->upgrade_wrong_format="Error: Unknown version: wrong patch format.";
+$lang->upgrade_devel_config="Configuration for DEVELOPERS";
+$lang->upgrade_modified="Modified";
+$lang->upgrade_diff_file_upgraded="File saved and it will be installed during this session together with package installation.<br> Attention! After logging out repeat the operation of connecting changes.";
+$lang->upgrade_files_list="List of files in upgrade package";
+$lang->upgrade_files_simulation="Result of simulated installation of upgrade package. Control sum verification.";
+$lang->upgrade_already_installed="Package installed";
+$lang->upgrade_wrong_pkg_number="Incorrect package number. Packages should be installed in correct order";
+$lang->upgrade_legend_title="Legend";
+$lang->upgrade_legend=array(
+                '0'=>"Correct file",
+                '1'=>"Modified file",
+                '2'=>"File on disc is newer than file from upgrading",
+                '3'=>"Modified file, individual modification",
+                '4'=>"Modified file, approved during previous upgrading",
+                'repair'=>"File modification edit. <b> Option only for advanced PHP programmers",
+                );
+$lang->upgrade_update="Install upgrade";
+$lang->upgrade_update_not_allowed="System found conflicts in files. Upgrade cannot be installed.";
+$lang->upgrade_hard_install="Ignore conflicts. Install files from upgrade package.";
+$lang->upgrade_terms="<B>ATTENTION!</B>
+<OL>
+<LI>Upgrade installation will cause overwriting these files in which 
+modification in relation to the original file version was found.
+<LI>It can cause disappearance of changes individually introduced to the file.
+In order to connect changes, after installing the package they should be introduced
+once again (the system will copy files from the shop).
+<LI>Quarantee DOES NOT COMPRISE introducing individual changes to files
+installed from the upgrade package.
+</OL>";
+$lang->upgrade_file_info="The system tested automatic connection of changes introduced in the upgrade package with changes individually introduced to a given file.<BR>
+<B>ATTENTION!</B>
+<OL>
+<LI>Make a copy of the file being installed in order to ensure the possibility of restoring the original version.
+<LI>Quarantee DOES NOT COMPRISE installation of changes. If you are not sure about connected changes, DO NOT INSTALL the file.
+<LI>Quarantee DOES NOT COMPRISE introducing individual changes to files installed from the upgrade package.
+</OL>";
+$lang->upgrade_accept="Accept";
+$lang->bugs_download_source="Look through the file to be installed (with connected changes)";
+$lang->bugs_download_diff_result="Look through the differences found between the package file and the original version.";
+$lang->upgrade_repo_not_exists="Changes cannot be connected automatically. No repositorium of the version. Information has been sent to the administrator. Try later.";
+$lang->upgrade_info_code="Optional code";
+$lang->upgrade_code_error="Incorrect package activating code.";
+$lang->upgrade_error_save_pkg="Package cannot be saved in ./admin/upgrade";
+$lang->upgrade_img="[IMG]";
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/lang/_en/lang.inc.php soteesklep3/admin/lang/_en/lang.inc.php
--- ../soteesklep3/admin/lang/_en/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/lang/_en/lang.inc.php	2006-07-11 14:14:05.000000000 +0200
@@ -0,0 +1,795 @@
+<?php
+$lang->yes="yes";
+$lang->no="no";
+$lang->or="or";
+$lang->installed="OK";
+$lang->not_installed="Not installed";
+$lang->required="Required";
+$lang->next="Next";
+$lang->more="more";
+$lang->reset="[_]";
+$lang->go=">";
+$lang->delete="delete";
+$lang->go2trash="delete";
+$lang->upload="Upload";
+$lang->lock="Lock";
+$lang->export="Export";
+$lang->save="Save";
+$lang->change="Change";
+$lang->time_execute="page generation time";
+$lang->set_language="Change language";
+$lang->search="Search";
+$lang->edit_submit="Update changes";
+$lang->update="Update";
+$lang->login="user";
+$lang->logout="Log out";
+$lang->choose="Choose";
+$lang->tips=array(
+                '0'=>"The best idea for e-commerce",
+                '1'=>"Protects your data",
+                '2'=>"Allows creating the shop aspect",
+                '3'=>"Complex solutions for e-commerce",
+                );
+$lang->netto="net";
+$lang->brutto="gross";
+$lang->trash="Remove";
+$lang->back="<< back";
+$lang->page="Page";
+$lang->records="Records";
+$lang->empty_list_message="No records";
+$lang->first="Beginning";
+$lang->edit_category="Edit category";
+$lang->info="Information";
+$lang->choose_language="Choose language";
+$lang->az="abcdefghijklmnoprstuvwwyz";
+$lang->transalate="Translate";
+$lang->edit_update_ok="Data has been updated";
+$lang->order_by=array(
+                'name'=>"Name",
+                'price'=>"Price",
+                'producer'=>"Producer",
+                'SCORE'=>"Matching",
+                'partner'=>"Partner",
+                'rake_off'=>"Commission",
+                'amount'=>"Amount",
+                );
+$lang->sort="Sort";
+$lang->producers="Producers";
+$lang->admin_top_menu=array(
+                'register'=>"Register licence (activate starting service panel)",
+                'merchant'=>"Salesperson data. Shop address",
+                'reports'=>"Reports",
+                'stats'=>"Statistics",
+                'themes'=>"Aspect editing",
+                'admin'=>"Administrator",
+                'configure'=>"Configuration",
+                );
+$lang->super_admin="super admin";
+$lang->admin_users=array(
+                'admin'=>"admin",
+                'normal'=>"normal",
+                );
+$lang->menu=array(
+                'add_product'=>"Add product",
+                'all_products'=>"All products",
+                'edit_category'=>"Edit categories",
+                );
+$lang->choose_category="Choose category";
+$lang->producer_select="Choose producer";
+$lang->and="and";
+$lang->all="All";
+$lang->search_date="Search according to date";
+$lang->search_from="from";
+$lang->search_to="to";
+$lang->search_submit="Search";
+$lang->title="SOTESHOP administration";
+$lang->bar_title=array(
+                'order'=>"Transaction management",
+                'order_edit'=>"Transaction number:",
+                'order_search'=>"Transaction search",
+                'xml_options'=>"Advanced options",
+                'users'=>"Customer data management",
+                'users_edit'=>"Customer data editing",
+                'users_order'=>"Customer order list",
+                'users_search'=>"Customer search",
+                'users_points'=>"Customer's points edition",
+                'category_all'=>"All products",
+                'points'=>"Point recalculation editing",
+                'currency'=>"Currencies",
+                'newsletter'=>"Newsletter",
+                'opt'=>"Optimization",
+                );
+$lang->plugins="Plugins";
+$lang->plugins_name=array(
+                'market'=>"Market",
+                'discounts'=>"Discounts",
+                'newsletter'=>"Newsletter",
+                'reviews'=>"Reviews",
+                'sales'=>"Merchants",
+                'synch'=>"Synchronization",
+                );
+$lang->check_version="check program upgrades";
+$lang->icons=array(
+				'plugins'=>"Plugins / Additions",
+                'text'=>"Text change",
+                'opt'=>"Optimization",
+                'customers'=>"Customers",
+                'orders'=>"Orders",
+                'delivery'=>"Delivery",
+                'availability'=>"Availability",
+                'currency'=>"Rate of currency exchange",
+                'discounts'=>"Discounts",
+                'reviews'=>"Reviews",
+                'merchants'=>"Merchants",
+                'options'=>"Plugins",
+                'newsedit'=>"Newsedit",
+                'vat'=>"VAT rates",
+                'lang'=>"Languages",
+                'stats_pro'=>"PRO statistics",
+                'stats'=>"Reports/Statistics",
+                'help'=>"Documentation",
+                'newsletter'=>"Newsletter",
+                'main_keys'=>"Code editing",
+                'cd'=>"CD version",
+                'promotions'=>"Promotions",
+                'offline'=>"Import/Export",
+                'partners'=>"Partners",
+                'docs'=>"Documentation",
+                'onet'=>"Onet Passage",
+                'wp'=>"WP Passage",
+                'dictionary'=>"Dynamic dictionary",
+                'language_versions'=>"Constant language definitions",
+                'help_management'=>"Help editing",
+                'lang_update'=>"Language import",
+                'configure'=>"Configuration",
+                'market'=>"Market",
+                'catalog_mode'=>"Catalog mode",
+                'ask4price'=>"Ask for price",
+                'platnoscipl'=>"Payments PL (PlatnosciPL)",
+				'google'=>"Google indexing",
+				'ceneo'=>"Ceneo.pl",
+				'assoc_rules'=>"Product recommendation",
+				'basket_wishlist'=>"Basket / Repository",
+                'allegro'=>"Allegro",
+                );
+$lang->main_version="Updating SOTESHOP version ";
+$lang->main_welcome="Welcome to the <b>SOTESHOP</b> management system. Enjoy your work.";
+$lang->head_update="SOTESHOP v3.x updating";
+$lang->order_list=array(
+                'date'=>"Date",
+                'status'=>"Status",
+                'amount'=>"Amount",
+                'paid'=>"Paid",
+                'payment'=>"Payment",
+                'paid_online'=>"Paid online",
+                'partner_name'=>"Partner",
+                'partner_rake_off'=>"Commission",
+                'payed_online'=>"Paid online",
+                'lang'=>"Language",
+                );
+$lang->delivery_list=array(
+                'id'=>"ID",
+                'name'=>"Name",
+                'nofee'=>"No fee from",
+                'brutto_price'=>"Gross price",
+                'order'=>"Order",
+                );
+$lang->groups_list=array(
+                'name'=>"Name",
+                'number'=>"Number of users",
+                );
+$lang->newsletter_list=array(
+                'email'=>"Email address",
+                'register_date'=>"Register date",
+                'status'=>"Status",
+                );
+$lang->bool=array(
+                '1'=>"yes",
+                '0'=>"no",
+                );
+$lang->cols=array(
+                'id'=>"ID",
+                'user_id'=>"User id",
+                'name'=>"Name",
+                'price_brutto'=>"Gross price",
+                'price_currency'=>"Price",
+                'vat'=>"VAT",
+                'price_brutto_detal'=>"Old price",
+                'price_brutto_2'=>"Wholesale gross price",
+                'price_2'=>"Wholesale price",
+                'producer'=>"Producer",
+                'category1'=>"Category 1",
+                'category2'=>"Category 2",
+                'category3'=>"Category 3",
+                'category4'=>"Category 4",
+                'category5'=>"Category 5",
+                'xml_options'=>"Options",
+                'photo'=>"Photo",
+                'xml_description'=>"Description",
+                'xml_short_description'=>"Short description",
+                'main_page'=>"Main page",
+                'newcol'=>"New product",
+                'promotion'=>"Promotion",
+                'bestseller'=>"Bestseller",
+                'id_available'=>"Availability",
+                'accessories'=>"Accessories",
+                'hidden_price'=>"Hide the price",
+                'ask4price'=>"Ask about the price",
+                'status_vat'=>"Sale without VAT",
+                'weight'=>"Weight",
+                'onet'=>"Export",
+                'onet_category'=>"Category id",
+                'onet_attr'=>"Onet attribute",
+                'discount'=>"Discount",
+                'max_discount'=>"Maximum discount",
+                'main_keys_online'=>"Online sale",
+                'active'=>"Active",
+                'category_multi_1'=>"Additional category 1 (Cat 1/Cat 2...)",
+                'category_multi_2'=>"Additional category 2",
+                 'points_value'=>"Value in points",
+                'points'=>"Product for points",
+                'sms'=>"Product for SMS",
+                );
+$lang->nccp_error="Product has been not added to database. Product number limit  exceeded.";
+$lang->upload_file="attach file";
+$lang->record_add="Record has been added";
+$lang->delete_empty="Basket is empty";
+$lang->delete_not_found="record on not found";
+$lang->deleted="deleted record";
+$lang->auth_www="WWW authorization, <br>database access";
+$lang->auth_www_error="Logging data different from database access data.";
+$lang->auth_ftp="FTP access<br>  ";
+$lang->server_ftp="FTP server";
+$lang->port_ftp="FTP port ";
+$lang->ftp_auth_ok="Authorization correct";
+$lang->password="password";
+$lang->password_old="enter old password";
+$lang->password_new="enter new password";
+$lang->password_confirm="confirm password";
+$lang->password_change="enter changes";
+$lang->auth_www_form_errors=array(
+                'login'=>"incorrect value",
+                'password_old'=>"incorrect value",
+                'password_new'=>"no password",
+                'password_confirm'=>"incorrect password repetition",
+                );
+$lang->opt_ok="Optimization finished";
+$lang->empty_main="No records";
+$lang->empty_trash="Delete <img src=/themes/base/base_theme/_img/trash.png width=15 height=15 border=0>";
+$lang->submit_upload_file="attach file";
+$lang->search_empty_query="Incorrect search string. Enter name of product you are looking for.";
+$lang->delivery_bar="Delivery costs management";
+$lang->delivery_menu=array(
+                'add'=>"New deliverer",
+                'list'=>"Deliverer list",
+                'zone'=>"Delivery zone",
+                'volume'=>"Volume",
+                'help'=>"Help",
+                'delivery'=>"Delivery",
+                'config'=>"Configuration",
+                );
+$lang->delivery_edit="Edit deliverer properties";
+$lang->delivery_cols=array(
+                'name'=>"deliverer name",
+                'order_by'=>"display order",
+                'price_brutto'=>"delivery costs",
+                'vat'=>"vat",
+                'free_from'=>"free delivery from",
+                'delivery_info'=>"additional information",
+                'delivery_zone'=>"Delivery cost in zones",
+                );
+$lang->delivery_edit_form_errors=array(
+                'name'=>"incorrect value",
+                'price_brutto'=>"incorrect value",
+                'vat'=>"incorrect value",
+                'free_from'=>"incorrect value",
+                );
+$lang->delivery_add_bar="Add new deliverer";
+$lang->newsletter_update_bar="User modification";
+$lang->newsletter_send="Newsletter sending";
+$lang->newsletter_search="Search";
+$lang->newsletter_menu=array(
+                'add'=>"Add address",
+                'edit'=>"Data editing",
+                'list'=>"User list",
+                'send'=>"Send newsletter",
+                'search'=>"Search",
+                );
+$lang->newsletter_cols=array(
+                'subject'=>"Subject",
+                'content'=>"Message",
+                'id'=>"id",
+                'email'=>"Email address",
+                'status'=>"Status",
+                'active'=>"Active",
+                'string'=>"Search",
+                );
+$lang->newsletter_form_errors=array(
+                'email'=>"No email address",
+                );
+$lang->offline="Off-line system";
+$lang->offline_update="Off-line updating: price list attachment";
+$lang->offline_status="Off-line updating: updating status";
+$lang->offline_example="Off-line updating: example files";
+$lang->offline_update_now="Off-line updating: data loading";
+$lang->offline_backup_bar="Database backup";
+$lang->order_status_bar="Order status";
+$lang->order_status_menu=array(
+                'add'=>"New status",
+                'list'=>"Status list",
+                'help'=>"Help",
+                );
+$lang->order_status_edit="Edit order status";
+$lang->order_status_cols=array(
+                'name'=>"Status name",
+                'user_id'=>"Id",
+                );
+$lang->order_status_edit_form_errors=array(
+                'name'=>"bad value",
+                'user_id'=>"bad value",
+                );
+$lang->order_status_add_bar="Add new status";
+$lang->partner_names=array(
+                'partner'=>"Onet Passage",
+                );
+$lang->onet_status=array(
+                'tak'=>"Register in Onet Passage",
+                'nie'=>"Do not register in Onet Passage",
+                'ok'=>"Approved",
+                );
+$lang->order_names=array(
+                'order_id'=>"order number",
+                'session_id'=>"session number",
+                'amount'=>"total order amount",
+                'delivery_cost'=>"delivery costs",
+                'id_currency'=>"currency",
+                'id_pay_method'=>"payment method",
+                'date_add'=>"date",
+                'time_add'=>"time",
+                'remote_ip'=>"Remote IP address",
+                'email'=>"e-mail",
+                'xml_description'=>"Order",
+                'id_user'=>"Customer id",
+                'xml_user'=>"Customer's details",
+                'name'=>"Customer",
+                'id_delivery'=>"Deliverer",
+                'id_status'=>"Status",
+                'confirm'=>"Payed",
+                'confirm_user'=>"Confirmed",
+                'description'=>"Additional information",
+                'status'=>"Status",
+                'checksum'=>"order checksum",
+                'send_date'=>"Package send date",
+                'send_number'=>"Package number",
+                'send_confirm'=>"Package was sent",
+                'onet_pasaz'=>"Register in Onet Pasaz",
+                );
+$lang->order_search=array(
+                'amount'=>"Total order amount",
+                'pay_method'=>"Payment method",
+                'confirm'=>"Confirmed payment",
+                'status'=>"Order status",
+                'order_id'=>"Order Id",
+                );
+$lang->order_basket=array(
+                'name'=>"product name",
+                'options'=>"options",
+                'user_id'=>"id",
+                'price_netto'=>"cena netto",
+                'vat'=>"VAT",
+                'num'=>"ilo¶æ",
+                'price_brutto'=>"cena brutto",
+                'sum'=>"suma",
+                );
+$lang->order_form_name=array(
+                'firm'=>"firma",
+                'name'=>"name",
+                'surname'=>"surname",
+                'street'=>"street",
+                'street_n1'=>"house number",
+                'street_n2'=>"flat number",
+                'postcode'=>"post code",
+                'city'=>"city",
+                'phone'=>"phone",
+                'email'=>"e-mail",
+                'nip'=>"nip",
+                'description'=>"remarks",
+                );
+$lang->order_billing="Customer data";
+$lang->order_cor="Delivery data";
+$lang->order_go2_users="Customer's details";
+$lang->send=array(
+                'subject'=>"subject",
+                'message'=>"message",
+                'submit'=>"Send message",
+                );
+$lang->points=array(
+                'title_edit'=>"number of points for every 100",
+                );
+$lang->points_category="Shopping for points";
+$lang->onet=array(
+                'category_list'=>"choose category",
+                );
+$lang->currency_menu=array(
+                'add'=>"Add currency",
+                'list'=>"Currency rates/Change",
+                'nbp'=>"NBP rates",
+                );
+$lang->currency_cols=array(
+                'id'=>"ID",
+                'currency_name'=>"Currency ",
+                'currency_val'=>"Rate ",
+                'date_update'=>"Date",
+                );
+$lang->currency_add_bar="Add currency";
+$lang->currency_update_bar="Rate of currency exchange/Modifications";
+$lang->currency_form_errors=array(
+                'currency_name'=>"no currency symbol/or currency symbol already exists in database",
+                'currency_val'=>"no rate of currency exchange/or wrong format",
+                );
+$lang->id="Id";
+$lang->add="Add";
+$lang->help="Help";
+$lang->new="new";
+$lang->close="Close";
+$lang->add_info="Additional information";
+$lang->lang="Language";
+$lang->select_all="all";
+$lang->welcome="Welcome";
+$lang->cancel="Cancel";
+$lang->change_img="<img
+src=/themes/base/base_theme/_icons/button_edit.png
+border=0 alt='Change'>";
+$lang->html="HTML";
+$lang->pdf="PDF";
+$lang->right_choose_layout="Choose panel aspect";
+$lang->hidden="hide";
+$lang->edit="edit";
+$lang->user_log_on="Logged in";
+$lang->wysiwyg_button="HTML editor";
+$lang->currency_nbp_bar="Present currency exchange rates according to the National Bank  of Poland";
+$lang->currency_nbp=array(
+                'welcome_text'=>"Display of currency exchange rate form",
+                'country'=>"Country",
+                'currency_name'=>"Currency name",
+                'currency_code'=>"Currency code",
+                'exchange'=>"Present exchange rate",
+                );
+$lang->opt_short_info="Category and producer optimization";
+$lang->pay_fraud=array(
+                '1'=>"Control sum is incorrect!!!",
+                '2'=>"Control sum of online payment acknowledgement is not correct!!!",
+                '10'=>"Accounts sum different from order sum",
+                '300'=>"Risk has not been checked",
+                '301'=>"Small risk",
+                '302'=>"High risk!",
+                '303'=>"Very high risk",
+                );
+$lang->pay_status=array(
+                '000'=>"Transaction is waiting for salesperson acknowledgement",
+                '001'=>"Transaction approved by salesperson for payment",
+                '002'=>"Transaction paid",
+                '010'=>"Transaction marked to be cancelled",
+                '050'=>"Rejected transaction",
+                '053'=>"Cancellation of transaction confirmed",
+                '054'=>"Return of means to customer confirmed",
+                '301'=>"Transaction sent to PolCard to be confirmed. Shop has not received confirmation (CFD) yet.",
+                '321'=>"This transaction is not present in PolCard system",
+                '324'=>"Transaction ready to be paid too late",
+                '325'=>"Sum higher than authorization sum",
+                '326'=>"Transaction has been already paid.",
+                '327'=>"attempt to acknowledge unpaid transaction as paid",
+                '328'=>"Sum below lower transaction limit",
+                '329'=>"Unknown transaction type (not Debit, not Credit), contact PolCard",
+                '330'=>"Incorrect payment calculation - no authorization date",
+                '350'=>"Incorrect transaction verification",
+                '351'=>"Transaction data is not correct - verify this transaction in PolCard",
+                '352'=>"Transaction rejected - it was ready to be paid too late",
+                '394'=>"Sum of transaction return during payment  calculation was different from transaction sum ",
+                '395'=>"Sum of transaction payment confirmation is different from transaction sum",
+                '396'=>"Error in PolCard system, contact PolCard",
+                '397'=>"Incorrect payment calculation - error in generating payment calculation file ",
+                '398'=>"Error in PolCard database",
+                '399'=>"Transaction has not been verified. Unidentified irreversible error",
+                );
+$lang->ftp_go2newpass="Unsuccessful connection with FTP account. Enter new password into FTP account";
+$lang->ftp_new_password="Enter new password";
+$lang->opt_short_buttons=array(
+                'category'=>"Category",
+                'producers'=>"Producer",
+                'category_producers'=>"Category and producer",
+                );
+$lang->foot_search_product="Show product (ID)";
+$lang->foot_search_order="Show order (ID)";
+$lang->translate="<img src=/themes/base/base_theme/_img/add2dict.png width=18 height=18 border=0>";
+$lang->no_item="no items";
+$lang->sum="sum";
+$lang->underline_diff="Expose the differences";
+$lang->real_propor="Show real proportions";
+$lang->country_user_def="Choose country";
+$lang->country=array(
+                'AF'=>"Afghanistan",
+                'AL'=>"Albania",
+                'DZ'=>"Algeria",
+                'AS'=>"American Somoa",
+                'AD'=>"Andorra",
+                'AO'=>"Angola",
+                'AI'=>"Anguilla",
+                'AQ'=>"Antartica",
+                'AG'=>"Antigua and Barbuda",
+                'AE'=>"Arab Emirates (United)",
+                'AR'=>"Argentina",
+                'AM'=>"Armenia",
+                'AW'=>"Aruba",
+                'AU'=>"Australia",
+                'AT'=>"Austria",
+                'AZ'=>"Azerbaidjan",
+                'BS'=>"Bahamas",
+                'BH'=>"Bahrain",
+                'BD'=>"Bangladesh",
+                'BB'=>"Barbados",
+                'BY'=>"Belarus",
+                'BE'=>"Belgium",
+                'BZ'=>"Belize",
+                'BJ'=>"Benin",
+                'BM'=>"Bermuda",
+                'BT'=>"Bhutan",
+                'IO'=>"British Indian Ocean Territory",
+                'BN'=>"Brunei Darussalam",
+                'BO'=>"Bolivia",
+                'BA'=>"Bosnia and Herzegovina",
+                'BV'=>"Bouvet Island",
+                'BW'=>"Botswana",
+                'BR'=>"Brazil",
+                'BF'=>"Bukina Faso",
+                'BG'=>"Bulgaria",
+                'BI'=>"Burndi",
+                'KH'=>"Cambodia, Kingdom of",
+                'CM'=>"Cameroon",
+                'CA'=>"Canada",
+                'CV'=>"Cape Verde",
+                'KY'=>"Cayman Islands",
+                'CF'=>"Central African Republic",
+                'TD'=>"Chad",
+                'CL'=>"Chile",
+                'CN'=>"China",
+                'CX'=>"Christmas Island",
+                'HR'=>"Croatia",
+                'CC'=>"Cocos Islands",
+                'CO'=>"Colombia",
+                'KM'=>"Comoros",
+                'CG'=>"Congo",
+                'CD'=>"Congo, The Democratic Republic of the",
+                'CR'=>"Costa Rica",
+                'CK'=>"Cook Islands",
+                'CU'=>"Cuba",
+                'CY'=>"Cyprus",
+                'CZ'=>"Czech Republic",
+                'DK'=>"Denmark",
+                'DJ'=>"Djibouti",
+                'DM'=>"Dominica",
+                'DO'=>"Dominican Republic",
+                'TP'=>"East Timor",
+                'EC'=>"Ecuador",
+                'EG'=>"Egypt",
+                'SV'=>"El Salvador",
+                'GQ'=>"Equatorial Guinea",
+                'ER'=>"Eritrea",
+                'EE'=>"Estonia",
+                'ET'=>"Ethiopia",
+                'FK'=>"Falkland Islands",
+                'FO'=>"Faroe Islands",
+                'FJ'=>"Fiji",
+                'FI'=>"Finland",
+                'FR'=>"France",
+                'FX'=>"France (European Territory)",
+                'GF'=>"French Guyana",
+                'TF'=>"French Southern Territories",
+                'GA'=>"Gabon",
+                'GM'=>"Gambia",
+                'DE'=>"Germany",
+                'GE'=>"Georgia",
+                'GH'=>"Ghana",
+                'GI'=>"Gibraltar",
+                'GB'=>"Great Britain",
+                'GR'=>"Greece",
+                'GL'=>"Greenland",
+                'GD'=>"Grenada",
+                'GP'=>"Guadeloupe (French)",
+                'GT'=>"Guatemala",
+                'GN'=>"Guinea",
+                'GU'=>"Guam (USA)",
+                'GW'=>"Guinea Bissau",
+                'GY'=>"Guyana",
+                'HT'=>"Haiti",
+                'HM'=>"Heard and Mcdonald Islands",
+                'HN'=>"Honduras",
+                'HK'=>"Hong Kong",
+                'HU'=>"Hungary",
+                'IS'=>"Iceland",
+                'IN'=>"India",
+                'ID'=>"Indonesia",
+                'IQ'=>"Iraq",
+                'IR'=>"Iran",
+                'IE'=>"Ireland",
+                'IL'=>"Israel",
+                'IT'=>"Italy",
+                'CI'=>"Ivory Coast",
+                'JM'=>"Jamaica",
+                'JP'=>"Japan",
+                'JO'=>"Jordan",
+                'KZ'=>"Kazakhstan",
+                'KE'=>"Kenya",
+                'KI'=>"Kiribati",
+                'KW'=>"Kuwait",
+                'KG'=>"Kyrgyz Republic (Kyrgyzstan)",
+                'LA'=>"Laos",
+                'LV'=>"Latvia",
+                'LB'=>"Lebanon",
+                'LS'=>"Lesotho",
+                'LR'=>"Liberia",
+                'LY'=>"Libya",
+                'LI'=>"Liechtenstein",
+                'LT'=>"Lithuania",
+                'LU'=>"Luxembourg",
+                'MO'=>"Macau",
+                'MK'=>"Macedonia",
+                'MG'=>"Madagascar",
+                'MY'=>"Malaysia",
+                'MW'=>"Malawi",
+                'MV'=>"Maldives",
+                'ML'=>"Mali",
+                'MT'=>"Malta",
+                'MH'=>"Marshall Islands",
+                'MR'=>"Mauritania",
+                'MU'=>"Mauritius",
+                'MQ'=>"Martinique (French)",
+                'YT'=>"Mayotte",
+                'MX'=>"Mexico",
+                'FM'=>"Micronesia",
+                'MD'=>"Moldavia",
+                'MC'=>"Monaco",
+                'MN'=>"Mongolia",
+                'MS'=>"Montserrat",
+                'MA'=>"Morocco",
+                'MZ'=>"Mozambique",
+                'MM'=>"Myanmar",
+                'NA'=>"Namibia",
+                'NR'=>"Nauru",
+                'NP'=>"Nepal",
+                'NI'=>"Nicaragua",
+                'NE'=>"Niger",
+                'NG'=>"Nigeria",
+                'NU'=>"Niue",
+                'NL'=>"Netherlands",
+                'AN'=>"Netherlands Antilles",
+                'NC'=>"New Caledonia",
+                'NZ'=>"New Zealand",
+                'NO'=>"Norway",
+                'KP'=>"North Korea",
+                'MP'=>"Northern Mariana Islands",
+                'OM'=>"Oman",
+                'PK'=>"Pakistan",
+                'PW'=>"Palau",
+                'PA'=>"Panama",
+                'PG'=>"Papua New Guinea",
+                'PY'=>"Paraguay",
+                'PE'=>"Peru",
+                'PH'=>"Philippines",
+                'PN'=>"Pitcairn Island",
+                'PL'=>"Poland",
+                'PF'=>"Polynesia (French)",
+                'PT'=>"Portugal",
+                'PR'=>"Puerto Rico",
+                'QA'=>"Qatar",
+                'RE'=>"Reunion",
+                'RO'=>"Romania",
+                'RU'=>"Russian Federation",
+                'RW'=>"Rwanda",
+                'GS'=>"S. Georgia and S. Sandwich Isls.",
+                'SH'=>"Saint Helena",
+                'KN'=>"Saint Kitts and Nevis Anguilla",
+                'LC'=>"Saint Lucia",
+                'PM'=>"Saint Pierre and Miquelon",
+                'ST'=>"Saint Tome and Principe",
+                'VC'=>"Saint Vincent and Grenadines",
+                'WS'=>"Samoa",
+                'SM'=>"San Marino",
+                'SA'=>"Saudi Arabia",
+                'SN'=>"Senegal",
+                'SC'=>"Seychelles",
+                'SL'=>"Sierra Leone",
+                'SG'=>"Singapore",
+                'SK'=>"Slovak Republic",
+                'SI'=>"Slovenia",
+                'SB'=>"Solomon Islands",
+                'ZA'=>"South Africa",
+                'KR'=>"South Korea",
+                'SO'=>"Somalia",
+                'ES'=>"Spain",
+                'LK'=>"Sri Lanka",
+                'SD'=>"Sudan",
+                'SR'=>"Suriname",
+                'SZ'=>"Swaziland",
+                'SE'=>"Sweden",
+                'CH'=>"Switzerland",
+                'SY'=>"Syria",
+                'TJ'=>"Tadjikistan",
+                'TW'=>"Taiwan",
+                'TZ'=>"Tanzania",
+                'TH'=>"Thailand",
+                'TG'=>"Togo",
+                'TK'=>"Tokelau",
+                'TO'=>"Tonga",
+                'TT'=>"Trinidad and Tobago",
+                'TN'=>"Tunisia",
+                'TR'=>"Turkey",
+                'TM'=>"Turkmenistan",
+                'TC'=>"Turks and Caicos Islands",
+                'TV'=>"Tuvalu",
+                'UG'=>"Uganda",
+                'UA'=>"Ukraine",
+                'US'=>"United States of America",
+                'UY'=>"Uruguay",
+                'UM'=>"Usa Minor Outlying Islands",
+                'UZ'=>"Uzbekistan",
+                'VU'=>"Vanuatu",
+                'VA'=>"Vatican City State(Holy See)",
+                'VE'=>"Venezuela",
+                'VN'=>"Vietnam",
+                'VG'=>"Virgin Islands (British)",
+                'VI'=>"Virgin Islands (USA)",
+                'WF'=>"Wallis and Futuna Islands",
+                'EH'=>"Western Sahara",
+                'YE'=>"Yemen",
+                'YU'=>"Yugoslavia",
+                'ZR'=>"Zaire",
+                'ZM'=>"Zambia",
+                'ZW'=>"Zimbabwe",
+                'NT'=>"Neutral Zone",
+                );
+$lang->advanced_search="Avanced search";
+$lang->products_from_category="Products from a selected category";
+$lang->ftp_upload_error="File wasn't uploaded (max:";
+$lang->pay_method=array(
+                '1'=>"Upon reciept",
+                '2'=>"eCard",
+                '3'=>"PolCard",
+                '4'=>"Inteligo",
+                '5'=>"mBank",
+                '6'=>"CitiConnect",
+                '7'=>"PayU",
+                '11'=>"Transfer",
+                '12'=>"Przelewy 24",
+                '20'=>"PlatnosciPL",
+                '21'=>"Allpay",
+                '101'=>"PayPal",
+                '110'=>"Platnosc karta",
+                );
+                
+$lang->admin_bottom_menu=array("polcard"=>"PolCard",
+                               "p24"=>"Przelewy24.pl",
+                               "pasaz.onet.pl"=>"Pasaz Onet",
+                               "pasaz.wp.pl"=>"Pasaz WP",
+                               "pasaz.interia.pl"=>"Pasaz Interia",
+                               "payments"=>"Platnosci",
+                               "ext_store"=>"Pasaze",
+                               );
+
+$lang->multi_shop=array("master"=>"Master",
+                        "slave"=>"Slave",
+                        "single"=>"Single",
+                        "multi_shop"=>"MultiShop",
+                        );
+
+$lang->ftp_upload_count_error="5 attempts to copy a file by ftp have been made";
+$lang->ftp_upload_info="The following file has to be copied manually";
+$lang->admin_bottom_menu=array("polcard"=>"PolCard",
+                               "p24"=>"Przelewy24.pl",
+                               "pasaz.onet.pl"=>"Pasa¿ Onet",
+                               "pasaz.wp.pl"=>"Pasa¿ WP",
+                               "pasaz.interia.pl"=>"Pasa¿ Interia",
+                               "payments"=>"P³atno¶ci",
+                               "ext_store"=>"Pasa¿e",
+                               );
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/plugins/_main_keys/_main_keys_ftp/lang/_en/lang.inc.php soteesklep3/admin/plugins/_main_keys/_main_keys_ftp/lang/_en/lang.inc.php
--- ../soteesklep3/admin/plugins/_main_keys/_main_keys_ftp/lang/_en/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_main_keys/_main_keys_ftp/lang/_en/lang.inc.php	2006-07-11 14:14:10.000000000 +0200
@@ -0,0 +1,35 @@
+<?php
+$lang->main_keys_ftp_bar="main_keys_ftp";
+$lang->main_keys_ftp_add_bar="Add a new file";
+$lang->main_keys_ftp_record_add="Record added";
+$lang->main_keys_ftp_update_bar="Record updating";
+$lang->main_keys_ftp_edit_update_ok="Record updated";
+$lang->main_keys_ftp_form_errors=array(
+                'ftp'=>"No file location (ftp://path or http://path)",
+                'user_id_main'=>array(
+                                '0'=>"No product ID",
+                                '1'=>"Too long ID value",
+                                '10'=>"Product with this ID does not exist",
+                                '11'=>"File is already attached to this product<br>Two files cannot be attached to 1 product.",
+                                '12'=>"Product ID cannot be changed in editing",),
+                                );
+$lang->main_keys_ftp_cols=array(
+                'ID'=>"ID",
+                'ftp'=>"FTP file address",
+                'active'=>"Active",
+                'user_id_main'=>"Product ID",
+                'demo'=>"\"DEMO\" file",
+                );
+$lang->main_keys_ftp_cols_list=array(
+                'ID'=>"ID",
+                'user_id_main'=>"ID, product",
+                'ftp'=>"Localization",
+                'active'=>"Active",
+                );
+$lang->main_keys_ftp_menu=array(
+                'add'=>"Add a file",
+                'list'=>"File list",
+                );
+$lang->main_keys_ftp_list_bar="File list";
+$lang->main_keys_ftp_unknown="Unknown";
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/plugins/_newsedit/lang/_en/lang.inc.php soteesklep3/admin/plugins/_newsedit/lang/_en/lang.inc.php
--- ../soteesklep3/admin/plugins/_newsedit/lang/_en/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_newsedit/lang/_en/lang.inc.php	2006-07-11 14:14:12.000000000 +0200
@@ -0,0 +1,58 @@
+<?php
+$lang->newsedit_bar="News management";
+$lang->newsedit_add_bar="Add news";
+$lang->newsedit_menu=array(
+                'add'=>" Add News",
+                'edit'=>"News editing",
+                'configure'=>"Configuration",
+                'list'=>"List and editing",
+                'view'=>"Preview",
+                'help'=>"Help",
+                );
+$lang->configure_form=array(
+                'newsedit'=>"Place news window on the page",
+                'rss_link'=>"Place the link to RSS format under the news list",
+                'newsedit_columns_default'=>"How many columns should the news window be divided into",
+                );
+$lang->newsedit_cols=array(
+                'id'=>"ID",
+                'date_add'=>"Date YYYY-MM-DD",
+                'active'=>"Active",
+                'ordercol'=>"Sorting",
+                'subject'=>"Subject",
+                'category'=>"Category",
+                'short_description'=>"Summary",
+                'description'=>"Content",
+                'photo_small'=>"Small photo",
+                'desc_file'=>"Attach HTML file",
+                'photo1'=>"Photo 1",
+                'photo2'=>"Photo 2",
+                'photo3'=>"Photo 3",
+                'photo4'=>"Photo 4",
+                'photo5'=>"Photo 5",
+                'photo6'=>"Photo 6",
+                'photo7'=>"Photo 7",
+                'photo8'=>"Photo 8",
+                'id_newsedit_groups'=>"Group",
+                'main_page'=>"Place on the main page",
+                'url'=>"Different URL (optional)",
+                'url_auto'=>"Link to message",
+                'multi_groups'=>"Display also in groups",
+                'lang'=>"Language",
+                'group'=>"Group",
+                'rss'=>"RSS",
+                );
+$lang->newsedit_edit_group="Edit groups";
+$lang->newsedit_edit_form_errors=array(
+                'subject'=>"incorrect value",
+                );
+$lang->newsedit_groups_all="All";
+$lang->newsedit_groups_select="Select a group";
+$lang->newsedit_lang_info="Choose a language in which the message will be displayed";
+$lang->newsedit_news="News list";
+$lang->newsedir_conf_bar="Newsedit configuration";
+$lang->newsedit_columns_default=array(
+                '1'=>"1",
+                '2'=>"2",
+);
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/plugins/_newsletter/_users/lang/_en/lang.inc.php soteesklep3/admin/plugins/_newsletter/_users/lang/_en/lang.inc.php
--- ../soteesklep3/admin/plugins/_newsletter/_users/lang/_en/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_newsletter/_users/lang/_en/lang.inc.php	2006-07-11 14:14:15.000000000 +0200
@@ -0,0 +1,88 @@
+<?php
+$lang->tips="Using SOTEeSHOP you can control serial correspondence to your customers in an easy way";
+$lang->newsletter_options=array(
+                'users'=>"Users",
+                'groups'=>"Groups",
+                'send'=>"Send Newsletter",
+                'config'=>"Configuration",
+                );
+$lang->edit_update_ok="Record has been updated :)";
+$lang->newsletter_empty="No e-mail has been sent";
+$lang->newsletter_delete_bar="Record deleting";
+$lang->newsletter_config_bar="Newsletter configuration";
+$lang->newsletter_sending="Newsletter sending";
+$lang->newsletter_users_bar="Addition/User modification";
+$lang->newsletter_search_users="Search in users";
+$lang->newsletter_menu=array(
+                'add'=>"Add an address",
+                'edit'=>"Data editing",
+                'list'=>"Address list",
+                'send'=>"New message",
+                'search'=>"Search",
+                );
+$lang->newsletter_config=array(
+                'options'=>"Parameters",
+                'info'=>"Letter content",
+                'info_link'=>"Link messages",
+                );
+$lang->newsletter_cols=array(
+                'subject'=>"Subject",
+                'content'=>"Message",
+                'id'=>"ID",
+                'email'=>"E-mail address",
+                'status'=>"Status",
+                'active'=>"Active",
+                'groups'=>"Groups",
+                'string'=>"Search (e-mail)",
+                'lang'=>"Language",
+                );
+$lang->groups_menu=array(
+                'add'=>"Add a group",
+                'edit'=>"Data editing",
+                'list'=>"Group list",
+                'search'=>"Search",
+                );
+$lang->newsletter_parametres=array(
+                'sender'=>"Sender address",
+                'default_group'=>"Default group",
+                'head'=>"Greetings",
+                'info_add'=>"Greeting message",
+                'info_del'=>"Good-bye message",
+                'foot_add'=>"Register in confirmation link",
+                'foot_del'=>"Register out confirmation link",
+                'foot_delete'=>"Ina message being sent",
+                );
+$lang->newsletter_groups=array(
+                'name'=>"Group name",
+                'id'=>"ID",
+                );
+$lang->newsletter_choose_lang="Choose a language";
+$lang->newsletter_submit="Save";
+$lang->newsletter_form_errors=array(
+                'email'=>array(
+                                '10'=>"No email address",
+                                '11'=>"Bad email address",
+                                '12'=>"Address is already in database",
+                                ),
+                                
+                );
+$lang->newsletter_letters=" letters";
+$lang->newsletter_sent="Sent: ";
+$lang->newsletter_not_sent="Not sent: ";
+$lang->newsletter_ommited="Omitted: ";
+$lang->newsletter_sent_ok="Newsletter has been sent correctly.";
+$lang->newsletter_sent_error1="Registered user's status is <b>not active</b>. Newsletter has not been sent.";
+$lang->newsletter_sent_error2="Newsletter has not been sent. Incorrect e-mail address or mail program error.";
+$lang->newsletter_no_subject="No News subject";
+$lang->newsleter_no_body="No News content";
+$lang->newsletter_lang_select_info="Choose a group according to the language";
+$lang->newsletter_list=array(
+                'email'=>"E-mail address",
+                'register_date'=>"Registration date",
+                'status'=>"Active",
+                'lang'=>"Language",
+                );
+$lang->newsletter_delete="Click the below link to enter:";
+$lang->no_save_db="Problem with saving information about sent newsletter in database.<br> Report the problem to administrator.";
+$lang->no_open_file="File for saving email addresses cannot be opened.";
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/plugins/_partners/lang/_en/lang.inc.php soteesklep3/admin/plugins/_partners/lang/_en/lang.inc.php
--- ../soteesklep3/admin/plugins/_partners/lang/_en/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_partners/lang/_en/lang.inc.php	2006-07-11 14:14:16.000000000 +0200
@@ -0,0 +1,62 @@
+<?php
+$lang->partners_bar="Partners";
+$lang->partners_add_bar="Add a new partner";
+$lang->partners_record_add="Partner added";
+$lang->partners_update_bar="Record updating";
+$lang->partners_edit_update_ok="Record updated";
+$lang->partners_form_errors=array(
+                'name'=>'Incorrect value',
+                'partner_id'=>'Incorrect value (give 8 digits) or this identifier already exists',
+                'email'=>'Incorrect value (example: p@example.com)',
+                'rake_off'=>'Incorrect value (range 0.1 - 100)',
+                'login'=>'The introduced login is incorrect or such a login already exists in database',
+                'password'=>'The introduced password is incorrect',
+                );
+$lang->partners_cols=array(
+                'ID'=>'ID',
+                'name'=>'Name',
+                'partner_id'=>'Identifier (8 digits)',
+                'www'=>'www address',
+                'email'=>'E-mail address',
+                'rake_off'=>'Commission %',
+                'login'=>'Login',
+                'password'=>'Password',
+                );
+$lang->partners_cols_list=array(
+                'ID'=>'ID',
+                'edit'=>'',
+                'partner_id'=>'Identifier',
+                'name'=>'Name',
+                'www'=>'WWW',
+                'email'=>'E-mail',
+                'rake_off'=>'Commission %',
+                );
+$lang->partners_menu=array(
+                'add'=>'Add a partner',
+                'list'=>'Partner list',
+                'rake_off'=>'Commissions',
+                'transactions'=>'Transactions',
+                'links'=>'Generate links',
+                'help'=>'Help',
+                );
+$lang->partners_list_bar="Partner list";
+$lang->partners_links="Links for partners";
+$lang->partners_gen="Generate";
+$lang->partners_choose="Select a partner";
+$lang->partners_rake_off="Commission calculation for a selected partner in a given period of time";
+$lang->partners_compute_rake_off="Calculate a commission";
+$lang->partners_date="Define the period for which you want to calculate commission";
+$lang->partners_no_transactions="No transaction for this partner in the given period has been found";
+$lang->partners_total_trans_found="Total number of found transactions";
+$lang->partners_total_rake_off="Commission sum for the partner";
+$lang->partners_period="for the period of time from";
+$lang->partners_to="to";
+$lang->partners_no_records="Links cannot be generated because the partner has not been defined yet.";
+$lang->partners_no_records_rake="Commission calculation is not possible because the partner has not been defined yet.";
+$lang->partners_attention="ATTENTION!";
+$lang->partners_links_info="The links generated below should be sent to the partner";
+$lang->partners_partner="Partner";
+$lang->partners_link="Link";
+$lang->partners_email="E-mail";
+$lang->partners_select_all="Select all";
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/plugins/_pay/_allpay/index.php soteesklep3/admin/plugins/_pay/_allpay/index.php
--- ../soteesklep3/admin/plugins/_pay/_allpay/index.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_pay/_allpay/index.php	2006-07-11 14:14:20.000000000 +0200
@@ -0,0 +1,116 @@
+<?php
+/**
+ * Konfiguracja modu³u allpay
+ *
+ * @author  krzys@sote.pl
+ * @version $Id: index.php,v 1.5 2006/05/30 11:38:50 krzys Exp $
+* @package    allpay
+ */
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+
+/**
+ * Nag³ówek skryptu oraz inne potrzebne pliki
+ */
+require_once ("../../../../include/head.inc");
+@include_once ("config/auto_config/allpay_config.inc.php");
+require_once("include/metabase.inc");
+
+
+// najpierw dokonujemy zmian, potem wyswietlamy wyglad, z juz zaktualizowanymi danymi
+// naglowek
+$theme->head();
+$theme->page_open_head();
+
+include_once("./include/menu.inc.php");
+$theme->bar($lang->allpay_bar['config']);
+
+if (! empty($_REQUEST['item'])) {
+    $item=$_REQUEST['item'];
+} else $item=array();
+$item['url']=ereg_replace("http://[a-z0-9.-]+/","",@$item['url']);
+$item['urlc']=ereg_replace("http://[a-z0-9.-]+/","",@$item['urlc']);
+
+      // nadanie zmiennym wartosci albo 1 albo 0    
+     if (! empty($item['save'])) {  
+	    if (empty($item['active'])) $item['active']=0;
+	    else $item['active']=1;
+	    if (empty($item['status'])) $item['status']=0;
+	    else $item['status']=1;
+	    if (empty($item['ch_lock'])) $item['ch_lock']=0;
+	    else $item['ch_lock']=1;    
+	    if (empty($item['onlinetransfer'])) $item['onlinetransfer']=0;
+	    else $item['onlinetransfer']=1;
+	    
+    // zapisz dane w pliku konfiguracyjnym usera o aktywnej platnosci
+     require_once("include/gen_user_config.inc.php");
+     global $ftp;
+     $ftp->connect();	
+          $config->pay_method_active;
+	     if(array_key_exists("21",$config->pay_method_active)) {
+	     	if($item['active'] == 1) {
+	     	$config->pay_method_active['21']=1;	
+	     	}else{
+	     	$config->pay_method_active['21']=0;
+	     	} 	
+	     }else{
+	     	if($item['active'] == 1) {
+	     	$config->pay_method_active=$config->pay_method_active+array("21"=>"1");
+	     	}else{
+	     	$config->pay_method_active=$config->pay_method_active+array("21"=>"0");	
+	     	}
+	     } 
+	     
+	         $gen_config->gen(array(
+                           "pay_method_active"=>$config->pay_method_active,
+                           )
+                     );
+    
+    
+     // wpis do pliku konfiguracynego allpay
+    require_once("./include/gen_allpay_config.inc.php");
+    $gen_config->gen(array(
+                           "allpay_id"=>$item['id'],
+                           "allpay_url"=>$item['url'],
+                           "allpay_urlc"=>$item['urlc'],
+                           "allpay_out_url"=>$item['out_url'],
+                           "allpay_pr_set"=>$item['pr_set'],
+                           "allpay_active"=>$item['active'],
+                           "allpay_status"=>$item['status'],
+                           "allpay_ch_lock"=>$item['ch_lock'],
+                           "allpay_onlinetransfer"=>$item['onlinetransfer'],
+                           "allpay_channel"=>$item['channel'],
+                           "allpay_type"=>$item['type'],
+                           "allpay_txtguzik"=>$item['txtguzik'],
+                           "allpay_buttontext"=>$item['buttontext'],
+                           
+                           )
+                     );
+    $ftp->close();
+    $allpay_config->allpay_id=$item['id'];
+    $allpay_config->allpay_url=$item['url'];
+    $allpay_config->allpay_urlc=$item['urlc'];
+    $allpay_config->allpay_out_url=$item['out_url'];
+    $allpay_config->allpay_pr_set=$item['pr_set'];
+    $allpay_config->allpay_active=$item['active'];
+    $allpay_config->allpay_status=$item['status'];
+    $allpay_config->allpay_ch_lock=$item['ch_lock'];
+    $allpay_config->allpay_onlinetransfer=$item['onlinetransfer'];
+    $allpay_config->allpay_channel=$item['channel'];
+    $allpay_config->allpay_type=$item['type'];
+    $allpay_config->allpay_txtguzik=$item['txtguzik'];
+    $allpay_config->allpay_buttontext=$item['buttontext'];
+
+}
+
+require_once ("./html/allpay_config.html.php");
+
+$theme->page_open_foot();
+
+// stopka
+$theme->foot();
+
+include_once ("include/foot.inc");
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/plugins/_pay/_allpay/lang/_pl/lang.inc.php soteesklep3/admin/plugins/_pay/_allpay/lang/_pl/lang.inc.php
--- ../soteesklep3/admin/plugins/_pay/_allpay/lang/_pl/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/plugins/_pay/_allpay/lang/_pl/lang.inc.php	2006-07-11 14:14:20.000000000 +0200
@@ -0,0 +1,47 @@
+<?php
+$lang->allpay_buttons=array(
+                'config'=>"Konfiguracja",
+                'help'=>"Pomoc",
+                );
+$lang->allpay_bar=array(
+                      "config"=>"Konfiguracja p³atno¶ci Allpay", 
+	
+                      );
+$lang->allpay_config=array(
+                'id'=>"Identyfikator nadany przez Allpay",
+                'save'=>"Zapisz",
+                "url"=>"Adres powrotu do strony sklepu",
+                "urlc"=>"Adres potwierdzenia transakcji",
+                "pr_set"=>"Has³o promocyjne",
+                "active"=>"Aktywuj p³atno¶æ",
+                "status"=>"W³±cz tryb produkcyjny",
+                "ch_lock"=>"Poka¿ tylko domy¶ln± p³atno¶æ",
+                "onlinetransfer"=>"Sprawdzaj, czy bank jest czynny",
+                "type"=>"Wybierz metodê zakoñczenia transakcji",
+                "channel"=>"Wybierz domy¶ln± p³atno¶æ",
+                "buttontext"=>"Tekst na guziku potwierdzenia transakcji w systemie AllPay <br><i>(min.4 znaki - max.100 znaków)",
+                "txtguzik"=>"Tekst na guziku powrotu do sklepu w systemie AllPay <br><i>(min.4 znaki - max.100 znaków)",
+                "out_url"=>"Adres serwisu Allpay",
+                );
+$lang->allpay_channel=array(
+				0=>'karty p³atnicze',
+				1=>'mTransfer (mBank)',
+				2=>'P³acê z Inteligo (Inteligo Bank PKO BP)',
+				3=>'MultiTransfer (MultiBank)',
+				4=>'AllPay Transfer (Allpay.pl)',
+				6=>'Przelew24 (Bank Zachodni WBK)',
+				7=>'ING On-Line (ING Bank ¦l±ski)',
+				8=>'Sez@m (Bank Przemys³owo-Handlowy S.A.)',
+				9=>'Pekao24 (Bank Pekao S.A.)',
+				10=>'Millnet (Millennium Bank)',
+				11=>'przekaz/przelew - forma uniwersalna',
+				12=>'Serwis PayPal',
+				13=>'Deutsche Bank PBC S.A.',
+				14=>'Kredyt Bank S.A. - KB24 Bankowo¶æ Elektroniczna',
+				15=>'PKO BP (konto Inteligo)',
+				16=>'Lukas Bank',
+				17=>'Nordea Bank',
+				
+				
+);
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/admin/setup/include/test_php.inc.php soteesklep3/admin/setup/include/test_php.inc.php
--- ../soteesklep3/admin/setup/include/test_php.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/admin/setup/include/test_php.inc.php	2006-07-11 14:14:42.000000000 +0200
@@ -0,0 +1,182 @@
+<?php
+/**
+ * Testowanie opcji PHP
+ *
+ * @author  m@sote.pl
+ * @version $Id: test_php.inc.php,v 2.10 2006/05/29 13:11:19 lukasz Exp $
+ * @soteesklep
+* @package    setup
+ */
+ 
+class TestPHP {
+    var $version="436"; // wymagana wersja m.in. PHP-4.1.2
+    var $version_print=">=4.3.6";
+    var $installed="Yes:)";
+    var $not_onstalled="No:(";
+    var $next="Next";
+    var $num=1;
+    var $testall=true;
+
+    /**
+     * Rozpocznij testy opcji PHP
+     *
+     * \@global bool $this->testall true wszystko OK
+     *
+     * return none 
+     */
+    function test_start() {
+    	global $_ERROR;
+    	$_ERROR=false;
+        print "<table align=center>\n";
+        $this->test("PHP: ($this->version_print): ",$this->version());
+        $this->test("PHP: MySQL",$this->mysql());
+        $this->test("PHP: ftp",$this->ftp());
+        $this->test("PHP: trans_sid",$this->trans_sid());        
+        $this->test("PHP: zlib",$this->zlib());
+        $this->test("PHP: openssl",$this->openssl());
+        $this->test("PHP: open_basedir (off)",$this->open_basedir());
+        $this->test("PHP: memory(>8M)",$this->free_mem());
+        print "</table>\n";
+        @include ("./ignore");
+        if (@$ignore_all) $_ERROR=false; 
+        return;
+    } // end test_start()
+
+    /**
+    * Wy¶wietl informacje o tym, czy dana opcja jest zainstalowana
+    *
+    * @param string $text nazwa/opis opjcji
+    * @param bool   true  opcja jest zainstalowana/skonfigurowana
+    * 
+    * @return none
+    */
+    function test($text,$bool) {
+        global $lang;
+
+        print "<tr><td>$this->num. $text</td><td>";
+        if ($bool) print "<b>".$this->installed."</b>";
+        else print "<b><font color=red>".$this->not_installed."</font></b>";
+        print "</td></tr>";
+        $this->num++;
+		if (!$bool) {
+			global $_ERROR;
+			$_ERROR=true;
+		}
+        if (! $bool) $this->testall=false;
+
+        return;
+    } // end test()
+	    
+    /**
+     * Sprawd¼ obecno¶æ zlib
+     *
+     * @return bool true - OK, false - brak
+     */
+    function zlib() {
+    	if (function_exists('gzopen')) {
+    		return true;
+    	}
+    	return false;
+    } // end zlib
+    
+    /**
+     * Sprawd¼ czy na serwerze jest wlaczone open_basedir
+     *
+     * @return bool true - OK, false - brak
+     */
+    function open_basedir() {
+    	$open_basedir=ini_get("open_basedir");
+    	if (empty($open_basedir)) {
+    		return true;
+    	}
+    	return false;
+    } // end open_basedir
+    
+    /**
+     * Sprawd¼ ilosc pamieci dostepnej na serwerze
+     *
+     * @return bool true - OK, false - brak
+     */
+    function free_mem() {
+    	$memory=ini_get("memory_limit");
+    	if (empty($memory)) {
+    		return true;
+    	}
+    	$memory=substr($memory,0,-1);
+    	if ($memory<=8) return false;
+    	return true;
+    } // end free_mem
+    
+    
+    /**
+     * Sprawd¼ obecno¶æ openssl
+     *
+     * @return bool true - OK, false - brak
+     */
+    function openssl() {
+    	if (function_exists('openssl_open')) {
+    		return true;
+    	}
+    	return false;
+    } // end openssl
+    
+    /**
+    * Weryfikuj wersje PHP
+    *
+    * @return bool true - wersja OK, false w p.w.
+    */
+    function version() {
+        $php_version=phpversion();
+        $php_version=preg_split('@\.@',$php_version);
+        if ($php_version[0]>=$this->version[0]) {
+        	return true;
+        }
+        if ($php_version[1]>=$this->version[1]) {
+        	return true;
+        }
+        if ($php_version[2]>=$this->version[2]) {
+        	return true;
+        }
+        return false;
+    } // end version
+
+    /**
+    * Sprawd¼, czy PHP zawiera obs³uge MySQL
+    *
+    * @return bool true PHP zawiera obs³uge MySQL, false w p.w.
+    */
+    function mysql() {
+        if (function_exists('mysql_connect')) return true;
+        else return false;
+    } // end mysql()
+
+    /**
+    * Sprawd¼, czy PHP zawiera obs³uge FTP (--enable-ftp)
+    *    
+    * @return bool true PHP zawiera obs³uge FTP, false w p.
+    */
+    function ftp() {
+        if (function_exists('ftp_login')) return true;
+        else return false;
+    } // end ftp()
+
+    /**
+    * Sprawd¼, czy PHP ma w³±czon± opcjê transparentnych sesji
+    *
+    * @return bool true PHP zawiera obs³uge transparentnych sesji, false w p.
+    */
+    function trans_sid() {
+        $trans_sid=ini_get("session.use_trans_sid");
+        if ($trans_sid==1) return true;
+        else return false;
+    } // end ftp()
+
+} // end class TestPHP
+
+$test_php =& new TestPHP;
+
+$test_php->installed=$lang->installed;
+$test_php->not_installed=$lang->not_installed;
+$test_php->next=$lang->next;
+
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/bin/un_home_pl.sh soteesklep3/bin/un_home_pl.sh
--- ../soteesklep3/bin/un_home_pl.sh	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/bin/un_home_pl.sh	2006-07-11 14:14:50.000000000 +0200
@@ -0,0 +1,75 @@
+#!/bin/sh
+
+#
+# Skrypt cofa zmiany dokonane przez skrypt home_pl.sh
+# Usuwa zgedne symlinki i przenosi katalogi sporotem na miesce
+# Tam gdzie to mozliwe wykorzystywane sa ogolniki 
+# (np wszystkie pliki z katalogu admin/libs sa na nowo linkowane w odpowiednie miejsce)
+# wiec skrypt powinien funkcjonowac mimo dodawania/zmian w obrebie tych katalogow
+# przed jego wykonaniem konieczny jest jednak backup - inne zmiany dokonywane w sklepie moga zostac utracone!
+# UWAGA! sklep musi byc wersja przerobiona na home.pl - w przeciwnym wypadku skutki beda fatalne (usuniecie znacznej czesci katalogow systemowych)
+#
+# @author lukasz@sote.pl
+# @version $Id: un_home_pl.sh,v 1.2 2006/05/22 09:05:39 lukasz Exp $
+# @package home.pl
+# @subpackage install
+#
+
+echo "Uwaga!!!"
+echo "Upewnij sie ze sklep ktory przerabiasz to wersja home.pl!"
+echo "Jezeli sklep jest w normalnej wersji - usuniete zostana katalogi systemowe"
+read
+cd ..
+rm -rf htdocs
+mv ./admin/htdocs ./
+echo "admin/htdocs -> htdocs"
+
+files=`ls | grep -v "admin" | grep -v "htdocs"`
+for file in `echo $files`
+do
+    rm -rf $file
+    mv ./htdocs/base/$file ./
+    echo "htdocs/base/$file -> ./$file"
+done
+
+# usuwamy padle linki w admin
+rm -rf admin/sessions admin/sessions_secure admin/sql admin/sum.md5 htdocs/sessions htdocs/include htdocs/base admin/VERSION admin/tmp2 admin/tmp/tmp admin/.htaccess admin/php.ini htdocs/php.ini
+
+echo "usuwam admin/sessions admin/sessions_secure admin/sql admin/sum.md5 htdocs/sessions htdocs/include htdocs/base admin/VERSION admin/tmp2 admin/tmp/tmp admin/.htaccess admin/php.ini htdocs/php.ini"
+
+# podmieniamy katalog photo
+rm -rf admin/photo
+ln -s ../htdocs/photo admin/photo
+echo "admin/photo -> ../htdocs/photo"
+
+# podmieniamy linki w admin/lib
+files=`ls admin/lib`
+for file in `echo $files`
+do
+    rm -rf admin/lib/$file
+    ln -s ../../lib/$file admin/lib/$file
+    echo "admin/lib/$file -> ../../lib/$file"
+done
+
+# podmieniamy linki w htdocs/lib
+files=`ls htdocs/lib`
+for file in `echo $files`
+do
+    rm -rf htdocs/lib/$file
+    ln -s ../../lib/$file htdocs/lib/$file
+    echo "htdocs/lib/$file -> ../../lib/$file"
+done
+
+cp admin/.htaccess.dist.setup ./admin/.htaccess
+echo "kopia: admin/.htaccess.dist.setup ./admin/.htaccess"
+cp admin/.htaccess.dist.setup ./htdocs/.htaccess
+echo "Kopia: admin/.htaccess.dist.setup ./htdocs/.htaccess"
+rm -rf htdocs/themes/.htaccess
+touch htdocs/themes/.htaccess
+echo "<FilesMatch \"\.html|~\">" >> htdocs/themes/.htaccess
+echo "    Order allow,deny" >> htdocs/themes/.htaccess
+echo "    Deny from all" >> htdocs/themes/.htaccess
+echo "</FilesMatch>"  >> htdocs/themes/.htaccess
+echo "Utworzono nowy plik htdocs/themes/.htaccess"
+
+echo "Sklep przetworzony na standardowa wersje."
\ No newline at end of file
diff -ruN ../soteesklep3/config/config.inc.php soteesklep3/config/config.inc.php
--- ../soteesklep3/config/config.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/config/config.inc.php	2006-07-11 14:14:50.000000000 +0200
@@ -0,0 +1,870 @@
+<?php
+/**
+* Konfiguracja systemowa sklepu.
+*
+* UWAGA! Plik tem mo¿e byæ edytowany tylko przez progamistów, którzy dok³adnie wiedz± co zmieniaj±. Nie jest to
+* plik konfiguracji sklepu dla uzytkowników sklepu.
+*
+* Wiele warto¶ci zdefiniowanych i opisach w klasie Config,
+* jest nadpisywana przez inne pliki konfiguracyjne np. plik tworzony z definicjami w wprowadzanymi w panelu
+* config/auto_config/user_config.inc.php, dlatego te¿ zmiana warto¶ci nie zawsze spodowuje to, czego oczekujemy.
+* Je¶li chcemy wprowadzaæ zmiany to nale¿y dok³adnie prze¶ledziæ ca³± drogê generowania danych dla obiektu
+* $config.
+*
+* @author  m@sote.pl lech@sote.pl
+* @version $Id: config.inc.php,v 2.129 2006/07/07 06:47:37 cvs Exp $
+*
+* @package    default
+* \@lang
+* \@encoding
+*/
+
+/**
+* G³ówna klasa konfiguracji sklepu.
+* @package config
+* @subpackage base
+*/
+class Config {
+
+    /**
+    * Wersja SOTEeSKLEP. Seria.
+    */
+    var $version="3.5.x";
+
+    /**
+    * Numer pakietu aktualizcyjnego, który ma byæ instalowany dla tej wersji jako pierwszy.
+    * Uwaga! Warto¶c ta MUSI byæ zmieniana przy ka¿dym generowaniu nowego numeru wersji. 
+    * Wstawiamy tu numer kolejnego uaktualnienia, które zostanie wydane po wydaniu wersji.
+    */
+    var $pkg_first_number=13;
+
+    
+    /**
+    * devel=1, wersje debveloperska sklepu.
+    * @ignore
+    * @todo dodac obs³ugê trybu dla developerów
+    */
+    var $devel=1;
+
+    /**
+    * Rodzaj bazy danych; obecnie tylko mysql.
+    */
+    var $dbtype="mysql";
+
+    /**
+    * Nazwa bazy danych. Pod t± zmienn± zostan± podstawione odszyfrowane dane dot. bazy danych.
+    */
+    var $dbname;
+
+    /**
+    * Nazwa u¿ytkownika dostêpu do bazy danych.
+    */
+    var $dbuser;
+
+    /**
+    * Has³o dostêpu do bazy danych.
+    */
+    var $dbpass;
+
+    /**
+    * Serwer bazy danych.
+    */
+    var $dbhost;
+
+    /**
+    * Okre¶lenie czy dana wersja jest demonstracyjn?: yes - wersja demo, no - wersja produkcyjna
+    * Je¶li demo jest w³±czone to panel sklepu jest tylko w trybie do odczytu.
+    * @todo zmieni? "yes"=>1, "no"=>0
+    */
+    var $demo="no";
+
+    /**
+    * Okre¶lenie poziomu logowania. 1 - logowanie w³±czone, 0 - wy³aczone
+    */
+    var $logs=1;                         // poziom logowania
+
+    /**
+    * Okre?lenie trybu parcy sklepu.
+    * Je¶li cd=1 to wy³±czane s± niektóre funkcje, dziêki czemu sklep ³atwiej jest zgraæ na CD.
+    * Opcja ta jest prze³±czana z panelu.
+    */
+    var $cd=0;
+
+    /* @deprecated since 3.0 */
+    var $simple="no";
+
+    /**
+    * Prefix URL do htdocs dla SV
+    * @deprecated since 3.0
+    */
+    var $htdocs_dir="";
+
+    /**
+    * Prefix URL do admin dla SV
+    * @deprecated since 3.0
+    */
+    var $admin_dir="";
+
+    /**
+    * prefix URL = htdocs_dir lub admin_dir
+    * @deprecated since 3.0
+    */
+    var $url_prefix="";
+    // end sv:
+
+    /**
+    * Adres internetowy sklepu. Zmienna konfigurowana z panelu.
+    */
+    var $www;
+
+    /**
+    * @var int category_multi 1 - w³±cz opcjê: 1 produkt w kilku kategoriach, 0 - w p.w.
+    */
+    var $category_multi=1;
+
+    /**
+    * @var int Zmienna odpowiedzialna za wy¶wietlenie w sklepie listy walut do wyboru.
+    */
+
+    var $currency_show_form=1;
+    
+    // ************** LANG
+    var $langs_symbols = array(
+        0 => "pl",
+        1 => "en",
+        2 => "de",
+        3 => "cz",
+        4 => "ru",
+    );
+
+    var $langs_names = array(
+        0 => "Polski",
+        1 => "English",
+        2 => "Deutsch",
+        3 => "Cestina",
+        4 => "Russkij",
+    );
+
+    var $langs_encoding = array(
+        0 => "052|iso-8859-2",
+        1 => "018|iso-8859-1",
+        2 => "031|iso-8859-1",
+        3 => "015|iso-8859-2",
+        4 => "000|utf-8",
+    );
+
+    var $langs_active = array(
+        0 => 1,
+        1 => 1,
+        2 => 1,
+        3 => 1,
+        4 => 1,
+        );
+    
+    var $lang_id = 0;
+
+    // ************** LANG - END
+    
+    /**
+    * Jêzyk w którym bêdzie domy¶lnie pracowaæ sklep. Aktualna warto¶æ jezyka, w którym pracuje sklep.
+    * Po zmianie jêzyka jest modyfikaowana ta zmienna.
+    */
+    var $lang="en";
+
+    /**
+    * Domy¶lny jêzyk w sklepie (nie w panelu). Zmienna ta ma t± sam± warto¶æ co $config->lang.
+    * Jest ona wykorzystywana w panlu do sprawdzenia jêzyka zdefiniowanego dla sklepu, gdy¿
+    * w panelu zmienna $config->lang ma warto¶æ aktualnie wy¶wietlanego jêzyka dla panelu, co
+    * nie musi sie zgadzaæ z ustawieniami dla sklepu.
+    */
+    var $htdocs_lang="en";
+
+    /**
+    * Bazowy jêzyk sklepu. Wed³ug tego jezyka s± przypisywane g³ówne warto¶ci $lang, nastêpnie
+    * odczytywane s± warto¶ci dla jêzyka $config->lang, które nadpisuj± wcze¶niejsze definicje.
+    * Aktualnie zawsze warto¶æ "pl". 
+    */
+    var $base_lang="pl";
+
+    /**
+    * Jêzyk w którym bêdzie domy¶lnie pracowaæ panel administracyjny sklepu.
+    */
+    var $admin_lang="en";
+
+    /**
+    * Dostêpne jêzyki w sklepie. Oznaczenia.
+    */
+    var $languages=array("en","de","pl");
+    /**
+    * Nazwy jêzyków wg oznacze?.
+    */
+    var $languages_names=array
+    (
+    "en"=>"English",
+    "de"=>"Deutsch",
+    "pl"=>"Polski",
+    );
+
+    var $lang_active=array(
+    "pl"=>1,
+    "en"=>1,
+    "de"=>1,
+
+    );
+
+    /**
+    * @var array Zmienna odpowiedzialna za przypisanie odpowiedniej waluty odpowiediej wersji jêzykowej.
+    */
+
+    var $currency_lang_default=array("pl"=>1);
+
+    // start tematy wygl±du sklepu:
+    /**
+    * Nazwa tematu bazowego
+    */
+    var $base_theme="base_theme";
+
+    /**
+    * Nazwa tematu koñcowego(tematu  wygl±du).
+    * temat okre¶la katalog, w którym bêd± wyszukiwane odpowiednie pliki/szablony prezentacji itp.
+    */
+    var $theme="blue";
+
+    /**
+    * Lista dotêpnych tematow wygl±du sklepu
+    */
+    var $themes=array
+    (
+    "redball"=>"redball",
+    "blueball"=>"blueball",
+    "red"=>"red",
+    "blue"=>"blue",
+    "green"=>"green",
+    "brown"=>"brown",
+    "blueday"=>"blueday",
+    "grayday"=>"grayday",
+    "bluelight"=>"bluelight",
+    "pinklight"=>"pinklight",
+    );
+    // end tematy wygl?du sklepu:
+
+    // start tematy wygladu panelu administratora:
+    /**
+    * Nazwa bazowego tematu w panelu amdinistracyjnym.
+    */
+    var $admin_base_theme="base_theme";
+
+    /**
+    * Nazwa tematu koñcowego w panelu amdinistracyjnym.
+    */
+    var $admin_theme="base_theme";
+
+    /**
+    * Lista dotêpnych tematów wygladu panelu administracyjnego.
+    */
+    var $admin_themes=array
+    (
+    "base_theme"=>"standard",
+    "green"=>"jungle",
+    "box"=>"box",
+    );
+    // end tematy wygladu panelu administratora:
+
+    /**
+    * Okre¶lenie czy dla sklepu dostêpna jest obs³uga SSL.
+    */
+    var $ssl=0;
+
+    /**
+    * @var string Domy¶lna waluta, w której bêda prezentowane i zapisywane ceny.
+    *             Jest to waluta rozliczenia.
+    */
+    var $currency="PLN";
+
+    /**
+    * Konto, na które s± wysylane zamówienia.
+    */
+    var $order_email='';
+
+    /**
+    * Od kogo bêd± wysy³ane wiadomo¶ci z zamówieniem.
+    */
+    var $from_email='';
+
+    /**
+    * Dane sprzedawcy - edytowane z panelu.
+    */
+    var $merchant=array();
+
+    /**
+    * @var array lista edytowalnych tematow wygladu sklepu
+    */
+    var $editable_themes=array(
+    "blue"=>"blue",
+    "redball"=>"redball",
+    "blueday"=>"blueday",
+    "grayday"=>"grayday",
+    "bluelight"=>"bluelight",
+    "pinklight"=>"pinklight",
+    );
+
+    /**
+    * Maksymalna wielko?? uploadowanego pliku w bajtach: 1000000=1MB
+    */
+    var $max_file_size=1000000;
+
+
+    // start FTP:
+    // dane konta ftp, na ktorym jest zainstalowany program
+    var $ftp_dir='';
+    var $ftp_password=-1;                // UWAGA! nie wpisywac tu hasla!
+    var $ftp_port="21";
+    // end FTP:
+
+    /**
+    * Dodatkowy klucz wykorzystywany do kodowania.
+    * Po zainstalowaniu sklepu NIE WOLNO zmieniaæ tej warto¶ci.
+    */
+    var $salt='12345678901234567890123456789012';
+
+    /**
+    * Adres servleta eCard
+    * @deprecated since 3.0
+    */
+    var $ecard_servlet="http://adres_servleta_ecardu";
+    // Ujednolicenie kolorów elementach sklepu
+    var $colors=array("light"=>"#E9F0F8",
+    "dark"=>"#6699cc",
+    );
+
+    /**
+    * Opcja okre¶la, czy w sklepie mo¿na do³±czaæ zdêcia do zamówionych produktów np. zdjêcie na nadruki na koszulki.
+    * /go/_basket/_photo zalaczanie zdjec do produktow
+    */
+    var $basket_photo="no";
+
+    /**
+    * Czy zdjêcia robione sa aparatem cyfrowym? Jesli tak to nadawaj automatycznie nazwy zdjeciom wg. id
+    */
+    var $cyfra_photo=1;
+
+    /**
+    * Typ ceny jaki siê ma wyswietlaæ: netto, brutto, netto/brutto
+    */
+    var $price_type="netto/brutto";
+
+    /**
+    * Ilo¶c produktów na listach w zale¿no¶ci od typu listy.
+    * "short" - lista uproszczona bez zdjec i opisu, "long" - pelna lista ze zdjeciami i krotkim opisem
+    */
+    var $products_on_page=array
+    (
+    "short"=>20,
+    "long"=>10
+    );
+
+    /* Domy¶lny rodzaj listy proudktow "short", "long" jw. */
+    var $record_row_type_default="long";
+
+    var $vat_confirm=1;
+
+    /**
+    * Rozmiary du¿ych i ma³ych zdjêæ na listach i w informacjach szczeg³oowych produktów.
+    */
+    var $image=array
+    (
+    "max_size" =>"300",
+    "min_size" =>"115",
+    );
+	
+    /**
+    * Poka¿ numer id produktu w sklepie
+    */
+    
+    var $show_user_id=1;
+    
+    /**
+    * Od jakiego numeru numerowaæ transakcje, domy¶lne id startowe transakcji
+    */
+
+    var $id_start_orders_default=1;
+
+    /**
+    * Okre¶lenie czy wstawiamy okienko newsletter na stronie
+    */
+    var $newsletter=1;
+
+    /**
+    * Okre¶lenie czy wstawiamy newsedit na g³ównej stronie sklepu
+    */
+
+    var $newsedit=0;
+
+    /**
+    * Newsedit w kolumnach jednej czy dwoch
+    */
+
+    var $newsedit_columns_default=1;
+
+    /**
+    * Dpmy¶lna ilo¶æ produktów kolumnach promocje,nowosci itd
+    */
+    var $random_on_page=array("promotion"=>2,
+    "newcol"=>3,
+    "bestseller"=>2,
+    );
+
+    /**
+    * Domy¶lny rodzaj sortowania produktów na listach.
+    */
+    var $main_order_default="name_L0";
+
+    /**
+    * Pola, ktore musz byc zaselectowane do odczytania nazwy produktu, producenta i ceny
+    */
+    var $select_main_price_list="id,user_id,name_L0,name_L1,name_L2,name_L3,name_L4,producer,price_brutto,vat,price_brutto_detal,photo,price_brutto_2,hidden_price,ask4price,discount,price_currency,id_currency,id_category1,id_category2,id_category3,id_category4,id_category5,id_producer,max_discount,points,points_value";
+
+
+    /**
+    * Metody p³atno¶ci dostêpne w sklepie.
+    * UWAGA! Nie mo¿na zmieniaæ ID.
+    */
+    var $pay_method=array
+    (
+    "1"=>"Za zaliczeniem",
+    "2"=>"eCard",
+    "3"=>"PolCard",
+    // "4"=>"Inteligo",
+    // "5"=>"mBank",
+    // "6"=>"CitiConnect",
+    // "7"=>"PayU",
+    // "8"=>"WBK",
+    // "9"=>"SMS",
+    "11"=>"Przelew",
+    "12"=>"Przelewy24",
+    "20"=>"PlatnosciPL",
+    "21"=>"Allpay",
+    "101"=>"PayPal",
+    "110"=>"P³atno¶æ Kart±",
+    // "30"=>"AllPay",
+    "999"=>"DefaultPay",
+    );
+
+    /**
+    *Aktywacja wybranej metody platnosci
+    */
+    var $pay_method_active=array
+    (
+    "1"=>1,
+    "11"=>1,
+    "110"=>0,
+    );
+
+
+
+    /**
+    * Rodzaj prezentacji kategorii
+    * "treeview" - dynamiczne JS+DHTML, "standard" - statyczne z przeladowaniem strony
+    */
+    var $category=array
+    (
+    "type"=>"standard",
+    );
+
+    /**
+    * Przegladarki, ktore nie obs³uguj± javascript wymaganego dla Treeview.
+    *
+    * zachowana dla zgodno?ci
+    * @deprecated since 3.0
+    */
+    var $browsers_nojavascript=array();
+    // var $browsers_nojavascript=array("Mozilla/4","konqueror","safari");
+
+    /**
+    * Dostepno¶æ. Tablica ID->nazwa.
+    * Warto¶æ tablicy jest definiowana dynamicznie w ./auto_config/user_config.inc.php
+    */
+    var $availabale=array();
+
+    /**
+    * @var array tablica ze zmiennymi, ktore sa zpisywane przez uzytkwonika w ./auto_config/user_config.inc.php
+    */
+    var $user_vars=array("db","ftp","salt","md5_pin","license","auth_sign","config_setup",
+    "order_points","available","currency_data","currency_name",
+    "category","stats","merchant","order_email","from_email","newsletter_email",
+    "www","currency","cd_setup","theme","themes_active",
+    "record_row_type_default","producers_category_filter","google",
+    "price_type","currency","products_on_page","google","image",
+    "main_order_default","vat_confirm","id_start_orders_default","newsedit_columns_default",
+    "lang","lang_id","lang_active","currency_lang_default",
+    "category_multi","newsedit","newsletter","currency_show_form","cyfra_photo",
+    "basket_photo","htdocs_lang","pay_method_active","random_on_page","themes","theme","fields",
+    "editable_themes","admin_lang","home","in_category_down","catalog_mode","rss_link","happy_hour"	,"country_select",
+    "langs_symbols","langs_names","langs_active","langs_encoding","users_online","unit","id_shop","ssl","catalog_mode_options",
+    "ranking1_max_length","ranking2_max_length","ranking1_enabled","ranking2_enabled","depository",
+    "basket_ext","basket_wishlist","display_availability","show_user_id",
+    );
+
+    // w³±czenie linków rss pod newsami
+    var $rss_link="1";
+	
+    // wy³±czenie poszerzonych informacji o produkcie w koszyku
+    var $basket_ext="0";
+
+    var $themes_active=array();
+    // w³±czenie trybu dla programistu
+    var $debug=0;
+    // w³±czenie trybu katalogowego - wy³±czenie koszyka
+    var $catalog_mode=0;
+    // opcje katalogu
+    var $catalog_mode_options=array(
+    "currency"=>"0",
+    "users"=>"0",
+    "newsletter"=>"0",
+    "newsedit"=>"0",
+    "price"=>"0",
+    );
+    // [1-5] ilosc porownywanych kategorii przy liscie produktow z tej samej kategorii
+    var $in_category_down=3;
+    // czy promocje, nowosci oraz wyszukiwanie maja zalezec od wybranego producenta?
+    var $producers_category_filter="yes";
+    // wprowadz id producenta i odpowiedni dla niego temat
+    var $themes_producers=array("12"=>"art_orange");
+    // wprowadz id kategorii i odpowieni temat dla danej kategorii np. 18, 18_1, 18_1_4 itp.
+    var $themes_category=array("18"=>"art_orange");
+    // end plugins
+
+
+    /**
+    * Ocena ryzyka transakcji  \@depend  $lang->pay_fraud
+    * true - nie wyswietlaj ostrzezenia, false - wyswietl ostrzezenie przy transakcji
+    * wartosc <0 oznacza inne zagrozenia, ktore nalezy zglosic pilnie do amdinistratora
+    */
+    var $pay_fraud=array
+    (
+    "1"=>-1,
+    "2"=>-1,
+    "10"=>-1,
+    "300"=>true,
+    "301"=>true,
+    "302"=>false,
+    "303"=>false
+    );
+
+    /**
+    * Ilosc dni przed koncem terminu rozliczenia transakcji, kiedy system ostrzega sprzedawce o koniecznosci potwierdzenia transakcji
+    */
+    var $order_alert_days=3;
+
+    /**
+    * Ilo¶æ dni, po ktorych transakcja nie bedzie przyjeta wg. id_pay_method
+    */
+    var $order_timeout=array("2"=>7,
+    "3"=>7,
+    "4"=>30
+    );
+
+    /**
+    * Okre¶lenie kolumn sortowania wg parametru $order - dla tablicy main
+    */
+    var $dbedit_order_names=array('main'=>array
+    (
+    "1"=>"name",
+    "-1"=>"name DESC",
+    "2"=>"price_brutto",
+    "-2"=>"price_brutto DESC",
+    "3"=>"producer",
+    "-3"=>"producer DESC",
+    "default"=>"price_brutto"
+    )
+    );
+
+    var $default_country = 'PL';
+
+    /**
+    * Domy¶lna konfiguracja nazwy, tytu³u strony itp.
+    */
+    var $google=array("title"=>"SOTEeSKLEP",
+    "keywords"=>"sklep internetowy",
+    "description"=>"sklep internetowy");
+
+    var $users_online = 1;
+    
+    var $unit = "kg";
+    
+    var $supported_encoding = array (
+    "utf-8" => "000|utf-8",
+    "ISO" => array(
+        "Afrikaans (iso-8859-1 Latin-1)"                              =>  "001|iso-8859-1" ,
+        "Albanian (iso-8859-1 Latin-1)"                               =>  "002|iso-8859-1" ,
+        "Albanian (iso-8859-16 Latin-10 South-Eastern European)"      =>  "003|iso-8859-16",
+        "Arabic (iso-8859-6 Arabic)"                                  =>  "004|iso-8859-6" ,
+        "Azerbaijani (iso-8859-9 Latin-5 Turkish)"                    =>  "005|iso-8859-9" ,
+        "Baltic Rim (iso-8859-13 Latin-7 Baltic Rim)"                 =>  "006|iso-8859-13",
+        "Basque (iso-8859-1 Latin-1)"                                 =>  "007|iso-8859-1" ,
+        "Belarusian (iso-8859-5 Cyrillic)"                            =>  "008|iso-8859-5" ,
+        "Brazilian portuguese (iso-8859-1 Latin-1)"                   =>  "009|iso-8859-1" ,
+        "Breton (iso-8859-14 Latin-8 Celtic)"                         =>  "010|iso-8859-14",
+        "Bulgarian (iso-8859-5 Cyrillic)"                             =>  "011|iso-8859-5" ,
+        "Catalan (iso-8859-1 Latin-1)"                                =>  "012|iso-8859-1" ,
+        "Croatian (iso-8859-2 Latin-2)"                               =>  "013|iso-8859-2" ,
+        "Croatian (iso-8859-16 Latin-10 South-Eastern European)"      =>  "014|iso-8859-16",
+        "Czech (iso-8859-2 Latin-2)"                                  =>  "015|iso-8859-2" ,
+        "Danish (iso-8859-1 Latin-1)"                                 =>  "016|iso-8859-1" ,
+        "Dutch (iso-8859-1 Latin-1)"                                  =>  "017|iso-8859-1" ,
+        "English (iso-8859-1 Latin-1)"                                =>  "018|iso-8859-1" ,
+        "English (iso-8859-15 Latin-9 Latin-0)"                       =>  "019|iso-8859-15",
+        "Esperanto (iso-8859-3 Latin-3 South European)"               =>  "020|iso-8859-3" ,
+        "Estonian (iso-8859-1 Latin-1)"                               =>  "021|iso-8859-1" ,
+        "Estonian (iso-8859-4 Latin-4 North European)"                =>  "022|iso-8859-4" ,
+        "Faroese (iso-8859-1 Latin-1)"                                =>  "023|iso-8859-1" ,
+        "Finnish (iso-8859-1 Latin-1)"                                =>  "024|iso-8859-1" ,
+        "Finnish (iso-8859-16 Latin-10 South-Eastern European)"       =>  "025|iso-8859-16",
+        "French (iso-8859-1 Latin-1)"                                 =>  "026|iso-8859-1" ,
+        "French (iso-8859-15 Latin-9 Latin-0)"                        =>  "027|iso-8859-15",
+        "French (iso-8859-16 Latin-10 South-Eastern European)"        =>  "028|iso-8859-16",
+        "Gaelic (iso-8859-14 Latin-8 Celtic)"                         =>  "029|iso-8859-14",
+        "Galician (iso-8859-1 Latin-1)"                               =>  "030|iso-8859-1" ,
+        "German (iso-8859-1 Latin-1)"                                 =>  "031|iso-8859-1" ,
+        "German (iso-8859-15 Latin-9 Latin-0)"                        =>  "032|iso-8859-15",
+        "German (iso-8859-16 Latin-10 South-Eastern European)"        =>  "033|iso-8859-16",
+        "Greek (iso-8859-7 Greek)"                                    =>  "034|iso-8859-7" ,
+        "Greenlandic (iso-8859-4 Latin-4 North European)"             =>  "035|iso-8859-4" ,
+        "Hebrew (iso-8859-8)"                                         =>  "036|iso-8859-8" ,
+        "Hungarian (iso-8859-2 Latin-2)"                              =>  "037|iso-8859-2" ,
+        "Hungarian (iso-8859-16 Latin-10 South-Eastern European)"     =>  "038|iso-8859-16",
+        "Indonesian (iso-8859-1 Latin-1)"                             =>  "039|iso-8859-1" ,
+        "Icelandic (iso-8859-1 Latin-1)"                              =>  "040|iso-8859-1" ,
+        "Irish (iso-8859-1 Latin-1)"                                  =>  "041|iso-8859-1" ,
+        "Irish Gaelic (iso-8859-16 Latin-10 South-Eastern European)"  =>  "042|iso-8859-16",
+        "Italian (iso-8859-1 Latin-1)"                                =>  "043|iso-8859-1" ,
+        "Italian (iso-8859-16 Latin-10 South-Eastern European)"       =>  "044|iso-8859-16",
+        "Latin (iso-8859-1 Latin-1)"                                  =>  "045|iso-8859-1" ,
+        "Latvian (iso-8859-4 Latin-4 North European)"                 =>  "046|iso-8859-4" ,
+        "Lithuanian (iso-8859-4 Latin-4 North European)"              =>  "047|iso-8859-4" ,
+        "Malay (iso-8859-1 Latin-1)"                                  =>  "048|iso-8859-1" ,
+        "Maltese (iso-8859-3 Latin-3 South European)"                 =>  "049|iso-8859-3" ,
+        "Nordic (iso-8859-10 Latin-6)"                                =>  "050|iso-8859-10",
+        "Norwegian (iso-8859-1 Latin-1)"                              =>  "051|iso-8859-1" ,
+        "Polish (iso-8859-2 Latin-2)"                                 =>  "052|iso-8859-2" ,
+        "Polish (iso-8859-16 Latin-10 South-Eastern European)"        =>  "053|iso-8859-16",
+        "Portuguese (iso-8859-1 Latin-1)"                             =>  "054|iso-8859-1" ,
+        "Portuguese (iso-8859-15 Latin-9 Latin-0)"                    =>  "055|iso-8859-15",
+        "Romanian (iso-8859-1 Latin-1)"                               =>  "056|iso-8859-1" ,
+        "Romanian (iso-8859-2 Latin-2)"                               =>  "057|iso-8859-2" ,
+        "Romanian (iso-8859-16 Latin-10 South-Eastern European)"      =>  "058|iso-8859-16",
+        "Russian (iso-8859-5 Cyrillic)"                               =>  "059|iso-8859-5" ,
+        "Sami (iso-8859-4 Latin-4 North European)"                    =>  "060|iso-8859-4" ,
+        "Scotish (iso-8859-1 Latin-1)"                                =>  "061|iso-8859-1" ,
+        "Serbian (in Latin transcription) (iso-8859-2 Latin-2)"       =>  "062|iso-8859-2" ,
+        "Serbocroatian (iso-8859-2 Latin-2)"                          =>  "063|iso-8859-2" ,
+        "Slovak (iso-8859-2 Latin-2)"                                 =>  "064|iso-8859-2" ,
+        "Slovenian (iso-8859-2 Latin-2)"                              =>  "065|iso-8859-2" ,
+        "Slovenian (iso-8859-16 Latin-10 South-Eastern European)"     =>  "066|iso-8859-16",
+        "Sorbian (Upper and Lower) (iso-8859-2 Latin-2)"              =>  "067|iso-8859-2" ,
+        "Spanish (iso-8859-1 Latin-1)"                                =>  "068|iso-8859-1" ,
+        "Spanish (iso-8859-15 Latin-9 Latin-0)"                       =>  "069|iso-8859-15",
+        "Swahili (iso-8859-1 Latin-1)"                                =>  "070|iso-8859-1" ,
+        "Swedish (iso-8859-1 Latin-1)"                                =>  "071|iso-8859-1" ,
+        "Thai (iso-8859-11)"                                          =>  "072|iso-8859-11",
+        "Turkish (iso-8859-3 Latin-3 South European)"                 =>  "073|iso-8859-3" ,
+        "Turkish (iso-8859-9 Latin-5 Turkish)"                        =>  "074|iso-8859-9" ,
+        "Ukrainian (iso-8859-5 Cyrillic)"                             =>  "075|iso-8859-5" ,
+        "Welsh (iso-8859-14 Latin-8 Celtic)"                          =>  "076|iso-8859-14",
+        "(iso-8859-12)"                                               =>  "077|iso-8859-12",
+        ),
+    "Windows" => array (
+        "Latin I (windows-1252)"                     =>  "078|windows-1252",
+        "Albanian (windows-1250 Central Europe)"     =>  "079|windows-1250",
+        "Arabic (windows-1256)"                      =>  "080|windows-1256",
+        "Bulgarian (windows-1251 Cyrillic)"          =>  "081|windows-1251",
+        "Croatian (windows-1250 Central Europe)"     =>  "082|windows-1250",
+        "Czech (windows-1250 Central Europe)"        =>  "083|windows-1250",
+        "Estonian (windows-1257 Baltic)"             =>  "084|windows-1257",
+        "Greek (windows-1253)"                       =>  "085|windows-1253",
+        "Hebrew (windows-1255)"                      =>  "086|windows-1255",
+        "Hungarian (windows-1250 Central Europe)"    =>  "087|windows-1250",
+        "Latvian (windows-1257 Baltic)"              =>  "088|windows-1257",
+        "Lithuanian (windows-1257 Baltic)"           =>  "089|windows-1257",
+        "Polish (windows-1250 Central Europe)"       =>  "090|windows-1250",
+        "Romanian (windows-1250 Central Europe)"     =>  "091|windows-1250",
+        "Russian (windows-1251 Cyrillic)"            =>  "092|windows-1251",
+        "Serbian (windows-1251 Cyrillic)"            =>  "093|windows-1251",
+        "Slovak (windows-1250 Central Europe)"       =>  "094|windows-1250",
+        "Slovene (windows-1250 Central Europe)"      =>  "095|windows-1250",
+        "Thai (cp874)"                               =>  "096|cp874"       ,
+        "Turkish (windows-1254)"                     =>  "097|windows-1254",
+        "Ukrainian (windows-1251 Cyrillic)"          =>  "098|windows-1251",
+        "Vietnamese (windows-1258)"                  =>  "099|windows-1258",
+        ),
+    "DOS" => array (
+        "Latin US (cp437)"     =>  "100|cp437",
+        "Greek (cp737)"        =>  "101|cp737",
+        "BaltRim (cp775)"      =>  "102|cp775",
+        "Latin1 (cp850)"       =>  "103|cp850",
+        "Latin2 (cp852)"       =>  "104|cp852",
+        "Cyryllic (cp855)"     =>  "105|cp855",
+        "Turkish (cp857)"      =>  "106|cp857",
+        "Portuguese (cp860)"   =>  "107|cp860",
+        "Iceland (cp861)"      =>  "108|cp861",
+        "Hebrew (cp862)"       =>  "109|cp862",
+        "Canada (cp863)"       =>  "110|cp863",
+        "Arabic (cp864)"       =>  "111|cp864",
+        "Nordic (cp865)"       =>  "112|cp865",
+        "Cyryllic (cp866)"     =>  "113|cp866",
+        "Greek2 (cp869)"       =>  "114|cp869",
+        ),
+    "MAC" => array(
+        "x-mac-cyrillic"  => "115|x-mac-cyrillic",
+        "x-mac-greek"     => "116|x-mac-greek",
+        "x-mac-icelandic" => "117|x-mac-icelandic",
+        "x-mac-ce"        => "118|x-mac-ce",
+        "x-mac-roman"     => "119|x-mac-roman",
+        ),
+    "..." => array(
+        "cp037"                       => "120|cp037",
+        "cp424"                       => "121|cp424",
+        "cp500 "                      => "122|cp500",
+        "cp856"                       => "123|cp856",
+        "cp875"                       => "124|cp875",
+        "cp1006"                      => "125|cp1006",
+        "cp1026"                      => "126|cp1026",
+        "koi8-r (Cyrillic)"           => "127|koi8-r",
+        "koi8-u (Cyrillic Ukrainian)" => "128|koi8-u",
+        ),
+    );
+        
+
+    /**
+    * Adres serwisowy dot. komunikatów systemowych.
+    */   
+    var $service_email="service_soteshop@sote.pl";
+    
+    /**
+    * Konfiguracja maksymalnych d³ugo¶ci list produktów polecanych
+    */
+    var $ranking1_max_length=5;
+    var $ranking2_max_length=5;
+    
+    var $ranking1_enabled='1';
+    var $ranking2_enabled='1';
+    
+    var $depository = array(
+        'show_unavailable' => "1",
+        'general_min_num' => "5",
+        'update_num_on_action' => 'on_paid',
+        'return_on_cancel' => "1",
+        'available_type_to_hide'=>"3",
+        'display_availability'=>"1",
+    );
+    
+    var $basket_wishlist = array(
+        'prod_ext_info' => "0",
+    );
+
+/*
+
+ "euc" => "Japanese (ja-euc)",
+ "sjis" => "Japanese (ja-sjis)",
+ "ks_c_5601-1987" => "Korean (ko-ks_c_5601-1987)",
+ "dos-866" => "Russian (ru-dos-866)",
+ "koi8-r" => "Russian (ru-koi8-r)",
+ "tis-620" => "Thai (th-tis-620)",
+    );
+*/  
+    /**
+    * Okresl katalog "tematu"
+    *
+    * @return string katalog np. /home/www/webapps/htdocs/themes/_pl/standard
+    */
+    function theme_dir(){
+        global $_SERVER;
+        $this->theme_dir=$_SERVER['DOCUMENT_ROOT']."/themes/_".$this->lang."/".$this->theme;
+        return $this->theme_dir;
+    } // end theme_dir()
+
+} // end class Config
+
+// ------------------------------ koniec konfiguracji----------------------------------------
+
+// odczytaj konfiguracje wygenerowana automatycznie i utworz obiekt $config
+require_once("config/auto_config/config.inc.php");
+
+
+// odczytaj konfiguracje uzytkownika (ustawiane przez panel on-line)
+require_once("config/auto_config/user_config.inc.php");
+
+
+// odczytaj dane licencji
+$lckey=substr($config->license['nr'],12,2);
+switch ($lckey) {
+    case "01": $__nccp="0x1388";  break;
+    case "11": $__nccp="0x1388";  break;
+    case "02": $__nccp="0x01f4";  break;
+    default: $__nccp="0x01f4"; break;
+}
+// end
+
+// odczytaj konfiguracje nccp
+require_once ("config/auto_config/nccp_config.inc.php");
+
+
+if (empty($config)) {
+    $config =& new Config;
+}
+
+if (!in_array("multi_lang",$config->plugins)) {
+    $config->lang="pl";
+    $config->languages=array("pl");
+    $config->languages_names=array("pl"=>"Polski");
+}
+
+$config->theme_dir();
+
+/**
+* Ustaw odpowiedni jezyk dla panelu
+*/
+if ($shop->admin) {    
+    $config->lang=$config->admin_lang;
+}
+
+
+// sprawdz czy jest zdefiniowany indywidualny klucz aplikacji
+$secure_key=ini_get("disable_function");
+if ((! empty($secure_key)) && (eregi("^[0-9a-z]${32}"))) {
+    $config->salt=$secure_key;
+}
+
+// wlacz demo tylko w panelu demo
+if (ereg("htdocs$",$DOCUMENT_ROOT)) {
+    $config->demo="no";
+}
+
+// sprawdz przegladarke i jesli przegladarka nie obsluguje javascript (tj. treeview) to wlacz statyczne menu
+foreach ($config->browsers_nojavascript as $browser) {
+    if (eregi($browser,$_SERVER['HTTP_USER_AGENT'])) {
+        $config->category['type']="standard";
+    }
+} // end foreach
+
+// start cd:
+if ((in_array("cd",$config->plugins)) && (@$config->cd_setup['cd']==1) && ($_SERVER['REMOTE_ADDR']==@$config->cd_setup['IP']) && ($shop->admin==0))  {
+    $config->cd=1;
+    $config->lang_active=array();         // dezaktywuj linki do roznych wersji jezykowych
+    $config->category['type']="standard"; // wlacz statyczne kategorie
+    // sprawdz jakie ceny maj± byæ wy¶wietlane
+    if ($config->cd_setup['price']=="netto") {
+        $config->price_type="netto";
+    }
+} else $config->cd=0;
+// end cd:
+
+if (!in_array("extbasket",$config->plugins)) {
+    $config->basket_photo=0;
+}
+
+// nowy obiektowy koszyk
+
+ $config->new_basket=true;
+
+// nie wstawiaæ zakoñczenia PHP
diff -ruN ../soteesklep3/exe/0.php soteesklep3/exe/0.php
--- ../soteesklep3/exe/0.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/exe/0.php	2006-07-11 14:43:19.000000000 +0200
@@ -0,0 +1,65 @@
+<?php
+/**
+ * Aktualizacja kilku plików konfiguracyjnych bez nadpisywania ich zawarto¶ci
+ * @author lukasz@sote.pl
+ */ 
+
+$ftp->connect();
+require_once ("config/auto_config/platnoscipl_config.inc.php");
+// pobieramy te zmienne ktore wystepuja tylko w tej klasie
+$_config=get_class_vars('AutoConfig');
+$_platnosciconfig=get_class_vars('platnosciplConfig');
+$platnoscivars=array_diff_assoc($_platnosciconfig,$_config);
+// modyfikacja
+$platnoscivars['pl_url_fail']="plugins/_pay/_platnoscipl/confirm_false.php?SESSIONID=%sessionId%";
+// generujemy nowego konfiga
+require_once("include/gen_user_config.inc.php");
+$gen_config->auto_ftp=false;
+global $ftp;
+// tutaj potrzebujemy liste parametrow
+$gen_config->vars=array_keys($platnoscivars);
+$gen_config->config_dir = "/config/auto_config/";
+$gen_config->config_file="platnoscipl_config.inc.php";
+$gen_config->classname="platnosciplConfig";
+$gen_config->class_object="platnoscipl_config";
+$gen_config->config=&$platnoscipl_config;
+$gen_config->gen($platnoscivars);
+//$ftp->close();
+print "
+<font style='color: red'>
+<b>UWAGA</b><br>
+Zmianie uleg³ adres powrotu negatywnego do sklepu w konfiguracji Platnosci.pl!<br>
+Je¿eli korzystasz z tej p³atnosci w swoim sklepie,<br>
+zaktualizuj konfiguracje po stronie platnosciPL na podstawie panelu adminstracyjnego sklepu!
+</font>
+";
+
+// zmieniamy adres w allpay
+require_once ("config/auto_config/allpay_config.inc.php");
+$_allpayconfig=get_class_vars('allpayConfig');
+$allpayvars=array_diff_assoc($_allpayconfig,$_config);
+$allpayvars['allpay_urlc']='plugins/_pay/_allpay/check.php';
+$gen_config->vars=array_keys($allpayvars);
+$gen_config->config_dir = "/config/auto_config/";
+$gen_config->config_file="allpay_config.inc.php";
+$gen_config->classname="allpayConfig";
+$gen_config->class_object="allpay_config";
+$gen_config->config=&$allpay_config;
+$gen_config->gen($allpayvars);
+
+// zmieniamy stopke w newsletterze - tylko je¿eli jest pusta
+require_once ("config/auto_config/newsletter/newsletter_config_L0.inc.php");
+$_newsletter=get_class_vars('ConfigNewsletter');
+$newsletter_vars=array_diff_assoc($_newsletter,$_config);
+if (empty($newsletter_vars['newsletter_foot'])) {
+	$newsletter_vars['newsletter_foot']='Kliknij na poni¿szy link, aby siê wyrejestrowaæ.';
+}
+$gen_config->vars=array_keys($newsletter_vars);
+$gen_config->config_dir = "/config/auto_config/newsletter/";
+$gen_config->config_file="newsletter_config_L0.inc.php";
+$gen_config->classname="ConfigNewsletter";
+$gen_config->class_object="config_newsletter";
+$gen_config->config=&$_newsletter;
+$gen_config->gen($newsletter_vars);
+
+?>
diff -ruN ../soteesklep3/htdocs/go/_register/_ecard/include/ecard.inc.php soteesklep3/htdocs/go/_register/_ecard/include/ecard.inc.php
--- ../soteesklep3/htdocs/go/_register/_ecard/include/ecard.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/go/_register/_ecard/include/ecard.inc.php	2006-07-11 14:14:54.000000000 +0200
@@ -0,0 +1,124 @@
+<?php
+/**
+ * Funckje zwiazane z obsluga platnosci za posrednictwem eCard (http://www.ecard.pl)
+ *
+ * @author Marek Jakubowicz 
+ * @copyright 2002 (C) SOTE www.sote.pl
+ */
+require_once ("HTTP/Client.php");
+
+class eCard {
+
+    /* Dane przekazywane do eCardu */
+    var $ORDERNUMBER;        // numer zamowienia
+    var $ORDERDESCRIPTION;   // opis zamowienia
+    var $AMOUNT;             // kwota do zaplaty w groszach
+    var $NAME;               // imie
+    var $SURNAME;            // nazwisko
+    var $SESSIONID;          // numer sesji
+    var $LANGUAGE="PL";      // PL lub EN jezyk w ktorym ma byc wyswietlona strona
+    /* end */ 
+        
+    /* adres skryptu eCardu */
+    var $urlpost="https://localhost:8081";
+	
+    /* przycisk przej¶cia na strone PolCrad'u */
+    var $submit="<input type=submit value='eCard - p³acê kart±'>\n";   
+
+    /**
+     * Zamien kwote na format dla PolCard tj. na kwote wyrazona w groszach
+     * 
+     * @param real $price
+     * @return int kwota do zaplaty w groszach
+     */
+    function price($price) {
+        $price=number_format($price,2,".","");
+        return intval($price*100);
+    } // end
+
+    /**
+     * Dodaj element hidden w formularzu
+     */
+    function add_hidden($name) {
+        $value=$this->$name;
+        return "<input type=hidden name=$name value='$value'>\n";
+    } // end add_hidden()
+
+    /**
+     * Generuj opis skrocony zamowienia
+     *
+     * @param addr object $my_basket
+     * @return string opis skrocony zmowienia
+     */
+    function order_description(&$my_basket) {
+        $o="";
+        foreach ($my_basket->items as $item) {
+            $o.=$item['name']."; ";
+        }
+        $o=substr($o,0,strlen($o)-2);        
+
+        return $o;
+    } // end order_description()
+    
+    /**
+     * Funkcja wyswietla formularz HTML z elementami wymaganymi prez eCard
+     */
+    function form() {               
+        global $lang;
+        global $ecard_config;
+        
+        
+        $http =& new HTTP_Client;
+        $http->post($ecard_config->ecardServerHash,array(
+        													'orderDescription'=>"",
+        													'amount'=>$this->price($this->AMOUNT),
+        													'currency'=>'985',
+        													'merchantId'=>$ecard_config->ecardAccount,
+           													'password'=>$ecard_config->ecardPassword,
+        													'orderNumber'=>$this->ORDERNUMBER,
+        													'verify'=>1
+        													)
+        			);
+        
+        			
+        			
+       $result=$http->_responses[0]['body'];
+	    
+        
+        
+        $result=preg_replace("/^\s+/","",$result);
+		$result=preg_replace("/\s+$/","",$result);
+		if (!$result || $result=="zlyhash") {
+	    	print "blad"; 
+    		exit(1);
+  		} else {
+	        $this->ORDERDESCRIPTION=preg_replace("/\"/","\\\"",$this->ORDERDESCRIPTION);
+	        $o="<form action=\"".$ecard_config->ecardServerPay."\" method=\"post\">\n";
+	        $o.="<input type=\"hidden\" name=\"ORDERNUMBER\" value=\"".$this->ORDERNUMBER."\">\n";
+	        $o.="<input type=\"hidden\" name=\"ORDERDESCRIPTION\" value=\"".$this->ORDERDESCRIPTION."\">\n";
+	        $o.="<input type=\"hidden\" name=\"AMOUNT\" value=\"".$this->price($this->AMOUNT)."\">\n";
+	        $o.="<input type=\"hidden\" name=\"CURRENCY\" value=\"985\">\n";
+	        $o.="<input type=\"hidden\" name=\"HASH\" value=\"".$result."\">\n";
+	        $o.="<input type=\"hidden\" name=\"MERCHANTID\" value=\"".$ecard_config->ecardAccount."\">\n";
+	        $o.="<input type=\"hidden\" name=\"SESSIONID\" value=\"".$this->SESSIONID."\">\n";
+	        $o.="<input type=\"hidden\" name=\"NAME\" value=\"".$this->NAME."\">\n";
+	        $o.="<input type=\"hidden\" name=\"SURNAME\" value=\"".$this->SURNAME."\">\n";
+	        $o.="<input type=\"hidden\" name=\"LANGUAGE\" value=\"".$ecard_config->ecardLang."\">\n";
+	        $o.="<input type=\"hidden\" name=\"AUTODEPOSIT\" value=\"0\">\n";
+	        $o.="<input type=\"hidden\" name=\"CHARSET\" value=\"iso-8859-2\">\n";
+		$o.="<input TYPE=\"hidden\" name=\"PAYMENTTYPE\" value=\"".$ecard_config->ecardPayType."\">\n";
+	        $o.="<input type=\"hidden\" name=\"LINKOK\" value=\"http://".$_SERVER['HTTP_HOST']."/".$ecard_config->ecardReturnUrl."?\">\n";
+	        $o.="<input type=\"hidden\" name=\"LINKFAIL\" value=\"http://".$_SERVER['HTTP_HOST']."/".$ecard_config->ecardCancelReturnUrl."?\">\n";
+	        print "<DIV ALIGN=RIGHT>\n";
+	        $o.="<input type=\"submit\" name=\"JS\" value=\"Dalej\">\n";
+	        print "</DIV>\n";
+	        print "</FORM>\n";
+	        $o.="</form>";
+	
+	        return $o;
+  		}    
+    } // end form()
+
+} // end eCard class
+
+?>
diff -ruN ../soteesklep3/htdocs/go/_register/include/order_register.inc.php soteesklep3/htdocs/go/_register/include/order_register.inc.php
--- ../soteesklep3/htdocs/go/_register/include/order_register.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/go/_register/include/order_register.inc.php	2006-07-11 14:14:55.000000000 +0200
@@ -0,0 +1,68 @@
+<?php
+/**
+* Zapisz transakcje w bazie danych
+*
+* \@session int $order_id
+* \@session string $order_id_date
+* \@session int $global_id_pay_method numer id rodzaju platbosci 1- zalicznie, 2 - eCard, 3 - PolCard
+* \@session string $global_pay_name nzwa metody platnosci
+*
+* @author  m@sote.pl
+* @version $Id: order_register.inc.php,v 2.18 2006/06/29 14:23:07 lukasz Exp $
+* @package    register
+*/
+
+if (@$global_secure_test!=true) {
+    die ("Forbidden");
+}
+
+/**
+* Dodaj dodatkow± obs³ugê Metabase.
+*/
+global $database;
+require_once ("include/metabase.inc");
+
+/**
+* Dodaj klasê obs³ugi transakcji.
+*/
+require_once ("include/order/order.inc");
+$ord_reg =& new OrderRegister;
+
+// dodaj transakcje do bazy, generuj numer transakcji
+if (! $ord_reg->getOrderID()) {
+    $ord_reg->insert();
+    
+} else {    
+    // aktualizuj id_pay_method, na wypadek, gdyby uzytlownik np. wybral platnsoc karta
+    // nie dokonczyl platnosci i pozniej wybral inna forme zaplaty
+    
+    // sprawdz czy uzytkownik nie wybral wczesniej platnosci karta kredytowa
+    $my_order_id=$ord_reg->getOrderID();
+    
+    // odczytaj, czy wczesniej nie bylo zdefinowanej metody platnosci
+    // (np. kleint nie dokonczyl autoryzacji karte itp.)
+    $prev_id_pay_method=$database->sql_select("id_pay_method","order_register","order_id=$my_order_id");
+    
+    // przekaz zmienna do pliku _post/index.php
+    // sprawdz czy klient zmienil metode platnosci
+    if (($prev_id_pay_method!=$global_id_pay_method) && ($prev_id_pay_method>1)) {
+        $__check=1;
+    } else $__check=0;
+	if (empty($_SESSION['order_session'])) {
+		$_SESSION['order_session']=$sess->id;
+	} else {
+		$_SESSION['order_session']=md5(time());
+	}    
+    $ord_reg->update($ord_reg->getOrderID());  
+} 
+
+// zapisz wybrana forme platnosci
+$sess->register("global_id_pay_method",$global_id_pay_method);
+$global_pay_name=$config->pay_method[$global_id_pay_method];
+$sess->register("global_pay_name",$global_pay_name);
+
+// wstaw numer order_id do zalaczonych zdjec, o ile opcja taka jest dostepna w sklepie
+if ($config->basket_photo==true) {
+    require_once("./include/basket_photo_update.inc.php");
+}
+?>
diff -ruN ../soteesklep3/htdocs/go/_search/advanced_search.php soteesklep3/htdocs/go/_search/advanced_search.php
--- ../soteesklep3/htdocs/go/_search/advanced_search.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/go/_search/advanced_search.php	2006-07-11 14:14:55.000000000 +0200
@@ -0,0 +1,229 @@
+<?php
+$global_database=true;
+$global_secure_test=true;
+global $config;
+
+
+
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+require_once ("../../../include/head.inc");
+/**
+* klasa obslugujaca sprawdzanie poprawnosci danych z formularzy
+* @version FormCheck 3.x or higher
+*/
+require_once("include/form_check.inc");
+require_once ("include/image.inc");
+require_once ("include/description.inc");
+require_once ("themes/include/buttons.inc.php");
+require_once("config/auto_config/search_config.inc.php");
+/**
+* slownik z lokalizacja
+*/
+include_once("./lang/_pl/lang.inc.php");
+/**
+* dodatkowe klasa z funkcjami dla search
+*/
+include_once("./include/search.inc.php");
+/**
+* dane tymczasowe spersoanilizowane dla aktualnego serwisu
+* (podlaczane opcjonalnie)
+*/
+@include_once("./tmp_data/data.inc.php");
+
+$form_check=&new AdvSearch; 
+$theme->form_check=&$form_check;
+
+/**
+* funkcje wykorzystane z klasy FormCheck
+*/
+$form_check->fun['name']="string_null";
+$form_check->fun['phrase']="string_null";
+$form_check->fun['color']="string_null";
+$form_check->fun['price_min']="int_null";
+$form_check->fun['price_max']="int_null";
+$form_check->fun['size']="string_null";
+$form_check->fun['bowl']="string_null";
+
+/**
+* komunikaty z bledami dla poszczegolnych funkcji FormCheck
+*/
+$form_check->errors=$lang->adv_search_errors;
+
+/**
+* sprawdz czy sa jakies dane wejsciowe
+* jesli sa przekaz je do klasy FormCheck
+* oraz do klasy theme aby wypelnic formularz danymi
+* bo blednym wypelnieniu
+*/
+if(!empty($_REQUEST['form'])){
+	$form=$_REQUEST['form'];
+	$form_check->form=&$form;
+	$theme->form=&$form;
+}
+
+global $config;
+$lid = $config->lang_id;
+
+if(@$_REQUEST['send_form']==1){    
+    if($form_check->form_test()){        
+        $theme->head();        
+        if (empty($form['price_min'])) {
+        	$form['price_min']="0";
+        }
+        if (empty($form['price_max'])) {
+        	$form['price_max']="9999999999";
+        }
+        $_and=false;
+        $sql = "SELECT * FROM main WHERE 1=1 ";
+        $_and=true;
+        
+        reset($form);$form2=array();
+        foreach ($form as $key=>$val) {
+            $form2[$key]=addslashes($val);
+            $form2[$key]=htmlspecialchars($val);
+        }
+        $form=$form2;
+        
+        /**
+        * zapytanie na podstawie danych z formularza
+        */
+        if(!empty($form['phrase'])){
+            if($_and==true){
+                $sql.="AND ";
+                $_and=false;
+            }
+            $sql.="(name_L$lid LIKE '%".$form['phrase']."%' OR lower(xml_description_L$lid) like lower('%".$form['phrase']."%'))";
+            $_and=true;
+                        
+        } else if(!empty($form['name'])){
+            if($_and==true){
+                $sql.="AND ";
+                $_and=false;
+            }
+            $sql.="name_L$lid LIKE '%".$form['name']."%'";
+            $_and=true;
+        }
+        // wprowadz ceny min i max uwzglednic waluty
+        $__currency=$_SESSION['__currency'];
+        $search_price=$config->currency_data[$__currency];
+        
+        if(!empty($form['price_min'])){
+                if($_and==true){
+            	$form['price_min']=$form['price_min']*$search_price;
+                $sql.=" AND ";
+                $_and=false;
+            }
+        if ($form['brutto_netto']==1){
+        	$sql.="price_brutto > '".$form['price_min']."' ";
+        	$_and=true;
+        }else{
+	        $sql.="price_currency > '".$form['price_min']."' ";
+	        $_and=true;
+    	}
+        }
+        if(!empty($form['price_max'])){
+            if($_and==true){
+            	$form['price_max']=$form['price_max']*$search_price;
+                $sql.=" AND ";
+                $_and=false;
+            }
+            if ($form['brutto_netto']==1){
+            $sql.="price_brutto < '".$form['price_max']."' ";
+            $_and=true;
+            }else{
+            $sql.="price_currency < '".$form['price_max']."' ";
+            $_and=true;
+            }     
+        }
+        
+        
+        if(!empty($form['size'])){
+            if($_and==true){
+                $sql.=" AND ";
+                $_and=false;
+            }
+             $sql.="xml_options LIKE '%".$form['size']."%' ";
+        	$_and=true;
+	    }
+	
+
+        if(!empty($form['producer']) && $form['producer']!='opt'){
+            if($_and==true){
+                $sql.=" AND ";
+                $_and=false;
+            }
+            $sql.="id_producer=".$form['producer'];
+            $_and=true;
+        }
+        
+        if(!empty($form['c1'])){
+            if($_and==true){
+                $sql.=" AND ";
+                $_and=false;
+            }
+            $sql.="id_category1 = " . $form['c1'] . " ";
+            $_and=true;
+        }       
+
+        if(!empty($form['c2'])){
+            if($_and==true){
+                $sql.=" AND ";
+                $_and=false;
+            }
+            $sql.="id_category2 = " . $form['c2'] . " ";
+            $_and=true;
+        }
+        if(!empty($form['c3'])){
+            if($_and==true){
+                $sql.=" AND ";
+                $_and=false;
+            }
+            $sql.="id_category3 = " . $form['c3'] . " ";
+            $_and=true;
+        }
+        if(!empty($form['c4'])){
+            if($_and==true){
+                $sql.=" AND ";
+                $_and=false;
+            }
+            $sql.="id_category4 = " . $form['c4'] . " ";
+            $_and=true;
+        }
+        if(!empty($form['c5'])){
+            if($_and==true){
+                $sql.=" AND ";
+                $_and=false;
+            }
+            $sql.="id_category5 = " . $form['c5'] . " ";
+            $_and=true;
+        }
+        /**
+        * funkcja prezentujaca wynik zapytania w glownym oknie strony
+        */
+        include_once ("include/dbedit_list.inc");
+        $dbedit =& new DBEditList;
+        $dbedit->title="Wynik wyszukiwania zaawansowanego";
+        $theme->page_open_object("show",$dbedit,"page_open");
+        $theme->foot();        
+    } else {        
+        // naglowek
+        $theme->head();
+        $theme->page_open_head("page_open_2_head");
+        include_once("./include/prepare_javascript.inc.php");
+        include_once("./html/adv_search_form.html.php");     
+        // stopka
+        $theme->page_open_foot("page_open_1_foot");
+        $theme->foot();
+    }
+} else {
+    // naglowek
+    $theme->head();
+    $theme->page_open_head("page_open_2_head");
+    include_once("./include/prepare_javascript.inc.php");
+    include_once("./html/adv_search_form.html.php");       
+    // stopka
+    $theme->page_open_foot("page_open_1_foot");
+    $theme->foot();
+}
+include_once ("include/foot.inc");
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/htdocs/go/_search/full_search.php soteesklep3/htdocs/go/_search/full_search.php
--- ../soteesklep3/htdocs/go/_search/full_search.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/go/_search/full_search.php	2006-07-11 14:14:55.000000000 +0200
@@ -0,0 +1,85 @@
+<?php
+/**
+ * Wyszukaj produkty, pelne wyszukiwanie wg wyrazenia
+ *
+ * @param string GET $search_query_words szukany ciag znakow
+ * 
+ * @author m@sote.pl
+ * \@modified_by p@sote.pl (szukaj w nazwie dla kazdego ze slow wyrazenia)
+ * @version $Id: full_search.php,v 2.9 2006/06/05 11:15:45 lukasz Exp $
+* @package    search
+ */
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+require_once ("../../../include/head.inc");
+
+// naglowek
+$theme->head();
+
+// odczytaj wyszukiwany ciag znakow
+if (! empty($_REQUEST['search_query_words'])) {
+    $query_words=my($_REQUEST['search_query_words']);
+} else  $query_words="";
+
+$lang_id = $config->lang_id;
+
+// add magic quotes
+$query_words=ereg_replace(";","\;",$query_words);
+$query_words=ereg_replace("'","\'",$query_words);
+$query_words=ereg_replace("\*","", $query_words);
+$query_words=ereg_replace("%","",  $query_words);
+$query_words=htmlspecialchars($query_words);
+if ((strlen($query_words)<2) || empty($query_words)) {
+    $sql="SELECT id FROM main WHERE 1=2";
+} else {
+    if ($config->lang!=$config->base_lang) {
+        $prefix_lang=$config->lang."_";   
+    } else $prefix_lang='';
+    
+    $sql="SELECT * FROM main WHERE 
+              lower(category1) like lower('%$query_words%') OR
+              lower(category2) like lower('%$query_words%') OR
+              lower(category3) like lower('%$query_words%') OR
+              lower(category4) like lower('%$query_words%') OR
+              lower(category5) like lower('%$query_words%') OR
+              lower(producer)  like lower('%$query_words%') OR
+              lower(name_L$lang_id)      like lower('%$query_words%') OR
+              lower(user_id)   like lower('%$query_words%') OR
+              lower(xml_description_L$lang_id) like lower('%$query_words%') OR";
+}
+
+// jezeli wpisano wiecej niz jedno slowo szukaj dla kazdego z nich w nazwie poduktu
+$words=split(" ",$query_words);
+$count=count($words);
+
+if ($count>1) {
+    foreach ($words as $value) {
+	$sql.=" lower(name_L$lang_id) like lower('%$value%') AND ";
+    }
+    
+    $sql=ereg_replace("AND $","",$sql);	    
+} else {
+    $sql=ereg_replace("OR$","",$sql);	    
+}
+
+// funkcja prezentujaca wynik zapytania w glownym oknie strony 
+include_once ("include/dbedit_list.inc");
+
+$dbedit = new DBEditList;
+$dbedit->title=$lang->bar_title['search'].": $query_words";
+$dbedit->empty_list_message=$lang->search_empty_list2;   
+
+// funkcja prezentujaca wynik zapytania w glownym oknie strony 
+include_once ("include/dbedit_list.inc");
+
+// jesli nie ma wynikow to wywolaj skrypt
+$__new_search_action="index.php";
+$theme->page_open_object("show",$dbedit,"page_open");
+
+// stopka
+$theme->foot();
+
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/htdocs/go/_search/include/prepare_javascript.inc.php soteesklep3/htdocs/go/_search/include/prepare_javascript.inc.php
--- ../soteesklep3/htdocs/go/_search/include/prepare_javascript.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/go/_search/include/prepare_javascript.inc.php	2006-07-11 14:14:55.000000000 +0200
@@ -0,0 +1,29 @@
+<?php
+global $search_form_tree, $DOCUMENT_ROOT, $sess, $_SESSION, $js_code;
+
+include_once("config/tmp/adv_search_form_config.php");
+
+function getNodeCode($node, $level = 1) {
+    $code = '';
+    while (list($key, $val) = each($node)) {
+        $cat_id = $key;
+        $cat_name = LangF::translate($val['name']);
+        $indent = str_repeat('    ', $level);
+        $node_name = "c_$level";
+        $prev_level = $level - 1;
+        if($prev_level == 0) {
+            $parent_node_name = "c_root";
+        }
+        else {
+            $parent_node_name = "c_" . $prev_level;
+        }
+        $code .= $indent . "$node_name = $parent_node_name.addCategoryChild($cat_id, \"$cat_name\", false);\n";
+        if(!empty($val['children'])) {
+            $code .= getNodeCode($val['children'], $level + 1);
+        }
+    }
+    return $code;
+}
+
+$js_code = getNodeCode($search_form_tree);
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/htdocs/lang/_pl/lang.inc.php soteesklep3/htdocs/lang/_pl/lang.inc.php
--- ../soteesklep3/htdocs/lang/_pl/lang.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/lang/_pl/lang.inc.php	2006-07-11 14:14:57.000000000 +0200
@@ -0,0 +1,755 @@
+<?php
+$lang->encoding="ISO-8859-2";
+$lang->shop="SOTEeSKLEP";
+$lang->date="Data";
+$lang->back="Powrót";
+$lang->search="Szukaj";
+$lang->add="Dodaj";
+$lang->help="Pomoc";
+$lang->symbol_add="+";
+$lang->symbol_del="-";
+$lang->del="Usuñ";
+$lang->next="Dalej";
+$lang->send="Wy¶lij";
+$lang->more="Informacja";
+$lang->recommend="Poleæ sklep (wpisz e-mail)";
+$lang->basket_add="Dodaj do koszyka";
+$lang->wishlist_add="Dodaj do przechowalni";
+$lang->time_execute="czas generowania strony";
+$lang->go=">>";
+$lang->producer_select="Wszyscy producenci";
+$lang->category_select="Wszystkie kategorie";
+$lang->choose_producer="Kategorie";
+$lang->page="Strona";
+$lang->records="Rekordy";
+$lang->empty_list_message="Brak rekordów";
+$lang->first="Pocz±tek";
+$lang->bool=array(
+                '1'=>"tak",
+                '0'=>"nie",
+                );
+$lang->head_home="Home";
+$lang->head_help="Pomoc";
+$lang->head_contact="Kontakt";
+$lang->head_about_shop="O sklepie";
+$lang->head_your_basket="Twój koszyk";
+$lang->head_login_register="Logowanie, rejestracja";
+$lang->head_my_account="Moje konto";
+$lang->head_terms="Regulamin";
+$lang->head_soteshop="SOTEeSKLEP 2";
+$lang->head_in_basket="Warto¶æ";
+$lang->head_products_count="Liczba produktów";
+$lang->head_shop="Sklep";
+$lang->head_search="Szukaj";
+$lang->head_promotions="Promocje";
+$lang->head_news="Nowo¶ci";
+$lang->head_about_company="O firmie";
+$lang->head_users_online="U¿ytkownicy online";
+$lang->head_register="Zarejestruj siê";
+$lang->head_simple_title="Sklep";
+$lang->google=array(
+                'title'=>"",
+                'keywords'=>"",
+                'description'=>"",
+                );
+$lang->foot_main_page="Strona g³ówna";
+$lang->foot_promotions="Promocje";
+$lang->foot_news="Nowo¶ci";
+$lang->foot_about="O firmie";
+$lang->foot_terms="Regulamin";
+$lang->foot_basket_state="Aktualny stan koszyka";
+$lang->foot_help="Pomoc";
+$lang->foot_soft="oprogramowanie";
+$lang->cols=array(
+                'name'=>"Nazwa",
+                'producer'=>"Producent",
+                'price'=>"Cena",
+                'price_brutto'=>"Cena brutto",
+                'price_netto'=>"Cena netto",
+                'price_nettobrutto'=>"Cena netto/brutto",
+                'category'=>"Kategoria",
+                'discount'=>"Rabat",
+                'price_brutto_detal'=>"Stara cena",
+                'points'=>"Punkty",
+                'm_points'=>"Punktów",
+                );
+$lang->main_recommend="Polecamy";
+$lang->main_news="Najnowsze wiadomo¶ci";
+$lang->left_choose_category="Wybierz kategoriê";
+$lang->right_choose_layout="Wybierz wygl±d sklepu";
+$lang->right_send="Wy¶lij";
+$lang->right_news="Nowo¶ci";
+$lang->random_discount="Rabat";
+$lang->random_price_brutto="Cena brutto";
+$lang->random_price_netto="Cena netto";
+$lang->info_price_detal="Cena detaliczna";
+$lang->record_price_netto="Cena netto";
+$lang->record_price_brutto="Cena brutto";
+$lang->discount="rabat";
+$lang->calculate_order="Podlicz";
+$lang->take_order="Realizuj zamówienie";
+$lang->delivery_cost="Koszt dostawy";
+$lang->shopping_amount="Warto¶æ zakupów";
+$lang->total_order_amount="Razem do zap³aty";
+$lang->delivery_country="Wybierz kraj dostawy";
+$lang->register_info="Je¶li nie jeste¶ zarejestrowanym u¿ytkownikiem mo¿esz siê zarejestrowaæ.";
+$lang->register_now="Zarejestruj siê";
+$lang->register_fill_gaps="Nale¿y wype³niæ pola oznaczone t³ustym drukiem";
+$lang->register_nip_desc="je¶li chcesz otrzymaæ <br>fakturê VAT";
+$lang->register_cor_desc=" Czy podany wy¿ej adres <BR>jest adresem wysy³kowym?";
+$lang->register_news_desc="Czy chcesz otrzymywaæ informacje ze sklepu?";
+$lang->register_newsletter="Chcesz otrzymywaæ informacje o promocjach<BR> i nowo¶ciach na konto e-mail.";
+$lang->register_bil_cor_data="Dane billingowe i adres korespondencyjny";
+$lang->register_bil_data="Dane billingowe";
+$lang->register_cor_address="Adres wysy³kowy";
+$lang->register_post_payment="Wy¶lij zamówienie za zaliczeniem pocztowym";
+$lang->register_ecard_payment="P³atno¶æ kart± kredytow± - system eCard";
+$lang->register_polcard_payment="P³atno¶æ kart± kredytow± - system PolCard";
+$lang->register_polcard_cards="Akceptowane karty: VISA, MasterCard, PolCard, JCB, Diners Club, Styl";
+$lang->register_citi_payment="P³atno¶æ kart± kredytow± - system CitiConnect";
+$lang->register_paypal_payment="P³acê systemem PayPal";
+$lang->register_allpay_payment="P³atno¶æ poprzez Allpay";
+$lang->register_paypal_info="Po kliknieciu w przycisk zostaniesz przekierowany do systemu p³ato¶ci PayPal";
+$lang->register_payu_payment="P³acê systemem PayU";
+$lang->register_transfer_payment="P³acê przelewem";
+$lang->register_post_order="Zamów za zaliczeniem";
+$lang->register_ecard_order="P³acê kart± - eCard";
+$lang->register_polcard_order="P³acê kart± - PolCard";
+$lang->register_paypal_order="P³acê systemem PayPal";
+$lang->register_citi_order="P³acê kart± - CitiConnect";
+$lang->register_payu_order="P³acê systemem PayU";
+$lang->register_allpay_order="P³acê z systemem Allpay";
+$lang->register_transfer_order="P³acê przelewem";
+$lang->users_login_name="Zaloguj siê";
+$lang->users_login_email="Login lub e-mail";
+$lang->users_password="Has³o";
+$lang->users_login="Zalogowany";
+$lang->users_logout="Wyloguj siê";
+$lang->users_change_personal_data="Zmieñ swoje dane";
+$lang->users_your_points="Twoja aktualna liczba punktów";
+$lang->users_register_desc="Je¶li jeste¶ nowym klientem mo¿esz siê zarejestrowaæ";
+$lang->users_register="Zarejestruj siê";
+$lang->users_sales="Handlowiec";
+$lang->users_order_register_desc="Je¶li chcesz teraz zrealizowaæ swoje zamówienie, to kliknij poni¿szy przycisk.";
+$lang->users_take_order="Realizuj zamówienie";
+$lang->users_bar_auth="Autoryzacja";
+$lang->users_login_error="B³êdna autoryzacja!";
+$lang->users_login_error_advice="Spróbuj ponownie siê zalogowaæ";
+$lang->users_user="U¿ytkownik ";
+$lang->users_loginok_desc=" zosta³ poprawnie zalogowany :)";
+$lang->users_change_data="Edytuj dane";
+$lang->users_points="Punkty";
+$lang->users_trans="Transakcje";
+$lang->users_trans_history="Historia transakcji";
+$lang->users_password_confirm="Powtórz has³o";
+$lang->users_continue="Dalej";
+$lang->users_already_registered="Je¶li jeste¶ ju¿ zarejestrowanym klientem to";
+$lang->users_logout_action="zosta³ wylogowany";
+$lang->users_registered="Twoje dane zosta³y zarejestrowane";
+$lang->login_ok="jest zalogowany";
+$lang->users_address_book="Ksiazka adresowa";
+$lang->users_reminder="Terminarz";
+$lang->basket_delivery_name_unknown="Nieokre¶lony";
+$lang->basket_delivery_country="Kraj dostawy";
+$lang->basket_delivery_cost="Koszt dostawy";
+$lang->basket_photo_description="<B>Opis zamówionego  produktu (uwagi):</b>";
+$lang->basket_upload="Za³±cz plik";
+$lang->basket_upload_file_exists="Za³±czony plik ju¿ istnieje, zmieñ nazwê pliku ";
+$lang->basket_photo_submit="Aktualizuj zmiany/za³±cz zbiorowo pliki";
+$lang->basket_total_order_amount="Razem do zap³aty";
+$lang->basket_bar_title="Zawarto¶æ koszyka";
+$lang->basket_order_continue="Kontynuuj zakupy";
+$lang->basket_delivery_name="Dostawca";
+$lang->basket_order_amount_name="Kwota do zap³aty";
+$lang->basket_txt_title="Zawarto¶æ koszyka";
+$lang->basket_amount_name="Warto¶æ zakupów";
+$lang->basket_elements=array(
+                'name'=>"nazwa",
+                'user_id'=>"ID",
+                'num'=>"ilosc",
+                'price_netto'=>"cena netto",
+                'price_brutto'=>"cena brutto",
+                'vat'=>"vat",
+                'sum_brutto'=>"suma brutto",
+                'name_unavailable'=>"Sprawd¼ dostêpno¶æ produktu",
+                'points_value'=>"punktów",
+                );
+$lang->order_points_update="Zakup za punkty";
+$lang->basket_attach_images_order="Za³±cz zdjêcia do zamówienia";
+$lang->basket_attach_file_desc1="Je¶li chcesz za³aczyæ zdjêcie do danego produktu, to wybierz plik i kliknij przycisk";
+$lang->basket_attach_file="Za³±cz plik";
+$lang->basket_attach_file_desc2="Kiedy dla kilku produktów jest to samo zdjêcie, za³±cz tylko jedno,a dla pozosta³ych produktów wybierz nazwê z listy i kliknij";
+$lang->basket_check_attach="Sprawd¼/Za³±cz zdjêcia do zamówienia";
+$lang->promotions_basket_name="Promocja, z której korzystasz";
+$lang->promotions_basket_amount="Warto¶æ zakupów po rabacie, w promocji";
+$lang->promotions_order_amount="Kwota do zap³aty po rabacie, w promocji";
+$lang->promotions_basket_discount="rabat";
+$lang->promotions_mail_name="Promocja";
+$lang->promotions_select="Dostêpne promocje";
+$lang->promotions_submit="Skorzytaj z promocji";
+$lang->promotions_go2basket="Realizuj zamówienie";
+$lang->promotions_code="Wpisz kod promocji";
+$lang->promotions_title="Promocje";
+$lang->promotions_all="Zobacz opisy promocji";
+$lang->choose="Wybierz";
+$lang->short_list="Lista skrócona";
+$lang->full_list="Pe³na lista ze zdjêciami";
+$lang->producers="Producenci";
+$lang->sort="Sortowanie";
+$lang->all="Wszyscy";
+$lang->trans_desc="Klikaj±c w id transakcji uzyskasz szczegó³owe informacje !";
+$lang->trans_id="Id transakcji";
+$lang->trans_date="Data transakcji";
+$lang->trans_amount="Kwota";
+$lang->trans_stat="Status";
+$lang->trans_pay_conf="Zap³acona";
+$lang->trans_payment="P³atno¶æ";
+$lang->trans_ask4trans="Zadaj pytanie sprzedawcy";
+$lang->basket_th_product_name="nazwa produktu";
+$lang->basket_th_netto="netto";
+$lang->basket_th_vat="vat";
+$lang->basket_th_brutto="brutto";
+$lang->basket_th_count="ilo¶æ";
+$lang->basket_th_sum="suma";
+$lang->basket_th_delete="usuñ";
+$lang->basket_th_points="punkty";
+$lang->yes="tak";
+$lang->no="nie";
+$lang->delete="usuñ";
+$lang->basket_title="Zawarto¶æ koszyka";
+$lang->bar_title=array(
+                'promotion'=>"Promocje",
+                'newcol'=>"Nowo¶ci",
+                'bestseller'=>"Bestseller",
+                'main_page'=>"Zapraszamy na zakupy",
+                'users'=>"Logowanie, rejestracja",
+                'register_confirm'=>"Sprawd¼ wprowadzone dane, wybierz sposób p³atnosæi",
+                'register_cor'=>"Adres wysy³kowy",
+                'register_billing'=>"Dane billingowe",
+                'search'=>"Wynik wyszukiwania dla",
+                'polcard'=>"P³atno¶æ kart± kredytow± - system <a href=http:// www.polcard.com.pl target=polcard>PolCard</a>",
+                'ecard'=>"P³atno¶æ kart± kredytow± - system <a href=http:// www.ecard.pl target=ecard>eCard</a>",
+                'newsletter'=>"Newsletter",
+                'firm'=>"Logowanie dla odbiorców hurtowych",
+                'themes'=>"Zmiana wygl±du strony",
+                'account'=>"Moje konto",
+                'trans'=>"Moje transakcje",
+                'trans_products'=>"Zawarto¶æ transakcji numer:",
+                'info'=>"Informacje",
+                'address_book'=>"Ksi±zka adresowa",
+                'reminder'=>"Terminarz",
+                'contact'=>"Kontakt",
+                'about_shop'=>"O sklepie",
+                'help'=>"Pomoc",
+                'about_company'=>"O firmie",
+                'terms'=>"Regulamin",
+                'points'=>"Moje punkty",
+                );
+$lang->register_billing_form_errors=array(
+                'name'=>"brak imienia",
+                'surname'=>"brak nazwiska",
+                'street'=>"brak ulicy",
+                'street_n1'=>"brak numeru domu",
+                'postcode'=>"brak kodu pocztowego",
+                'city'=>"brak miasta",
+                'phone'=>"brak telefonu",
+                'email'=>"niepoprawny adres email/lub adres istnieje ju¿ w bazie",
+                'country'=>"niew³a¶ciwy kraj",
+                );
+$lang->register_cor_form_errors=array(
+                'name'=>"brak imienia",
+                'surname'=>"brak nazwiska",
+                'street'=>"brak ulicy",
+                'street_n1'=>"brak numeru domu",
+                'postcode'=>"brak kodu pocztowego",
+                'city'=>"brak miasta",
+                'email'=>"niepoprawny adres email",
+                );
+$lang->form_name=array(
+                'firm'=>"firma",
+                'name'=>"imiê",
+                'surname'=>"nazwisko",
+                'street'=>"ulica",
+                'street_n1'=>"nr domu",
+                'street_n2'=>"nr mieszkania",
+                'postcode'=>"kod pocztowy",
+                'city'=>"miasto",
+                'phone'=>"telefon",
+                'email'=>"e-mail",
+                'country'=>"kraj",
+                'nip'=>"NIP",
+                'description'=>"uwagi",
+                'change_country'=>"zmieñ kraj",
+                );
+$lang->select_country="Wybierz kraj dostawy";
+$lang->form_title_addr="Dane billingowe";
+$lang->form_title_addr_cor="Adres korespondencyjny";
+$lang->form_title_one_addr="Adres korespondencyjny taki sam jak billingowy";
+$lang->basket_empty="Koszyk jest pusty";
+$lang->order_continue="Kontynuuj zakupy";
+$lang->order_subject="Zamówienie ze sklepu";
+$lang->order_confirm_subject="Potwierdzenie zamówienia";
+$lang->search_empty_query="B³êdny ci±g wyszukiwania. Wpisz nazwê szukanego produktu.";
+$lang->search_empty_title="Wyszukiwanie";
+$lang->search_category="szukaj w kategorii";
+$lang->search_description="szukaj w opisach";
+$lang->search_advanced="Wyszukiwanie zaawansowane";
+$lang->delivery_name="Dostawca";
+$lang->delivery_name_unknown="Nieokre¶lony";
+$lang->order_amount_name="Kwota do zap³aty";
+$lang->users_new_form_errors=array(
+                'login'=>"b³êdny login",
+                'password'=>"b³êdne has³o, wpisz min. 6 znaków",
+                'password2'=>"b³êdnie powtórzone has³o",
+                );
+$lang->users_log_in="Zaloguj siê";
+$lang->users_change_password="Zmieñ has³o";
+$lang->pay_method=array(
+                '1'=>"Przy odbiorze",
+                '2'=>"eCard",
+                '3'=>"PolCard",
+                '4'=>"Inteligo",
+                '5'=>"mBank",
+                '6'=>"CitiConnect",
+                '7'=>"PayU",
+                '11'=>"Przelew",
+                '12'=>"Przelewy24",
+                '20'=>"P³atno¶ciPL",
+                '21'=>"Allpay",
+                '110'=>"P³atno¶æ kart±",
+                );
+$lang->pay_method_title="Rodzaj p³atno¶ci";
+$lang->pay_method_status_off="Tryb testowy";
+$lang->upload="Za³±cz plik";
+$lang->upload_photo="Za³±czono plik";
+$lang->upload_file_exists="Za³±czony plik juz istnieje, zmieñ nazwê pliku ";
+$lang->upload_name_info="wpisz nazwê pliku";
+$lang->message_basket_photo_title="Zdjêcia do produktów:
+
+";
+$lang->newsletter="Newsletter";
+$lang->newsletter_list_info="Niusy";
+$lang->info_options="Wybierz opcjê: ";
+$lang->mp3=array(
+                'title'=>"Pliki do ods³uchania w formacie MP3",
+                'ftp'=>"¶ci±gnij player mp3",
+                );
+$lang->points_category="Zakupy za punkty";
+$lang->points_show="Liczba Twoich punktów";
+$lang->available="Dostêpno¶æ:";
+$lang->available_online=array(
+                '1'=>"produkt dostêpny on-line",
+                '0'=>"jest, ale niedostêpny on-line",
+                );
+$lang->ask4price_mail="Zapytanie o cene produktu";
+$lang->ask4price="Zapytaj o cenê";
+$lang->ask4price_list="Zapytania o cenê";
+$lang->ask4price_empty_list="Brak zapytañ o cenê";
+$lang->close="Zamknij";
+$lang->order_by=array(
+                'name'=>"Nazwa",
+                'price'=>"Cena",
+                'producer'=>"Producent",
+                'SCORE'=>"Dopasowanie",
+                );
+$lang->in_category="Inne produkty z tej samej kategorii";
+$lang->accessories="Akcesoria";
+$lang->full_description="Pe³ny opis";
+$lang->write_up="Recenzje produktu";
+$lang->order_names=array(
+                'order_id'=>"Numer transakcji",
+                'amount'=>"Kwota do zap³aty",
+                'delivery_cost'=>"Koszzty dostawy",
+                'id_currency'=>"Waluta",
+                'id_pay_method'=>"P³atno¶æ",
+                'date_add'=>"Data transakcji",
+                'time_add'=>"Godzina",
+                'xml_description'=>"zamówienie",
+                'id_user'=>"id u¿ytkownika",
+                'xml_user'=>"dane zamawiaj±cego",
+                'name'=>"zamawiaj±cy",
+                'id_delivery'=>"Dostawca",
+                'id_status'=>"Status",
+                'confirm'=>"Zap³acona",
+                'confirm_user'=>"Potwierdzona mailem",
+                'description'=>"Informacje dodatkowe",
+                'status'=>"Status",
+                'checksum'=>"suma kontrolna transakcji",
+                'send_date'=>"Data wys³ania przesy³ki",
+                'send_number'=>"Numer przesy³ki",
+                'send_confirm'=>"Przesy³ka wys³ana",
+                );
+$lang->users_bar="Witamy w panelu u¿ytkownika !";
+$lang->order_basket=array(
+                'name'=>"nazwa produktu",
+                'options'=>"opcje",
+                'user_id'=>"id",
+                'price_netto'=>"cena netto",
+                'vat'=>"VAT",
+                'num'=>"ilo¶æ",
+                'price_brutto'=>"cena brutto",
+                'sum'=>"suma",
+                );
+$lang->send_link="W celu potwierdzenia zamowienia kliknij ponizszy link";
+$lang->register_send_title="Wys³anie zamówienia";
+$lang->register_send_confirm_ok="Dziêkujemy za dokonanie zakupów.";
+$lang->register_send_confirm_ok_add_info="<BR><b>UWAGA!</b> Zmieniona zosta³a forma p³atno¶ci.<BR>
+
+Je¶li jednak dosz³o do autoryzacji transakcji przez inny system p³atno¶ci, towar zostanie wys³any do Ciebie bez zaliczenia.<BR><BR>";
+$lang->register_send_order_error="Niestety nie uda³o siê wys³aæ zamówienia. <BR>
+
+				Skontaktuj siê ze sprzedawc± pod adresem ";
+$lang->send_add_info=" 
+
+UWAGA! U¿ytkownik zmieni³ formê p³atno¶ci. Sprawd¼ w panelu administracyjnym POLCARD'u czy ta transakcja zosta³a zautoryzowana. ";
+$lang->trans_link="Aby zobaczyæ szczegó³owe informacje dotycz±ce Twojej transakcji kliknij poni¿szy link";
+$lang->main_keys_empty="w bazie nie ma aktualnie kodów do tego produktu, <br> odpowiedni kod otrzymasz mailem";
+$lang->main_keys_code="Kody do zamówienia";
+$lang->main_keys_cols=array(
+                'name'=>"Nazwa produktu",
+                'info'=>"Komunikat",
+                );
+$lang->main_keys_errors_title="Dodatkowe informacje o realizacji zamówienia";
+$lang->main_keys_title="Dodatkowe dane do zamówienia";
+$lang->main_keys_mail=array(
+                'subject'=>"Dodatkowe dane do zamówienia",
+                'title'=>"Poni¿ej znajduj± siê kody do zamówienia z³o¿onego w sklepie internetowym",
+                'user_id'=>"ID",
+                'name'=>"Nazwa",
+                );
+$lang->main_keys_download="pobierz plik";
+$lang->main_keys_demo_title="Bezp³atne pliki do pobrania:";
+$lang->main_keys_download_title="Pobieranie plików";
+$lang->main_keys_download_not_found="Wskazany plik nie istnieje. Skontaktuj siê ze sprzedawc±";
+$lang->month_name=array(
+                '1'=>"Styczeñ",
+                '2'=>"Luty",
+                '3'=>"Marzec",
+                '4'=>"Kwiecieñ",
+                '5'=>"Maj",
+                '6'=>"Czerwiec",
+                '7'=>"Lipiec",
+                '8'=>"Sierpieñ",
+                '9'=>"Wrzesieñ",
+                '10'=>"Pa¼dziernik",
+                '11'=>"Listopad",
+                '12'=>"Grudzieñ",
+                );
+$lang->currency_select="Wybierz walutê";
+$lang->infoOnPageURI=array(
+                'name'=>"Wiêcej",
+                );
+$lang->printPage=array(
+                'button'=>"Drukuj",
+                'info'=>"Wydrukowaæ stronê?",
+                );
+$lang->newsletter_add=" Dodaj ";
+$lang->newsletter_remove=" Usuñ ";
+$lang->wp_store_trans=array(
+                '-1'=>"Serwer SOAP niedostêpny",
+                '0'=>"Wszystko ok",
+                '1'=>"B³±d autoryzacji",
+                '2'=>"Operacja powiod³a siê czê¶ciowo",
+                '3'=>"Operacja nie powiod³a siê ca³kowicie",
+                );
+$lang->users_forgot_password="Nie pamiêtasz has³a?";
+$lang->users_click_here="Kliknij tutaj";
+$lang->country_user_def="Wybierz kraj";
+$lang->country=array(
+                'AF'=>"Afganistan",
+                'AL'=>"Albania",
+                'DZ'=>"Algeria",
+                'AD'=>"Andora",
+                'AO'=>"Angola",
+                'AI'=>"Anguilla",
+                'AQ'=>"Andarktyda",
+                'AG'=>"Antigua i Barbuda",
+                'AN'=>"Antyle holenderskie",
+                'SA'=>"Arabia Saudyjska",
+                'AR'=>"Argentyna",
+                'AM'=>"Armenia",
+                'AW'=>"Aruba",
+                'AU'=>"Australia",
+                'AT'=>"Austria",
+                'AZ'=>"Azejberd¿an",
+                'BS'=>"Bahamy",
+                'BH'=>"Bahrajn",
+                'BD'=>"Bangladesz",
+                'BB'=>"Barbados",
+                'BE'=>"Belgia",
+                'BZ'=>"Belize",
+                'BJ'=>"Benin",
+                'BM'=>"Bermudy",
+                'BT'=>"Bhutan",
+                'BY'=>"Bia³oru¶",
+                'BO'=>"Boliwia",
+                'BA'=>"Bo¶nia i Hercegowina",
+                'BW'=>"Botswana",
+                'BR'=>"Brazylia",
+                'BN'=>"Brunei Darussalam",
+                'IO'=>"Brytyjskie Terytorium Oceanu Indyjskiego",
+                'BG'=>"Bu³garia",
+                'BF'=>"Burkina Faso",
+                'BI'=>"Burundi",
+                'HR'=>"Chorwacja",
+                'CL'=>"Chile",
+                'CN'=>"Chiny",
+                'CY'=>"Cypr",
+                'TD'=>"Czad",
+                'CZ'=>"Czechy",
+                'DK'=>"Dania",
+                'DM'=>"Dominika",
+                'DO'=>"Dominikana",
+                'DJ'=>"D¿ibuti",
+                'EG'=>"Egypt",
+                'EC'=>"Ekwador",
+                'ER'=>"Erytrea",
+                'EE'=>"Estonia",
+                'ET'=>"Etiopia",
+                'FK'=>"Falklandy",
+                'FJ'=>"Fid¿i",
+                'PH'=>"Filipiny",
+                'FI'=>"Finlandia",
+                'FR'=>"Francja",
+                'TF'=>"Francuskie Terytorium Po³udniowe",
+                'GA'=>"Gabon",
+                'GM'=>"Gambia",
+                'GH'=>"Ghana",
+                'GI'=>"Gibraltar",
+                'GR'=>"Grecja",
+                'GD'=>"Grenada",
+                'GL'=>"Grenlandia",
+                'GE'=>"Gruzja",
+                'GU'=>"Guam",
+                'GY'=>"Gujana",
+                'GF'=>"Gujana Francuska",
+                'GP'=>"Gwadelupa",
+                'GT'=>"Gwatemala",
+                'GN'=>"Gwinea",
+                'GW'=>"Gwinea Bissau",
+                'GQ'=>"Guinea Równikowa",
+                'HT'=>"Haiti",
+                'HM'=>"Heard i wyspy McDonalda",
+                'ES'=>"Hiszpania",
+                'NL'=>"Holandia",
+                'HN'=>"Honduras",
+                'HK'=>"Hongkong",
+                'IN'=>"Indie",
+                'ID'=>"Indonezia",
+                'IQ'=>"Irak",
+                'IR'=>"Iran",
+                'IE'=>"Irlandia",
+                'IS'=>"Islandia",
+                'IL'=>"Izrael",
+                'JM'=>"Jamajka",
+                'JP'=>"Japonia",
+                'YE'=>"Jemen",
+                'JO'=>"Jordania",
+                'KY'=>"Kajmany",
+                'KH'=>"Kambod¿a",
+                'CM'=>"Kamerun",
+                'CA'=>"Kanada",
+                'QA'=>"Katar",
+                'KZ'=>"Kazachstan",
+                'KE'=>"Kenia",
+                'KI'=>"Kiribati",
+                'CO'=>"Kolumbia",
+                'KM'=>"Komory",
+                'CG'=>"Kongo",
+                'CD'=>"Kongo (d. Zair)",
+                'KR'=>"Korea Po³udniowa",
+                'KP'=>"Korea Pó³nocna",
+                'CR'=>"Kostaryka",
+                'CU'=>"Kuba",
+                'KW'=>"Kuwejt",
+                'KG'=>"Kyrgystan",
+                'LA'=>"Laos",
+                'LS'=>"Lesotho",
+                'LB'=>"Liban",
+                'LR'=>"Liberia",
+                'LY'=>"Libia",
+                'LI'=>"Liechtenstein",
+                'LT'=>"Litwa",
+                'LU'=>"Luksemburg",
+                'LV'=>"£otwa",
+                'MK'=>"Macedonia",
+                'MG'=>"Madagaskar",
+                'YT'=>"Majotta",
+                'MO'=>"Makao",
+                'MW'=>"Malawi",
+                'MV'=>"Malediwy",
+                'MY'=>"Malezja",
+                'ML'=>"Mali",
+                'MT'=>"Malta",
+                'MA'=>"Maroko",
+                'MQ'=>"Martynika",
+                'MR'=>"Mauretania",
+                'MU'=>"Mauritius",
+                'MP'=>"Mariany Pó³nocne",
+                'MX'=>"Meksyk",
+                'FM'=>"Mikronezja",
+                'UM'=>"Minor (Usa)",
+                'MD'=>"Moldawia",
+                'MC'=>"Monako",
+                'MN'=>"Mongolia",
+                'MS'=>"Montserrat",
+                'MZ'=>"Mozambik",
+                'MM'=>"Myanmar (Birma)",
+                'NA'=>"Namibia",
+                'NR'=>"Nauru",
+                'NP'=>"Nepal",
+                'DE'=>"Niemcy",
+                'NE'=>"Niger",
+                'NG'=>"Nigeria",
+                'NI'=>"Nikaragua",
+                'NU'=>"Niue",
+                'NO'=>"Norwegia",
+                'NC'=>"Nowa Kaledonia",
+                'NZ'=>"Nowa Zelandia",
+                'OM'=>"Oman",
+                'PK'=>"Pakistan",
+                'PW'=>"Palau",
+                'PA'=>"Panama",
+                'PG'=>"Papua Nowa Gwinea",
+                'PY'=>"Paragwaj",
+                'PE'=>"Peru",
+                'PN'=>"Pitcairn",
+                'PF'=>"Polinezja Francuska",
+                'PL'=>"Polska",
+                'GS'=>"Po³udniowa Georgia i p³d wyspy Sandwich",
+                'PT'=>"Portugalia",
+                'PR'=>"Portoryko",
+                'ZA'=>"Rep. Po³ud. Afryki (RPA)",
+                'CF'=>"Rep. ¦rodk. Afrykañska",
+                'RE'=>"Reunion",
+                'RU'=>"Rosja",
+                'RO'=>"Rumunia",
+                'RW'=>"Ruanda",
+                'EH'=>"Sahara Zachodnia",
+                'KN'=>"St.Kitts i Nevis",
+                'PM'=>"St.Pierre i Miquelon",
+                'VC'=>"St.Vincent i Grenadyny",
+                'SV'=>"Salwador",
+                'AS'=>"Samoa Amerykañskie",
+                'WS'=>"Samoa",
+                'SM'=>"San Marino",
+                'SN'=>"Senegal",
+                'CS'=>"Serbia i Czarnogóra",
+                'SC'=>"Seszele",
+                'SL'=>"Sierra Leone",
+                'SG'=>"Singapur",
+                'SK'=>"S³owacja",
+                'SI'=>"Slowenia",
+                'SO'=>"Somalia",
+                'LK'=>"Sri Lanka",
+                'US'=>"Stany Zjednoczone Ameryki",
+                'SD'=>"Sudan",
+                'SR'=>"Surinam",
+                'SZ'=>"Suazi",
+                'SY'=>"Syria",
+                'SE'=>"Szwecja",
+                'CH'=>"Szwajcaria",
+                'SH'=>"¦wiêta Helena",
+                'LC'=>"Swiêta £ucja",
+                'TJ'=>"Tad¿ykistan",
+                'TH'=>"Tajlandia",
+                'TW'=>"Tajwan",
+                'TZ'=>"Tanzania",
+                'TG'=>"Togo",
+                'TK'=>"Tokelau",
+                'TT'=>"Trinidad i Tobago",
+                'TO'=>"Tonga",
+                'TN'=>"Tunezja",
+                'TR'=>"Turcja",
+                'TM'=>"Turkmenistan",
+                'TC'=>"Turks i Caicos",
+                'TV'=>"Tuvalu",
+                'UG'=>"Uganda",
+                'UA'=>"Ukraina",
+                'UY'=>"Urugwaj",
+                'UZ'=>"Uzbekistan",
+                'VU'=>"Vanuatu",
+                'WF'=>"Wallis i Futuna ",
+                'VA'=>"Watykan",
+                'VE'=>"Wenezuela",
+                'HU'=>"Wêgry",
+                'GB'=>"Wielka Brytania",
+                'VN'=>"Wietnam",
+                'IT'=>"W³ochy",
+                'TP'=>"Wschodni Timor",
+                'CI'=>"Wybrze¿e Ko¶ci S³oniowej",
+                'BV'=>"Wyspa Bouveta",
+                'CX'=>"Wyspa Bo¿ego Narodzenia",
+                'CK'=>"Wyspy Cooka",
+                'VI'=>"Wyspy Dziewicze (USA)",
+                'VG'=>"Wyspy Dziewicze (Brytyjskie)",
+                'CC'=>"Wyspy Kokosowe",
+                'MH'=>"Wyspy Marshala",
+                'FO'=>"Wyspy Salomona",
+                'ST'=>"Wyspy ¦w.Tomasza i Ksi±¿êce",
+                'CV'=>"Zielony Przyl±dek",
+                'ZM'=>"Zambia",
+                'ZW'=>"Zimbabwe",
+                'AE'=>"Zjednoczone Emiraty Arabskie",
+                'NT'=>"Neutralna strefa",
+                );
+$lang->google_product_list="Lista produktów";             
+$lang->google_categories="Kategorie";
+$lang->google_main_page="Produkty polecane";
+$lang->google_files="Strony tekstowe, informacje";
+$lang->google_up_link="Mapa serwisu";
+$lang->order_confirm_ok="Twoja transakcja zosta³a potwierdzona !<br /> Dziêkujemy.";
+$lang->order_confirm_error="Twoja transakcja nie mo¿e zosta³a potwierdzona.<br /> Sprawd¼ link.";
+$lang->order_confirm_error1="Twojej transakcji nie ma w bazie danych.<br /> Sprawd¼ link.";
+$lang->order_confirm_error2="Twoja transakcja ju¿ wcze¶niej zosta³a zatwierdzona !<br /> Dziêkujemy.";
+$lang->order_confirm_error3="B³êdny numer transakcji !<br /> Sprawd¼ link.";
+$lang->trans_error="Informacje dotycz±ce Twojej transakcji nie mog± zostaæ wy¶wietlone.<br /> Sprawd¼ link.";
+$lang->trans_error1="Twojej transakcji nie ma ju¿ w bazie danych.<br /> Przepraszamy.";		
+$lang->google_up_link="Mapa serwisu";		
+$lang->ranking_title="Klienci, którzy kupili prezentowany produkt, kupili równie¿ poni¿sze:";		
+$lang->products4u_title="Produkty dla Ciebie";		
+$lang->check_uncheck_all="Zaznacz/odznacz wszystkie";
+$lang->to_be_deleted=" do usuniêcia: ";	
+$lang->to_be_moved=" do przechowlani: ";	
+$lang->to_be_moved_2basket=" do koszyka: ";	
+$lang->basket_th_move="do przechowalni";
+$lang->basketForm="Koszyk";
+$lang->wishlistForm="Przechowalnia";
+$lang->info_attrib_wishlist="Do przechowalni";
+$lang->wishlist_empty="Przechowalnia jest pusta";
+$lang->basket_th_move="do przechowalni";
+$lang->wishlist_th_move="do koszyka";
+$lang->info_attrib_wishlist="Do przechowalni";
+$lang->tooltip=array (
+					'wishlist'=>'Dodaj do przechowalni',
+					'wishlist_head'=>'Przechowalnia',
+					'basket'=>'Dodaj do koszyka',
+					'basket_head'=>'Koszyk',
+					'info'=>'Pe³ny opis');
+$lang->head_wishlist="Przechowalnia";
+$lang->points_action="Akcja";
+$lang->points_time="Czas wykonania";
+$lang->points_id_product="Id produktu";
+$lang->user_points=array(
+				    'decrease'=>"zmniejszenie",
+					'add'=>"zwiêkszenie",
+					'for_recommend'=>"za <b>polecenie</b> produktu",
+					'for_product'=>"za <b>kupno</b>",
+					'for_review'=>"za dodanie <b>recenzji</b>",
+					);
+
+$lang->basket_points_amount_name="Warto¶æ zakupów";
+$lang->basket_points_cost="Warto¶æ zamówienia w punktach";
+$lang->basket_points_left="Pozosta³o punktów do wykorzystania";					
+$lang->basket_currency="Waluta obowi±zuj±ca w sklepie to";
+$lang->basket_products_extra=array(
+								  "user_id"=>"ID",
+								  "points_value"=>"pkt"
+								  );
+$lang->info_no_sms="Produktów w poni¿szej tabelce nie mo¿esz kupic p³ac±c SMS. Usuñ te produkty z koszyka i spróbuj jeszcze raz albo zap³aæ u¿ywaj±c jedngo z poni¿szych systemów p³atno¶ci. Zap³aciæ SMS mo¿esz wtedy kiedy w Twoim koszyku s± tylko produktów za które mo¿na p³aciæ SMS i kwota zakupów wynosi 1.22, 2.44, 3.66, 6.10, 7.32, 10.98 PLN ";
+$lang->info_bad_value="Zap³aciæ SMS mo¿esz wtedy kiedy kwota zakupów wynosi 1.22, 2.44, 3.66, 6.10, 7.32, 10.98 PLN. Zmieñ zawarto¶æ koszyka i spróbuj jeszcze raz albo zap³aæ u¿ywaj±c jedngo z poni¿szych systemów p³atno¶ci.";
+$lang->info_for_client="Informacje od sprzedawcy dotycz±ce tej transakcji";
+$lang->desc_max_photo="Poka¿ du¿e zdjêcie";
+$lang->pay_error_info="P³atno¶æ zosta³a anulowana. Sklep nie otrzyma³ potwierdzenia p³atno¶ci.";
+$lang->change_pay_method="Wybierz inn± metodê p³atno¶ci";
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/htdocs/plugins/_pay/_allpay/include/allpay.inc.php soteesklep3/htdocs/plugins/_pay/_allpay/include/allpay.inc.php
--- ../soteesklep3/htdocs/plugins/_pay/_allpay/include/allpay.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/plugins/_pay/_allpay/include/allpay.inc.php	2006-07-11 14:15:02.000000000 +0200
@@ -0,0 +1,79 @@
+<?PHP
+/**
+ * Funckje zwiazane z obsluga platnosciPl
+ *
+ * @author Robert Diak
+ */
+
+class allpay {
+     /**
+     * Konstruktor obiektu 
+     */
+    function allpay($amount) {
+        global $allpay_config;
+        $this->_amount=$amount;
+        return true;
+    } // end func platnoscipl
+    
+     /**
+     * Zamien kwote na format dla Platnosci tj. na kwote wyrazona w groszach
+     * 
+     * @param real $price
+     * @return int kwota do zaplaty w groszach
+     */
+    function price($price) {
+        $price=number_format($price,2,".","");
+        return intval($price*100);
+    } // end
+    
+    /**
+     * Enter description here...
+     *
+     * @return unknown
+     */
+    function form() {
+        global $_SERVER;
+        global $sess;
+        global $allpay_config;
+        global $lang;
+        global $_SESSION;
+        global $config;
+        global $_REQUEST;
+        global $shop;
+        $shop->currency();
+            $o="";
+            $o.="<form action=\"".$allpay_config->allpay_out_url."\" method=\"POST\" name=\"payform\">\n";
+            $o.="<input type=\"hidden\" name=\"id\" value=\"".$allpay_config->allpay_id."\">\n";
+            $o.="<input type=\"hidden\" name=\"amount\" value=\"".$this->_amount."\">\n";
+            $o.="<input type=\"hidden\" name=\"description\" value=\"".$_SESSION['global_order_id']."\">\n";
+            $o.="<input type=\"hidden\" name=\"currency\" value=\"PLN\">\n";
+            $o.="<input type=\"hidden\" name=\"lang\" value=\"".$config->lang."\">\n";
+            $o.="<input type=\"hidden\" name=\"channel\" value=\"".$allpay_config->allpay_channel."\">\n";
+            $o.="<input type=\"hidden\" name=\"ch_lock\" value=\"".$allpay_config->allpay_ch_lock."\">\n";
+            $o.="<input type=\"hidden\" name=\"onlinetransfer\" value=\"".$allpay_config->allpay_onlinetransfer."\">\n";
+            $o.="<input type=\"hidden\" name=\"URL\" value=\"http://".$config->www."/".$allpay_config->allpay_url."\">\n"; 
+            $o.="<input type=\"hidden\" name=\"type\" value=\"".$allpay_config->allpay_type."\">\n"; 
+            $o.="<input type=\"hidden\" name=\"txtguzik\" value=\"".$allpay_config->allpay_txtguzik."\">\n"; 
+            $o.="<input type=\"hidden\" name=\"buttontext\" value=\"".$allpay_config->allpay_buttontext."\">\n"; 
+            $o.="<input type=\"hidden\" name=\"URLC\" value=\"http://".$config->www."/".$allpay_config->allpay_urlc."\">\n"; 
+            $o.="<input type=\"hidden\" name=\"control\" value=\"".$_SESSION['order_session']."\">\n";
+            $o.="<input type=\"hidden\" name=\"firstname\" value=\"".$_SESSION['form']['name']."\">\n";
+            $o.="<input type=\"hidden\" name=\"surname\" value=\"".$_SESSION['form']['surname']."\">\n";
+            $o.="<input type=\"hidden\" name=\"email\" value=\"".$_SESSION['form']['email']."\">\n";
+            $o.="<input type=\"hidden\" name=\"street\" value=\"".$_SESSION['form']['street']."\">\n";
+            $o.="<input type=\"hidden\" name=\"street_n1\" value=\"".$_SESSION['form']['street_n1']."\">\n";
+            $o.="<input type=\"hidden\" name=\"street_n2\" value=\"".$_SESSION['form']['street_n2']."\">\n";
+            $o.="<input type=\"hidden\" name=\"city\" value=\"".$_SESSION['form']['city']."\">\n";
+            $o.="<input type=\"hidden\" name=\"postcode\" value=\"".$_SESSION['form']['postcode']."\">\n";
+            $o.="<input type=\"hidden\" name=\"phone\" value=\"".$_SESSION['form']['phone']."\">\n";
+            $o.="<input type=\"hidden\" name=\"country\" value=\"".$config->country_select[$_SESSION['form']['country']]."\">\n";
+            //$o.="<input type=\"hidden\" name=\"code\" value=\"Jaki kod\">\n";
+            $o.="<input type=\"hidden\" name=\"p_info\" value=\"".$config->merchant['name']."\">\n";
+            $o.="<input type=\"hidden\" name=\"p_email\" value=\"".$config->order_email."\">\n";
+            $o.="<input type=\"hidden\" name=\"pr_set\" value=\"".$allpay_config->allpay_pr_set."\">\n";
+            $o.="<input type=\"submit\" value=\"$lang->register_allpay_order\">\n";
+            $o.="</form>\n";
+        print $o;
+    } // end func form
+} // end class
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/htdocs/plugins/_pay/_allpay/include/online.inc.php soteesklep3/htdocs/plugins/_pay/_allpay/include/online.inc.php
--- ../soteesklep3/htdocs/plugins/_pay/_allpay/include/online.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/plugins/_pay/_allpay/include/online.inc.php	2006-07-11 14:15:02.000000000 +0200
@@ -0,0 +1,114 @@
+<?php
+/**
+ * Klasa do potwierdzen platnosci w tle z serwisu allpay
+ *
+ */
+
+
+define ("ALLPAY_SERVER","217.17.41.5");
+
+class AllpayOnline {
+
+	/**
+	 * Konstruktor klasy
+	 *
+	 * @return AllpayOnline
+	 */
+	function AllpayOnline() {
+		if($this->checkParam()) {
+			if($this->prepareData()) {
+
+			}
+		}
+
+	} // end func AllpayOnline
+
+	/**
+	 * Zapisz parametry do bazy danych
+	 *
+	 */
+	function checkParam()
+	{
+		global $_REQUEST;
+		global $database;
+		foreach($_REQUEST as $key=>$value) {
+			$_REQUEST[$key]= addslashes($_REQUEST[$key]);
+		}
+		$database->sql_insert("allpay_trans",$_REQUEST);
+		return true;
+	} // end func checkParam
+
+	/**
+     * Sprawdz trenaskacje
+     *
+     */
+	function prepareData()
+	{
+		global $database;
+		global $allpay_config;
+
+		$data=$database->sql_select_multi_array4("*","order_register","order_id=".$_REQUEST['description']);
+
+		$amount=$data[0]['amount']+$data[0]['delivery_cost'];
+		if(!preg_match("/\./")) {
+			$amount=$amount.".00";
+		}
+		//$md5=md5(":10045:b03337e6e90a9dc291d528d113cdf3c3:10045-P12:70:fsd@fsdfsd.pl:::::1");
+		$md5=md5(
+					@$allpay_config->allpay_pin.":".
+					$allpay_config->allpay_id.":".
+					$_REQUEST['control'].":".
+					$_REQUEST['t_id'].":".
+					$amount.":".
+					$_REQUEST['email'].":".
+					@$_REQUEST['service'].":".
+					@$_REQUEST['code'].":".
+					@$_REQUEST['username'].":".
+					@$_REQUEST['password'].":".
+					$_REQUEST['t_status']
+		);
+
+		$database->sql_insert("allpay_trans",array(
+													"control"=>@$_REQUEST['control'],
+													"t_id"=>@$_REQUEST['t_id'],
+													"order_id"=>@$_REQUEST['description'],
+													"amount"=>$amount,
+													"email"=>@$_REQUEST['email'],
+													"service"=>@$_REQUEST['service'],
+													"code"=>@$_REQUEST['code'],
+													"username"=>@$_REQUEST['username'],
+													"password"=>@$_REQUEST['password'],
+													"t_status"=>$_REQUEST['t_status'],
+													"md5"=>$md5,
+													"md5_req"=>$_REQUEST['md5'],
+													"orginal_amount"=>$_REQUEST['amount'],
+													"remote_addres"=>$_SERVER["REMOTE_ADDR"]
+													)
+		);
+
+		// transakcja nowa lub odmowna
+		if($md5 == $_REQUEST['md5'] && ($_REQUEST['t_status'] == 1 || $_REQUEST['t_status'] == 3) && $_SERVER["REMOTE_ADDR"] == ALLPAY_SERVER) {
+				print "OK";
+		}
+		// potwierdzenie trasakcji
+		if($md5 == $_REQUEST['md5'] && $_REQUEST['t_status'] == 2 && $_SERVER["REMOTE_ADDR"] == ALLPAY_SERVER) {
+			// jesli skroty sa dobre tzn ze transakcja jest prawidlowa
+			require_once ("include/order_register.inc");
+			$my_checksum=OrderRegisterChecksum::checksum($_REQUEST['description'],1,$data[0]['amount']);
+			$database->sql_update("order_register","order_id=".$_REQUEST['description'],array(
+								"confirm_online"=>"1",
+								"confirm"=>"1",
+								"pay_status"=>"001",
+								"checksum_online"=>$my_checksum,
+			)
+			);
+			$result_online=$database->sql_select("confirm_online","order_register","order_id=".$_REQUEST['description']);
+			if($result_online == 1) {
+				print "OK";
+			} else {
+				print "ERROR";
+			}
+		} 
+	} // end func prepareData
+} // end class AllpayOnline
+?>
diff -ruN ../soteesklep3/htdocs/plugins/_pay/_allpay/index.php soteesklep3/htdocs/plugins/_pay/_allpay/index.php
--- ../soteesklep3/htdocs/plugins/_pay/_allpay/index.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/plugins/_pay/_allpay/index.php	2006-07-11 14:15:02.000000000 +0200
@@ -0,0 +1,53 @@
+<?php
+/**
+ * Przejscie na strone platnoscipl
+*/
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+include_once ("include/head.inc");
+
+include_once ("config/auto_config/allpay_config.inc.php");
+// klasa funckji zwiazanych z platnoscipl - inicjacja obiektu $planosciPL
+require_once("plugins/_pay/_allpay/include/allpay.inc.php");
+if (! empty($_SESSION['global_basket_data'])) {
+	global $shop;
+	$shop->basket();
+    $basket=& $shop->basket;
+    $my_basket=&$basket;
+    $my_basket->display="text";
+}
+
+// naglowek
+$theme->head();
+$theme->page_open_head("page_open_1_head");
+
+// sprawdz, czy zostal juz zainicjowany koszyk; jesli nie to nie zezwalaj na
+// wprowadzenie danych
+if (empty($_SESSION['my_basket']) && (! is_object($my_basket))) {
+    exit;
+}
+
+// odczytaj order_id
+if (! empty($_SESSION['global_order_id'])) $order_id=$_SESSION['global_order_id'];
+if ((empty($order_id)) && (! empty($global_order_id))) $order_id=$global_order_id;
+
+global $shop;
+$my_price = new MyPrice;
+$shop->basket();
+$amount1=$shop->basket->amount();
+$amount=$my_price->promotionsAmount($_SESSION['global_order_amount']);
+
+global $allpay;
+$allpay=new allpay($amount);
+
+$theme->theme_file("_allpay/allpay_before.html.php");
+$allpay->form();
+
+$theme->page_open_foot("page_open_1_foot");
+
+// stopka
+$theme->foot();
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/htdocs/plugins/_pay/_platnoscipl/error.php soteesklep3/htdocs/plugins/_pay/_platnoscipl/error.php
--- ../soteesklep3/htdocs/plugins/_pay/_platnoscipl/error.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/plugins/_pay/_platnoscipl/error.php	2006-07-11 14:15:01.000000000 +0200
@@ -0,0 +1,26 @@
+<?php
+/**
+* Powrót po rezygnacji z p³atno¶ci przelewy24.pl
+*
+* @author m@sote.pl
+* @version $Id: error.php,v 1.2 2006/05/30 10:18:51 lukasz Exp $
+* @package przelewy24
+*/
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+require_once ("../../../../include/head.inc");
+
+// naglowek
+$theme->head();
+$theme->page_open_head("page_open_1_head");
+
+$theme->theme_file("_platnosciPL/platnosciPL_false.html.php");
+
+$theme->page_open_foot("page_open_1_foot");
+
+// stopka
+$theme->foot();
+include_once ("include/foot.inc");
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/htdocs/plugins/_pay/_platnoscipl/sess_confirm_false.php soteesklep3/htdocs/plugins/_pay/_platnoscipl/sess_confirm_false.php
--- ../soteesklep3/htdocs/plugins/_pay/_platnoscipl/sess_confirm_false.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/plugins/_pay/_platnoscipl/sess_confirm_false.php	2006-07-11 14:15:01.000000000 +0200
@@ -0,0 +1,19 @@
+<?php
+/**
+ * Brak potwierdzenia autoryzacji z eCardu
+ */
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+require_once ("../../../../include/head.inc");
+$theme->head();
+$theme->page_open_head("page_open_1_head");
+$theme->bar($lang->bar_title['platnoscipl']);
+$theme->theme_file("_platnosciPL/platnosciPL_false.html.php");
+$theme->page_open_foot("page_open_1_foot");
+
+// stopka
+$theme->foot();
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/htdocs/plugins/_pay/_platnoscipl/sess_confirm.php soteesklep3/htdocs/plugins/_pay/_platnoscipl/sess_confirm.php
--- ../soteesklep3/htdocs/plugins/_pay/_platnoscipl/sess_confirm.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/plugins/_pay/_platnoscipl/sess_confirm.php	2006-07-11 14:15:01.000000000 +0200
@@ -0,0 +1,66 @@
+<?php
+// +----------------------------------------------------------------------+
+// | SOTEeSKLEP version 2                                                 |
+// +----------------------------------------------------------------------+
+// | Copyright (c) 1999-2002 SOTE www.sote.pl                             |
+// +----------------------------------------------------------------------+
+// | Wyslanie zamowienia platnosc eCard. Wyslanie zamowienia              |
+// | na konto e-mail + potwierdzenie dla klienta                          |
+// +----------------------------------------------------------------------+
+// | authors: Marek Jakubowicz <m@sote.pl>                                |
+// +----------------------------------------------------------------------+
+//
+// $Id: sess_confirm.php,v 1.5 2006/06/29 14:24:19 lukasz Exp $
+
+/**
+ * @session string $global_lock_send zapamietanie informacji, ze zamowienie zostalo juz wyslane
+ */
+
+// Jesli w sesji zapisany jest obiekt, to klasa tego obiektu, 
+// musi byc zaladowana przed otworzeniem sesji!
+
+$global_database=true;
+$global_secure_test=true;
+$DOCUMENT_ROOT=$HTTP_SERVER_VARS['DOCUMENT_ROOT'];
+require_once ("../../../../include/head.inc");
+//require_once ("$DOCUMENT_ROOT/../include/metabase.inc");
+
+global $mdbd;
+$p24_session=$_GET['sess_id'];
+$order_id=$mdbd->select('order_id','order_register',"session_id='$p24_session'",'','LIMIT 1');
+if (!empty($order_id)) {
+	$session=$mdbd->select('data','order_session',"order_id='$order_id'");
+	if (!empty($session)) {
+		$_SESSION=unserialize($session);
+		// zapalamy flage
+		$session_restored=true;
+	}
+}
+// wyslij mailem zamowienie
+include_once("$DOCUMENT_ROOT/go/_register/include/send_order.inc.php");
+
+// naglowek
+$theme->head();
+$theme->page_open_head("page_open_1_head");
+
+if ($confirm==true) {
+    // zapamietaj, ze zostalo wywolane wyslanie zamowienia, pozwoli to na zabronienie
+    // ponownego wyslanie tego samego zamowienia
+#    $global_lock_send=true;
+#    $global_lock_basket=false;
+#    $global_lock_register=false;
+#    $sess->register("global_lock_send",$global_lock_send);
+#    $sess->register("global_lock_basket",$global_lock_basket);
+#    $sess->register("global_lock_register",$global_lock_register);
+     // wyswietl informacje o wyslaniu zamowienia
+    $theme->send_confirm();
+} else {
+    $theme->send_error();
+}
+
+$theme->page_open_foot("page_open_1_foot");
+
+// stopka
+$theme->foot();
+include_once ("include/foot.inc");
+?>
diff -ruN ../soteesklep3/htdocs/plugins/_pay/_przelewy24/html/przelewy24_before.html.php soteesklep3/htdocs/plugins/_pay/_przelewy24/html/przelewy24_before.html.php
--- ../soteesklep3/htdocs/plugins/_pay/_przelewy24/html/przelewy24_before.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/plugins/_pay/_przelewy24/html/przelewy24_before.html.php	2006-07-11 14:15:02.000000000 +0200
@@ -0,0 +1,63 @@
+<center>
+<table width=70%>
+<tr>
+  <td width="50%"  valign="top">
+    <img src=/themes/base/base_theme/_img/przelewy24.jpg><br />
+  </td>
+  <td width="50%" valign="top">
+    <p />
+    <?php print $lang->przelewy24_info;?><br />
+  </td>
+</tr>
+</table>
+</center>
+
+<form action="https://secure.przelewy24.pl/index.php" method="post">
+<input type=hidden name="p24_session_id" value="<?php print $_SESSION['order_session'];?>">
+<input type=hidden name="p24_id_sprzedawcy" value="<?php print $przelewy24_config->posid;?>">
+<input type=hidden name="p24_kwota" value="<?php print $__amount;?>">
+<!--<input type=hidden name="p24_opis" value="TEST_OK">-->
+<input type=hidden name="p24_opis" value="<?php 
+if ($przelewy24_config->status=='1') {
+		print $basket->orderDescription();
+}	else print "TEST_OK";
+	?>">
+<input type=hidden name="p24_return_url_ok" value="http://<?php print $_SERVER['HTTP_HOST']."/plugins/_pay/_przelewy24/confirm_check.php?sess_id=".$_SESSION['order_session'];?>">
+<input type=hidden name="p24_return_url_error" value="http://<?php print $_SERVER['HTTP_HOST']."/plugins/_pay/_przelewy24/error.php?sess_id=".$_SESSION['order_session'];?>">
+
+<?php
+/*
+2004-10-19 rozszerzenie opcji zwi±zanych z pe³niejsz± weryfikacj± PolCard
+Dodatkowe parametry:
+
+p24_klient - imiê i nazwisko odbiorcy zamówienia. 
+p24_adres - ulica i numer odbiorcy. 
+p24_kod - kod pocztowy odbiorcy. 
+p24_miasto - miejscowo¶æ odbiorcy. 
+p24_kraj - kraj odbiorcy (kod kraju np:PL,DE,itp lub nazwa). 
+p24_email - e-mail kupuj±cego.
+*/
+?>
+
+<input type=hidden name=p24_klient value='<?php print Przelewy24::getInfo('p24_klient');?>'>
+<input type=hidden name=p24_adres value='<?php print Przelewy24::getInfo('p24_adres');?>'>
+<input type=hidden name=p24_miasto value='<?php print Przelewy24::getInfo('p24_miasto');?>'>
+<input type=hidden name=p24_kraj value='<?php print Przelewy24::getInfo('p24_kraj');?>'>
+<input type=hidden name=p24_email value='<?php print Przelewy24::getInfo('p24_email');?>'>
+
+<?php
+/**
+2004-03-16 dodatkowe pola zwi±zane z pe³na implementacj± obs³ugi przelewy24
+*/
+?>
+<input type=hidden name=p24_kod value='<?php print Przelewy24::getInfo('p24_kod');?>'>
+<input type=hidden name=p24_language value='<?php print Przelewy24::getInfo('p24_language');?>'>
+
+<?php 
+if ($przelewy24_config->active==1) {
+?>
+<input type=submit name="submit_end" value="<?php print $lang->przelewy24_next;?>">
+<?php 
+}
+?>
+</form>
\ No newline at end of file
diff -ruN ../soteesklep3/htdocs/plugins/_pay/_przelewy24/include/przelewy24.inc.php soteesklep3/htdocs/plugins/_pay/_przelewy24/include/przelewy24.inc.php
--- ../soteesklep3/htdocs/plugins/_pay/_przelewy24/include/przelewy24.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/plugins/_pay/_przelewy24/include/przelewy24.inc.php	2006-07-11 14:15:02.000000000 +0200
@@ -0,0 +1,219 @@
+<?php
+/**
+* Obs³uga p³atno¶ci przelewy24.pl
+*
+* @author  m@sote.pl
+* @version $Id: przelewy24.inc.php,v 1.15 2006/05/31 11:37:55 lukasz Exp $
+* @package przelewy24
+*/
+
+/**
+* Konfiguracja systemu przelewy24, definicje u¿ytkownika.
+*/
+@include_once ("config/auto_config/przelewy24_config.inc.php");
+
+/**
+* @package przelewy24
+*/
+class Przelewy24 {
+
+    /**
+    * @var int numer transakcji z tabeli order_register, warto¶æ order_id    
+    */
+    var $order_id=0;
+    
+    /**
+    * @var string p24_session_id numer sesji przekazany z p24 (powinien odpowiadaæ numerowi sesji ze sklepu)
+    */
+    var $session_id='';
+    
+    /**
+    * Konstruktor
+    */
+    function Przelewy24() {}
+    
+    // {{{ confirm()
+
+    /**
+    * Funkcja weryfikuj±ca odp. autoryzacyjn± oraz zapisuj±ca informacjê o autoryzacji w order_register.
+    * FUnkcja jest wywo³ywana w przypadku odebrania komunikatu TRUE z systemu przelewy24.pl.
+    *
+    * @param string $p24_order_id   ID transakcji nadane w systemie przelewy24, parametr odebrany z POST
+    * @param string $p24_session_id numer sesji, parametr odebrany z POST
+    * @param string $p24_kwota      kwota zamówienia w groszach, parametr odebrany  z POST
+    * @return bool true - transakcja potwierdzona, dane siê zgadzaj±; false - w p.w.
+    */
+    function confirm($p24_order_id,$p24_session_id,$p24_kwota) {
+        global $_SESSION;
+        global $mdbd;
+		global $db;
+        // sprawd¼ czy wcze¶niej tranakcja by³a poprawnie zatwierdzona
+        $dat=$mdbd->select("response_auth,confirm_auth","przelewy24_auth","p24_order_id=? AND p24_session_id=?",
+        array(
+        $p24_order_id=>"text",
+        $p24_session_id=>"text"
+        ),"ORDER BY id DESC LIMIT 1");
+        if (($dat['response_auth']==1) && ($dat['confirm_auth']==1)) {
+            return true;
+        }
+		// zawsze ladujemy z bazy zeby otrzymac wynik uwzgledniajacy koszta dostawy
+//        if (empty($_SESSION['p24_kwota'])) {
+            $this->_getSessionInfoFromDB($p24_session_id);
+//        }
+
+        // zapamiêtaj dane, które po¼niej zostan± wykorzystane do aktualizacji
+        // pay_status w order_register
+        $this->order_id=$_SESSION['global_order_id'];        
+        $this->session_id=$p24_session_id;
+        // end
+        if (empty($_SESSION['p24_kwota'])) {
+            return false;
+        }
+        if (number_format($p24_kwota,2,'.','')!=number_format($_SESSION['p24_kwota'],2,'.',''))  {
+            return false;
+        }
+        
+        if (! empty($_SESSION['global_order_id'])) {
+            $order_id=$_SESSION['global_order_id'];
+        } else {            
+            return false;
+        }
+        require_once("include/order_register.inc");
+        $orgc =& new OrderRegisterChecksum();
+
+        // format ceny wymagany do generowania sumy kontrolnej
+        $amount=number_format((($p24_kwota)/100),2,'.','');
+
+        // generuj sumê kontroln±
+        $checksum_online=$orgc->checksum($order_id,1,$amount);
+
+        $mdbd->update("order_register","confirm_online=?,confirm=?,checksum_online=?","order_id=?",
+        array(
+        "1,"."1"=>"int",
+        "2,"."1"=>"int",
+        "3,".$checksum_online=>"text",
+        "4,".$order_id=>"int",
+        ));
+
+        return true;
+    } // end confirm()
+
+    // }}}
+
+    // {{{  getSessionInfoFromDB()
+
+    /**
+    * Odczytaj dane dot. transakcji z bazy i udostêpnij je w tablicy sesji
+    *
+    * @param string $session_id numer sesji
+    * @access private
+    * @return none
+    */
+    function _getSessionInfoFromDB($session_id) {
+        global $mdbd;
+        global $_SESSION;
+
+        $order=$mdbd->select("order_id,total_amount,delivery_cost","order_register","session_id=?",array($session_id=>"text"),"ORDER BY id DESC LIMIT 1");
+        $_SESSION['p24_kwota']=($order['total_amount']+$order['delivery_cost'])*100;
+        $_SESSION['global_order_id']=$order['order_id'];   
+        
+        return;
+    } // end _getSessionInfoFromDB()
+
+    // }}}
+
+    /**
+    * Zapisz dane z przelewy24 w bazie danych.
+    * Dane s± zapisywane do celów debugowania.
+    *
+    * @param string $p24_order_id   order id transakcji, numer nadawany przez system przelewy24 np. p24-102-498
+    * @param string $p24_session_id numer sesji, warto¶æ parametru przekazywany z systemu przelewy24
+    * @param int    $p24_kwota      warto¶æ transakcji w groszach np. dla 20 z³ 34 gr bêdzie to 2034
+    * @param int    $response_auth  status odebrania odpowiedzi autoryzacyjnej z przelewy24
+    * @param int    $confirm_auth   status weryfikacji parametrów przekazanych przy autoryzacji m.in. kwoty
+    * @return void
+    */
+    function saveData($p24_order_id,$p24_session_id,$p24_kwota,$response_auth,$confirm_auth) {
+        global $db;
+
+        $query="INSERT INTO przelewy24_auth (p24_session_id,p24_order_id,p24_kwota,response_auth,confirm_auth)
+                VALUES (?,?,?,?,?)";
+        $prepared_query=$db->prepareQuery($query);
+        if ($prepared_query) {
+            $db->querySetText($prepared_query,1,$p24_session_id);
+            $db->querySetText($prepared_query,2,$p24_order_id);
+            $db->querySetText($prepared_query,3,$p24_kwota);
+            $db->querySetText($prepared_query,4,$response_auth);
+            $db->querySetText($prepared_query,5,$confirm_auth);
+            $result=$db->executeQuery($prepared_query);
+            if ($result!=0) {
+                // rekord zostal dodany
+                // print "INSERT OK <br>$query<br>";
+            }
+        }
+
+        return;
+    } // end saveData()
+
+    // {{{ getInfo()
+
+    /**
+    * Odczytaj dodatkowe dane z zamówienia przekazywane do centrum autoryzacji
+    *
+    * @param string $type
+    * @return string opis pola wg danych z formularza
+    */
+    function getInfo($type) {
+        global $_SESSION,$config;
+
+        $form=array();$form_cor=array();
+        if (! empty($_SESSION['form'])) $form=$_SESSION['form'];
+        if (! empty($_SESSION['form_cor'])) $form_cor=$_SESSION['form_cor'];
+        
+        if (! empty($form_cor)) $form2=$form_cor;
+        else $form2=$form;
+        
+        switch ($type) {
+            case "p24_klient":
+            $val=$form2['name']." ".$form2['surname'];
+            break;
+            case "p24_adres":
+            $val=$form2['street']." ".$form2['street_n1'];
+            if (! empty($form2['street_n2'])) $val.="/".$form2['street_n2'];
+            break;
+            case "p24_miasto":
+            $val=$form2['city'];
+            break;
+            case "p24_kod":
+            $val=$form2['postcode'];
+            break;
+            case "p24_language":
+            switch ($config->lang) {
+                case "pl": $val="pl";
+                break;
+                default: $val="en";
+                break;
+            }
+            break;
+            case "p24_kraj":
+            // dla wersji 3.0
+            if ($config->version=="3.x") {
+                $val="PL";
+            } else {
+                // dla wersji 3.1.x i nowszych
+                $val=$form2['country'];
+            }
+            break;
+            case "p24_email":
+            if (!empty($form2['email'])) $val=$form2['email'];
+            else $val=$form['email'];
+            break;
+        }
+        return $val;
+    } // end getInfo()
+
+    // }}}
+
+
+} // end class Przelewy24
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/htdocs/themes/base/base_theme/info.html.php soteesklep3/htdocs/themes/base/base_theme/info.html.php
--- ../soteesklep3/htdocs/themes/base/base_theme/info.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/themes/base/base_theme/info.html.php	2006-07-11 14:15:11.000000000 +0200
@@ -0,0 +1,394 @@
+<?php
+/**
+* Szablon PHP wygl±du rekordu w pe³nej prezentacji produktu - info.
+*
+* @author  m@sote.pl
+* @version $Id: info.html.php,v 2.62 2006/06/29 14:28:38 lukasz Exp $
+* @package    themes
+* @subpackage base_theme
+*/
+
+// XHTML Id: info.html.php,v 2.12 2003/10/15 12:20:10 maroslaw Exp
+
+global $config, $prefix,$wp_config;
+global $description;
+global $available;
+global $DOCUMENT_ROOT;
+global $shop;
+global $theme;
+
+// odczytaj plugins
+// @todo dolaczanie dodatkowych klas wylaczyc z pliku html i przeniesc do pliku php
+if (in_array("in_category",$config->plugins)) {
+    include_once ("plugins/_info/_in_category/include/in_category.inc.php");
+}
+if (in_array("accessories",$config->plugins)) {
+    include_once ("plugins/_info/_accessories/include/accessories.inc.php");
+}
+if (in_array("pasaz.wp.pl",$config->plugins)) {
+	include_once ("config/auto_config/wp_config.inc.php");
+}
+
+include_once ("plugins/_info/_ranking/include/ranking.inc.php");
+
+?> 
+<center>
+  <?php
+  $this->bar($rec->data['name']);
+  ?>
+  <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
+    <tr> 
+      <td width="1" background="<?php $this->img($prefix . $config->theme_config['box']['img']['middle']['left']);?>"><img src="<?php $this->img($prefix . $config->theme_config['box']['img']['middle']['left']);?>"></td>
+      <td width="100%" valign="top" align="center">
+  		<table width="100%" border="0" cellspacing="0" cellpadding="0">          
+          <tr> 
+            
+            <td align="center" bgcolor="<?php print $config->colors['light'];?>" style="padding: 2px;"><?php print $lang->cols['name'];?></td>
+
+            <?php global $wp_config; 
+            // rejestracja w statystykach wp
+            if(!empty($wp_config->wp_shop_id) && $_SESSION['global_partner_id'] == 47474747) { ?>
+            
+            <img src="http://zakupy.wp.pl/stat_view.html?sid=<?php print $wp_config->wp_shop_id; ?>" width="1" height="1" border="0">
+            <?php } ?>
+            
+            <?php 
+            // wy¶wietlaj cenne brutto tylko wtedy gdy hidden price=0
+            if (($rec->data['hidden_price']==0) && ($rec->data['ask4price']==0)) {
+            ?>	
+            <td align="center" bgcolor="<?php print $config->colors['light'];?>" style="padding: 2px;">
+            <?php 
+            //if ($this->checkView("price",$rec)) print $lang->cols['price_brutto'];
+            if ($this->checkView("points",$rec)) print $this->info_points(); else 
+            if ($this->checkView("price",$rec)) print $this->info_price();
+            
+            ?>
+            </td>
+            <?php 
+            }
+            ?>
+            
+            <?php
+            //stara cena
+            //wyswietlaj tylko wted kiedy stara cena jest wprowadzona i nie ma rabatu
+            if (($rec->data['price_brutto_detal']>0) && ($rec->data['base_discount']==0)){
+             ?>	
+            <td align="center" bgcolor="<?php print $config->colors['light'];?>" style="padding: 2px;">
+            	<?php 
+            	if ($this->checkView("price",$rec) && (!$this->checkView("points",$rec))) print $this->info_price();
+            	?>
+            </td>
+            <?php 
+            }
+             ?>
+            
+            <?php 
+            // rabat;
+            // wyswietalj tylko wtedy kiedy rabat jest wprowadzony
+            if ((!$this->checkView("points",$rec)) && (! empty($rec->data['base_discount']))  && ($rec->data['base_discount']>0) && ($rec->data['base_discount']<99)) {
+            ?>
+            <td align="center" bgcolor="<?php print $config->colors['light'];?>" style="padding: 2px;">
+            	<?php 
+            	if ($this->checkView("discount",$rec)) print @$lang->cols['discount'];
+            	?>
+            </td>
+            <?php
+            }
+            ?>
+            
+          </tr>
+          <tr> 
+            <td width="100%" align="center" colspan="100%" bgcolor="#536083"><img src="<?php $this->img("_img/mask.gif");?>" width="1" height="1"></td>
+          </tr>
+          <tr> 
+           
+            <td align="center"> 
+              <?php print $rec->data['name'];?>
+            </td>
+            
+            <?php             
+            //wy¶wietlaj cene brutto tylko wtedy gdy hidden price=0
+            if (($rec->data['hidden_price']==0) && ($rec->data['ask4price']==0)) {
+            ?>
+            <td align="center"> <B><CENTER>
+              <?php
+              // start cena:
+              // sprawdz, czy w opcjach sa atrybuty zmiany cen
+              if ($this->checkView("points",$rec)) {
+				print $rec->data['points_value'];
+              } else if ($this->checkView("price",$rec)) {
+                  //$price=$rec->data['price_brutto']." ".$shop->currency->currency;
+                  print $price=$this->print_price($rec)." ".$shop->currency->currency;
+              }
+              // end cena:
+             ?>
+              </B> </CENTER></td>
+            <?php 
+            }
+            ?>
+             <?php
+             //stara cena
+             //wyswietlaj tylko wted kiedy stara cena jest wprowadzona i nie ma rabatu
+             if ((!$this->checkView("points",$rec)) && ($rec->data['price_brutto_detal']>0)&& ($rec->data['base_discount']==0)){
+             ?>	
+            <td align="center">
+            <?php 
+            if ($this->checkView("price",$rec)) print"<font color=red><strike>".$rec->data['price_brutto_detal']."</strike>&nbsp;</font>".$shop->currency->currency."\n";
+            ?>
+            </td>
+              <?php
+             }
+             ?>
+            
+            
+            <?php
+            // rabat;
+            // wyswietalj tylko wtedy kiedy rabat jest wprowadzony
+            if ((!$this->checkView("points",$rec)) && (! empty($rec->data['base_discount']))  && ($rec->data['base_discount']>0) && ($rec->data['base_discount']<99)) {
+            ?>
+            <td align="center">
+            	<?php 
+            	if ($this->checkView("discount",$rec)) print $rec->data['base_discount']."%\n";
+            	?>
+            </td> 
+            <?php
+            }
+            ?>
+            
+            </tr>
+          <tr> 
+            <td width="100%" align="center" colspan="100%" bgcolor="#536083"><img src="<?php $this->img("_img/mask.gif");?>" width="1" height="1"></td>
+          </tr>
+        </table>
+        <br>
+        <table width="100%" border="0" cellspacing="0" cellpadding="0">
+          <tr> 
+            <td width="318" style="padding: 8px;" valign="top" align="left"> 
+              <!-- Opis produktu -->
+              <?php
+              //wyswietlenie producenta jesli istnieje
+              if (!empty($rec->data['producer'])){
+                  print $lang->cols['producer'].":&nbsp;".LangF::translate($rec->data['producer'])."<BR><BR>";
+              }
+              if ($config->show_user_id==1){
+                  print "<b>".$lang->basket_products_extra['user_id'].":</b> ".$rec->data['user_id']."<br><br>";
+                  }
+              ?>
+              <?php               
+              // sprawdz czy istnieje plik HTML np. A001.html.php
+              // @todo przeniesc do funkcji w temacie
+              $file=$rec->data['user_id'];
+              $file=ereg_replace(" ","_",$file);
+              $file.=".html.php";
+              $file_path="$DOCUMENT_ROOT/products/$file";
+              if (file_exists($file_path)) {
+                  $check_info=1;
+              } else $check_info=0;
+              // przekaz zmienna globalna do pliku menu.inc.php
+              $__check_info=$check_info;
+              print $rec->data['xml_description']; //description pelen opis
+              // end
+              ?>			
+              <?php 
+              // start dodatkowy link
+               if ((! empty($rec->data['link_url'])) && ($rec->data['link_name'])) {
+               print "<BR><BR>";
+               print $lang->see_link.":<BR>";
+               print "<a target=\"_blank\" href=\"http://".$rec->data['link_url']."\">".$rec->data['link_name']."</a>";
+               } 
+              // end dodatkowy link
+              ?>											
+            </td>
+            <td width="250" align="center" valign="top" style="padding: 8px 0px;"> 
+              
+              <!-- start zdjecie produktu: -->
+              <?php $image->show($rec->data['photo'],"no");?>
+              <br>
+              <?php $image->_show_max_Photo($rec->data['photo'],$lang->desc_max_photo);?>
+              <!-- end zdjecie produktu:-->
+              
+              <!-- start Flash: -->              
+              <?php print "\n\n".$rec->data['flash_html']."\n\n";?>
+              <!-- end Flash: -->
+              
+              <!-- start PDF: -->
+              <?php
+              // @todo przeniesc wywolanie pdf do funkcji w temacie
+              if ((! empty($rec->data['pdf'])) && file_exists("$DOCUMENT_ROOT/photo/_pdf/".$rec->data['pdf'])) {
+                  print "<br>";
+                  print "$lang->info_pdf <a href=".$config->url_prefix."/photo/_pdf/".$rec->data['pdf'].">"."<img src=";
+                  $this->img("_img/_icons/pdf.gif");
+                  print " border=0 align=center></a>";
+                  print "</br>";
+              }
+              ?>
+              <!-- end PDF: -->
+              <!-- start DOC: -->
+                 <?php
+              // @todo przeniesc wywolanie pdf do funkcji w temacie
+              if ((! empty($rec->data['doc'])) && file_exists("$DOCUMENT_ROOT/photo/_doc/".$rec->data['doc'])) {
+                  print "<br>";
+                  print "$lang->info_doc <a href=".$config->url_prefix."/photo/_doc/".$rec->data['doc'].">"."<img src=";
+                  $this->img("_img/_icons/doc.gif");
+                  print " border=0 align=center></a>";
+                  print "</br>";
+              }
+              ?>
+              <!-- end DOC: -->
+              <table width="250" border="0" cellspacing="0" cellpadding="0">
+                <tr> 
+                  <td width="250" align="center" colspan="4">
+                   <?php 
+                  if ($rec->data['id_available']!=0){
+                  print $lang->available."<b><nobr> ".$available->get($rec->data['id_available'],$rec,"string")."</b></nobr>";
+                  }
+                  ?>                
+                  </td>
+                </tr>
+              </table>
+            </td>
+          </tr>
+        </table>
+        <table width="100%" border="0" cellspacing="0" cellpadding="0">
+          <tr> 
+            <td align="center">
+												<!-- Koszyk -->
+              <table width="100%" border="0" cellspacing="0" cellpadding="0">
+                <tr> 
+                  <td align="center">
+			         
+                    <table border="0" cellspacing="0" cellpadding="0" align="center">
+					<tr valign="baseline">
+					  <td align="left">
+					  <?php
+					  // wy¶wietl koszyk + opcje, je¶li s± dostêpne
+					  $this->recBasket($rec->data['id'],$rec);
+				      ?>
+                      </td>
+					  <td align="left" style="padding-left: 10px">
+					  <?php
+					  // wy¶wietl koszyk + opcje, je¶li s± dostêpne
+					  $this->recWishlist($rec->data['id'],$rec);
+				      ?>
+                      </td>
+                      <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
+                      <td>
+                      <?php $this->print_page('/go/_info/print.php?id=' . $rec->data['id']);?>
+                      </td>
+                    </tr>
+                    </table>
+                  </td>
+                </tr>
+              </table>  
+
+              <br />   
+                <?php ?>
+              <?php
+              // @todo przeniesc do funckji w temacie, polec produkt itp.
+              if ($config->cd!=1) {
+                  
+                  // polec produkt
+                  
+                  $user_id=$rec->data['user_id'];
+                  $product=urlencode($rec->data['name']);
+                  $onclick=$this->onclick("360","230");
+                  $recommend_url="\"/plugins/_recommend/?id=$user_id&product=$product\" $onclick target=\"window\"";
+                  print "<a href=$recommend_url>$lang->info_recommend_product</a>";
+                  print "&nbsp;&#183;&nbsp;";
+                  // ocen produkt
+                  $onclick=$this->onclick("440","320");
+                  $id=$rec->data['id'];
+                  $score_link="\"/plugins/_reviews/add.php?id=$id&user_id=$user_id&product=$product\" $onclick target=\"window\"";
+                  print "<a href=$score_link>$lang->info_score</a>";
+                  print "&nbsp;"; // spacja pomiedzy info a wynikiem
+                  if(isset($rec->data['user_score'])){
+                      $this->user_score($rec->data['user_score'],"star.gif");
+                  }
+                  print "&nbsp;&nbsp;&nbsp;";
+              } // end plugin cd:
+              ?>
+              
+              <br /><br />
+              
+            </td>
+          </tr>
+        </table>        
+      </td>
+      <td width="1" background="<?php $this->img($prefix . $config->theme_config['box']['img']['middle']['right']);?>"><img src="<?php $this->img($prefix . $config->theme_config['box']['img']['middle']['right']);?>"></td>
+    </tr>
+  </table>
+  <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
+    <tr> 
+      <td width="1" background="<?php $this->img($prefix . $config->theme_config['box']['img']['bottom']['left']);?>"><img src="<?php $this->img($prefix . $config->theme_config['box']['img']['bottom']['left']);?>"></td>
+      <td width="100%" background="<?php $this->img($prefix . $config->theme_config['box']['img']['bottom']['center']);?>"><img src="<?php $this->img($prefix . $config->theme_config['box']['img']['bottom']['center']);?>"></td>
+      <td width="1" background="<?php $this->img($prefix . $config->theme_config['box']['img']['bottom']['right']);?>"><img src="<?php $this->img($prefix . $config->theme_config['box']['img']['bottom']['right']);?>"></td>
+    </tr>
+  </table>
+</center>
+<br />
+<?php 
+// start plugin cd:
+if (in_array("reviews",$config->plugins)) 
+{
+?>
+<center>
+<table width="570" border="0" cellspacing="0" cellpadding="0" align="center">
+  <tr> 
+    <td width="570" align="center">
+      <?php      
+	  if (($config->ranking1_enabled == 1) && ($ranking->check_product_in_ranking($rec))) {
+//	  if (1) {
+	      $this->win_top($lang->ranking_title,570,1,1);
+	      include ("./include/ranking.inc.php");
+	      $this->win_bottom(570);
+	      echo "<br>";
+	  }
+      // @todo cale ponizsze wywolanie przeniesc do funkcji (menu z linkami pod info)
+      /**
+      * pokaz buttony dla plugin'u jesli nie to pokaz link tekstowy
+      * Inne produkty, Recenzje, itp;
+      */
+      include ("./include/menu.inc.php");
+
+
+      
+      /* obsluga zakladek w zaleznosci od klikniecia
+      *  gdy $__item=1 - inne produkty z tej samej kategorii
+      *  $__item=2 - akcesoria do produktow
+      *  $__item=3 - pelny opis produktu (zalaczony plik html)
+      *  $__item=4 - recenzje do produktu
+      */
+      $secure_test=true;
+      @$__id=$_REQUEST['id'];
+      @$__item=$_REQUEST['item'];
+      switch ($__item){
+          case 1:
+          $bar_title=$lang->in_category;
+          break;
+          case 2:
+          $bar_title=$lang->accessories;
+          break;
+          case 3:
+          $bar_title=$lang->full_description;
+          break;
+          case 4:
+          $bar_title=$lang->write_up;
+          break;
+          default:
+          $bar_title=$lang->in_category;
+      }
+      $this->win_top($bar_title,570,1,1);
+      include ("./include/choose_item.inc.php");
+      $this->win_bottom(570);
+      // koniec obsluga zakladek
+      ?>
+    </td>
+  </tr>
+</table>
+
+</center>
+<?php
+}
+// end plugin cd:
+?>
+<!-- end dodatkowe menu na dole: -->
diff -ruN ../soteesklep3/htdocs/themes/base/base_theme/_newsedit/newsedit_row.html.php soteesklep3/htdocs/themes/base/base_theme/_newsedit/newsedit_row.html.php
--- ../soteesklep3/htdocs/themes/base/base_theme/_newsedit/newsedit_row.html.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/htdocs/themes/base/base_theme/_newsedit/newsedit_row.html.php	2006-07-11 14:15:17.000000000 +0200
@@ -0,0 +1,75 @@
+<?php
+/**
+* prezentacja produktow w wierszu
+* @version    $Id: newsedit_row.html.php,v 1.8 2006/06/05 10:02:25 lukasz Exp $
+* @package    newsedit
+*/
+global $__news_row, $theme;
+
+/* szeroko¶æ maksymlana wiersza z newsami */
+$max_rows_width=370;
+
+/**
+* liczba rekordow w wierszu
+* @var int
+*/
+
+$rec_per_row=$config->newsedit_columns_default;
+$width=intval($max_rows_width/$rec_per_row) -1;
+
+
+if (empty($__news_row)) $__news_row=1;
+else $__news_row++;
+
+if ($__news_row==1) {
+    print "  <tr>\n";
+    print "    <td valign=\"top\">";
+} else {   
+    /**
+    * separator rekordow w wierszu
+    * uzyty opcjonalnie
+    */
+    $this->recordSeparator();
+    print "    <td valign=\"top\" align=\"center\">";    
+}
+?>
+<table width="<?php print $width;?>" border="0" cellspacing="0" cellpadding="0" class="bg_yellow">
+  <tr> 
+    <td bgcolor="#ffffff" style="padding: 8px;" valign="top"> 
+      <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
+        <tr> 
+          <td valign="top" style="padding: 0px 0px 4px 0px;"><?php $this->newsPhoto(); ?></td>
+        </tr>
+        <tr> 
+          <td valign="top" style="padding: 0px 0px 4px 0px;"><?php $this->newsSubject(); ?><br><?php $this->newsAddDate();?></td>
+        </tr>
+        <tr>
+          <td height="60" valign="top" align="left"><?php $this->newsShortDescription(); ?></td>
+        </tr>
+        <tr> 
+          <td valign="bottom"> 
+            <div align="right" style="padding: 8px 24px;"><?php $this->newsInfoButton(); ?></div>
+          </td>
+        </tr>
+      </table>
+				</td>
+		</tr>
+</table>    
+
+<?php
+if ($__news_row==$rec_per_row) {
+    $__news_row=0;
+    
+    /**
+    * zakonczenie rekordu
+    */
+    print "    </td>\n";
+    print "  </tr>";    
+    /**
+    * ozdobne zakonczenie tabeli
+    * uzyty opcjonalnie
+    */
+    $this->recordEndDots($rec_per_row);
+    
+} else print "    </td>";
+?>
diff -ruN ../soteesklep3/include/ceneo/soap.inc.php soteesklep3/include/ceneo/soap.inc.php
--- ../soteesklep3/include/ceneo/soap.inc.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/include/ceneo/soap.inc.php	2006-07-11 14:15:37.000000000 +0200
@@ -0,0 +1,358 @@
+<?php
+/**
+ * Klasa obslugujaca protokó³ SOAP
+ *
+ *
+ * @author  rdiak@sote.pl
+ * @version $Id: soap.inc.php,v 1.3 2006/07/11 10:16:52 cvs Exp $
+* @package    include
+ */
+
+/**
+ * Includowanie potrzebnych klas 
+ */
+require_once("HTTP/http.php");
+
+/**
+ * Klasa SOAP
+ *
+ * @package ceneo
+ * @subpackage admin
+ */
+class SOAP {
+	
+	var $address='';
+	var $port='';
+	var $rpc='';
+	var $message='';
+	var $transaction='';
+	var $login='';
+	var $password='';
+	
+	
+	/**
+	* Konstruktor obiektu ceneoGetCat
+	*
+	* @return boolean true/false
+	*/
+	function SOAP() {
+		global $ceneo_config;
+		global $config;
+
+		if($ceneo_config->ceneo_load == 'product') {
+			$this->address=$ceneo_config->ceneo_server;
+		} else {
+			$this->address=$ceneo_config->ceneo_test_server;
+		}
+		$this->port=$ceneo_config->ceneo_port;
+		$this->rpc=@$ceneo_config->ceneo_rpc;
+		$this->message=$ceneo_config->ceneo_message;
+		$this->login=$ceneo_config->ceneo_login;
+		$this->password=$ceneo_config->ceneo_password;
+		$this->transaction=@$ceneo_config->ceneo_transaction;
+		return true;
+	} // end SOAP()
+	
+	/**
+	 * Funkcja konwersji metaznakow z xml
+	 *
+	 * @param  string $xml      string xml
+	 *
+	 * @return string           skonwetowany xml
+	 */
+	function & xml_to_chars(&$xml) {
+		$xml = eregi_replace('&lt;', '<', $xml);
+		$xml = eregi_replace('&gt;', '>', $xml);
+		$xml = eregi_replace('&amp;', '&', $xml);
+		$xml = eregi_replace('&quot;', '"', $xml);
+		$xml = eregi_replace('&apos;', '\'', $xml);
+		return $xml;
+	} // end xml_to_chars()
+	
+	/**
+	 * Funkcja konwersji metaznakow do xml
+	 *
+	 * @param  string $str      string xml
+	 *
+	 * @return string          skonwetowany xml
+	 */
+	function & chars_to_xml(&$xml) {
+		$xml = eregi_replace('<', '&lt;', $xml);
+		$xml = eregi_replace('>', '&gt;', $xml);
+		$xml = eregi_replace('&', '&amp;', $xml);
+		$xml = eregi_replace('"', '&quot;', $xml);
+		$xml = eregi_replace('\'', '&apos;', $xml);
+		return $xml;
+	} // end chars_to_xml()
+
+	/**
+	 * Funkcja konwertujaca string z standardu utf-8 na iso-8859-2
+	 *
+	 * @param  string $string  ciag znakow,
+	 *
+	 * @return string $string  ciag znakow po konwersji
+	 */
+	function & encoding_utf8_to_8859_2(&$string) {
+		$decode=array(
+		"\xC4\x84"=>"\xA1",
+		"\xC4\x85"=>"\xB1",
+		"\xC4\x86"=>"\xC6",
+		"\xC4\x87"=>"\xE6",
+		"\xC4\x98"=>"\xCA",
+		"\xC4\x99"=>"\xEA",
+		"\xC5\x81"=>"\xA3",
+		"\xC5\x82"=>"\xB3",
+		"\xC5\x83"=>"\xD1",
+		"\xC5\x84"=>"\xF1",
+		"\xC3\x93"=>"\xD3",
+		"\xC3\xB3"=>"\xF3",
+		"\xC5\x9A"=>"\xA6",
+		"\xC5\x9B"=>"\xB6",
+		"\xC5\xB9"=>"\xAC",
+		"\xC5\xBA"=>"\xBC",
+		"\xC5\xBB"=>"\xAF",
+		"\xC5\xBC"=>"\xBF"
+		);
+		
+		$string = strtr("$string",$decode);
+		return $string;
+	} // end func encoding_unicode_to_8859-2
+	
+	/**
+	 * Funkcja konwertujaca string z standardu iso-8859-2 na utf-8
+	 *
+	 * @param  string $string  ciag znakow,
+	 *
+	 * @return string $string  ciag znakow po konwersji
+	 */
+	function & encoding_iso8859_2_to_utf8(&$string) {
+		/*$decode=array(
+		"\xA1" => "\xC4\x84",
+		"\xB1" => "\xC4\x85",
+		"\xC6" => "\xC4\x86",
+		"\xE6" => "\xC4\x87",
+		"\xCA" => "\xC4\x98",
+		"\xEA" => "\xC4\x99",
+		"\xA3" => "\xC5\x81",
+		"\xB3" => "\xC5\x82",
+		"\xD1" => "\xC5\x83",
+		"\xF1" => "\xC5\x84",
+		"\xD3" => "\xC3\x93",
+		"\xF3" => "\xC3\xB3",
+		"\xA6" => "\xC5\x9A",
+		"\xB6" => "\xC5\x9B",
+		"\xAC" => "\xC5\xB9",
+		"\xBC" => "\xC5\xBA",
+		"\xAF" => "\xC5\xBB",
+		"\xBF" => "\xC5\xBC",
+		);
+		$string = strtr("$string",$decode);*/
+		return $string;
+	} // end func encoding_iso8859_2_to_utf8
+		
+	
+	/**
+	 * Glowna funkcja  pobierania  kategorii z ceneo_pasaz.
+	 *
+	 * @param  string $mesg      depesza SOAP ktora ma zostac wyslana do serwera
+	 *
+	 * @return boolean true/false
+	 */
+	function & send_soap_category($mesg) {
+		global $lang;
+		$category='';
+
+		print $this->address;
+		// inicjalizacja klasy ktora zostanie wykorzystana do komunikacji
+		$http = new http_class;
+		
+		// otwieramy polaczenie z serwerem SOAP
+		$error=$http->Open(array(
+			"HostName"=>$this->address,
+			"HostPort"=>$this->port,
+			)
+		);
+		// jesli polaczenie zostalo otwarte pomyslnie
+		if($error == "" ) {
+			$str=$this->address.$this->rpc;
+			$error1=$http->SendRequest(array(
+				"RequestMethod"=>"POST",
+				"RequestURI"=>$this->rpc,
+				"Headers"=>array(
+					"Host"=>$this->address,
+					"User-Agent"=>"Manuel Lemos HTTP class SOAP test script",
+					"Pragma"=>"no-cache",
+					"SoapAction"=>"http://rentserver73.internet1.de/ConvertTemperature",
+					"EndPointURL"=>"$str",
+					"Content-Type"=>"text/xml; charset=utf-8"
+					),
+				"Body"=>$mesg
+				)
+			);
+			
+			if($error1 == ""){
+				$headers=array();
+				$error2=$http->ReadReplyHeaders($headers);
+				if($error2 == "") {
+					$i=0;
+					for(;;)
+					{
+						$error3=$http->ReadReplyBody($body,1000);
+						if($error3!="" || strlen($body)==0){
+							break;
+						} else {
+							$category.=HtmlSpecialChars($body);
+						}
+						$i++;
+					}
+				} else {
+					print $lang->ceneo_soap['no_header']."<br>";
+					print $error2;
+				} //end error2
+			} else {
+				print $lang->ceneo_soap['bad_reply']."<br>";
+				print $error1;
+			} // end error1
+		} else {
+			print $lang->ceneo_soap['not_connect']."<br>";
+			print $error;
+		} //end error
+		$cat=&$category;
+		return $cat;
+	} // end send_soap_offer()
+	
+	/**
+	* Funkcja inlementuje komunikacje i ladowanie oferty do ceneo_pasaz.
+	*
+	* @param  string $mesg      depesza SOAP ktora ma zostac wyslana do serwera
+	*
+	* @return boolean true/false
+	*/
+	function & send_soap_offer(&$mesg) {
+		global $lang;
+		$category='';
+		
+		// inicjalizacja klasy ktora zostanie wykorzystana do komunikacji
+		$http = new http_class;
+		
+		$address=$this->login.":".$this->password."@".$this->address;
+		//print $address;
+		// otwieramy polaczenie z serwerem SOAP
+		$error=$http->Open(array(
+			"HostName"=>$this->address,
+			"HostPort"=>$this->port,
+			)
+		);
+		// jesli polaczenie zostalo otwarte pomyslnie
+		if($error == "" ) {
+			$str="http://".$address.$this->message;
+			$auth='Basic ' . base64_encode($this->login . ':' . $this->password);
+			$error1=$http->SendRequest(array(
+				"RequestMethod"=>"POST",
+				"RequestURI"=>$this->message,
+				"Headers"=>array(
+						"Host"=>$this->address.":".$this->port,
+						"User-Agent"=>"Manuel Lemos HTTP class SOAP test script",
+						"Pragma"=>"no-cache",
+						"SoapAction"=>"http://rentserver73.internet1.de/ExportCennik",
+						"EndPointURL"=>"$str",
+						"Content-Type"=>"text/xml; charset=utf-8",
+					),
+				"Body"=>$mesg
+				)
+			);
+			
+			if($error1 == ""){
+				$headers=array();
+				$error2=$http->ReadReplyHeaders($headers);
+				if($error2 == "") {
+					$i=0;
+					for(;;)
+					{
+						$error3=$http->ReadReplyBody($body,1000);
+						if($error3!="" || strlen($body)==0){
+							break;
+						} else {
+							$category.=HtmlSpecialChars($body);
+						}
+						$i++;
+					}
+				} else {
+					print $lang->ceneo_soap['no_header']."<br>";
+					print $error2;
+				} //end error2
+			} else {
+				print $lang->ceneo_soap['bad_reply']."<br>";
+				print $error1;
+			} // end error1
+		} else {
+			print $lang->ceneo_soap['not_connect']."<br>";
+			print $error;
+		} //end error
+		$cat=&$category;
+		return $cat;
+	} // end send_soap_offer()
+	
+	/**
+	 * Funkcja implementuje komunikacje i obsluge transakcji.
+	 *
+	 * @param  string $mesg      depesza SOAP ktora ma zostac wyslana do serwera
+	 *
+	 * @return boolean true/false
+	 */
+	function & send_transaction(&$mesg) {
+		global $lang;
+		
+		$category='';
+		
+		// inicjalizacja klasy ktora zostanie wykorzystana do komunikacji
+		$http = new http_class;
+		
+		// otwieramy polaczenie z serwerem SOAP
+		$error=$http->Open(array(
+			"HostName"=>$this->address,
+			"HostPort"=>$this->port,
+			)
+		);
+		// jesli polaczenie zostalo otwarte pomyslnie
+		if($error == "" ) {
+			$str="http://".$this->address.$this->transaction;
+			$error1=$http->SendRequest(array(
+				"RequestMethod"=>"POST",
+				"RequestURI"=>$this->transaction,
+				"PostValues"=>$mesg,
+				)
+			);
+			
+			if($error1 == ""){
+				$headers=array();
+				$error2=$http->ReadReplyHeaders($headers);
+				if($error2 == "") {
+					$i=0;
+					for(;;)
+					{
+						$error3=$http->ReadReplyBody($body,1000);
+						if($error3!="" || strlen($body)==0){
+							break;
+						} else {
+							$category.=HtmlSpecialChars($body);
+						}
+						$i++;
+					}
+				} else {
+					print $lang->ceneo_soap['no_header']."<br>";
+					print $error2;
+				} //end error2
+			} else {
+				print $lang->ceneo_soap['bad_reply']."<br>";
+				print $error1;
+			} // end error1
+		} else {
+			print $lang->ceneo_soap['not_connect']."<br>";
+			print $error;
+		} //end error
+		$cat=&$category;
+		return $cat;
+	} // end send_transaction()
+} // end class SOAP
+?>
diff -ruN ../soteesklep3/include/happy_hour.inc soteesklep3/include/happy_hour.inc
--- ../soteesklep3/include/happy_hour.inc	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/include/happy_hour.inc	2006-07-11 14:15:35.000000000 +0200
@@ -0,0 +1,182 @@
+<?php
+/**
+ * Happy hour - klasa odpowiedzialna za sprawdzenie czy dana grupa rabatowa ma byc aktywna w systemie w okreslonym czasie
+ *
+ * @author  p@sote.pl
+ * @version $Id: happy_hour.inc,v 2.13 2006/06/29 10:15:35 lukasz Exp $
+* @package    include
+ */
+
+class HappyHour {
+
+    /*
+    * Konstruktor obiektu
+    *
+    */
+    function HappyHour () {
+        global $_SESSION;
+        global $sess;
+        global $my_group;
+        global $__id_discounts_groups;
+        global $__user_discount;
+
+        // sprawdzaj czy jest happy hour pod warunkiem ze 
+        // uzytkownik nie ma juz przypisanej grupy rabatowej
+        // I
+        // uzytkownik nie zalogowal/wylogowal sie przed chwila
+        // LUB
+        // uzytkownik ma przypisane happy hour, i trzeba sprawdzic czy juz sie nie skonczylo
+        if (((empty($_SESSION['my_group']['id'])) && (! ereg("users",$_SERVER['SCRIPT_NAME']))) || (!empty($_SESSION['my_group']['start_time']))) {
+            // sprawdz czy istnieje grupa spelniajaca ramy czasowe
+            $my_group=$this->check_discounts_group();
+            // zarejestruj w sesji zwrocona informacje
+            $sess->register("my_group",$my_group);
+        }
+
+        // spelnia ramy czasowe
+        if (! empty($_SESSION['my_group'])) {
+        	$start_time=@$_SESSION['my_group']['start_time'];
+            $end_time=@$_SESSION['my_group']['end_time'];
+            if ((@$_SESSION['my_group']!=-1) && (@$_SESSION['my_group']!=-2)) {
+                $__id_discounts_groups=$_SESSION['my_group']['id'];
+
+                // jesli nie ma identyfikatora w sesji to zarejestruj w sesji identyfikator grupy
+                if (empty($_SESSION['__id_discounts_groups'])) {
+                    $sess->register("__id_discounts_groups",$__id_discounts_groups);
+                }
+
+                // zarejestruj domyslny rabat w sesji (emulacja zmiennej $__user_discount)
+                if (empty($_SESSION['__user_discount'])) {
+                    global $discounts_config;
+
+                    $__user_discount=$discounts_config->default_discounts[$__id_discounts_groups];
+                    $sess->register("__user_discount",$__user_discount);
+                    // prze³adowujemy zawarto¶æ koszyka
+                    global $shop;
+					$shop->basket();
+					$shop->basket->reload();
+                }
+
+                // sprawdz czy promocja ma jeszcze trwac
+                $check=$this->check_time($start_time,$end_time);
+
+            } elseif (@$_SESSION['my_group']==-2) {
+                // wyrejestruj zmienne z sesji jesli czas promocji dobiegl konca
+                if (! $this->check_time($start_time,$end_time)) {
+                    $sess->unregister("my_group");
+                    $sess->unregister("__id_discounts_groups");
+                    $sess->unregister("__user_discount");
+                    // prze³adowujemy zawartosæ koszyka
+					global $shop;
+					$shop->basket();
+					$shop->basket->reload();
+                }
+            }
+            // prze³adowujemy zawarto¶æ koszyka ¿eby zaktualizowaæ ceny je¿eli w³a¶nie zacze³a lub skoñczy³a siê happy hour
+        }
+
+    } //end konstruktor
+
+    /**
+     * Sprawdz czy jakas grupa rabatowa ma zdefiniowana date poczatkowa i koncowa promocji
+     * 
+     * \@modified_by m@sote.pl 2003-10-18: 19:46 dodanie sprawdzania istnienia definicji czasu promocji dla grupy rabatowej 
+     * @return -1 - brak plikow konfiguracyjnych lub brak definicji czasu promocji dla grupy rabatowej
+     * @return -2 - jest definicja nie spelnia ram czasowych
+     *
+     */
+    function check_discounts_group() {
+        global $discounts_config;
+        global $DOCUMENT_ROOT;
+        global $config;
+        $my_date_time=date("Y-m-d;H:i");  // pobranie daty i godziny w odpowiednim formacie
+
+        // sprawdzam czy istnieje w pliku konfiguracyjnym uzytkownika zmienna happy_hour
+        if (! empty($config->happy_hour)) {
+            $happy_hour_file_id=$config->happy_hour;
+        } else return -1;
+
+        // sprawdzam czy istnieje plik konfiguracyjny o takim id
+        if (!$shop->home) {
+	        $file="$DOCUMENT_ROOT/../config/auto_config/discounts/".$happy_hour_file_id."_discounts_config.inc.php";
+        } else {
+        	$file="/base/config/auto_config/discounts/".$happy_hour_file_id."_discounts_config.inc.php";
+        }
+        if (file_exists($file)) {
+            include_once($file);
+        } else return -1;
+
+        // brak definicji czasu promocji dla grupy rabatowej (nie ma takich tablic w pliku)
+        if (empty($discounts_config->discounts_start_date) || empty($discounts_config->discounts_end_date)) {
+            return -1;
+        }
+
+        // odczytaj date poczatku promocji
+        foreach ($discounts_config->discounts_start_date as $key=>$value) {
+            if ($value!=0) {
+                $start_time=$value;         // poczatek happy hour
+                $check_start_date=0;        // czy data poczatkowa miesci sie w ramach czasowych
+
+                // sprawdzam czy data poczatku promocji jest wieksza od aktualnej
+                if ($my_date_time>=$start_time) {
+                    $check_start_date=1;
+                    $my_start_time=$value;            // poczatek promocji
+                    $id_discounts_group_start=$key;   // identyfikator grupy rabatowej
+                }
+            }
+        }
+
+        if (empty($id_discounts_group_start)) return -1;
+        
+        // odczytaj date konca promocji
+        foreach ($discounts_config->discounts_end_date as $key=>$value) {
+            if ($value!=0) {
+                $end_time=$value;           // koniec happy hour
+                $check_end_date=0;          // czy data koncowa miesci sie w ramach czasowych
+
+                // sprawdzam czy data konca promocji jest mniejsza od aktualnej
+                if ($my_date_time<=$end_time) {
+                    $check_end_date=1;
+                    $my_end_time=$value;            // koniec promocji
+                    $id_discounts_group_end=$key;   // identyfikator grupy rabatowej
+                }
+            }
+        }
+
+        // jesli zdefiniowana grupa rabatowa miesci sie w ramach czasowych zwroc strukture (id grupy, poczatek i koniec promocji)
+        if ((@$id_discounts_group_start==@$id_discounts_group_end)) {
+
+            // tworze strukture danych
+            $discounts_group_data=array("id"=>$id_discounts_group_start,
+            "start_time"=>$my_start_time,
+            "end_time"=>$my_end_time);
+            return $discounts_group_data ;   // definicja istnieje, spelnia ramy czasowe
+
+        } else return -2;
+
+        return -1;
+
+    } // end check_discounts_group()
+
+    /*
+    * Sprawdz czy grupa miesci sie w przedziale czasowym
+    *
+    * @param $start_time - poczatkowa promocji wraz z godzina w formacie (np. 2003-10-07;11:55)
+    * @param $end_time - koncowa data promocji wraz z godzina w formacie (np. 2003-10-07;15:55)
+    * @return boolean true  - grupa miesci sie w przedziale czasowym
+    * @return boolean false - grupa nie miesci sie w przedziale czasowym
+    */
+    function check_time($start_time, $end_time) {
+        $my_date_time=date("Y-m-d;H:i");         // pobranie daty i godziny w odpowiednim formacie
+
+        if (($my_date_time>=$start_time) && ($my_date_time<=$end_time)) {
+            return true;
+        }
+
+        return false;
+
+    } // end check_time
+
+} // end class HappyHour
+
+?>
\ No newline at end of file
diff -ruN ../soteesklep3/include/image.inc soteesklep3/include/image.inc
--- ../soteesklep3/include/image.inc	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/include/image.inc	2006-07-11 14:15:35.000000000 +0200
@@ -0,0 +1,303 @@
+<?php
+/**
+* Wyswietlanie zdjec do produktu
+*
+* @author  m@sote.pl rp@sote.pl
+* @version $Id: image.inc,v 2.42 2006/07/11 10:16:50 cvs Exp $
+* @version $Id: image.inc,v 2.42 2006/07/11 10:16:50 cvs Exp $
+*
+* @package    include
+*/
+
+// okreslenie czy dane zdjêcie mo¿e byæ powiêkszane (po klikniêciu)
+define ("IMAGE_ZOOM_UP_TRUE",true);
+define ("IMAGE_ZOOM_UP_FALSE",false);
+
+class Image {
+    
+    var $photo_dir;                            // katalog zawierajacy zdjecia produktow wzgledem $DOCUMENT_ROOT
+    var $support_ext="jpg|gif|png";            // obslugiwane typy plikow
+    var $max_size=250;                         // maksymalna szerokosc lub wysokosc zdjecia
+    var $max_images=10;                        // maksymalna liczba zdjec
+    var $default_bmp_name="/themes/base/base_theme/_img/_mask.gif"; // nazwa zalczanego pliku w przypadku nie odnalezienia zadanego pliku
+    
+    /**
+    * @var string prefix wywo³ania zdjêcia (np. http://www.sklep.pl, wykorzystywane w adminie, do odwolania sie do /photo/)
+    */
+    var $http_prefix='';
+    
+    /**
+    * Konstruktor
+    *
+    * @access public
+    * @return none
+    */
+    function Image() {
+        global $DOCUMENT_ROOT,$_SERVER;
+        global $config,$shop;
+        
+        if ($shop->admin) {
+            $this->photo_dir=$config->admin_dir."/photo/";
+            $this->http_prefix="http://".$_SERVER['HTTP_HOST'];
+        } else {
+            $this->photo_dir=$config->htdocs_dir."/photo/";
+        }
+        
+        return(0);
+    } // end image()
+    
+    /**
+    * Wyswietl wszystkie zdjecia do produktu; obsluga wyswietlania kilku zdjec do produktu
+    *
+    * @param string $photo    nazwa zdejcia z bazy danych (pole 'photo' z tabeli 'main')
+    * @param string $align    wyrownanie zdjecia, do prawej, lewej
+    * @param string $prefix   prefix do nazwy zdjecia $photo
+    * @param int    $max_size maksymalna szeroko¶æ luib wysoko¶c zdjêcia
+    * @param bool   $zoom_up  true - zdjêcie mo¿e byæ powiêkszane po klikniêciu, false - w p.w.
+    *
+    * @access public
+    * @return none
+    */
+    function show($photo,$align="right",$prefix="",$max_size=0,$zoom_up=true) {
+        global $DOCUMENT_ROOT,$config,$shop;
+        $dynamic_scale = 0;
+        
+        if ((empty($prefix)) && (empty($max_size))) {
+            $max_size=$config->image['max_size'];
+            $dynamic_scale = 1;
+        } elseif ($prefix=="m_") {
+            $max_size=$config->image['min_size'];
+        }
+        
+        
+        // 1. wywolaj wyswietlenie zdjecia np. nazwa.jpg (dla $photo="nazwa.jpg")
+        // 2. sprawdz czy istnieje plik nazwa-1.jpg
+        // 3. a) jesli jest to wyswietl je i zwieksz numer o 1 i idz do 2.
+        //    b) jesli nie to zakoncz wyswietlanie || sprawdz kolejny numer az do $this->max_images
+        
+        // odczytaj nazwe i rozszezenie pliku zdjecia
+        $tab=$this->get_name_ext($photo);
+        $filename=$tab[0];$ext=$tab[1];
+        
+        // 1.
+        $this->_showPhoto($photo,$align,$prefix,$max_size,$zoom_up,$dynamic_scale);
+        
+        // kilka zdjec wyswietlaj tylko w info (tj jesli zdjecie jest wywolywane bez prefixu)
+        if (empty($prefix)) {
+            // 2.
+            for ($i=1;$i<$this->max_images;$i++) {
+                if ($shop->home!=1) {
+                    $file=$DOCUMENT_ROOT."/../htdocs/photo/$filename-$i.$ext";
+                }
+                else {
+                    $file=$DOCUMENT_ROOT."/photo/$filename-$i.$ext";
+                }
+                if (@fileinode($file)>0) {
+                    // 3. a)
+                    $photo="$filename-$i.$ext";
+                    $this->_showPhoto($photo,$align,$prefix,$max_size,$zoom_up);
+                } else {
+                    // 3. b)
+                    //return;
+                }
+            } // end for
+        } // end empty($prefix)
+        
+        return(0);
+    } // end show()
+    
+    /**
+    * Rozdziej rozszezenie o nazwy pliku
+    *
+    * @param string $filename  nazwa pliku
+    *
+    * @static
+    * @access public
+    * @return array array($name,$ext) (nazwa, rozszezenie pliku)
+    */
+    function get_name_ext($filename) {
+        $name=preg_match("/^(.+).(.{3})$/",$filename,$matches);
+        
+        $name=&$matches[1];
+        $ext=&$matches[2];
+        // print "<font color=red>$name</font>.<font color=green>$ext</font <BR>";
+        
+        return array($name,$ext);
+    } // end get_name_ext()
+    
+    /**
+    * Funkcja odpowiadajaca za weryfikacje obslugiwanych formatow bitmap
+    *
+    * @param  string $filename      nazwa pliku do weryfikacji
+    * @param  array  $support_ext   obslugiwane typy plikow
+    *
+    * @access public
+    * @static
+    * @return int  status weryfikacji pliku (1 - rozpoznano rozszezenie i typ pliku, 0 - nie rozpoznano rozszezenia)
+    *
+    */
+    function verifyInputData($file){
+        $verify_status=0;
+        if (preg_match("/$this->support_ext/i",$file)){
+            $verify_status=1;
+        }
+        return $verify_status;
+    } // end verifyInputData()
+    
+    /**
+    * Wyswietl zdjecie produktu, jesli istnieje.
+    *
+    * @param string $photo    nazwa zdjecia pobrana z bazy
+    * @param string $align    [left|right] parametr align przy zdjeciu
+    * @param string $prefix   string poprzedzajacy nazwe zdjecia (nazwa pobrana z bazy)
+    * @param int    $max_size maksymalna szeroko¶æ lub wysoko¶æ zdjêcia
+    * @param bool   $zoom_up  true - zdjêcie mo¿e byæ powiêkszane po klikniêciu, false - w p.w.
+    *
+    * @access private
+    * @return none
+    */
+    function _showPhoto($photo,$align="right",$prefix="",$max_size=0,$zoom_up=true,$dynamic_scale=0) {
+        global $DOCUMENT_ROOT;
+        global $theme;
+        global $my_xml_options;
+        global $shop;
+        
+        if (empty($photo)) return;
+        
+        $_allow_scale=true;
+        /*
+        if ((! empty($my_xml_options)) && (method_exists($my_xml_options,'checkChangeImage'))) {
+            // sprawdz czy zdjecie nie jest zmieniane online, jesli tak, to nie zezwalaj na skaluowanie zdjecia
+            if (! $my_xml_options->checkChangeImage()) {
+                if (empty($prefix)) $_allow_scale=false;
+            }
+        }
+        */
+        if ($max_size==0) $max_size=$this->max_size;
+        
+        if ($shop->home!=1) {
+            $file=$DOCUMENT_ROOT."/../htdocs/photo/".$prefix.$photo;
+        } else {
+            $file="/photo/".$prefix.$photo;
+        }
+        
+        if (file_exists($file)) {
+            // odczytaj parametry wysokosci i szerokosci zdjecia
+            $isize=GetImageSize($file);
+            $width=$isize[0];  $width_orig=$width;
+            $height=$isize[1]; $height_orig=$height;
+            
+            // przeskaluj zdjecie, jesli jest zbyt duze
+            $p=0;
+            if ($width>$max_size) {
+                $p=($max_size/$width);
+            } elseif ($height>$max_size) {
+                $p=($max_size/$height);
+            }
+            
+            if ($p>0) {
+                $width=intval($p*$width);
+                $height=intval($p*$height);
+                // wstaw link do oryginalnego rozmiaru zdjecia, otworz nowe dopasowane
+                // do wielkosci zdjecia okno
+                if (($_allow_scale==true) && ($zoom_up==true)) {
+                    
+                	print "<a id=\"photolink\" href=\"".$this->http_prefix.$this->photo_dir.$prefix.$photo."\" ";
+                    $this->onclick($width_orig+25,$height_orig+25,"photo");
+                    print " target=\"photo\" alt=\"\">";
+                }
+            }
+            
+            if (! empty($align)) {
+                $html_align=" align=$align ";
+            } else $html_align='';
+            /* zmiany by maciej
+            if ($dynamic_scale == 1) {
+                $scale_str = "onload='imageScale(this, $max_size)'";
+            }
+            else {
+                $scale_str = "width='$width'";
+            }
+            */
+            $id="";
+            if (empty($prefix) && $zoom_up) {
+            	$id='photo';
+            }
+            if (empty($prefix) && $zoom_up) {
+            	$id='photo';
+            }
+            
+            /*zmiany w resize zdjec by maciej*/
+            if($width > 0 && $height>0)
+            $scale_str = ' width="'.$width.'" height="'.$height.'" ';
+            	else
+            $scale_str = '';
+            /*koniec zmiany w resize zdjec*/
+            
+            print "<img $scale_str id=\"$id\" name=".$prefix."photo src=\"".$this->http_prefix.$this->photo_dir.$prefix.$photo."\" $html_align".
+            "border=\"$theme->img_border\"";
+            print ">\n";
+            
+            
+            
+            if ($p>0) {
+                if (($_allow_scale==true) && ($zoom_up==true)) {
+                    print "</a>";
+                }
+            }
+            
+         
+        } // end file_exists($file)
+        
+        return;
+    } // end _showPhoto()
+       
+    
+    /**
+    * Wyswietl zdjecie produktu duze (max_photo) jesli istnieje.
+    *
+    * @param string $photo    nazwa zdjecia pobrana z bazy
+	* @author krzys@sote.pl
+    * @access private
+    * @return none
+    **/
+    
+    function _show_max_Photo($photo,$desc_max_photo) {
+        global $DOCUMENT_ROOT;
+        
+       $max_file=$DOCUMENT_ROOT."/../htdocs/photo/"."max_".$photo;
+            if (file_exists($max_file)){
+	            $big_size=GetImageSize($max_file);
+	            $max_width=$big_size[0];
+	            $max_height=$big_size[1];
+	            print "<a id=\"photolink\" href=\"".$this->http_prefix.$this->photo_dir."max_".$photo."\" ";
+	            $this->onclick($max_width+25,$max_height+25,"photo");
+	            print " target=\"photo\" alt=\"\">";
+	            print "<img src='/themes/base/base_theme/_img/view_big.png' style=\"border-style:none\">&nbsp;";
+	            print $desc_max_photo;
+	            print "</a>";
+            }
+            return;
+    }
+             
+    
+    
+    /**
+    * Wyswietl jako atrybut onClick wywolanie otworzenie nowego okna przegladarki
+    *
+    * @param int   $x    szerokosc okna
+    * @param int   $y    wysokosc okna
+    * @param stirn $name nazwa okna
+    *
+    * @access public
+    * @return none
+    */
+    function onClick($x,$y,$name) {
+        print "onclick=\"window.open('','$name','width=$x,height=$y,scrollbars=0,menubar=0,status=0,location=0,directories=0,toolbar=0,resizable=0');\"";
+    } // end onClick()
+    
+} // end class Image
+
+$image =& new Image;
+
+?>
diff -ruN ../soteesklep3/include/lang_functions.inc soteesklep3/include/lang_functions.inc
--- ../soteesklep3/include/lang_functions.inc	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/include/lang_functions.inc	2006-07-11 14:15:35.000000000 +0200
@@ -0,0 +1,166 @@
+<?php
+/**
+* Klasa zawierajaca funkcje zwiazane z ustawieniami jezykowymi
+* np. tlumaczenie kategorii na dany jezyk dostepny w sklepie itd.
+*
+* @author  piotrek@sote.pl m@sote.pl
+* @version $Id: lang_functions.inc,v 2.17 2006/06/21 11:02:38 lukasz Exp $
+* @package    include
+*/
+
+global $dictionary;
+global $config;
+global $DOCUMENT_ROOT;
+
+// przypisanie odpowiedniego jezyka w zaleznosci od parametru $config->lang
+$absolute_path="$DOCUMENT_ROOT/lang/_".$config->lang."/dictionary_config.inc.php";
+
+// includowanie plikow konfiguracyjnych (slownikow) w zaleznosci od danego jezyka
+if (file_exists($absolute_path)) {
+    /**
+    * Odczytaj definicje s³ownika. Odczytaj obiekt $dictionary.
+    */
+    include_once("$absolute_path");
+}
+
+/**
+* T³umaczenie wyra¿eñ na podstwie s³ownika.
+* @package lang
+* @subpackage dictionary
+*/
+class LangFunctions extends Lang {
+    
+    /**
+    * Wyswietl slowo ze slownika (odpowiedni plik konfiguracyjny) w odpowiednim jezyku odpowiadajace slowu bazowemu (wordbase)
+    *
+    * @param string $wordbase slowo bazowe
+    */
+    function f_print($wordbase) {
+        global $dictionary;
+        $wordbase=trim($wordbase);
+        if(! empty($dictionary->words["$wordbase"])) {    // jesli slowo bazowe wystepuje w tablicy wyswietl jezykowy odpowiednik
+        print $dictionary->words["$wordbase"];
+        } else {
+            print $wordbase;    // wyswietl slowo bazowe
+        }
+        
+        return(0);
+    } // end f_print
+    
+    /**
+    * Zwroc slowo ze slownika (odpowiedni plik konfiguracyjny) w odpowiednim jezyku odpowiadajace slowu bazowemu (wordbase)
+    *
+    * @param string $wordbase slowo bazowe
+    */
+    function f_translate($wordbase) {
+        global $dictionary;
+        global $config;
+        $wordbase=trim($wordbase);
+        if (! empty($dictionary)) {
+            // jesli slowo bazowe wystepuje w tablicy zwroc jezykowy odpowiednik
+            if (! empty($dictionary->words[$wordbase])) {
+                return $dictionary->words["$wordbase"];
+            } else {
+                return $wordbase;
+            }
+        } else return $wordbase;
+        
+    } // end f_translate()
+    
+    /**
+    * Uproszczenie wywo³ania funkcji f_translate. Funkcja modyfikuje s³owo przekazane jako parametr (wska¼nik).
+    *
+    * @access string &$wordbase wyra¿enie, które bêdzie t³umaczone
+    * @return string przet³umaczone s³owo
+    */
+    function translate(&$wordbase) {
+    	$wordbase=trim($wordbase);
+        $wordbase=LangFunctions::f_translate($wordbase);
+        return $wordbase;
+    } // end translate()
+    
+    /**
+    * Zwroc slowo ze slownika w odpowiednim jezyku wyrazonym przez parametr $lang2 odpowiadajace slowu $word
+    * Przyklad wywolania: $translated_word=f_translate2("pl","en","Drukarki")
+    * Pod zmienna $translated_word otrzymamy tlumaczenie angielskie slowa polskiego Drukarki
+    *
+    * @param string $lang1 jezyk slowa $word
+    * @param string $lang2 jezyk na, ktory mam byc przetlumaczone slowo $word
+    * @param string $word slowo przeznaczone do tlumaczenia
+    */
+    function f_translate2($lang1,$lang2,$word) {        
+        global $dictionary,$_dictionary;
+        global $DOCUMENT_ROOT;
+        global $shop;
+        
+        if ($shop->admin==1) {
+            $MAIN_DOCUMENT_ROOT=ereg_replace("\/admin$","",$DOCUMENT_ROOT);
+        }
+        
+        // przypisanie odpowiedniego jezyka w zaleznosci od parametrow $lang1, $lang2
+        // na razie domyslnie przyjete jest tylko tlumaczenie z jezyka polskiego
+                        
+        $absolute_path="$MAIN_DOCUMENT_ROOT/htdocs/lang/_".$lang2."/dictionary_config.inc.php";
+                
+        //includowanie plikow konfiguracyjnych (slownikow) w zaleznosci od danego jezyka
+        if (file_exists($absolute_path)) {
+            if (empty($_dictionary[$lang2])) {
+                
+                // sprawdz czy wczesniej w inenj funckji slownik nie byl juz zaladowany
+                // jesli tak, to stworz obiekt odpowiedniej klasy slownika, jesli nie
+                // to zalacz plik (w pliku jest generowany obiekt $dictionary)
+                $DClass="DictionaryConfig_$lang2";
+                if (! class_exists($DClass)) {                   
+                    include ($absolute_path);            
+                } else $dictionary =& new $DClass;
+                
+                // zapamietaj slownik w globalnej bazie slownikow
+                $_dictionary[$lang2]=$dictionary;
+                
+            } else {
+                // odczytaj wczesniej odczytany slownik
+                $dictionary=$_dictionary[$lang2];                
+            }
+        } else {            
+            $dictionary->words=array();
+        }
+        
+
+        
+        // jesli slowo bazowe wystepuje w tablicy zwroc jezykowy odpowiednik
+        if(! empty($dictionary->words[$word])) {
+            return $dictionary->words[$word];
+        } else {
+            return $word;    // zwroc slowo bazowe
+        }
+    } // end f_translate2
+    
+    
+    /**
+    * T³umacz nazy produktów zapamiêtane w sesji (nazwy produktów z koszyka)
+    * 
+    * @param string $name
+    * @return string nazwa w jêzyku $config->lang
+    */
+    function name($name) {
+        global $_SESSION,$config;
+        if (! empty($_SESSION['products_lang_name'])) {
+            $products_lang_name=$_SESSION['products_lang_name'];
+            if (! empty($products_lang_name[$name][$config->lang])) return $products_lang_name[$name][$config->lang];
+        }
+        return $name;
+    } // end name()
+    
+} // end class LangFunctions
+
+/**
+* Rozszerzenie klasy, uproszczenie nazwy.
+* @package lang
+* @subpackage dictionary
+*/
+class LangF extends LangFunctions{};
+
+$langfunctions =& new LangF;
+$langf=&$langfunctions;
+
+?>
diff -ruN ../soteesklep3/include/order/order.inc soteesklep3/include/order/order.inc
--- ../soteesklep3/include/order/order.inc	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/include/order/order.inc	2006-07-11 14:15:37.000000000 +0200
@@ -0,0 +1,733 @@
+<?php
+/**
+* Obs³uga transakcji.
+*
+* @author  m@sote.pl
+* @version $Id: order.inc,v 1.37 2006/06/29 14:23:15 lukasz Exp $
+* @package    include
+*/
+/**
+* Dodanie klasy generuj±cej sumê kontroln± transakcji.
+*/
+require_once ("include/order/checksum.inc");
+
+/**
+* Dodanie klasy obs³ugi cen
+*/
+require_once ("include/price.inc");
+
+/**
+* Dodaj klasê obs³ugi kodowania danych.
+*/
+require_once ("include/my_crypt.inc");
+
+/**
+* Dodaj obs³ugê newslettera
+*/
+require_once ("include/newsletter_add.inc");
+
+/**
+* Klasa obs³ugi transakcji.
+* @package order
+* @subpackage htdocs
+*/
+class OrderRegister {
+    
+    /**
+    * Konstruktor
+    *
+    * @return none
+    */
+    function OrderRegister() {
+        $this->order_id=$this->getOrderID();
+        return;
+    } // end OrderRegister()
+    
+    /**
+    * Zapisz numer transakcji w sesji
+    *
+    * @param int $order_id numer transakcji
+    *
+    * @access private
+    * @return none
+    */
+    function _register($order_id) {
+        global $global_order_id,$sess;
+                
+        $global_order_id=$order_id;
+        $this->order_id=$order_id;
+        $sess->register("global_order_id",$global_order_id);
+        return;
+    } // end register()
+    
+    /**
+    * Odczytaj numer zamówienia
+    *
+    * @return int numer zamówienia, 0 - jesli nie ma nadanego numeru order_id
+    */
+    function getOrderID() {
+        global $_SESSION;
+        
+        $order_id=0;
+        if (! empty($this->order_id)) {            
+            $order_id=$this->order_id;
+        } elseif (! empty($_SESSION['global_order_id'])) {
+            $order_id=$_SESSION['global_order_id'];
+        }
+//        die($order_id);
+        return $order_id;
+    } // end getOrderID()
+    
+    /**
+    * Odczytaj numer ID transakcji + date (dzien/miesiac/rok)
+    *
+    * @return string format 1001/2004/03/12, gdzie 1001 to order_id
+    */
+    function getOrderIDDate() {
+        return $this->getOrderID()."/".date("Y/m/d");
+    } // end getOrderIDDate();
+    
+    /**
+    * @deprecated since 3.0
+    */
+    function xml_user() {}
+    
+    /**
+    * Opis transakcji w XML
+    * @deprecated ver. 3.0
+    */
+    function xml_description() {
+        return;
+    } // end xml_description()
+    
+    /**
+    * Dodaj transakcje do bazy.
+    * UWAGA! Uzytkownik zapisujacy do bazy transakcje, nie ma praw SELECT do tabeli.
+    *
+    * \@global int $this->order_id
+    * \@global string $this->order_id_date
+    * \@global int $global_id_pay_method id metody p³tno¶ci
+    */
+    function insert() {
+        global $_SESSION;
+        global $sess;
+        global $_SERVER;
+        global $global_id_pay_method;
+        global $db;
+        global $config;
+        global $theme;
+        global $mdbd;
+        
+        // odczytaj dane bilingowe
+        if (! empty ($_SESSION['form'])) {
+            $form=$_SESSION['form'];
+        } else $form=array();
+        
+        // odczytaj dane dotsawy
+        if (! empty ($_SESSION['form_cor'])) {
+            $form_cor=$_SESSION['form_cor'];
+        } else $form_cor=array();
+        
+        $global_delivery=$_SESSION['global_delivery']; // ['id'] ['name'] ['cost']
+        $delivery_cost=$global_delivery['cost'];
+        $id_delivery=$global_delivery['id'];
+        
+        // dodaj klase OrderRegister + utowrzenie obiektu tej klasy: $order
+        require_once ("include/order.inc.php");
+        // generuj numer zamowienia
+        $order->get_id();
+        // zapamietaj numer order_id i order_id_date, dane do przekazania poza klasa
+        $this->order_id=$order->id;
+        $this->order_id_date=$order->id_date;
+        
+        
+        $order_id=$this->order_id;
+        if (empty($_SESSION['order_session'])) {
+        	$_SESSION['order_session']=$sess->id;
+        } else {
+        	$_SESSION['order_session']=md5(time());
+        }
+        $session_id=$_SESSION['order_session'];
+        $amount=$_SESSION['global_basket_amount'];
+        if (in_array("discounts",$config->plugins)) {
+            $my_price = new MyPrice;
+            $amount=$my_price->promotionsAmount($amount);
+        }
+        $date_add=date("Y-m-d");
+        $time_add=date("H:i:s");
+        $id_pay_method=$global_id_pay_method;
+        $remote_ip=$_SERVER['REMOTE_ADDR'];
+        
+       // dodaj ades e-mail klienta do bazy newslettera
+       if ($form['news']=='yes'){
+       	add_2_newsletter($form['email'],$date_add,1,1,@$email_md5,":1:",$config->lang);     
+       }
+
+        require_once("include/my_crypt.inc");
+        global $my_crypt;
+        $crypt_email=$my_crypt->endecrypt("",$form['email']);
+        
+        // @deprecated ver. 3.0 $crypt_xml_description=$my_crypt->endecrypt("",$this->xml_description());
+        $crypt_xml_description='';
+        
+        // odczytaj id uzytkownika, jesli jest zalogowany
+        if (! empty($_SESSION['global_id_user'])) {
+            $id_users=$_SESSION['global_id_user'];
+        } else $id_users=-1;
+        
+        // identyfikacja partnera - modul partners
+        if (! empty($_SESSION['global_partner_id'])) {
+            $partner_id=$_SESSION['global_partner_id'];
+            
+            // oblicz prowizje dla partnera
+            $rake_off=$mdbd->select("rake_off","partners","partner_id=?",array($partner_id=>"int"));  // prowizja procentowa dla danego partnera
+            $rake_off_amount=$amount*($rake_off/100);                                         // prowizja dla partnera od produktu
+            // end oblicz prowizje dla partnera
+            
+            // pobierz nazwe partnera z bazy
+            $partner_name=$mdbd->select("name","partners","partner_id=?",array($partner_id=>"int"));
+        } else {
+            $partner_id=0;
+            $rake_off_amount=0;
+            $partner_name='';
+        };
+        // end partners module
+        
+        // koduj dane klienta
+        $crypt_xml_user=$my_crypt->endecrypt("",$this->xml_user());
+        $crypt_name=$my_crypt->endecrypt("",$form['name']." ".$form['surname']);
+        
+        // statusy domyslne
+        $id_status=0;
+        $confirm=0;
+        
+        // sprawdz czy produkt byl polecany wczesniej przez innego uzytkownika sklepu
+	    $items=@$_SESSION['global_basket_data']['items'];
+        foreach ($items as $key=>$value) {
+        	if ($value['user_id']==@$_SESSION['recom']['recom_product']) {
+        		$recom_id_user=@$_SESSION['recom']['recom_user'];
+				$recom_code=@$_SESSION['recom']['recom_code'];
+				$sess->unregister('recom');
+        	} else {
+        		$recom_id_user="0";
+				$recom_code="0";
+        	}
+        }
+        // suma kontrolna potwierdzenia transakcji
+        $amount_all=$theme->price($amount+$delivery_cost);
+        $checksum = OrderChecksum::checksum($order_id,0,$amount);
+        $checksum_online = OrderChecksum::checksum($order_id,0,$amount_all);
+        // end
+        
+        // start oblicz date: do kiedy nalezy potwierdzic transakcje
+        $date_confirm='0000-00-00';
+        if (! empty($config->order_timeout[$id_pay_method])) {
+            require_once ("Date/Calc.php");
+            $day=date("d")+$config->order_timeout[$id_pay_method]-1;  // -1 bo obliczmy date wg funkcji nextDay
+            $month=date("m");
+            $year=date("Y");
+            $date_confirm=Date_Calc::nextDay($day,$month,$year,$format="%Y-%m-%d");
+        }
+        // end oblicz date:
+        
+        // dodaj dane klienta do bazy, niezaleznie od tego czy user jest zalogowany
+        // dane klient sa zapisywane jako nowy rekord
+        $id_users_data=$this->_addUser($_SESSION['form'],@$_SESSION['form_cor']);
+        
+        // je¿eli transakcja szla przez karte - konieczne sa dodatkowe wpisy do bazy
+        if ($id_pay_method==110) {
+        	require_once('include/order/card.inc');
+        	$card=& New Card_Pay;
+        	$id_card_pay=$card->save_to_db();
+        } else $id_card_pay=0;
+        
+        // obs³uga zamówieñ produktów punktowych
+        global $shop;
+        if ($shop->basket->mode=="points") {
+        	require_once("include/order/points.inc");
+        	$points=&new Points_pay();
+        	$points->pay_with_points($this->getOrderID());
+        	$is_points="1";
+        } else $id_points="0";
+        $query="INSERT INTO order_register (order_id,session_id,amount,delivery_cost,id_delivery,
+                                            id_pay_method,date_add,time_add,remote_ip,
+                                            id_users,
+                                            id_status,confirm,
+                                            partner_id,rake_off_amount,partner_name,
+                                            checksum,checksum_online,date_confirm,
+                                            id_promotions,promotions_name,promotions_discount,
+                                            total_amount,id_users_data,user_description,record_version,
+                                            id_card_pay,recom_id_user,recom_code,lang_id,
+                                            points
+                                            )
+                       VALUES (?,?,?,?,?,
+                               ?,?,?,?,
+                               ?,
+                               ?,?,
+                               ?,?,?,
+                               ?,?,?,
+                               ?,?,?,
+                               ?,?,?,'30',?,?,?,?,?)";
+        
+        $prepared_query=$db->PrepareQuery($query);
+        if ($prepared_query) {
+            $db->QuerySetInteger($prepared_query,1, $order_id);
+            $db->QuerySetText(   $prepared_query,2, $session_id);
+            $db->QuerySetText(   $prepared_query,3, $amount);
+            $db->QuerySetText(   $prepared_query,4, $delivery_cost);            
+            $db->QuerySetText(   $prepared_query,5, $id_delivery);
+            
+            $db->QuerySetInteger($prepared_query,6, $id_pay_method);
+            $db->QuerySetText(   $prepared_query,7, $date_add);
+            $db->QuerySetText(   $prepared_query,8, $time_add);
+            $db->QuerySetText(   $prepared_query,9, $remote_ip);
+                        
+            $db->QuerySetInteger($prepared_query,10,$id_users);            
+                                   
+            $db->QuerySetInteger($prepared_query,11,$id_status);
+            $db->QuerySetText(   $prepared_query,12,$confirm);
+            
+            $db->QuerySetInteger($prepared_query,13,$partner_id);
+            $db->QuerySetInteger($prepared_query,14,$rake_off_amount);
+            $db->QuerySetText(   $prepared_query,15,$partner_name);
+            
+            $db->QuerySetText(   $prepared_query,16,$checksum);
+            $db->QuerySetText(   $prepared_query,17,$checksum_online);
+            $db->QuerySetText(   $prepared_query,18,$date_confirm);
+            
+            $db->QuerySetText(   $prepared_query,19,@$_SESSION['__promotions']['id']);
+            $db->QuerySetText(   $prepared_query,20,@$_SESSION['__promotions']['name']);
+            $db->QuerySetText(   $prepared_query,21,@$_SESSION['__promotions']['discount']);
+                        
+            $total_amount=$amount;
+            $db->QuerySetText(   $prepared_query,22, $total_amount);
+            $db->QuerySetText(   $prepared_query,23,$id_users_data);
+            $db->QuerySetText(   $prepared_query,24,@$form['description']);
+            $db->QuerySetInteger($prepared_query,25,@$id_card_pay);
+            $db->QuerySetText(	 $prepared_query,26,$recom_id_user);
+		    $db->QuerySetText(	 $prepared_query,27,$recom_code);
+		    $db->QuerySetText(	 $prepared_query,29,@$is_points);
+		    $db->QuerySetText(	 $prepared_query,28,$config->lang_id);
+            $result=$db->ExecuteQuery($prepared_query);
+            if ($result!=0) {
+                // Transakcja zostala dodana.
+                // user obecny nie ma praw do selectu, wiec update jest dokonywany w pozniejszym czasie
+                // na podsatwie order_id, ktory jest takze unikalnym numerem transakcji
+                
+                // zapisz numer order_id w sesji
+                $this->_register($order_id);
+                $saved_session=serialize($_SESSION);
+                $mdbd->insert('order_session','order_id,data','?,?',array("$order_id"=>"int","$saved_session"=>"text"));
+                // zapisz produkty z zamówienia
+                $this->_registerProducts($order_id);
+            } else die ("I".$db->Error());
+        } else die ("J".$db->Error());
+       
+        if (! empty($_SESSION['global_partner_id'])) {
+			// jesli jest to partner "Onet" to wyslij info o transakcji
+            $partner_name=$mdbd->select("name","partners","partner_id=?",array($partner_id=>"int"));
+            if ($partner_name == 'onet') {
+		        global $onet_config;
+            	@include_once ("include/onet/onet_transaction.inc.php");
+            	$onet_trans=new OnetTrans;
+            	$onet_trans->send_trans(1,$order_id);
+            	//print_r($onet_trans);
+            } elseif ($partner_name == 'wp') {
+            	global $wp_config;
+            	include_once ("include/wp/wp_transaction.inc.php");
+            	$wp_trans=new WpTransaction();
+            	// wysylamy order_id oraz potwierdzenie transakcji w tej sytuacji zawsze jest
+            	// to transakcje niepotwierdzona
+            	$wp_trans->SendTrans($order_id,-1);
+            } elseif ($partner_name == 'interia') {
+            	global $interia_config;
+            	include_once ("include/interia/interia_transaction.inc.php");
+            	$interia_trans=new InteriaTransaction();
+            	// wysylamy order_id oraz potwierdzenie transakcji w tej sytuacji zawsze jest
+            	// to transakcje niepotwierdzona
+            	$interia_trans->SendTrans($order_id,1);
+            } 
+            
+        }        
+        return;
+    } // end insert()
+    
+    /**
+    * Dodaj dane zamawiaj±cego oraz dane odbiorcy do bazy klientów.
+    * Dane klienta z zamówienia s± dodawane jako nowy rekord do tabeli "users", niezale¿nie od tego
+    * czy klient by³ zalogowany czy nie. Rozwi±zanie takie umo¿liwia na zapamiêtanie
+    * modyfikacji adresu i danych osoby zalogowanej i nie powoduje zmiany danych w zamówieniu
+    * przy zmianie danych klienta.
+    *
+    * @param array $form
+    * @param array $form_cor
+    *
+    * @access private
+    * @return int  ID dodanego klienta, lub 0 jesli nie uda³o siê dodaæ klienta    
+    */
+    function _addUser($form,$form_cor=array()) {
+        global $db,$_SERVER;
+        
+        $crypt =& new MyCrypt;
+        
+        // podstaw dodatkowe dane, które bêd± zapisywane w tabeli users
+        $form['last_ip']=$_SERVER['REMOTE_ADDR'];
+        $form['date_add']=date("Y-m-d");
+        $form['login']=$this->_maxIDUsers()+1;          
+        $form['password']=md5(rand(1,100000).$form['login'].time());      // losowe haslo
+        
+                
+        $query1="INSERT INTO users (
+                                   crypt_firm,crypt_name,crypt_surname,
+                                   crypt_street,crypt_street_n1,crypt_street_n2,
+                                   crypt_country,crypt_postcode,crypt_city,
+                                   crypt_phone,crypt_email,crypt_nip,
+                                   crypt_cor_firm,crypt_cor_name,crypt_cor_surname,
+                                   crypt_cor_street,crypt_cor_street_n1,crypt_cor_street_n2,
+                                   crypt_cor_country,crypt_cor_postcode,crypt_cor_city,
+                                   crypt_cor_phone,crypt_cor_email,
+                                   date_add,last_ip,order_data,
+                                   crypt_login,crypt_password,record_version)
+                            VALUES (
+                                    ?,?,?,
+                                    ?,?,?,
+                                    ?,?,?,
+                                    ?,?,?,
+                                    ?,?,?,
+                                    ?,?,?,
+                                    ?,?,?,
+                                    ?,?,
+                                    ?,?,1,
+                                    ?,?,30)";
+        $prepared_query1=$db->PrepareQuery($query1);
+        if ($prepared_query1) {            
+            $db->QuerySetText($prepared_query1,1,$crypt->endecrypt('',@$form['firm']));
+            $db->QuerySetText($prepared_query1,2,$crypt->endecrypt('',@$form['name']));
+            $db->QuerySetText($prepared_query1,3,$crypt->endecrypt('',@$form['surname']));
+            $db->QuerySetText($prepared_query1,4,$crypt->endecrypt('',@$form['street']));
+            $db->QuerySetText($prepared_query1,5,$crypt->endecrypt('',@$form['street_n1']));
+            $db->QuerySetText($prepared_query1,6,$crypt->endecrypt('',@$form['street_n2']));
+            $db->QuerySetText($prepared_query1,7,$crypt->endecrypt('',@$form['country']));
+            $db->QuerySetText($prepared_query1,8,$crypt->endecrypt('',@$form['postcode']));
+            $db->QuerySetText($prepared_query1,9,$crypt->endecrypt('',@$form['city']));
+            $db->QuerySetText($prepared_query1,10,$crypt->endecrypt('',@$form['phone']));
+            $db->QuerySetText($prepared_query1,11,$crypt->endecrypt('',@$form['email']));
+            $db->QuerySetText($prepared_query1,12,$crypt->endecrypt('',@$form['nip']));
+            $db->QuerySetText($prepared_query1,13,$crypt->endecrypt('',@$form_cor['firm']));
+            $db->QuerySetText($prepared_query1,14,$crypt->endecrypt('',@$form_cor['name']));
+            $db->QuerySetText($prepared_query1,15,$crypt->endecrypt('',@$form_cor['surname']));
+            $db->QuerySetText($prepared_query1,16,$crypt->endecrypt('',@$form_cor['street']));
+            $db->QuerySetText($prepared_query1,17,$crypt->endecrypt('',@$form_cor['street_n1']));
+            $db->QuerySetText($prepared_query1,18,$crypt->endecrypt('',@$form_cor['street_n2']));
+            $db->QuerySetText($prepared_query1,19,$crypt->endecrypt('',@$form_cor['country']));
+            $db->QuerySetText($prepared_query1,20,$crypt->endecrypt('',@$form_cor['postcode']));
+            $db->QuerySetText($prepared_query1,21,$crypt->endecrypt('',@$form_cor['city']));
+            $db->QuerySetText($prepared_query1,22,$crypt->endecrypt('',@$form_cor['phone']));
+            $db->QuerySetText($prepared_query1,23,$crypt->endecrypt('',@$form_cor['email']));
+            $db->QuerySetText($prepared_query1,24,$form['date_add']);
+            $db->QuerySetText($prepared_query1,25,$form['last_ip']);
+            $db->QuerySetText($prepared_query1,26,$crypt->endecrypt('',@$form['login']));
+            $db->QuerySetText($prepared_query1,27,$form['password']);
+            
+            $result1=$db->ExecuteQuery($prepared_query1);
+            if ($result1!=0) {
+                // dane klienta zosta³y poprawnie dodane do bazy
+                // odczytaj ID kleinta                                
+                return $this->_maxIDUsers();
+            } else die ("F".$db->Error());
+        } else die ("G".$db->Error());
+        
+        return 0;
+    } // end _addUser()
+    
+       /**
+    * Dodaj dane zamawiaj±cego oraz dane odbiorcy do bazy klientów.
+    * Dane klienta z zamówienia s± dodawane jako nowy rekord do tabeli "users", niezale¿nie od tego
+    * czy klient by³ zalogowany czy nie. Rozwi±zanie takie umo¿liwia na zapamiêtanie
+    * modyfikacji adresu i danych osoby zalogowanej i nie powoduje zmiany danych w zamówieniu
+    * przy zmianie danych klienta.
+    *
+    * @param array $form
+    * @param array $form_cor
+    *
+    * @access private
+    * @return int  ID dodanego klienta, lub 0 jesli nie uda³o siê dodaæ klienta    
+    */
+    function _updateUser($id,$form,$form_cor=array()) {
+        global $db,$_SERVER;
+        
+        $crypt =& new MyCrypt;
+        
+        // podstaw dodatkowe dane, które bêd± zapisywane w tabeli users
+        $form['last_ip']=$_SERVER['REMOTE_ADDR'];
+        $form['date_add']=date("Y-m-d");
+        
+                
+        $query1="UPDATE users SET  crypt_firm=?,crypt_name=?,crypt_surname=?,
+                                   crypt_street=?,crypt_street_n1=?,crypt_street_n2=?,
+                                   crypt_country=?,crypt_postcode=?,crypt_city=?,
+                                   crypt_phone=?,crypt_email=?,crypt_nip=?,
+                                   crypt_cor_firm=?,crypt_cor_name=?,crypt_cor_surname=?,
+                                   crypt_cor_street=?,crypt_cor_street_n1=?,crypt_cor_street_n2=?,
+                                   crypt_cor_country=?,crypt_cor_postcode=?,crypt_cor_city=?,
+                                   crypt_cor_phone=?,crypt_cor_email=?,last_ip=? WHERE id=?";
+
+        $prepared_query1=$db->PrepareQuery($query1);
+        if ($prepared_query1) {            
+            $db->QuerySetText($prepared_query1,1,$crypt->endecrypt('',@$form['firm']));
+            $db->QuerySetText($prepared_query1,2,$crypt->endecrypt('',@$form['name']));
+            $db->QuerySetText($prepared_query1,3,$crypt->endecrypt('',@$form['surname']));
+            $db->QuerySetText($prepared_query1,4,$crypt->endecrypt('',@$form['street']));
+            $db->QuerySetText($prepared_query1,5,$crypt->endecrypt('',@$form['street_n1']));
+            $db->QuerySetText($prepared_query1,6,$crypt->endecrypt('',@$form['street_n2']));
+            $db->QuerySetText($prepared_query1,7,$crypt->endecrypt('',@$form['country']));
+            $db->QuerySetText($prepared_query1,8,$crypt->endecrypt('',@$form['postcode']));
+            $db->QuerySetText($prepared_query1,9,$crypt->endecrypt('',@$form['city']));
+            $db->QuerySetText($prepared_query1,10,$crypt->endecrypt('',@$form['phone']));
+            $db->QuerySetText($prepared_query1,11,$crypt->endecrypt('',@$form['email']));
+            $db->QuerySetText($prepared_query1,12,$crypt->endecrypt('',@$form['nip']));
+            $db->QuerySetText($prepared_query1,13,$crypt->endecrypt('',@$form_cor['firm']));
+            $db->QuerySetText($prepared_query1,14,$crypt->endecrypt('',@$form_cor['name']));
+            $db->QuerySetText($prepared_query1,15,$crypt->endecrypt('',@$form_cor['surname']));
+            $db->QuerySetText($prepared_query1,16,$crypt->endecrypt('',@$form_cor['street']));
+            $db->QuerySetText($prepared_query1,17,$crypt->endecrypt('',@$form_cor['street_n1']));
+            $db->QuerySetText($prepared_query1,18,$crypt->endecrypt('',@$form_cor['street_n2']));
+            $db->QuerySetText($prepared_query1,19,$crypt->endecrypt('',@$form_cor['country']));
+            $db->QuerySetText($prepared_query1,20,$crypt->endecrypt('',@$form_cor['postcode']));
+            $db->QuerySetText($prepared_query1,21,$crypt->endecrypt('',@$form_cor['city']));
+            $db->QuerySetText($prepared_query1,22,$crypt->endecrypt('',@$form_cor['phone']));
+            $db->QuerySetText($prepared_query1,23,$crypt->endecrypt('',@$form_cor['email']));
+            $db->QuerySetText($prepared_query1,24,$form['last_ip']);
+            $db->QuerySetInteger($prepared_query1,25,$id);
+            
+            $result1=$db->ExecuteQuery($prepared_query1);
+            if ($result1!=0) {
+                // dane klienta zosta³y poprawnie dodane do bazy
+                // odczytaj ID kleinta                                
+                return $this->_maxIDUsers();
+            } else die ("F".$db->Error());
+        } else die ("G".$db->Error());
+        
+        return 0;
+    } // end _addUser()
+    
+    /**
+    * Odczytaj maksymalne ID kleinta w bazie
+    * @access private
+    * @return int max ID
+    */
+     function _maxIDUsers() {
+        global $db;
+        $query2="SELECT max(id) AS maxid FROM users LIMIT 1";
+        $db->soteSetModSQLOff();
+        $result2=$db->Query($query2);
+        if ($result2!=0) {
+            $num_rows2=$db->NumberOfRows($result2);
+            if ($num_rows2>0) {
+            	$db->soteSetModSQLOn();
+                return $db->FetchResult($result2,0,"maxid");
+            } else return 0;
+        } else die ("E".$db->Error());
+    } // end _maxIDUsers()
+    
+     /**
+    * Odczytaj id_users kleinta w bazie
+    * @access private
+    * @return int max ID
+    */
+    function _getIDUsers($order_id) {
+        global $db;
+        $query2="SELECT id_users_data FROM order_register WHERE order_id=$order_id";
+        $result2=$db->Query($query2);
+        if ($result2!=0) {
+            //$db->QuerySetInteger($result2,0,$order_id);
+            $num_rows2=$db->NumberOfRows($result2);
+            if ($num_rows2>0) {
+                return $db->FetchResult($result2,0,"id_users_data");
+            } else return 0;
+        } else die ("E".$db->Error());
+    } // end _maxIDUsers()
+    
+    /**
+    * Generuj opis opcji produktu
+    *
+    * @param array $options dane opcji
+    *
+    * @access private
+    * @return string opis opcji, który zostanie zapisany pó¼niej w bazie danych
+    */
+    function _getOptions($options) {
+        if (is_array($options)) {
+            reset($options);$o='';
+            foreach ($options as $key=>$val) {
+                $o.=$val.";";
+            }
+            $o=substr($o,0,strlen($o)-1);
+            return $o;
+        } else return '';
+    } // end _getOptions()
+    
+    /**
+    * Zapisz produkty do danej transakcji w bazie.
+    *
+    * @param int $order_id order_id transakcji
+    *
+    * @access private
+    * @return none
+    */
+    function _registerProducts($order_id) {
+        global $db;
+        global $my_basket;
+        global $config, $mdbd;
+        
+        
+        $items=&$my_basket->items;
+        if (@$config->depository['update_num_on_action'] == 'on_take_order') {
+            $res_available = $mdbd->select("user_id,num_from,num_to", "available", "1=1", array(), '', 'array');
+        }
+        reset($items);$pos=0;
+        foreach ($items as $item) {
+            $pos++;
+            $options=$this->_getOptions(@$item['data']['options']);            
+            $query="INSERT INTO order_products (order_id,user_id_main,price_brutto,vat,name,num,currency,measure,
+                                                id_category1,id_category2,id_category3,id_category4,id_category5,
+                                                category1,category2,category3,category4,category5,
+                                                id_producer,producer,
+                                                promotion,new,bestseller,discount,
+                                                date_add,basket_pos,time_from,
+                                                options,points_value)
+                           VALUES (?,?,?,?,?,?,?,?,
+                                   ?,?,?,?,?,
+                                   ?,?,?,?,?,
+                                   ?,?,
+                                   ?,?,?,?,
+                                   ?,?,?,
+                                   ?,?)";
+            $prepared_query=$db->PrepareQuery($query);
+            if ($prepared_query) {
+                $db->QuerySetInteger($prepared_query,1,$order_id);
+                $db->QuerySetText(   $prepared_query,2,$item['data']['user_id']);
+                $db->QuerySetText(   $prepared_query,3,$item['price']);
+                $db->QuerySetText(   $prepared_query,4,$item['data']['vat']);
+                $db->QuerySetText(   $prepared_query,5,$item['name']);
+                
+                
+                $db->QuerySetText(   $prepared_query,6,$item['num']);
+                $db->QuerySetText(   $prepared_query,7,$item['data']['currency']);
+                $db->QuerySetText(   $prepared_query,8,'');
+                
+                $db->QuerySetText(   $prepared_query,9,@$item['data']['category']['id_category1']);
+                $db->QuerySetText(   $prepared_query,10,@$item['data']['category']['id_category2']);
+                $db->QuerySetText(   $prepared_query,11,@$item['data']['category']['id_category3']);
+                $db->QuerySetText(   $prepared_query,12,@$item['data']['category']['id_category4']);
+                $db->QuerySetText(   $prepared_query,13,@$item['data']['category']['id_category1']);
+                
+                $db->QuerySetText(   $prepared_query,14,@$item['data']['category']['category1']);
+                $db->QuerySetText(   $prepared_query,15,@$item['data']['category']['category2']);
+                $db->QuerySetText(   $prepared_query,16,@$item['data']['category']['category3']);
+                $db->QuerySetText(   $prepared_query,17,@$item['data']['category']['category4']);
+                $db->QuerySetText(   $prepared_query,18,@$item['data']['category']['category5']);
+                
+                $db->QuerySetText(   $prepared_query,19,@$item['data']['category']['id_producer']);
+                $db->QuerySetText(   $prepared_query,20,@$item['data']['category']['producer']);
+                
+                $db->QuerySetText(   $prepared_query,21,0);
+                $db->QuerySetText(   $prepared_query,22,0);
+                $db->QuerySetText(   $prepared_query,23,0);
+                $db->QuerySetText(   $prepared_query,24,0);
+                
+                
+                $db->QuerySetText(   $prepared_query,25,date("Y-m-d"));
+                $db->QuerySetInteger($prepared_query,26,$pos);
+                $db->QuerySetText(   $prepared_query,27,0);
+                $db->QuerySetText(   $prepared_query,28,@$options);
+                $db->QuerySetText(   $prepared_query,29,@$item['points_value']);
+                
+                $result=$db->ExecuteQuery($prepared_query);
+                if ($result!=0) {
+                    // rekord zosta³ poprawnie dodany do bazy
+                    // debug: print "<pre>";print_r($item);print "</pre>";
+                    if (@$config->depository['update_num_on_action'] == 'on_take_order') { // zdejmij produkty z magazynu
+                    
+                        $user_id_main = $item['data']['user_id'];
+                        $num = $item['num'];
+                        
+                        $res = $mdbd->select("num,min_num,id", "depository", "user_id_main=?", array($user_id_main => 'text'), '', 'array');
+                        if(is_array($res) && (count($res) == 1)) {
+                            $base_num = $res[0]['num'];
+                            $res_num = $base_num - $num;
+                            $res_num_positive = $res_num;
+                            if($res_num_positive < 0)
+                                $res_num_positive = 0;
+                                
+                            $mdbd->update("depository", "num=$res_num", "user_id_main=?", array($user_id_main => 'text')); // update depository
+
+                            
+                            if(!empty($res_available)) {
+                                $av_id = 0;
+                                reset($res_available);
+                                while (($av_id == 0) && (list($key, $val) = each($res_available))) {
+                                    $a = $val['user_id'];
+                                    $from = $val['num_from'];
+                                    $to = $val['num_to'];
+                                    if($to != '*') {
+                                        if (($from <= $res_num_positive) && ($res_num_positive <= $to)) {
+                                            $av_id = $a;
+                                        }
+                                    }
+                                    else {
+                                        $last_id = $a;
+                                    }
+                                }
+                                if($av_id == 0) {
+                                    $av_id = $last_id;
+                                }
+                                if(($av_id == '') || (!is_numeric($av_id)))
+                                    $av_id = 0;
+                                $mdbd->update("main","id_available=$av_id", "user_id=?", array($user_id_main => "text"));
+                            }
+
+                        }
+                    }
+                } else die ($db->Error());
+                
+            } else die ($db->Error());
+            
+        } // end foreach
+        
+        return;
+    } // end _registerProducts()
+    
+    /**
+    * Aktualizuj dane transakcji
+    *
+    * \@global int $id_pay_method id methody p³atno¶ci
+    * @return none
+    */
+    function update($order_id) {
+        global $db;
+        global $global_id_pay_method;
+        global $mdbd;
+        if (empty($order_id)) return;
+        
+        $query="UPDATE order_register SET id_pay_method=? WHERE order_id=?";
+        $prepared_query=$db->PrepareQuery($query);
+        if ($prepared_query) {
+            $db->QuerySetInteger($prepared_query,1,$global_id_pay_method);
+            $db->QuerySetInteger($prepared_query,2,$order_id);
+            $result=$db->ExecuteQuery($prepared_query);
+            if ($result!=0) {
+            	$id_users_data=$this->_getIDUsers($order_id);
+                $this->_updateUser($id_users_data,$_SESSION['form'],@$_SESSION['form_cor']);
+                $saved_session=serialize($_SESSION);
+                $order_id=$this->getOrderID();
+                $mdbd->update('order_session','data=?','order_id=?',array("$saved_session"=>"text","$order_id"=>"int"));
+                // dane transakcji zostaly poprawnie zaktualizowane
+            } else die ("C".$db->Error());
+        } else die ("D".$db->Error());
+        
+        return;
+    } // end update()
+    
+} // end class OrderRegister
+?>
diff -ruN ../soteesklep3/include/xml_options/multi_group.inc soteesklep3/include/xml_options/multi_group.inc
--- ../soteesklep3/include/xml_options/multi_group.inc	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/include/xml_options/multi_group.inc	2006-07-11 14:15:38.000000000 +0200
@@ -0,0 +1,797 @@
+<?php
+/**
+* Obsluga atrybutow do produktow, typ "multi"
+* Zmiana atrybutu, ceny, zdjecia, prezenatcja atrybutow
+*
+* @author  m@sote.pl lech@sote.pl
+* @version $Id: multi_group.inc,v 2.41 2006/05/25 10:59:25 lukasz Exp $
+* @package    include
+* \@lang
+*/
+
+require_once ("HTML/Form.php");
+require_once ("include/price.inc");
+require_once("include/lang_functions.inc");
+
+define ('ATTR_MAX_NUM',10);            // maksymalna ilosc atrybutow
+define ('ATTR_MAX_ELEMENTS_NUM',5000); // maksymalna ilosc opcji danego atrybutu
+define ('ATTR_MAX_CAT_LIST',100);      // maksymalna ilosc produktow z kategorii na liscie
+define ('ATTR_MAX_OPTIONS',3);         // maksymalna liczba opcji przy danej opcji np. nazwa, cena, zdjecie
+
+class MultiGroup {
+    /**
+    * @var bool zmianna okreslajaca czy wyswietlana bedzie lista z obsluga zmiany zdjecia
+    */
+    var $_allow_change_image=true;
+
+    /**
+    * @var bool zmienna okreslajaca, czy w danej liscie zostala wywolana zmiana zdjecia
+    */
+    var $_change_image=false;
+
+    /**
+    * @var float $price_brutto  wartosc zakupu wg atrybutow
+    */
+    var $_price_brutto=0;
+
+    /**
+    * @var bool $_set_price informacja o tym, czy w formularzyu jest opcja zmiany ceny
+    */
+    var $_set_price=false;
+
+    /**
+    * Tablica powiazan nazwa opcji => nazwa elementu formularza np. Rozmiar=>"attr2"
+    */
+    var $_names=array();
+
+    /**
+    * @var string typ opcji (multi|music|...)
+    * @access private
+    */
+    var $_type="multi";
+
+    /**
+    * Konstruktor
+    */
+    function MultiGroup () {
+        global $rec,$config,$shop;
+        global $__xml_options_type;
+
+        if (! empty($__xml_options_type)) $this->_type=$__xml_options_type;
+
+        if ($shop->admin) $action='#';
+        else $action=$config->url_prefix."/go/_basket/index.php";
+        if ($shop->admin) $action1='#';
+        else $action1=$config->url_prefix."/go/_basket/index3.php";
+        $this->forms = new HTML_Form($action,"POST","attrib");
+//        $this->forms1 = new HTML_Form($action1,"POST","attrib");
+
+        if ($this->_type=="music") {
+            // dla typu "music" nie dodawaj g³ównego produktu przy dodaniu do koszyka
+            // opcja przenaczona do zakupu utworów on-line, generowanych przez atrybuty
+            // lista utworów do wyboru z listy typu "checkbox"
+            $this->forms->addHidden("music",1);
+//            $this->forms1->addHidden("music",1);
+        }
+//        $this->forms1->addHidden("id",@$rec->data['id']);
+
+        $this->my_price =& new MyPrice;
+
+        return(0);
+    } // end MultiGroup
+
+    /**
+    * @var array grupy atrybutow
+    */
+    var $_groups=array();
+
+    var $_num=1; // numer porzadkowy atrybutu
+
+    /**
+    * Wyswietl prezentacje atrybutow do produktu
+    *
+    * @param &$result wynik zapytania z bazy danych
+    *
+    * @access public
+    * @return none
+    */
+    function show(&$result) {
+        global $db,$config,$lang, $shop, $theme, $rec;
+
+        if ($shop->admin){
+        	$action1='#';       	
+        $this->result=&$result;
+
+        include_once ("lib/JavaScripts/imgChange.js");
+        include_once ("lib/JavaScripts/selectChange.js");
+        $temp_db=$db->FetchResult($result,0,'xml_options');
+        $this->_SelectGroups($temp_db);
+        $this->forms->addHidden("id",@$rec->data['id']);
+         $this->forms->addHidden('attr_memory','null');
+//        $this->forms1->addHidden('attr_memory','null');
+        $this->_showForm();
+        }else{
+        	$action1=$config->url_prefix."/go/_basket/index3.php";
+        	
+        $this->result=&$result;
+
+        include_once ("lib/JavaScripts/imgChange.js");
+        include_once ("lib/JavaScripts/selectChange.js");
+        $temp_db=$db->FetchResult($result,0,'xml_options');
+        $this->_SelectGroups($temp_db);
+        
+//        $this->forms->addSubmit('add2basket',$lang->info_attrib_order);
+        
+        $this->forms->addHidden("id",@$rec->data['id']);
+        $this->forms->addImage('add2basket', "<a onclick=\"document.forms['attrib'].submit(); \" style='cursor: pointer;'>" . $lang->basket_add . "</a>", $theme->filepath("_img/_bmp/" . $config->theme_config['icons']['basket']), "style='border-width: 0px;'" , "first");
+        $this->forms->addImage('add2basket', "<a onclick=\"document.forms['attrib'].action='$action1'; document.forms['attrib'].submit(); \" style='cursor: pointer;'>" . $lang->wishlist_add . "</a>", $theme->filepath("_img/_bmp/" . $config->theme_config['icons']['wishlist']), "onclick=\"this.form.action='$action1'\" style='border-width: 0px;'" , "last");
+        
+//        $this->forms1->addSubmit('add2basket',$lang->info_attrib_wishlist);
+        // element, pod ktorym beda (przez skrypt JS) zapisane dostepne wartosci
+        // pola dla modyfikowanego pola select
+        $this->forms->addHidden('attr_memory','null');
+//        $this->forms1->addHidden('attr_memory','null');
+        $this->_showForm();
+
+        return (0);
+        }
+    } // end show()
+
+    /**
+    * Podziel dane na grupy oddzielone pusta linia
+    *
+    * @param string &$xml_options wartosc pola xml_options
+    * \@global array $this->_groups
+    *
+    * @access private
+    * @return none
+    */
+    function _SelectGroups(&$xml_options) {
+        $this->_groups=preg_split("/\n\s/",$xml_options,ATTR_MAX_NUM,PREG_SPLIT_NO_EMPTY);
+        reset($this->_groups);
+        foreach ($this->_groups as $group) {
+
+            if ((trim($group)!='multi') && (trim($group)!='music')) {
+                $group_tab=preg_split("/\n/",$group,ATTR_MAX_ELEMENTS_NUM,PREG_SPLIT_NO_EMPTY);
+                if (eregi("^ID:",@$group_tab[1])) {
+                    $this->_checkbox($group_tab);
+                } elseif (eregi("^IDC:",@$group_tab[1])) {
+                    $this->_select_cat($group_tab);
+                } else {
+                    $this->_select($group_tab);
+                }
+            }
+
+        } // end foreach
+        return(0);
+    } // end _SelectGroups()
+
+    /**
+    * Wyswietl formularz z atrybutami
+    *
+    * @access private
+    * @return none
+    */
+    function _showForm() {
+        $this->forms->display();
+//        $this->forms1->display();
+        return (0);
+    } // end _showForm()
+
+    /**
+    * Przet³umaczenie atrybutów na bie¿±c± wersjê jêzykow±
+    *
+    * @param array $data tablica z danymi [0]->nazwa pola [1]..[n]->atrybuty
+    * @access private
+    * @return array Przet³umaczona tablica atrybutów
+    * @author lech@sote.pl
+    */
+    function _translateData($data) {
+        while(list($key, $val) = each($data)) {
+            $val_arr = explode(',', $val);
+            $temp_trim=trim($val_arr[0]);
+            $val_arr[0] = LangF::translate($temp_trim);
+            $data[$key] = implode(', ', $val_arr);
+        }
+        return $data;
+    }
+
+
+    // {{{ changeCurrency()
+
+    /**
+    * Odszukaj warto¶ci cenowych w opcjach i zmieñ je wed³ug aktualnej waluty.
+    *
+    * @param array $data
+    *
+    * @access private
+    * @return array dane te same co na wej¶ciu, tylko ¿e ze zmienionymi cenami wg waluty
+    */
+    function _changeCurrency($data) {
+        global $shop,$rec,$theme;
+
+        $shop->currency();
+		$this->my_price->get_discount($this->result);
+        $discount=$this->my_price->discount;
+        $new_data=array();        
+        foreach ($data as $dat) {
+            $tab=split(",",$dat,3);
+            $d=trim(@$tab[1]);
+            $new_d=0;$sub='';
+            if (! empty($d)) {
+                if (ereg("^\+",$d)) $sub="+";
+//                if (ereg("^\-",$d)) $sub="-";
+                if (abs($d)>0) {
+                    // przelicz kurs                    
+                    $id_currency1=$rec->data['id_currency'];
+                    $id_currency2=$shop->currency->id_currency;
+                    $new_d=$theme->price($shop->currency->change($d,$id_currency1,$id_currency2));
+                    // dodajemy rabat
+                    $new_d=$new_d*(1-($discount/100));
+        			
+                }
+            }
+
+            // generuj tablicê danych z nowymi cenami
+            reset($tab);$val='';$i=0;
+//            print "<pre>";
+//            print_r ($tab);
+//            print "</pre>";
+			if ( $d=='+0' || $d=='-0' ) {
+				$new_d='';
+				$sub='';
+			}
+            foreach ($tab as $t) {
+                if ($i==1) {
+                    $val.=$sub.$new_d.", ";
+                } else {
+                    $val.=$t.", ";
+                }
+                $i++;
+            }
+            $val=substr($val,0,strlen($val)-2);
+            $new_data[]=$val;
+
+        } // end foreach
+
+        if (! empty($new_data)) return $new_data;
+
+        return $data;
+    } // end _changeCurrency()
+
+    // }}}
+
+    /**
+    * Wyswietl element select z atrybutami
+    *
+    * @param array $data tablica z danymi [0]->nazwa pola [1]..[n]->atrybuty
+    *
+    * @access private
+    * @return none
+    */
+    function _select($data) {
+        if (empty($data)) return;
+    
+        $data = $this->_translateData($data);          
+        $data = $this->_changeCurrency($data);
+          
+        $name=$this->_name();$title=$data[0];$data[0]='---';
+
+        // sprawdz czy tytul jest zakonczony znakiem '->', jesli tak to jest to definicja atrybutow zaleznych
+        if (ereg("->",$title)) {
+            $this->_subSelect($data,LangF::translate(trim($title)));
+            return(0);
+        }
+        
+        $data=$this->_activeData($data);
+        if ($this->_allow_change_image==true) {
+            // sprawdz czy w atrybutach jest jakies wywolanie zdjecia
+            if ($this->_isImage($data)) {
+                $attrib="onChange=imgChange(this)";
+            } else $attrib='';
+            if ($this->_change_image==true) $this->_allow_change_image=false;
+        } else $attrib='';
+        $temp_trim=trim($title);
+        $temp_lang=LangF::translate($temp_trim);
+        $this->forms->addSelect($name,$temp_trim,$data,'',1,'',false,$attrib);
+//        $this->forms1->addSelect($name,LangF::translate(trim($title)),$data,'',1,'',false,$attrib);
+        // zapamietaj powiazanie nazwy opcji z nazwa elementu formularza
+        $this->_names[trim($title)]=$name;
+
+        return(0);
+    } // end _select()
+
+    /**
+    * Generuj select dla listy zale¿nej
+    *
+    * @param array $data tablica z danymi  [0]->nazwa pola [1]..[n]->atrybuty
+    *
+    * @access private
+    * @return none
+    */
+    function _subSelect($data,$title) {
+        /*
+        Dane postaci:
+        Array
+        (
+        [0] => ---
+        [1] => L-> czerwony, zielony
+        [2] => XL->zolty, czerwony
+        )
+        Przerabiamy na:
+        '"options[attr_2]","L->czerwony,zielony;XL->zolty,czerwony"'
+        */
+
+        $data = $this->_translateData($data);
+        $tab=split("->",$title);
+        // nazwa elementu formularza w ktorym wywolujemy funkcje JS
+        $name_from=$this->_names[trim($tab[0])];
+        // nazwa elementu formularza, w ktorym zmieniamy opcje
+        $name_to=$this->_names[trim($tab[1])];
+
+        reset($data);$o="onChange='selectChange(this.form,this,";
+        foreach ($data as $key=>$val) {
+            if ($key==0) {
+                $o.='"'.$name_to.'","';
+            } else {
+                $tab2=preg_split("/\n/",$val,ATTR_MAX_ELEMENTS_NUM);
+                foreach ($tab2 as $attr2) {
+                    $tab3=split("->",$attr2,2);
+                    $o.=trim($tab3[0])."->";
+                    $tab4=split(",",$tab3[1],ATTR_MAX_ELEMENTS_NUM);
+                    foreach ($tab4 as $el) {
+                        $el=trim($el);
+                        $o.=$el.",";
+                    }
+                    $o=substr($o,0,strlen($o)-1);
+                    $o.=";";
+                }
+            }
+        }
+        $o=substr($o,0,strlen($o)-1);
+        $o.="\");'";
+
+        // zmien atrybuty w opcji SELECT
+        $this->_setFormsAttrib($name_from,$o);
+
+        return(0);
+    } // end _subSelect()
+
+    /**
+    * Zmien atrybuty w elemencie select
+    *
+    * @param string $name   nazwa pola
+    * @param string $attrib atrybuty
+    *
+    * @access private
+    * @return none
+    */
+    function _setFormsAttrib($name,$attrib) {
+        reset($this->forms->fields);
+        $i=0;
+        foreach ($this->forms->fields as $field) {
+            if (($field[0]=='select') && ($field[1]==$name)) {
+                $this->forms->fields[$i][8]=$attrib;            // dla elementu select 8 parametr to atryb.
+            }
+            $i++;
+        } // end foreach        
+//        reset($this->forms1->fields);
+//        $i=0;
+//        foreach ($this->forms1->fields as $field) {
+//            if (($field[0]=='select') && ($field[1]==$name)) {
+//                $this->forms1->fields[$i][8]=$attrib;            // dla elementu select 8 parametr to atryb.
+//            }
+//            $i++;
+//        } // end foreach
+        return(0);
+    } // end _setFormsAttrib()
+
+    /**
+    * Wyswietl element select z atrybutami - produktami odczytanymi ze wskazanych kategorii
+    *
+    * @param array $data tablica z danymi [0]->nazwa pola [1]..[n]->atrybuty (idc kategorii)
+    *
+    * @access private
+    * @return none
+    */
+    function _select_cat($data) {
+        global $mdbd;
+
+        $this->default='';                           // domyslnie nie zaznaczony jest zaden produkt
+
+        $title=$data[0];$entries=array();$entr=array();
+        for ($i=1;$i<sizeof($data);$i++) {
+            $entr[$i]=$this->_productsFromCat($data[$i]);
+        } // end for
+
+        reset($entr);
+        foreach ($entr as $e) {
+            while (list($id,$name) = each($e)) {
+                $entries[$id]=$name;
+            }
+        } // end foreach
+
+        $name=$this->_name($id,"basket_cat");
+        if (! empty($entries)) {
+            $this->forms->addSelect($name,$title,$entries,$this->default);
+//            $this->forms1->addSelect($name,$title,$entries,$this->default);
+        }
+
+        return(0);
+    } // end _select_cat()
+
+    /**
+    * Odczytaj liste produktow wedlug katergorii IDC: kategoria np. id_23, 23_1, 23_27_1
+    *
+    * @param  array  $idc_data      dane w postaci IDC: kategoria\n IDC: kategori2 itd.
+    * \@global string $this->default zapamietaj domyslny element na liscie
+    *
+    * @access private
+    * @return array tablica z nazwami produktow, ktore beda wyswietlone na liscie
+    */
+    function _productsFromCat($data=array()) {
+        global $mdbd;
+        global $config;
+        global $shop;
+        global $theme;
+
+        $tab=split("IDC:",$data,2);
+        if (! empty($tab[1])) {
+            $idc=trim($tab[1]);
+            if (ereg(",",$idc)) {
+                $tab2=split(",",$idc,2);
+                if (! empty($tab2[0])) {
+                    $idc=trim($tab2[0]);
+                }
+                if (! empty($tab2[1])) {
+                    $this->default=trim($tab2[1]);  // user_id produktu domyslnie zaznaczonego
+                }
+            }
+        }
+
+        $category=array();
+        if (ereg("^id_",$idc)) {
+            $idc=ereg_replace("id_","",$idc);
+        }
+        $category=split("_",$idc,5);
+
+        // generuj WHERE do zapytania SQL na podstawie danych kategorii
+        $where="1";
+        for ($i=1;$i<=sizeof($category);$i++) {
+            $c=$i-1;
+            if (ereg("^[0-9]+$",$category[$c])) {
+                $where.=" AND id_category$i=".$category[$c];
+            }
+        } // end for
+
+        // odczytaj liste produktow z bazy
+        $products=$mdbd->select($config->select_main_price_list,"main",$where." AND hidden_price!=1",array(),"LIMIT ".ATTR_MAX_CAT_LIST,"ARRAY");
+        if (($mdbd->num_rows>0) && (is_array($products))) {
+            reset($products);$entries=array(''=>'---');
+            $row=0;            
+            foreach ($products as $product) {                
+                $price=$this->my_price->price($mdbd->result,$row);                
+                $price=$theme->price($shop->currency->change($price,$product['id_currency'],$shop->currency->id_currency));
+                $entries[$product['id']]=$product['name_L' . $config->lang_id].", +".$price;
+                $row++;
+            }
+        } else return array();
+
+        return $entries;
+    } // end _productsFromCat()
+
+
+    /**
+    * Wyswietl element checkbox z atrybutami.
+    * Generowanie elementów dla danych postaci:
+    * ID: 12,1
+    *
+    * @param array tablica z danymi [0]->nazwa pola [1]..[n]->atrybuty
+    *
+    * @access private
+    * @return none
+    */
+    function _checkbox($data) {
+        global $config;        
+        global $shop,$theme;
+        
+        $shop->currency();
+        
+        $default=0;
+        reset($data);$i=0;
+        foreach ($data as $idp) {
+            if ($i++>0) {
+                $tab=split(":",$idp,2);
+                if (! empty($tab[1])) {
+                    // sprawdz, ktore atrybuty maja byc domyslnie wybrane
+                    $tab2=split(",",trim($tab[1]),2);
+                    if (! empty($tab2[0])) {
+                        $user_id=trim($tab2[0]);
+                        if (trim(@$tab2[1])!="1") {
+                            $default=0;
+                        } else $default=1;
+                    }
+                    $main=$this->_getMainInfo($user_id);
+                    $name=$this->_name($main['id']);
+                    $prod_price = $main['price'];
+                    if($config->price_type == 'netto') {
+                        $prod_price = MyPrice::brutto2netto($prod_price, $main['vat']);                        
+                    }
+                    
+                    // zmieñ cenê z waluty w jakiej zdefiniowany jest cena g³ówna produktu
+                    // na walutê aktualnie wy¶iwetlan± w sklepie
+                    $prod_price=$shop->currency->change($prod_price,1,$shop->currency->id_currency);                    
+                    $prod_price=$theme->price($prod_price);  // formatuj cenê
+                    
+                    $title=" ".$main['name_L0']."</td><td align=right>+<b>".$prod_price." ".$shop->currency->currency."</b>";
+                    if (! empty($main['name_L0'])) {
+                        $this->forms->addCheckbox($name,$title,$default);
+//                        $this->forms1->addCheckbox($name,$title,$default);
+                    }
+                }
+            } // end if ($i++>0)
+        } // end foreach
+
+        return(0);
+    } // end _checkbox()
+
+    /**
+    * Odczytaj nazwe produktu wskazanego jako atrybut
+    *
+    * @param string $user_id identyfikator produktu
+    *
+    * @access private
+    * @return array dane produktu "name"=>"nazwa","price"=>"cena produktu brutto"
+    */
+    function _getMainInfo($user_id='') {
+        global $mdbd;
+        global $config;
+
+        $m=$mdbd->select($config->select_main_price_list,"main","user_id=?",array($user_id=>"text"),"LIMIT 1");
+        if ($config->lang!=$config->base_lang) {
+            // zmieñ nazwê produktu, we¼ inne pole okre¶laj±ce nazwê w danym jêzyku
+            if(!empty($m["name_L" . $config->lang_id]))
+                $m['name'] = $m["name_L" . $config->lang_id];
+            else {
+                $m['name'] = $m["name_L0"];
+            }
+        }
+        @$m['price']=$this->my_price->price($mdbd->result);
+        return $m;
+    } // end _getMainName()
+
+    /**
+    * Sprawdz czy w danej opcji jest zdjecie
+    *
+    * @param array &$data tablica z danymi opcji
+    *
+    * @access private
+    * @return bool true - w opcji jest wywolanie zdjecia
+    */
+    function _isImage(&$data) {
+        reset($data);
+        foreach ($data as $key=>$val) {
+            if ((ereg(".jpg",$val)) || (ereg(".gif",$val)) ||(ereg(".jpeg",$val))) {
+                return true;
+            }
+            if ((ereg(".jpg",$key)) || (ereg(".jpg",$key)) ||(ereg(".jpg",$key))) {
+                return true;
+            }
+        } // end foreach
+
+        return false;
+    } // end _isImage()
+
+    /**
+    * 'Aktywuj' dane, odczytaj cene, dodlacz obsluge zmiany zdjecia
+    *
+    * @param array $dane dane do listy formularza
+    *
+    * @access private
+    * @return array przetworzone dane do listy fomularza
+    */
+    function _activeData($data) {
+        global $DOCUMENT_ROOT;
+        global $rec;
+
+        $_isImage=$this->_isImage($data);
+
+        reset($data);$data2=array();
+        foreach ($data as $key=>$val)  {
+
+            $val=trim($val);
+            // sprawdz, czy zdjecie jest zalaczone do opcji
+            $tab=split(",",$val,ATTR_MAX_OPTIONS);
+
+            $image='';$price='';
+            if (! empty($tab[1])) {
+                if ( (eregi(".gif$",$tab[1])) || (eregi(".png$",$tab[1])) || (eregi(".jpg$",$tab[1])) ) {
+                    $image=trim($tab[1]);
+                } else $price=trim($tab[1]);
+            }
+
+            if ( (empty($image)) && (! empty($tab[2])) && ((eregi(".png$",$tab[2])) || (eregi(".jpg$",$tab[2])) || (eregi(".gif$",$tab[2])))) $image=trim($tab[2]);
+
+            $name=$tab[0];
+
+            // zazwalaj zmiane zdjecia tylko na 1 liscie atrybutow
+            if ($this->_allow_change_image==true) {
+                if ((! empty($image)) && (file_exists("$DOCUMENT_ROOT/photo/$image"))) {
+                    $this->_change_image=true;
+                    $key="IMG:$name:/photo/$image";
+                } elseif ($_isImage) {
+                    $key="IMG:$name:/photo/".$rec->data['photo'];
+                } else $key=$name;
+                if (! empty($price)) {
+                    $data2[$key]=$name.", ".$price;
+                } else $data2[$key]=$name;
+            } else {
+                if (! empty($price)) {
+                    $data2[$name]=$name.", ".$price;
+                } else $data2[$name]=$name;
+            }
+
+        } // end foreach
+
+        // zapamietaj ze w fromularzu jest zmiana ceny
+        if (! empty($price)) $this->_set_price=true;
+
+        return $data2;
+    } // end _activeData()
+
+    /**
+    * Generuj kolejna nazwe pola formularza dla atrybutu
+    *
+    * @param string $id   id produktu
+    * @param string $name nazwa pola formularza (tablicy parametrow)
+    *
+    * @access private
+    * @return string nazwa pola formularza
+    */
+    function _name($id='',$name='') {
+        if (! empty($id)) {
+            return "basket[$id]";
+        } elseif (! empty($name)) {
+            return $name."[attr_".$this->_num++."]";
+        } else
+        return "options[attr_".$this->_num++."]";
+    } // end _name()
+
+    /**
+    * Sprawdz, czy w opcjach sa zmieniane zdjecia
+    *
+    * @access public
+    * @return bool true - zdjecia sa zmieniane, false w p.w.
+    */
+    function checkChangeImage() {
+        if ($this->_change_image==false) return false;
+        return $this->_change_image;
+    } // end checkChangeImage
+
+    /**
+    * Odczytaj wartosc parametru przekaywana do koszyka
+    *
+    * @param string $name np. IMG:wartosc:test.jpg
+    *
+    * @access public
+    * return string wartosc atrybutu
+    */
+    function getName($name) {
+        if (ereg("---",$name)) return '';
+
+        if (ereg("^IMG:",$name)) {
+            $tab=split(":",$name,3);
+            if (! empty($tab[1])) return $tab[1];
+            else return $name;
+        }
+        return $name;
+    } // end getName()
+
+    /**
+    * Wyswietl cen eproduktu wg atrybutow (cena zmieniana online)
+    *
+    * @param float $price domyslna cena
+    *
+    * @access public
+    * @return none
+    */
+    function showPrice($price) {
+        print "<form name=price><input type=text readonly name=price_preview value='$price' class=text_preview size=12></form>\n";
+        return(0);
+    } // end showPrice()
+
+
+    /**
+    * Odczytaj cene produktow wg podanych atrybutow
+    *
+    * @param float   $price_brutto cena produktu brutto
+    * @param string &$xml_options  wartosc pola xml_options produktu
+    *
+    * \@global object &$this->result wynik zapytania z bazy danych (o dane produktu)
+    *
+    * @access public
+    * @return float cena sprzedazy produktu
+    */
+    function price($price_brutto,&$xml_options) {
+        global $db;
+        global $_REQUEST;
+		
+        $this->my_price->get_discount($this->result);
+        $discount=$this->my_price->discount;
+        if (empty($xml_options)) {
+            return $price_brutto;
+        }
+
+        if (! empty($_REQUEST['options'])) {
+            if (is_array($_REQUEST['options'])) {
+                $options=$_REQUEST['options'];
+            } else return $price_brutto;
+        }
+
+        reset($options);
+        if (empty($this->_price_brutto)) {
+            $this->_price_brutto=$price_brutto;
+        }
+        foreach ($options as $key=>$val) {
+            if (ereg("^attr_",$key)) {
+
+                // odczytaj numer grupy parametrow
+                preg_match("/^attr_([0-9]+)$/",$key,$matches);
+                if (! empty($matches[1])) {
+                    $num=$matches[1];
+                } else continue;
+
+                $attrib=$this->getName($_REQUEST['options'][$key]);
+                if (empty($attrib)) continue;
+
+                $data=preg_split("/\n/",$xml_options);$num_param=0;
+                // $data zawiera w tablicy linie calej wartosci xml_options
+                foreach ($data as $line) {
+                    $line=trim($line);
+                    if ($num_param==$num) {
+                        $tab=split(",",$line,3);
+                        if (LangF::translate(@$tab[0])==trim($attrib)) {
+                            if (ereg("^[-0-9+. ]+$",trim(@$tab[1]))) {
+                                $nprice=trim($tab[1]);  $nprice=ereg_replace(" ","",$nprice);
+                                $subprice=number_format(substr($nprice,1,strlen($nprice)-1),2,'.','');
+								$subprice=$subprice*(1-($discount/100));
+                                if (substr($nprice,0,1)=="+") {
+                                	
+                                    $this->_price_brutto+=$subprice;
+                                } elseif (substr($nprice,0,1)=="-") {
+                                    $this->_price_brutto-=$subprice;
+                                } else {
+                                    $this->_price_brutto=$nprice;
+                                }
+                            }
+                        } // if (@$tab[0]==attrib)
+                    }
+                    if (empty($line)) {
+                        $num_param++;
+                    }
+                } // end foreach lines
+            } // if (ereg("^attr",$key))
+        } // end foreach
+
+        if ($this->_price_brutto<0) $this->_price_brutto=0;
+
+        return $this->_price_brutto;
+    } // end price()
+
+    /**
+    * Sprawdz czy dany typ danych mozna edytowac w formie uproszczonej (wprowadzajac dane do pola <input ...>
+    *
+    * @access public
+    * @return boll   true - uproszczona edycja jest dostepna, false w p.w.
+    */
+    function checkSimpleEdit() {
+        return false;
+    } // end checkSimpleEdit()
+
+} // end class MultiGroup
+
+class MyXMLOptions extends MultiGroup {};
+global $my_xml_options;
+$my_xml_options = new MyXMLOptions;
+
+?>
diff -ruN ../soteesklep3/lib/Metabase/metabase_mysql.php soteesklep3/lib/Metabase/metabase_mysql.php
--- ../soteesklep3/lib/Metabase/metabase_mysql.php	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/lib/Metabase/metabase_mysql.php	2006-07-11 14:15:42.000000000 +0200
@@ -0,0 +1,764 @@
+<?
+if(!defined("METABASE_MYSQL_INCLUDED"))
+{
+    define("METABASE_MYSQL_INCLUDED",1);
+
+    /*
+    * metabase_mysql.php
+    *
+    * @(#) $Header: /usr/local/CVS/soteesklep2/lib/Metabase/metabase_mysql.php,v 2.11 2006/06/12 09:12:25 marek Exp $
+    *
+    */
+
+    class metabase_mysql_class extends metabase_database_class
+    {
+        var $connection=0;
+        var $connected_host;
+        var $connected_user;
+        var $connected_password;
+        var $connected_port;
+        var $opened_persistent="";
+        var $decimal_factor=1.0;
+        var $highest_fetched_row=array();
+        var $columns=array();
+        var $fixed_float=0;
+        var $escape_quotes="\\";
+        var $demo="no";     // demo=yes zonacza, ze system zezwala tylko na wykonywania zapytan SELECT
+        var $_soteSetMod=1; // 1 dodaj opcje modyfikowania SQL multi_shop
+
+        Function Connect()
+        {
+            $port=(IsSet($this->options["Port"]) ? $this->options["Port"] : "");
+            if($this->connection!=0)
+            {
+                if(!strcmp($this->connected_host,$this->host)
+                && !strcmp($this->connected_user,$this->user)
+                && !strcmp($this->connected_password,$this->password)
+                && !strcmp($this->connected_port,$port)
+                && $this->opened_persistent==$this->persistent)
+                return(1);
+                mysql_Close($this->connection);
+                $this->connection=0;
+                $this->affected_rows=-1;
+            }
+            $this->fixed_float=30;
+            $function=($this->persistent ? "mysql_pconnect" : "mysql_connect");
+            if(!function_exists($function))
+            return($this->SetError("Connect","MySQL support is not available in this PHP configuration"));
+            if(($this->connection=@$function($this->host.(!strcmp($port,"") ? "" : ":".$port),$this->user,$this->password))<=0)
+            return($this->SetError("Connect",IsSet($php_errormsg) ? $php_errormsg : "Could not connect to MySQL server"));
+            if(IsSet($this->options["FixedFloat"]))
+            $this->fixed_float=$this->options["FixedFloat"];
+            else
+            {
+                if(($result=mysql_query("SELECT VERSION()",$this->connection)))
+                {
+                    $version=explode(".",mysql_result($result,0,0));
+                    $major=intval($version[0]);
+                    $minor=intval($version[1]);
+                    $revision=intval($version[2]);
+                    if($major>3
+                    || ($major==3
+                    && $minor>=23
+                    && ($minor>23
+                    || $revision>=6)))
+                    $this->fixed_float=0;
+                    mysql_free_result($result);
+                }
+            }
+            if(IsSet($this->supported["Transactions"])
+            && !$this->auto_commit)
+            {
+                if(!mysql_query("SET AUTOCOMMIT=0",$this->connection))
+                {
+                    mysql_Close($this->connection);
+                    $this->connection=0;
+                    $this->affected_rows=-1;
+                    return(0);
+                }
+                $this->RegisterTransactionShutdown(0);
+            }
+            $this->connected_host=$this->host;
+            $this->connected_user=$this->user;
+            $this->connected_password=$this->password;
+            $this->connected_port=$port;
+            $this->opened_persistent=$this->persistent;
+
+            return(1);
+        }
+
+        Function Close()
+        {
+            if($this->connection!=0)
+            {
+                if(IsSet($this->supported["Transactions"])
+                && !$this->auto_commit)
+                $this->AutoCommitTransactions(1);
+                mysql_Close($this->connection);
+                $this->connection=0;
+                $this->affected_rows=-1;
+            }
+        }
+
+        /**
+        * Zmieñ SELECT i INSERT tak, ¿eby uwzglêdniæ obs³ugê pola id_shop.
+        * Do ka¿dego SELECT dodaj warunke id_shop=X, oraz do ka¿dego INSERT dodaj ustawianie warto¶æi id_shop=X
+        *
+        * @tmp tymczasowe ograniczenie do tabeli main
+        *
+        * @param string $query zapytaanie/instrukcja SQL
+        *
+        * @access private
+        * @return sting zapytanie z modyfikacjami
+        */
+        function _soteMultiSQL($query) {
+            global $config;
+            $query=trim($query);
+            if (ereg(";$",$query)) $query=substr($query,0,strlen($query)-1);
+            if (eregi("^SELECT",$query)) {
+                //print "_soteMUltiSelect()<br>";
+                $query=$this->_soteMultiSelect($query);
+            } elseif (eregi("^INSERT",$query)) {             
+                $query=$this->_soteMultiInsert($query);
+            }            
+            
+            return $query;
+        } // end _soteMultiSQL()
+
+        /**
+        * Zmieñ instrukcjê SELECT
+        *
+        * @param string $query zapytanie SQL
+        *
+        * @access private
+        * @return string zmodyfikowane zapytanie SQL (+id_shop=1)
+        */
+        function _soteMultiSelect($query) {
+            global $config;
+            
+            if (eregi("where",$query)) {
+                // jest WHERE
+                $new_query=preg_replace("/ FROM[\s]+([a-zA-Z0-9_]+)[\s]+WHERE/i"," FROM \$1 WHERE id_shop=$config->id_shop AND (",$query);
+                if (eregi("group by",$new_query)) {
+                    $new_query=preg_replace("/GROUP[\s]+BY/i",") GROUP BY",$new_query);
+                } elseif (eregi("order by",$new_query)) {
+                    $new_query=preg_replace("/ORDER[\s]+BY/i",") ORDER BY",$new_query);
+                } elseif (eregi("limit",$new_query)) {
+                    $new_query=preg_replace("/LIMIT/i",") LIMIT",$new_query);
+                } else {                    
+                    $new_query.=")";
+                }
+            } else {
+                // nie ma WHERE
+                $new_query=preg_replace("/ FROM[\s]+([a-zA-Z0-9_]+)[\s]+/i"," FROM \$1 WHERE id_shop=$config->id_shop ",$query);
+            }
+            return $new_query;
+        } // end _soteMultiSelect()
+        
+        /**
+        * Zmieñ instrukcjê INSERT
+        *
+        * @param string $query instrukcja dodania SQL INSERT ...        
+        *
+        * @access private
+        * @return string zmodyfikowane instrukcja dodania SQL
+        */
+        function _soteMultiInsert($query) {
+            global $config;                        
+            $new_query=preg_replace("/^INSERT[\s]+INTO[\s]+([a-zA-Z0-9_]+)[\s]+\(/","INSERT INTO \$1 (id_shop,",$query);            
+            $new_query=preg_replace("/ VALUES[\s]+\(/"," VALUES ('$config->id_shop',",$new_query);
+            return $new_query;
+        } // end soteMultiInsert()
+        
+        /**
+        * Wy³±cz modyfikowanie SQL
+        */
+        function soteSetModSQLOff() {
+            $this->_soteSetMod=0;
+            return;
+        }
+        
+        /**
+        * W³±cz modyfikowanie SQL
+        */
+        function soteSetModSQLOn() {
+            $this->_soteSetMod=1;
+            return;
+        }
+        
+
+        Function Query($query)
+        {
+            
+            $this->Debug("Query: $query");
+            $first=$this->first_selected_row;
+            $limit=$this->selected_row_limit;
+            $this->first_selected_row=$this->selected_row_limit=0;
+            if(!strcmp($this->database_name,""))
+            return($this->SetError("Query","it was not specified a valid database name to select"));
+            if(!$this->Connect())
+            return(0);
+            if(($select=(substr(strtolower(ltrim($query)),0,strlen("select"))=="select"))
+            && $limit>0)
+            $query.=" LIMIT $first,$limit";
+
+            //
+            global $config,$_SESSION;
+            //print "before $query<br />";
+            if ((@$config->id_shop>0) && (empty($_SESSION['multi_shop']))) {
+                if ($this->_soteSetMod) {
+                    $query=$this->_soteMultiSQL($query);
+                }
+            }
+            //print "+after $query<br />";
+            if ((! eregi("^select",$query)) && ($this->demo=="yes")) {
+                return 1;
+            }
+            // end SOTE
+
+            if(mysql_select_db($this->database_name,$this->connection)
+            && ($result=@mysql_query($query,$this->connection)))
+            {
+                if($select)
+                $this->highest_fetched_row[$result]=-1;
+                else
+                $this->affected_rows=mysql_affected_rows($this->connection);
+            }
+            else
+            return($this->SetError("Query",mysql_error($this->connection)));
+            return($result);
+        }
+
+        Function Replace($table,&$fields)
+        {
+            $count=count($fields);
+            for($keys=0,$query=$values="",Reset($fields),$field=0;$field<$count;Next($fields),$field++)
+            {
+                $name=Key($fields);
+                if($field>0)
+                {
+                    $query.=",";
+                    $values.=",";
+                }
+                $query.=$name;
+                if(IsSet($fields[$name]["Null"])
+                && $fields[$name]["Null"])
+                $value="NULL";
+                else
+                {
+                    if(!IsSet($fields[$name]["Value"]))
+                    return($this->SetError("Replace","it was not specified a value for the $name field"));
+                    switch(IsSet($fields[$name]["Type"]) ? $fields[$name]["Type"] : "text")
+                    {
+                        case "text":
+                        $value=$this->GetTextFieldValue($fields[$name]["Value"]);
+                        break;
+                        case "boolean":
+                        $value=$this->GetBooleanFieldValue($fields[$name]["Value"]);
+                        break;
+                        case "integer":
+                        $value=strval($fields[$name]["Value"]);
+                        break;
+                        case "decimal":
+                        $value=$this->GetDecimalFieldValue($fields[$name]["Value"]);
+                        break;
+                        case "float":
+                        $value=$this->GetFloatFieldValue($fields[$name]["Value"]);
+                        break;
+                        case "date":
+                        $value=$this->GetDateFieldValue($fields[$name]["Value"]);
+                        break;
+                        case "time":
+                        $value=$this->GetTimeFieldValue($fields[$name]["Value"]);
+                        break;
+                        case "timestamp":
+                        $value=$this->GetTimestampFieldValue($fields[$name]["Value"]);
+                        break;
+                        default:
+                        return($this->SetError("Replace","it was not specified a supported type for the $name field"));
+                    }
+                }
+                $values.=$value;
+                if(IsSet($fields[$name]["Key"])
+                && $fields[$name]["Key"])
+                {
+                    if($value=="NULL")
+                    return($this->SetError("Replace","key values may not be NULL"));
+                    $keys++;
+                }
+            }
+            if($keys==0)
+            return($this->SetError("Replace","it were not specified which fields are keys"));
+            return($this->Query("REPLACE INTO $table ($query) VALUES($values)"));
+        }
+
+        Function EndOfResult($result)
+        {
+            if(!IsSet($this->highest_fetched_row[$result]))
+            {
+                $this->SetError("End of result","attempted to check the end of an unknown result");
+                return(-1);
+            }
+            return($this->highest_fetched_row[$result]>=$this->NumberOfRows($result)-1);
+        }
+
+        Function FetchResult($result,$row,$field)
+        {
+            @$this->highest_fetched_row[$result]=max($this->highest_fetched_row[$result],$row);
+            return(@mysql_result($result,$row,$field));
+        }
+
+        Function FetchResultArray($result,&$array,$row)
+        {
+            if(!mysql_data_seek($result,$row)
+            || !($array=mysql_fetch_row($result)))
+            return($this->SetError("Fetch result array",mysql_error($this->connection)));
+            $this->highest_fetched_row[$result]=max($this->highest_fetched_row[$result],$row);
+            return($this->ConvertResultRow($result,$array));
+        }
+
+        Function FetchCLOBResult($result,$row,$field)
+        {
+            return($this->FetchLOBResult($result,$row,$field));
+        }
+
+        Function FetchBLOBResult($result,$row,$field)
+        {
+            return($this->FetchLOBResult($result,$row,$field));
+        }
+
+        Function ConvertResult(&$value,$type)
+        {
+            switch($type)
+            {
+                case METABASE_TYPE_BOOLEAN:
+                $value=(strcmp($value,"Y") ? 0 : 1);
+                return(1);
+                case METABASE_TYPE_DECIMAL:
+                $value=sprintf("%.".$this->decimal_places."f",doubleval($value)/$this->decimal_factor);
+                return(1);
+                case METABASE_TYPE_FLOAT:
+                $value=doubleval($value);
+                return(1);
+                case METABASE_TYPE_DATE:
+                case METABASE_TYPE_TIME:
+                case METABASE_TYPE_TIMESTAMP:
+                return(1);
+                default:
+                return($this->BaseConvertResult($value,$type));
+            }
+        }
+
+        Function NumberOfRows($result)
+        {
+            return(mysql_num_rows($result));
+        }
+
+        Function FreeResult($result)
+        {
+            UnSet($this->highest_fetched_row[$result]);
+            UnSet($this->columns[$result]);
+            UnSet($this->result_types[$result]);
+            return(mysql_free_result($result));
+        }
+
+        Function CreateDatabase($name)
+        {
+            if(!$this->Connect())
+            return(0);
+            if(!mysql_create_db($name,$this->connection))
+            return($this->SetError("Create database",mysql_error($this->connection)));
+            return(1);
+        }
+
+        Function DropDatabase($name)
+        {
+            if(!$this->Connect())
+            return(0);
+            if(!mysql_drop_db($name,$this->connection))
+            return($this->SetError("Drop database",mysql_error($this->connection)));
+            return(1);
+        }
+
+        Function GetCLOBFieldTypeDeclaration($name,&$field)
+        {
+            if(IsSet($field["length"]))
+            {
+                $length=$field["length"];
+                if($length<=255)
+                $type="TINYTEXT";
+                else
+                {
+                    if($length<=65535)
+                    $type="TEXT";
+                    else
+                    {
+                        if($length<=16777215)
+                        $type="MEDIUMTEXT";
+                        else
+                        $type="LONGTEXT";
+                    }
+                }
+            }
+            else
+            $type="LONGTEXT";
+            return("$name $type".(IsSet($field["notnull"]) ? " NOT NULL" : ""));
+        }
+
+        Function GetBLOBFieldTypeDeclaration($name,&$field)
+        {
+            if(IsSet($field["length"]))
+            {
+                $length=$field["length"];
+                if($length<=255)
+                $type="TINYBLOB";
+                else
+                {
+                    if($length<=65535)
+                    $type="BLOB";
+                    else
+                    {
+                        if($length<=16777215)
+                        $type="MEDIUMBLOB";
+                        else
+                        $type="LONGBLOB";
+                    }
+                }
+            }
+            else
+            $type="LONGBLOB";
+            return("$name $type".(IsSet($field["notnull"]) ? " NOT NULL" : ""));
+        }
+
+        Function GetIntegerFieldTypeDeclaration($name,&$field)
+        {
+            return("$name ".(IsSet($field["unsigned"]) ? "INT UNSIGNED" : "INT").(IsSet($field["default"]) ? " DEFAULT ".$field["default"] : "").(IsSet($field["notnull"]) ? " NOT NULL" : ""));
+        }
+
+        Function GetDateFieldTypeDeclaration($name,&$field)
+        {
+            return($name." DATE".(IsSet($field["default"]) ? " DEFAULT '".$field["default"]."'" : "").(IsSet($field["notnull"]) ? " NOT NULL" : ""));
+        }
+
+        Function GetTimestampFieldTypeDeclaration($name,&$field)
+        {
+            return($name." DATETIME".(IsSet($field["default"]) ? " DEFAULT '".$field["default"]."'" : "").(IsSet($field["notnull"]) ? " NOT NULL" : ""));
+        }
+
+        Function GetTimeFieldTypeDeclaration($name,&$field)
+        {
+            return($name." TIME".(IsSet($field["default"]) ? " DEFAULT '".$field["default"]."'" : "").(IsSet($field["notnull"]) ? " NOT NULL" : ""));
+        }
+
+        Function GetFloatFieldTypeDeclaration($name,&$field)
+        {
+            if(IsSet($this->options["FixedFloat"]))
+            $this->fixed_float=$this->options["FixedFloat"];
+            else
+            {
+                if($this->connection==0)
+                $this->Connect();
+            }
+            return("$name DOUBLE".($this->fixed_float ? "(".($this->fixed_float+2).",".$this->fixed_float.")" : "").(IsSet($field["default"]) ? " DEFAULT ".$this->GetFloatFieldValue($field["default"]) : "").(IsSet($field["notnull"]) ? " NOT NULL" : ""));
+        }
+
+        Function GetDecimalFieldTypeDeclaration($name,&$field)
+        {
+            return("$name BIGINT".(IsSet($field["default"]) ? " DEFAULT ".$this->GetDecimalFieldValue($field["default"]) : "").(IsSet($field["notnull"]) ? " NOT NULL" : ""));
+        }
+
+        Function GetCLOBFieldValue($prepared_query,$parameter,$clob,&$value)
+        {
+            for($value="'";!MetabaseEndOfLOB($clob);)
+            {
+                if(MetabaseReadLOB($clob,$data,$this->lob_buffer_length)<0)
+                {
+                    $value="";
+                    return($this->SetError("Get CLOB field value",MetabaseLOBError($clob)));
+                }
+                $this->EscapeText($data);
+                $value.=$data;
+            }
+            $value.="'";
+            return(1);
+        }
+
+        Function FreeCLOBValue($prepared_query,$clob,&$value,$success)
+        {
+            Unset($value);
+        }
+
+        Function GetBLOBFieldValue($prepared_query,$parameter,$blob,&$value)
+        {
+            for($value="'";!MetabaseEndOfLOB($blob);)
+            {
+                if(!MetabaseReadLOB($blob,$data,$this->lob_buffer_length))
+                {
+                    $value="";
+                    return($this->SetError("Get BLOB field value",MetabaseLOBError($clob)));
+                }
+                $value.=AddSlashes($data);
+            }
+            $value.="'";
+            return(1);
+        }
+
+        Function FreeBLOBValue($prepared_query,$blob,&$value,$success)
+        {
+            Unset($value);
+        }
+
+        Function GetFloatFieldValue($value)
+        {
+            return(!strcmp($value,"NULL") ? "NULL" : "$value");
+        }
+
+        Function GetDecimalFieldValue($value)
+        {
+            return(!strcmp($value,"NULL") ? "NULL" : strval(round(doubleval($value)*$this->decimal_factor)));
+        }
+
+        Function GetColumnNames($result,&$column_names)
+        {
+            $result_value=intval($result);
+            if(!IsSet($this->highest_fetched_row[$result_value]))
+            return($this->SetError("Get column names","it was specified an inexisting result set"));
+            if(!IsSet($this->columns[$result_value]))
+            {
+                $this->columns[$result_value]=array();
+                $columns=mysql_num_fields($result);
+                for($column=0;$column<$columns;$column++)
+                $this->columns[$result_value][strtolower(mysql_field_name($result,$column))]=$column;
+            }
+            $column_names=$this->columns[$result_value];
+            return(1);
+        }
+
+        Function NumberOfColumns($result)
+        {
+            if(!IsSet($this->highest_fetched_row[intval($result)]))
+            {
+                $this->SetError("Get column names","it was specified an inexisting result set");
+                return(-1);
+            }
+            return(mysql_num_fields($result));
+        }
+
+        Function CreateTable($name,&$fields)
+        {
+            if(!IsSet($name)
+            || !strcmp($name,""))
+            return($this->SetError("Create table","it was not specified a valid table name"));
+            if(count($fields)==0)
+            return($this->SetError("Create table","it were not specified any fields for table \"$name\""));
+            $query_fields="";
+            if(!$this->GetFieldList($fields,$query_fields))
+            return(0);
+            if(IsSet($this->supported["Transactions"]))
+            $query_fields.=", dummy_primary_key INT NOT NULL AUTO_INCREMENT, PRIMARY KEY (dummy_primary_key)";
+            return($this->Query("CREATE TABLE $name ($query_fields)".(IsSet($this->supported["Transactions"]) ? " TYPE=BDB" : "")));
+        }
+
+        Function AlterTable($name,&$changes,$check)
+        {
+            if($check)
+            {
+                for($change=0,Reset($changes);$change<count($changes);Next($changes),$change++)
+                {
+                    switch(Key($changes))
+                    {
+                        case "AddedFields":
+                        case "RemovedFields":
+                        case "ChangedFields":
+                        case "RenamedFields":
+                        case "name":
+                        break;
+                        default:
+                        return($this->SetError("Alter table","change type \"".Key($changes)."\" not yet supported"));
+                    }
+                }
+                return(1);
+            }
+            else
+            {
+                $query=(IsSet($changes["name"]) ? "RENAME AS ".$changes["name"] : "");
+                if(IsSet($changes["AddedFields"]))
+                {
+                    $fields=$changes["AddedFields"];
+                    for($field=0,Reset($fields);$field<count($fields);Next($fields),$field++)
+                    {
+                        if(strcmp($query,""))
+                        $query.=", ";
+                        $query.="ADD ".$fields[Key($fields)]["Declaration"];
+                    }
+                }
+                if(IsSet($changes["RemovedFields"]))
+                {
+                    $fields=$changes["RemovedFields"];
+                    for($field=0,Reset($fields);$field<count($fields);Next($fields),$field++)
+                    {
+                        if(strcmp($query,""))
+                        $query.=", ";
+                        $query.="DROP ".Key($fields);
+                    }
+                }
+                $renamed_fields=array();
+                if(IsSet($changes["RenamedFields"]))
+                {
+                    $fields=$changes["RenamedFields"];
+                    for($field=0,Reset($fields);$field<count($fields);Next($fields),$field++)
+                    $renamed_fields[$fields[Key($fields)]["name"]]=Key($fields);
+                }
+                if(IsSet($changes["ChangedFields"]))
+                {
+                    $fields=$changes["ChangedFields"];
+                    for($field=0,Reset($fields);$field<count($fields);Next($fields),$field++)
+                    {
+                        if(strcmp($query,""))
+                        $query.=", ";
+                        if(IsSet($renamed_fields[Key($fields)]))
+                        {
+                            $field_name=$renamed_fields[Key($fields)];
+                            UnSet($renamed_fields[Key($fields)]);
+                        }
+                        else
+                        $field_name=Key($fields);
+                        $query.="CHANGE $field_name ".$fields[Key($fields)]["Declaration"];
+                    }
+                }
+                if(count($renamed_fields))
+                {
+                    for($field=0,Reset($renamed_fields);$field<count($renamed_fields);Next($renamed_fields),$field++)
+                    {
+                        if(strcmp($query,""))
+                        $query.=", ";
+                        $old_field_name=$renamed_fields[Key($renamed_fields)];
+                        $query.="CHANGE $old_field_name ".$changes["RenamedFields"][$old_field_name]["Declaration"];
+                    }
+                }
+                return($this->Query("ALTER TABLE $name $query"));
+            }
+        }
+
+        Function CreateSequence($name,$start)
+        {
+            if(!$this->Query("CREATE TABLE _sequence_$name (sequence INT DEFAULT 0 NOT NULL AUTO_INCREMENT, PRIMARY KEY (sequence))"))
+            return(0);
+            if($start==1
+            || $this->Query("INSERT INTO _sequence_$name (sequence) VALUES (".($start-1).")"))
+            return(1);
+            $error=$this->Error();
+            if(!$this->Query("DROP TABLE _sequence_$name"))
+            $this->warning="could not drop inconsistent sequence table";
+            return($this->SetError("Create sequence",$error));
+        }
+
+        Function DropSequence($name)
+        {
+            return($this->Query("DROP TABLE _sequence_$name"));
+        }
+
+        Function GetSequenceNextValue($name,&$value)
+        {
+            if(!$this->Query("INSERT INTO _sequence_$name (sequence) VALUES (NULL)"))
+            return(0);
+            $value=intval(mysql_insert_id());
+            if(!$this->Query("DELETE FROM _sequence_$name WHERE sequence<$value"))
+            $this->warning="could delete previous sequence table values";
+            return(1);
+        }
+
+        Function GetSequenceCurrentValue($name,&$value)
+        {
+            if(($result=$this->Query("SELECT MAX(sequence) FROM _sequence_$name"))==0)
+            return(0);
+            $value=intval($this->FetchResult($result,0,0));
+            $this->FreeResult($result);
+            return(1);
+        }
+
+        Function CreateIndex($table,$name,$definition)
+        {
+            $query="ALTER TABLE $table ADD ".(IsSet($definition["unique"]) ? "UNIQUE" : "INDEX")." $name (";
+            for($field=0,Reset($definition["FIELDS"]);$field<count($definition["FIELDS"]);$field++,Next($definition["FIELDS"]))
+            {
+                if($field>0)
+                $query.=",";
+                $query.=Key($definition["FIELDS"]);
+            }
+            $query.=")";
+            return($this->Query($query));
+        }
+
+        Function DropIndex($table,$name)
+        {
+            return($this->Query("ALTER TABLE $table DROP INDEX $name"));
+        }
+
+        Function AutoCommitTransactions($auto_commit)
+        {
+            $this->Debug("AutoCommit: ".($auto_commit ? "On" : "Off"));
+            if(!IsSet($this->supported["Transactions"]))
+            return($this->SetError("Auto-commit transactions","transactions are not in use"));
+            if(((!$this->auto_commit)==(!$auto_commit)))
+            return(1);
+            if($this->connection)
+            {
+                if($auto_commit)
+                {
+                    if(!$this->Query("COMMIT")
+                    || !$this->Query("SET AUTOCOMMIT=1"))
+                    return(0);
+                }
+                else
+                {
+                    if(!$this->Query("SET AUTOCOMMIT=0"))
+                    return(0);
+                }
+            }
+            $this->auto_commit=$auto_commit;
+            return($this->RegisterTransactionShutdown($auto_commit));
+        }
+
+        Function CommitTransaction()
+        {
+            $this->Debug("Commit Transaction");
+            if(!IsSet($this->supported["Transactions"]))
+            return($this->SetError("Commit transaction","transactions are not in use"));
+            if($this->auto_commit)
+            return($this->SetError("Commit transaction","transaction changes are being auto commited"));
+            return($this->Query("COMMIT"));
+        }
+
+        Function RollbackTransaction()
+        {
+            $this->Debug("Rollback Transaction");
+            if(!IsSet($this->supported["Transactions"]))
+            return($this->SetError("Rollback transaction","transactions are not in use"));
+            if($this->auto_commit)
+            return($this->SetError("Rollback transaction","transactions can not be rolled back when changes are auto commited"));
+            return($this->Query("ROLLBACK"));
+        }
+
+        Function Setup()
+        {
+            $this->supported["Sequences"]=
+            $this->supported["Indexes"]=
+            $this->supported["AffectedRows"]=
+            $this->supported["SummaryFunctions"]=
+            $this->supported["OrderByText"]=
+            $this->supported["GetSequenceCurrentValue"]=
+            $this->supported["SelectRowRanges"]=
+            $this->supported["LOBs"]=
+            $this->supported["Replace"]=
+            1;
+            if(IsSet($this->options["UseTransactions"])
+            && $this->options["UseTransactions"])
+            $this->supported["Transactions"]=1;
+            $this->decimal_factor=pow(10.0,$this->decimal_places);
+            return("");
+        }
+    };
+
+}
+?>
diff -ruN ../soteesklep3/sql/upgrade_12.sql soteesklep3/sql/upgrade_12.sql
--- ../soteesklep3/sql/upgrade_12.sql	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/sql/upgrade_12.sql	2006-07-05 12:46:58.000000000 +0200
@@ -0,0 +1,6 @@
+ALTER TABLE allpay_trans ADD COLUMN md5_req varchar(255) default NULL;
+ALTER TABLE allpay_trans ADD COLUMN order_id varchar(255) default NULL;
+ALTER TABLE allpay_trans ADD COLUMN remote_addres varchar(255) default NULL;
+ALTER TABLE allpay_trans ADD COLUMN date_time timestamp NOT NULL default
+CURRENT_TIMESTAMP;
+ALTER TABLE allpay_trans DROP INDEX t_id;
diff -ruN ../soteesklep3/VERSION soteesklep3/VERSION
--- ../soteesklep3/VERSION	1970-01-01 01:00:00.000000000 +0100
+++ soteesklep3/VERSION	2006-07-11 14:13:37.000000000 +0200
@@ -0,0 +1 @@
+3.5RC12
